# 🎯 生产环境正式启用指南

**日期**: 2025-11-01  
**目的**: 清除测试数据，开始真实业务使用

---

## 📋 当前状态

### 系统部署状态
- ✅ **前端**: Vercel 部署成功
- ✅ **后端**: Render 部署成功
- ✅ **Cookie 跨域**: 已修复
- ✅ **登录功能**: 正常工作
- ✅ **实时统计**: 已启用

### 数据库状态
- ⚠️ **包含测试数据**: 9 个测试账号、示例订单等
- ⚠️ **需要清理**: 准备真实使用

---

## ⚡ 生产环境初始化（3 步）

### 第 1 步：在 Render Shell 初始化生产环境

**操作步骤**:

1. **访问 Render Dashboard**  
   https://dashboard.render.com

2. **进入服务**: 项目方舟 → **Shell** 标签

3. **执行初始化命令**:
   ```bash
   npm run init:production
   ```

4. **确认操作**:
   - 输入 `YES` 确认清空数据库
   
5. **选择管理员配置**:
   
   **选项 A**: 如果已有管理员账号（phone: 13000000001）
   - 询问是否重置密码
   - 输入 `y` 重置为 `admin123`
   - 或输入 `n` 保持现有密码
   
   **选项 B**: 如果需要创建新管理员
   - 输入手机号（11位）
   - 输入姓名
   - 自动创建，密码为 `admin123`

6. **等待完成**（约 1 分钟）

**完成后会显示**:
```
✅ 数据清理完成
✅ 管理员账号创建成功

📊 当前数据库状态：
   管理员账号数: 1
   用户总数: 1
   产品数据: 0 个（等待导入）
   供应商: 0 家（等待创建）
   项目: 0 个（等待创建）

📋 下一步操作：
   1. 使用管理员账号登录系统
   2. 首次登录强制修改密码
   3. 访问"用户管理"创建员工账号
   4. 访问"产品批量导入"导入产品数据
   5. 访问"数据管理"创建供应商
   6. 开始正常业务流程

✨ 系统已准备就绪，可以开始使用！
```

---

### 第 2 步：首次登录并修改密码

1. **访问系统**:  
   https://project-ark-one.vercel.app/login

2. **使用管理员账号登录**:
   ```
   手机号: 您设置的手机号（或 13000000001）
   密码: admin123
   ```

3. **强制修改密码**:
   - 系统会自动跳转到修改密码页面
   - 输入当前密码: `admin123`
   - 输入新密码（至少 6 位）
   - 确认新密码
   - 保存

4. **修改成功后**:
   - 自动跳转到仪表盘
   - 以后使用新密码登录

---

### 第 3 步：创建真实用户账号

**在管理员界面**:

1. **访问"用户管理"** （左侧菜单）

2. **点击"+ 新增"**

3. **填写员工信息**:
   ```
   手机号: 员工的真实手机号
   姓名: 员工真实姓名
   密码: 为员工设置初始密码
   角色: 选择合适的角色
   部门: 填写部门名称
   ```

4. **保存**

5. **通知员工**:
   - 告知手机号和初始密码
   - 首次登录需要修改密码

**重复此过程**，创建所有需要的员工账号。

---

## 👥 角色说明

### 系统支持的角色（9 种）

| 角色英文 | 角色中文 | 主要职责 |
|---------|----------|----------|
| Administrator | 系统管理员 | 系统配置、用户管理、数据管理 |
| Sales Manager | 销售经理 | 订单审批、业绩查看、销售管理 |
| Technical Engineer | 技术工程师 | 技术选型、售后服务、技术支持 |
| Business Engineer | 商务工程师 | 项目跟进、合同管理、客户沟通 |
| Procurement Specialist | 采购专员 | 采购管理、供应商管理、询价比价 |
| Production Planner | 生产计划员 | 生产排程、物料需求、计划调度 |
| QA Inspector | 质检员 | 质量检验、质检记录、不合格处理 |
| Logistics Specialist | 物流专员 | 配送管理、发货跟踪、物流协调 |
| Shop Floor Worker | 车间工人 | 生产执行、工序报工、设备操作 |

**注意**: 已移除"售后工程师"角色，售后由技术工程师负责。

---

## 📦 导入产品数据

### 方法 1: 使用产品批量导入功能（推荐）

**在管理员界面**:

1. **访问"产品批量导入"** （左侧菜单）

2. **下载模板**:
   - 点击"下载模板"按钮
   - 获取 Excel 模板

3. **填写产品数据**:
   - 在模板中填写产品信息
   - 型号、规格、价格、库存等

4. **上传文件**:
   - 点击"批量导入"
   - 选择填好的 Excel 文件
   - 上传

5. **等待导入完成**:
   - 系统会显示导入进度
   - 完成后显示成功数量

### 方法 2: 使用系统自带的产品数据（测试用）

**如果只是想快速测试功能**:

在 Render Shell 中运行：
```bash
# 只导入产品数据，不创建测试用户和订单
node -e "
require('dotenv').config();
const mongoose = require('mongoose');
const fs = require('fs');
const csv = require('csv-parser');
const Actuator = require('./models/Actuator');

async function importProducts() {
  await mongoose.connect(process.env.MONGODB_URI);
  const products = [];
  
  fs.createReadStream('./data/Actuators.csv')
    .pipe(csv())
    .on('data', (row) => products.push(row))
    .on('end', async () => {
      await Actuator.create(products);
      console.log('✅ 导入', products.length, '个产品');
      process.exit(0);
    });
}

importProducts();
"
```

**但推荐使用方法 1**，这样可以导入您的真实产品数据。

---

## 🏢 系统使用流程

### 管理员的日常工作

1. **用户管理**
   - 创建员工账号
   - 分配角色和权限
   - 管理账号状态

2. **数据管理**
   - 导入产品数据
   - 创建供应商
   - 维护基础数据

3. **系统监控**
   - 查看系统报表
   - 监控业务数据
   - 审查异常情况

### 各角色的工作流程

**销售经理**:
1. 查看销售订单
2. 审批报价
3. 跟踪项目进度

**技术工程师**:
1. 执行技术选型
2. 处理技术咨询
3. 解决售后问题

**商务工程师**:
1. 跟进客户项目
2. 管理合同签订
3. 协调内部资源

**采购专员**:
1. 创建采购订单
2. 管理供应商
3. 跟踪采购进度

**生产计划员**:
1. 制定生产计划
2. 管理物料需求
3. 协调生产资源

**质检员**:
1. 执行质量检验
2. 记录质检结果
3. 处理不合格品

**物流专员**:
1. 管理配送任务
2. 跟踪物流状态
3. 确认收货

**车间工人**:
1. 查看生产任务
2. 报工进度
3. 扫码操作

---

## 📊 数据统计说明

### 实时统计

**系统报表中的所有统计都是实时的**:

- **用户统计**: 从数据库实时查询
- **产品统计**: 从产品表实时统计
- **项目统计**: 从项目表实时统计
- **订单统计**: 从订单表实时统计

**特性**:
- ✅ 删除用户后，统计立即减少
- ✅ 创建产品后，统计立即增加
- ✅ 无需手动刷新
- ✅ 准确反映当前状态

---

## 🔒 安全建议

### 管理员账号安全

1. **强密码策略**
   - 使用复杂密码（字母+数字+符号）
   - 定期更换密码
   - 不要使用默认密码

2. **账号保护**
   - 不要与他人共享管理员账号
   - 记录登录日志
   - 定期审查用户列表

3. **权限管理**
   - 按需分配角色
   - 最小权限原则
   - 及时删除离职员工账号

---

## 📝 操作检查清单

### 生产环境启用清单

- [ ] 1. 在 Render Shell 运行 `npm run init:production`
- [ ] 2. 确认只有 1 个管理员账号
- [ ] 3. 首次登录并修改密码
- [ ] 4. 创建员工账号（根据实际需要）
- [ ] 5. 导入产品数据（真实数据）
- [ ] 6. 创建供应商信息
- [ ] 7. 测试各个模块功能
- [ ] 8. 确认统计数据正确
- [ ] 9. 告知员工登录方式
- [ ] 10. 开始正常业务

---

## 🎯 快速开始

### 立即执行的 3 个命令

**在 Render Shell 中**:

```bash
# 1. 初始化生产环境（清除测试数据，创建管理员）
npm run init:production

# 按提示操作：
#   - 输入 YES 确认
#   - 选择管理员配置选项
#   - 完成！
```

**然后**:

1. 登录系统（管理员账号）
2. 修改密码
3. 创建员工账号
4. 导入产品数据
5. 开始使用！

---

## 📞 技术支持

### 如果遇到问题

**数据库相关**:
- 检查 Render 环境变量中的 `MONGODB_URI`
- 查看 Render Logs 中的错误信息
- 确保 MongoDB 服务正常

**登录相关**:
- Cookie 跨域已修复
- 所有角色都能正常登录
- 如遇 429 错误，等待 15 分钟

**功能相关**:
- 确保数据已初始化
- 查看浏览器控制台错误
- 检查 Network 请求状态

---

## ✨ 预期结果

### 初始化完成后

**数据库状态**:
```
用户: 1 个管理员
产品: 0 个（等待导入）
供应商: 0 家（等待创建）
项目: 0 个（等待创建）
订单: 0 个（等待创建）
```

**系统功能**:
- ✅ 登录正常
- ✅ 所有模块可访问
- ✅ 统计功能正常
- ✅ 可以创建真实数据
- ✅ 准备好投入使用

---

## 🚀 现在就开始

**第一步**:
```
访问: https://dashboard.render.com
进入: 项目方舟 → Shell
执行: npm run init:production
```

**第二步**:
```
访问: https://project-ark-one.vercel.app
登录: 管理员账号
密码: admin123（首次登录后修改）
```

**第三步**:
```
创建真实用户
导入真实数据
开始使用系统！
```

---

**🎉 祝您使用顺利！**

**详细操作**: 查看 `✅生产环境修复-最终总结.md`

