# 定价函数快速参考卡 🚀

## 核心函数

### calculatePrice(product, quantity)
计算产品单价

```javascript
const { calculatePrice } = require('./utils/pricing');

// 固定价格
const sfProduct = { pricing_model: 'fixed', base_price: 1200 };
const price1 = calculatePrice(sfProduct, 5);  // 返回: 1200

// 阶梯价格
const atProduct = {
  pricing_model: 'tiered',
  base_price: 2500,
  price_tiers: [
    { min_quantity: 1, unit_price: 2500 },
    { min_quantity: 10, unit_price: 2300 },
    { min_quantity: 50, unit_price: 2100 }
  ]
};
const price2 = calculatePrice(atProduct, 15);  // 返回: 2300
```

---

### getProductPriceInfo(product, quantity)
获取详细价格信息

```javascript
const { getProductPriceInfo } = require('./utils/pricing');

const priceInfo = getProductPriceInfo(atProduct, 15);
// 返回: {
//   unit_price: 2300,
//   total_price: 34500,
//   applied_tier: { ... },
//   savings: { amount: 3000, rate: 8.0 },
//   next_tier: { ... }
// }
```

---

## 快速使用

### API 路由
```javascript
router.get('/products/:id/price', async (req, res) => {
  const product = await Product.findById(req.params.id);
  const unitPrice = calculatePrice(product, req.query.quantity);
  res.json({ unit_price: unitPrice });
});
```

### 选型算法
```javascript
const unitPrice = calculatePrice(candidate, quantity);
const score = evaluateCandidate(candidate, unitPrice);
```

### 批量计算
```javascript
const items = [
  { product: product1, quantity: 5 },
  { product: product2, quantity: 10 }
];
const result = calculateBulkPrice(items);
```

---

## 定价模式

| 模式 | 值 | 说明 |
|------|-----|------|
| 固定价格 | `'fixed'` | 价格不变 |
| 阶梯价格 | `'tiered'` | 数量越多价格越低 |

---

## 返回值

### calculatePrice
- **新方式**: `Number` (单价)
- **旧方式**: `Object` (详细信息)

### getProductPriceInfo
- **返回**: `Object` (包含所有价格信息)

---

## 测试命令

```bash
cd backend
node test-pricing-upgrade.js
```

---

## 文档

- 📖 详细指南: `定价函数升级使用指南.md`
- 📋 完成报告: `定价函数升级完成报告.md`
- 🧪 测试脚本: `backend/test-pricing-upgrade.js`

---

**版本**: v2.0.0  
**更新**: 2025-10-28

