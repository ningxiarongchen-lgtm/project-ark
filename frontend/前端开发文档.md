# C-MAX 前端开发文档

## 📋 目录
1. [项目概述](#项目概述)
2. [技术栈](#技术栈)
3. [项目结构](#项目结构)
4. [核心功能](#核心功能)
5. [路由配置](#路由配置)
6. [API集成](#api集成)
7. [状态管理](#状态管理)
8. [快速开始](#快速开始)

---

## 📌 项目概述

**项目名称**: C-MAX SF系列气动执行器选型系统（前端）  
**版本**: 2.0.0  
**技术**: React 18 + Vite 5 + Ant Design 5  
**语言**: JavaScript (ES6+)

### 核心功能
- ✅ 用户认证与授权
- ✅ 基于角色的访问控制（RBAC）
- ✅ 智能执行器选型
- ✅ 项目管理
- ✅ 报价管理
- ✅ 产品管理
- ✅ 系统管理（管理员）

---

## 🛠 技术栈

### 核心框架
| 技术 | 版本 | 用途 |
|------|------|------|
| React | ^18.2.0 | UI框架 |
| React Router | ^6.18.0 | 路由管理 |
| Vite | ^5.0.0 | 构建工具 |

### UI组件
| 技术 | 版本 | 用途 |
|------|------|------|
| Ant Design | ^5.11.0 | UI组件库 |
| @ant-design/icons | ^5.2.6 | 图标库 |

### 数据管理
| 技术 | 版本 | 用途 |
|------|------|------|
| Axios | ^1.6.0 | HTTP客户端 |
| Zustand | ^4.4.6 | 状态管理 |
| dayjs | ^1.11.10 | 日期处理 |

### 其他工具
| 技术 | 版本 | 用途 |
|------|------|------|
| jsPDF | ^2.5.1 | PDF生成 |
| jsPDF-AutoTable | ^3.8.0 | PDF表格 |

---

## 📂 项目结构

```
frontend/
├── public/                 # 静态资源
├── src/
│   ├── components/        # 可复用组件
│   │   └── Layout/       # 布局组件
│   │       └── MainLayout.jsx  # 主布局（侧边栏+顶栏）
│   ├── pages/            # 页面组件
│   │   ├── Login.jsx           # 登录页
│   │   ├── Dashboard.jsx       # 控制台
│   │   ├── SelectionEngine.jsx # 智能选型
│   │   ├── Projects.jsx        # 项目列表
│   │   ├── ProjectDetails.jsx  # 项目详情
│   │   ├── Quotes.jsx          # 报价列表
│   │   ├── QuoteDetails.jsx    # 报价详情
│   │   ├── Products.jsx        # 产品管理
│   │   ├── AdminPanel.jsx      # 系统管理
│   │   ├── Profile.jsx         # 个人资料
│   │   └── NotFound.jsx        # 404页面
│   ├── services/         # API服务
│   │   └── api.js              # API调用封装
│   ├── store/            # 状态管理
│   │   └── authStore.js        # 认证状态
│   ├── utils/            # 工具函数
│   │   └── pdfGenerator.js     # PDF生成工具
│   ├── App.jsx           # 根组件（路由配置）
│   ├── main.jsx          # 入口文件
│   └── index.css         # 全局样式
├── .env                  # 环境变量
├── index.html            # HTML模板
├── package.json          # 依赖配置
└── vite.config.js        # Vite配置
```

---

## 🔐 核心功能

### 1. 认证与授权

#### 1.1 认证流程
```javascript
// 登录
import { authAPI } from './services/api'
import { useAuthStore } from './store/authStore'

const login = async (email, password) => {
  const response = await authAPI.login({ email, password })
  const { token, user } = response.data
  useAuthStore.getState().login(user, token)
}
```

#### 1.2 角色类型
- **Administrator（管理员）**: 全部权限
- **Engineer（工程师）**: 选型、项目管理
- **Sales Manager（销售经理）**: 报价、项目查看

#### 1.3 路由保护
```jsx
<ProtectedRoute requiredRole="Administrator">
  <AdminPanel />
</ProtectedRoute>

<ProtectedRoute requiredRoles={['Engineer', 'Sales Manager']}>
  <SelectionEngine />
</ProtectedRoute>
```

### 2. 布局系统

#### 2.1 MainLayout 组件
**特性**:
- ✅ 可折叠侧边栏
- ✅ 响应式设计
- ✅ 动态菜单（基于角色）
- ✅ 用户信息下拉菜单
- ✅ 中文界面

**组件结构**:
```jsx
<Layout>
  <Sider collapsible>
    {/* Logo */}
    {/* 导航菜单 */}
  </Sider>
  <Layout>
    <Header>
      {/* 折叠按钮 */}
      {/* 标题 */}
      {/* 用户菜单 */}
    </Header>
    <Content>
      <Outlet /> {/* 子页面渲染 */}
    </Content>
  </Layout>
</Layout>
```

#### 2.2 菜单配置
```javascript
const menuItems = [
  { key: '/', icon: <DashboardOutlined />, label: '控制台' },
  { key: '/selection-engine', icon: <ToolOutlined />, label: '智能选型' },
  { key: '/projects', icon: <ProjectOutlined />, label: '项目管理' },
  { key: '/quotes', icon: <FileTextOutlined />, label: '报价管理' },
  { key: '/products', icon: <AppstoreOutlined />, label: '产品管理' },
  // 管理员专属
  ...(user?.role === 'Administrator' ? [
    { key: '/admin', icon: <SettingOutlined />, label: '系统管理' }
  ] : [])
]
```

---

## 🌐 路由配置

### 路由表

| 路径 | 组件 | 权限 | 说明 |
|------|------|------|------|
| `/login` | Login | 公开 | 登录页 |
| `/` | Dashboard | 登录用户 | 控制台 |
| `/selection-engine` | SelectionEngine | 登录用户 | 智能选型 |
| `/projects` | Projects | 登录用户 | 项目列表 |
| `/projects/:id` | ProjectDetails | 登录用户 | 项目详情 |
| `/quotes` | Quotes | 登录用户 | 报价列表 |
| `/quotes/:id` | QuoteDetails | 登录用户 | 报价详情 |
| `/products` | Products | 登录用户 | 产品管理 |
| `/admin` | AdminPanel | 管理员 | 系统管理 |
| `/profile` | Profile | 登录用户 | 个人资料 |
| `*` | NotFound | 所有 | 404页面 |

### 路由保护实现

```jsx
const ProtectedRoute = ({ children, requiredRole, requiredRoles }) => {
  const { user, isAuthenticated } = useAuthStore()

  // 检查是否登录
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />
  }

  // 单一角色验证
  if (requiredRole && user?.role !== requiredRole) {
    return <Navigate to="/" replace />
  }

  // 多角色验证
  if (requiredRoles && !requiredRoles.includes(user?.role)) {
    return <Navigate to="/" replace />
  }

  return children
}
```

---

## 🔌 API集成

### API服务封装

#### 基础配置
```javascript
// services/api.js
const API_URL = 'http://localhost:5001/api'

const api = axios.create({
  baseURL: API_URL,
  headers: { 'Content-Type': 'application/json' }
})
```

#### 请求拦截器（自动添加Token）
```javascript
api.interceptors.request.use(config => {
  const token = useAuthStore.getState().token
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

#### 响应拦截器（401自动登出）
```javascript
api.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      useAuthStore.getState().logout()
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)
```

### API模块

#### 1. 认证 API
```javascript
export const authAPI = {
  login: (credentials) => api.post('/auth/login', credentials),
  getProfile: () => api.get('/auth/me'),
  updateProfile: (data) => api.put('/auth/profile', data)
}
```

#### 2. 执行器 API
```javascript
export const actuatorsAPI = {
  getAll: (params) => api.get('/actuators', { params }),
  getById: (id) => api.get(`/actuators/${id}`),
  create: (data) => api.post('/actuators', data),
  update: (id, data) => api.put(`/actuators/${id}`, data),
  delete: (id) => api.delete(`/actuators/${id}`),
  findByTorque: (data) => api.post('/actuators/find-by-torque', data),
  uploadExcel: (file) => {
    const formData = new FormData()
    formData.append('file', file)
    return api.post('/actuators/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  },
  downloadTemplate: () => api.get('/actuators/template', { 
    responseType: 'blob' 
  })
}
```

#### 3. 手动操作装置 API
```javascript
export const manualOverridesAPI = {
  getAll: (params) => api.get('/manual-overrides', { params }),
  getById: (id) => api.get(`/manual-overrides/${id}`),
  create: (data) => api.post('/manual-overrides', data),
  update: (id, data) => api.put(`/manual-overrides/${id}`, data),
  delete: (id) => api.delete(`/manual-overrides/${id}`),
  findCompatible: (bodySize) => api.get(`/manual-overrides/compatible/${bodySize}`),
  uploadExcel: (file) => { /* ... */ },
  downloadTemplate: () => { /* ... */ }
}
```

#### 4. 智能选型 API
```javascript
export const selectionAPI = {
  calculate: (data) => api.post('/selection/calculate', data),
  recommend: (data) => api.post('/selection/recommend', data),
  batch: (data) => api.post('/selection/batch', data)
}
```

#### 5. 项目管理 API
```javascript
export const projectsAPI = {
  getAll: (params) => api.get('/new-projects', { params }),
  getById: (id) => api.get(`/new-projects/${id}`),
  create: (data) => api.post('/new-projects', data),
  update: (id, data) => api.put(`/new-projects/${id}`, data),
  delete: (id) => api.delete(`/new-projects/${id}`),
  autoSelect: (id, data) => api.post(`/new-projects/${id}/auto-select`, data),
  getStats: () => api.get('/new-projects/stats/summary')
}
```

### API使用示例

```jsx
import { useState, useEffect } from 'react'
import { actuatorsAPI } from '../services/api'
import { Table, message } from 'antd'

const ProductsList = () => {
  const [loading, setLoading] = useState(false)
  const [actuators, setActuators] = useState([])

  useEffect(() => {
    fetchActuators()
  }, [])

  const fetchActuators = async () => {
    try {
      setLoading(true)
      const response = await actuatorsAPI.getAll()
      setActuators(response.data)
    } catch (error) {
      message.error('获取执行器列表失败')
    } finally {
      setLoading(false)
    }
  }

  return (
    <Table 
      loading={loading}
      dataSource={actuators}
      columns={columns}
    />
  )
}
```

---

## 💾 状态管理

### Auth Store（认证状态）

#### 状态
```javascript
{
  user: null,           // 用户信息
  token: null,          // JWT Token
  isAuthenticated: false // 是否登录
}
```

#### Actions
```javascript
const store = useAuthStore()

// 登录
store.login(userData, token)

// 登出
store.logout()

// 更新用户
store.updateUser(newData)

// 角色检查
store.isAdmin()          // 是否是管理员
store.isEngineer()       // 是否是工程师
store.isSalesManager()   // 是否是销售经理
store.hasRole('Administrator')  // 检查特定角色
store.hasAnyRole(['Engineer', 'Sales Manager']) // 检查多角色

// 获取角色名
store.getRoleNameCN()    // 返回中文角色名
```

#### 持久化
使用 `zustand/middleware/persist` 自动保存到 `localStorage`:
```javascript
{
  name: 'auth-storage'  // LocalStorage key
}
```

#### 使用示例
```jsx
import { useAuthStore } from '../store/authStore'

const UserProfile = () => {
  const { user, isAdmin, getRoleNameCN } = useAuthStore()

  return (
    <div>
      <h1>{user.username}</h1>
      <p>角色: {getRoleNameCN()}</p>
      {isAdmin() && <Button>管理员功能</Button>}
    </div>
  )
}
```

---

## 🚀 快速开始

### 1. 安装依赖
```bash
cd frontend
npm install
```

### 2. 配置环境变量
创建 `.env` 文件：
```env
VITE_API_URL=http://localhost:5001/api
VITE_APP_NAME=C-MAX SF系列气动执行器选型系统
VITE_APP_VERSION=2.0.0
```

### 3. 启动开发服务器
```bash
npm run dev
```

访问: http://localhost:5173

### 4. 构建生产版本
```bash
npm run build
```

输出目录: `dist/`

### 5. 预览生产构建
```bash
npm run preview
```

---

## 📝 开发规范

### 组件命名
- **Page组件**: 大驼峰 + `.jsx` (如: `SelectionEngine.jsx`)
- **通用组件**: 大驼峰 + `.jsx` (如: `MainLayout.jsx`)
- **工具函数**: 小驼峰 + `.js` (如: `pdfGenerator.js`)

### 文件组织
```
ComponentName/
├── index.jsx          # 主组件
├── styles.module.css  # 样式（如需独立样式）
└── components/        # 子组件
```

### API调用规范
1. ✅ 使用 `async/await`
2. ✅ 使用 `try-catch` 错误处理
3. ✅ 使用 Ant Design 的 `message` 显示提示
4. ✅ 使用 `loading` 状态显示加载状态

```javascript
const fetchData = async () => {
  try {
    setLoading(true)
    const response = await someAPI.getData()
    setData(response.data)
    message.success('数据加载成功')
  } catch (error) {
    message.error(error.response?.data?.message || '加载失败')
  } finally {
    setLoading(false)
  }
}
```

---

## 🎨 UI设计规范

### 颜色主题
- **主色**: `#1890ff` (Ant Design默认蓝)
- **成功**: `#52c41a`
- **警告**: `#faad14`
- **错误**: `#ff4d4f`
- **文本**: `rgba(0, 0, 0, 0.85)`
- **次要文本**: `rgba(0, 0, 0, 0.45)`

### 布局间距
- **页面外边距**: `24px`
- **卡片内边距**: `24px`
- **组件间距**: `16px`
- **表单项间距**: `16px`

### 响应式断点
- **xs**: < 576px
- **sm**: ≥ 576px
- **md**: ≥ 768px
- **lg**: ≥ 992px
- **xl**: ≥ 1200px
- **xxl**: ≥ 1600px

---

## 📦 关键依赖说明

### React Router DOM
**作用**: 客户端路由管理
```jsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'
```

### Ant Design
**作用**: 企业级UI组件库
- 提供50+高质量组件
- 中文友好
- TypeScript支持
- 主题定制

### Zustand
**作用**: 轻量级状态管理
- API简洁
- 支持中间件
- 无需Provider包裹
- 开发工具支持

### Axios
**作用**: HTTP客户端
- Promise based
- 拦截器支持
- 自动转换JSON
- 取消请求支持

### jsPDF
**作用**: 客户端PDF生成
- 纯JavaScript实现
- 支持中文字体
- 支持表格、图片
- 无需服务器端

---

## 🔧 Vite配置

```javascript
// vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:5001',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    minify: 'esbuild'
  }
})
```

---

## 🐛 常见问题

### 1. CORS错误
**原因**: 后端未配置CORS  
**解决**: 后端已配置 `cors` 中间件，确保后端服务运行

### 2. 401 Unauthorized
**原因**: Token过期或无效  
**解决**: 响应拦截器会自动登出，重新登录即可

### 3. API调用失败
**原因**: 后端服务未启动  
**解决**: 确保后端运行在 `http://localhost:5001`

### 4. 页面空白
**原因**: 路由配置错误或组件导入失败  
**解决**: 检查浏览器控制台错误信息

---

## 📚 学习资源

### 官方文档
- [React 文档](https://react.dev/)
- [Vite 文档](https://vitejs.dev/)
- [Ant Design 文档](https://ant.design/)
- [React Router 文档](https://reactrouter.com/)
- [Zustand 文档](https://github.com/pmndrs/zustand)

### 开发工具
- [React DevTools](https://react.dev/learn/react-developer-tools)
- [Redux DevTools](https://github.com/reduxjs/redux-devtools) (支持Zustand)
- [Axios DevTools](https://github.com/axios/axios)

---

## ✅ 完成状态

### 已完成
- ✅ 项目初始化
- ✅ 路由配置
- ✅ 布局组件（中文界面）
- ✅ 认证系统
- ✅ 角色权限系统
- ✅ API服务封装（27个端点）
- ✅ 状态管理
- ✅ 响应式设计

### 待开发页面组件
- ⏳ Login（登录页）
- ⏳ Dashboard（控制台）
- ⏳ SelectionEngine（智能选型）
- ⏳ Projects（项目管理）
- ⏳ Quotes（报价管理）
- ⏳ Products（产品管理）
- ⏳ AdminPanel（系统管理）
- ⏳ Profile（个人资料）

---

## 🎯 下一步

1. **实现登录页面**
   - 表单验证
   - 登录逻辑
   - 记住密码
   - 错误提示

2. **实现智能选型页面**
   - 参数输入表单
   - 实时推荐显示
   - 结果对比
   - 添加到项目

3. **实现项目管理页面**
   - 项目列表
   - 项目创建
   - 批量选型
   - 报价生成

4. **实现系统管理页面**
   - Excel批量导入
   - 数据管理
   - 用户管理
   - 系统统计

---

**文档版本**: v2.0.0  
**最后更新**: 2025-10-27  
**维护者**: Development Team

