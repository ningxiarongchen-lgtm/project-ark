/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * å¤šè§’è‰²ååŒå·¥ä½œæµæµ‹è¯• - å®Œæ•´å‰§æœ¬
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * æœ¬æµ‹è¯•æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®çš„ä¸šåŠ¡åœºæ™¯ï¼š
 * ä»é”€å”®ç»ç†å‘èµ·é¡¹ç›®ï¼Œåˆ°æŠ€æœ¯å·¥ç¨‹å¸ˆé€‰å‹ï¼Œåˆ°å•†åŠ¡å·¥ç¨‹å¸ˆæŠ¥ä»·ï¼Œ
 * å†åˆ°ç”Ÿäº§è®¡åˆ’å‘˜å®‰æ’ç”Ÿäº§ï¼Œæœ€ååˆ°å”®åå·¥ç¨‹å¸ˆæä¾›æœåŠ¡ã€‚
 * 
 * è¿™æ˜¯ä¸€åœºç²¾å¿ƒç¼–æ’çš„"ååŒä¹‹èˆ"ï¼Œæ¯ä¸ªè§’è‰²åœ¨æ­£ç¡®çš„æ—¶é—´ç™»åœºï¼Œ
 * æ‰§è¡Œè‡ªå·±çš„èŒè´£ï¼Œå¹¶å°†å·¥ä½œäº¤æ¥ç»™ä¸‹ä¸€ä¸ªè§’è‰²ã€‚
 * 
 * æ¶‰åŠè§’è‰²ï¼š
 * ğŸ‘” Sales Manager (é”€å”®ç»ç†) - é¡¹ç›®å‘èµ·ã€å•†æœºç®¡ç†ã€åˆåŒç­¾è®¢
 * ğŸ”§ Technical Engineer (æŠ€æœ¯å·¥ç¨‹å¸ˆ) - æŠ€æœ¯é€‰å‹ã€æ–¹æ¡ˆè®¾è®¡
 * ğŸ’¼ Business Engineer (å•†åŠ¡å·¥ç¨‹å¸ˆ) - BOMç®¡ç†ã€æˆæœ¬æ ¸ç®—ã€æŠ¥ä»·
 * ğŸ­ Production Planner (ç”Ÿäº§è®¡åˆ’å‘˜) - ç”Ÿäº§æ’æœŸã€è¿›åº¦ç®¡ç†
 * ğŸ“¦ Procurement Specialist (é‡‡è´­ä¸“å‘˜) - ä¾›åº”å•†ç®¡ç†
 * ğŸ« After-sales Engineer (å”®åå·¥ç¨‹å¸ˆ) - å”®åæœåŠ¡ã€å·¥å•å¤„ç†
 * ğŸ‘‘ Administrator (ç®¡ç†å‘˜) - å…¨å±€ç›‘æ§ã€æƒé™ç®¡ç†
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

describe('ğŸ­ Multi-Role Collaboration Workflow - The Complete Play', () => {
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ å‰§æœ¬å‡†å¤‡ï¼šå®šä¹‰æµ‹è¯•æ•°æ®å’Œå…±äº«å˜é‡
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const timestamp = Date.now()
  const projectName = `ååŒé¡¹ç›®-${timestamp}`
  const clientName = 'åŒ—äº¬æ™ºèƒ½åˆ¶é€ æœ‰é™å…¬å¸'
  const contactPerson = 'æç»ç†'
  const contactPhone = '13800138000'
  
  // å…±äº«å˜é‡ - åœ¨ä¸åŒè§’è‰²ä¹‹é—´ä¼ é€’
  let projectId = null
  let orderId = null
  let orderNumber = null
  let productionOrderId = null
  let productionOrderNumber = null
  let ticketId = null
  let ticketNumber = null
  
  before(() => {
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    cy.log('ğŸ¬ å‰§æœ¬å¼€å§‹ï¼šå¤šè§’è‰²ååŒå·¥ä½œæµæµ‹è¯•')
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    cy.log(`ğŸ“‹ é¡¹ç›®åç§°: ${projectName}`)
    cy.log(`ğŸ¢ å®¢æˆ·åç§°: ${clientName}`)
    cy.log(`ğŸ‘¤ è”ç³»äºº: ${contactPerson}`)
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  })

  after(() => {
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    cy.log('ğŸŠ å‰§æœ¬ç»“æŸï¼æ‰€æœ‰è§’è‰²å®Œæˆäº†ä»–ä»¬çš„ä½¿å‘½')
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    cy.log('ğŸ“Š æµ‹è¯•æ•°æ®æ±‡æ€»ï¼š')
    cy.log(`   ğŸ“‹ é¡¹ç›®ID: ${projectId || 'N/A'}`)
    cy.log(`   ğŸ“ è®¢å•å·: ${orderNumber || 'N/A'}`)
    cy.log(`   ğŸ­ ç”Ÿäº§è®¢å•å·: ${productionOrderNumber || 'N/A'}`)
    cy.log(`   ğŸ« å·¥å•å·: ${ticketNumber || 'N/A'}`)
    cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬ä¸€å¹•ï¼šé”€å”®ç»ç†å‘èµ·é¡¹ç›®
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šé”€å”®ç»ç† å¼ æ€» åˆšåˆšæ‹œè®¿äº†ä¸€ä¸ªå¤§å®¢æˆ·ï¼Œå®¢æˆ·å¯¹æˆ‘ä»¬çš„
  // é˜€é—¨æ‰§è¡Œå™¨å¾ˆæ„Ÿå…´è¶£ã€‚å¼ æ€»å›åˆ°å…¬å¸åï¼Œç«‹å³åœ¨ç³»ç»Ÿä¸­åˆ›å»ºäº†
  // ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶æŒ‡æ´¾æŠ€æœ¯å·¥ç¨‹å¸ˆè¿›è¡ŒæŠ€æœ¯é€‰å‹ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 1: Sales Manager Initiates Project', () => {
    
    it('Scene 1.1 - é”€å”®ç»ç†ç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ‘” è§’è‰²ç™»åœº: é”€å”®ç»ç†')
      cy.loginAs('salesManager')
      
      // éªŒè¯ç™»å½•æˆåŠŸ
      cy.url().should('include', '/dashboard')
      cy.contains('é”€å”®ç»ç†').should('be.visible')
      
      cy.log('âœ… é”€å”®ç»ç†æˆåŠŸç™»å½•')
    })

    it('Scene 1.2 - åˆ›å»ºæ–°é¡¹ç›®', () => {
      cy.log('ğŸ“‹ é”€å”®ç»ç†æ­£åœ¨åˆ›å»ºæ–°é¡¹ç›®...')
      
      // è¿›å…¥é¡¹ç›®ç®¡ç†é¡µé¢
      cy.visit('/projects')
      cy.contains('é¡¹ç›®ç®¡ç†').should('be.visible')
      
      // ç‚¹å‡»åˆ›å»ºé¡¹ç›®æŒ‰é’®
      cy.contains('button', 'æ–°å»ºé¡¹ç›®').should('be.visible').click()
      cy.wait(500)
      
      // å¡«å†™é¡¹ç›®åŸºæœ¬ä¿¡æ¯
      cy.log('ğŸ“ å¡«å†™é¡¹ç›®ä¿¡æ¯...')
      cy.get('input[name="projectName"]').should('be.visible').clear().type(projectName)
      cy.get('input[name="clientName"]').clear().type(clientName)
      cy.get('input[name="clientContact"]').clear().type(contactPerson)
      cy.get('input[name="clientPhone"]').clear().type(contactPhone)
      cy.get('textarea[name="description"]').clear().type('è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å·¥ä¸šè‡ªåŠ¨åŒ–é¡¹ç›®ï¼Œå®¢æˆ·éœ€è¦é«˜æ€§èƒ½çš„é˜€é—¨æ‰§è¡Œå™¨')
      
      // æäº¤åˆ›å»º
      cy.contains('button', 'åˆ›å»º').click()
      cy.wait(2000)
      
      // éªŒè¯é¡¹ç›®åˆ›å»ºæˆåŠŸ
      cy.contains('é¡¹ç›®åˆ›å»ºæˆåŠŸ').should('be.visible')
      cy.log('âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ')
      
      // ç­‰å¾…è·³è½¬å¹¶ä¿å­˜é¡¹ç›®ID
      cy.url().should('include', '/projects/')
      cy.url().then((url) => {
        projectId = url.split('/').pop()
        cy.log(`ğŸ“Œ é¡¹ç›®IDå·²ä¿å­˜: ${projectId}`)
      })
    })

    it('Scene 1.3 - éªŒè¯é”€å”®ç»ç†çš„æƒé™é™åˆ¶', () => {
      cy.log('ğŸ”’ éªŒè¯é”€å”®ç»ç†çš„æƒé™è¾¹ç•Œ...')
      
      // ç¡®ä¿åœ¨é¡¹ç›®è¯¦æƒ…é¡µé¢
      if (!projectId) {
        cy.visit('/projects')
        cy.contains(projectName).click()
        cy.url().then((url) => {
          projectId = url.split('/').pop()
        })
      } else {
        cy.visit(`/projects/${projectId}`)
      }
      
      cy.wait(1000)
      
      // éªŒè¯ï¼šé”€å”®ç»ç†ä¸åº”è¯¥çœ‹åˆ°"æäº¤é€‰å‹æ–¹æ¡ˆ"æŒ‰é’®ï¼ˆè¿™æ˜¯æŠ€æœ¯å·¥ç¨‹å¸ˆçš„æƒé™ï¼‰
      cy.get('body').should('not.contain', 'æäº¤é€‰å‹æ–¹æ¡ˆç»™å•†åŠ¡')
      cy.log('âœ… ç¡®è®¤ï¼šé”€å”®ç»ç†æ²¡æœ‰"æäº¤é€‰å‹æ–¹æ¡ˆ"æƒé™')
      
      // éªŒè¯ï¼šé”€å”®ç»ç†å¯ä»¥çœ‹åˆ°é¡¹ç›®ä¿¡æ¯
      cy.contains(projectName).should('be.visible')
      cy.contains(clientName).should('be.visible')
      
      cy.log('âœ… æƒé™éªŒè¯é€šè¿‡')
    })

    it('Scene 1.4 - é”€å”®ç»ç†ç™»å‡ºï¼Œç­‰å¾…æŠ€æœ¯å›¢é˜Ÿæ¥æ‰‹', () => {
      cy.log('ğŸ‘” é”€å”®ç»ç†å®Œæˆäº†åˆå§‹åŒ–å·¥ä½œï¼Œç°åœ¨ç™»å‡ºç³»ç»Ÿ')
      cy.logout()
      cy.log('âœ… é”€å”®ç»ç†å·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬äºŒå¹•ï¼šæŠ€æœ¯å·¥ç¨‹å¸ˆè¿›è¡Œé€‰å‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šæŠ€æœ¯å·¥ç¨‹å¸ˆ ç‹å·¥ æ”¶åˆ°äº†é¡¹ç›®é€šçŸ¥ï¼Œä»–éœ€è¦æ ¹æ®å®¢æˆ·çš„
  // éœ€æ±‚è¿›è¡ŒæŠ€æœ¯é€‰å‹ã€‚ä»–åˆ†æäº†å®¢æˆ·çš„å·¥å†µå‚æ•°ï¼Œé€‰æ‹©äº†åˆé€‚çš„
  // é˜€é—¨æ‰§è¡Œå™¨å‹å·ï¼Œå¹¶æäº¤ç»™å•†åŠ¡å·¥ç¨‹å¸ˆè¿›è¡ŒæŠ¥ä»·ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 2: Technical Engineer Performs Selection', () => {
    
    it('Scene 2.1 - æŠ€æœ¯å·¥ç¨‹å¸ˆç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ”§ è§’è‰²ç™»åœº: æŠ€æœ¯å·¥ç¨‹å¸ˆ')
      cy.loginAs('technicalEngineer')
      
      cy.url().should('include', '/dashboard')
      cy.contains('æŠ€æœ¯å·¥ç¨‹å¸ˆ').should('be.visible')
      
      cy.log('âœ… æŠ€æœ¯å·¥ç¨‹å¸ˆæˆåŠŸç™»å½•')
    })

    it('Scene 2.2 - åœ¨ä»ªè¡¨ç›˜æŸ¥çœ‹å¾…å¤„ç†é¡¹ç›®', () => {
      cy.log('ğŸ“Š æŠ€æœ¯å·¥ç¨‹å¸ˆæŸ¥çœ‹è‡ªå·±çš„å¾…åŠäº‹é¡¹...')
      
      cy.visit('/dashboard')
      cy.wait(1000)
      
      // åœ¨ä»ªè¡¨ç›˜ä¸Šåº”è¯¥èƒ½çœ‹åˆ°æ–°é¡¹ç›®ï¼ˆå¦‚æœä»ªè¡¨ç›˜æœ‰é¡¹ç›®åˆ—è¡¨ï¼‰
      cy.get('body').then(($body) => {
        if ($body.text().includes(projectName)) {
          cy.log('âœ… åœ¨ä»ªè¡¨ç›˜ä¸Šçœ‹åˆ°äº†æ–°é¡¹ç›®')
        } else {
          cy.log('â„¹ï¸ ä»ªè¡¨ç›˜æœªæ˜¾ç¤ºé¡¹ç›®ï¼Œç›´æ¥è¿›å…¥é¡¹ç›®åˆ—è¡¨')
        }
      })
    })

    it('Scene 2.3 - è¿›å…¥é¡¹ç›®å¹¶å¼€å§‹é€‰å‹', () => {
      cy.log('ğŸ¯ æŠ€æœ¯å·¥ç¨‹å¸ˆå¼€å§‹è¿›è¡ŒæŠ€æœ¯é€‰å‹...')
      
      // è¿›å…¥é¡¹ç›®è¯¦æƒ…
      cy.visit('/projects')
      cy.contains(projectName).should('be.visible').click()
      cy.wait(1000)
      
      // éªŒè¯URLåŒ…å«é¡¹ç›®ID
      cy.url().should('include', `/projects/${projectId}`)
      
      // éªŒè¯ï¼šæŠ€æœ¯å·¥ç¨‹å¸ˆå¯ä»¥çœ‹åˆ°"é€‰å‹æ˜ç»†"æ ‡ç­¾
      cy.contains('.ant-tabs-tab', 'é€‰å‹æ˜ç»†').should('be.visible')
      cy.log('âœ… ç¡®è®¤å¯ä»¥è®¿é—®é€‰å‹æ˜ç»†æ ‡ç­¾')
      
      // éªŒè¯ï¼šæŠ€æœ¯å·¥ç¨‹å¸ˆæš‚æ—¶çœ‹ä¸åˆ°BOMæ ‡ç­¾ï¼ˆæŠ¥ä»·å‰ä¸éœ€è¦ï¼‰
      cy.get('body').then(($body) => {
        const hasBOMTab = $body.text().includes('BOMæ¸…å•')
        if (!hasBOMTab) {
          cy.log('âœ… ç¡®è®¤ï¼šæ­¤é˜¶æ®µä¸æ˜¾ç¤ºBOMæ¸…å•æ ‡ç­¾ï¼ˆç¬¦åˆé¢„æœŸï¼‰')
        }
      })
    })

    it('Scene 2.4 - æ·»åŠ ç¬¬ä¸€ä¸ªé˜€é—¨é€‰å‹', () => {
      cy.log('ğŸ”§ æ·»åŠ ç¬¬ä¸€ä¸ªé˜€é—¨é€‰å‹ï¼šAT-150 æ‰§è¡Œå™¨')
      
      // ç¡®ä¿åœ¨é€‰å‹æ˜ç»†æ ‡ç­¾
      cy.contains('.ant-tabs-tab', 'é€‰å‹æ˜ç»†').click()
      cy.wait(500)
      
      // ç‚¹å‡»æ·»åŠ é€‰å‹æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ·»åŠ é€‰å‹') || $body.text().includes('æ–°å¢é€‰å‹')) {
          cy.contains('button', /æ·»åŠ é€‰å‹|æ–°å¢é€‰å‹/).click()
          cy.wait(500)
          
          // å¡«å†™é€‰å‹å‚æ•°
          cy.log('ğŸ“ å¡«å†™é€‰å‹å‚æ•°...')
          
          // æ‰§è¡Œå™¨ç±»å‹
          cy.get('select[name="actuatorType"]').select('AT')
          
          // é˜€é—¨å°ºå¯¸
          cy.get('input[name="valveSize"]').clear().type('150')
          
          // å·¥ä½œå‹åŠ›
          cy.get('input[name="workingPressure"]').clear().type('16')
          
          // å·¥ä½œæ¸©åº¦
          cy.get('input[name="workingTemperature"]').clear().type('120')
          
          // æ‰€éœ€æ‰­çŸ©
          cy.get('input[name="torque"]').clear().type('800')
          
          // æ•°é‡
          cy.get('input[name="quantity"]').clear().type('5')
          
          // å¤‡æ³¨
          cy.get('textarea[name="remarks"]').clear().type('ä¸»ç®¡è·¯æ§åˆ¶é˜€ï¼Œè¦æ±‚é«˜å¯é æ€§')
          
          // æäº¤é€‰å‹
          cy.contains('button', 'ç¡®å®š').click()
          cy.wait(2000)
          
          // éªŒè¯é€‰å‹å·²æ·»åŠ 
          cy.contains('AT').should('be.visible')
          cy.contains('150').should('be.visible')
          cy.log('âœ… ç¬¬ä¸€ä¸ªé€‰å‹æ·»åŠ æˆåŠŸ')
        } else {
          cy.log('âš ï¸ æœªæ‰¾åˆ°æ·»åŠ é€‰å‹æŒ‰é’®ï¼Œå¯èƒ½å·²æœ‰é€‰å‹æ•°æ®')
        }
      })
    })

    it('Scene 2.5 - æ·»åŠ ç¬¬äºŒä¸ªé˜€é—¨é€‰å‹', () => {
      cy.log('ğŸ”§ æ·»åŠ ç¬¬äºŒä¸ªé˜€é—¨é€‰å‹ï¼šGY-200 æ‰§è¡Œå™¨')
      
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ·»åŠ é€‰å‹') || $body.text().includes('æ–°å¢é€‰å‹')) {
          cy.contains('button', /æ·»åŠ é€‰å‹|æ–°å¢é€‰å‹/).click()
          cy.wait(500)
          
          // å¡«å†™ç¬¬äºŒä¸ªé€‰å‹å‚æ•°
          cy.get('select[name="actuatorType"]').select('GY')
          cy.get('input[name="valveSize"]').clear().type('200')
          cy.get('input[name="workingPressure"]').clear().type('10')
          cy.get('input[name="workingTemperature"]').clear().type('80')
          cy.get('input[name="torque"]').clear().type('1200')
          cy.get('input[name="quantity"]').clear().type('3')
          cy.get('textarea[name="remarks"]').clear().type('æ”¯è·¯æ§åˆ¶é˜€ï¼Œæ ‡å‡†é…ç½®')
          
          cy.contains('button', 'ç¡®å®š').click()
          cy.wait(2000)
          
          cy.contains('GY').should('be.visible')
          cy.contains('200').should('be.visible')
          cy.log('âœ… ç¬¬äºŒä¸ªé€‰å‹æ·»åŠ æˆåŠŸ')
        }
      })
    })

    it('Scene 2.6 - æäº¤é€‰å‹æ–¹æ¡ˆç»™å•†åŠ¡å·¥ç¨‹å¸ˆ', () => {
      cy.log('ğŸ“¤ æŠ€æœ¯å·¥ç¨‹å¸ˆæäº¤é€‰å‹æ–¹æ¡ˆ...')
      
      // æŸ¥æ‰¾å¹¶ç‚¹å‡»æäº¤æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('æäº¤é€‰å‹æ–¹æ¡ˆ') || $body.text().includes('æäº¤æŠ€æœ¯æ–¹æ¡ˆ')) {
          cy.contains('button', /æäº¤é€‰å‹æ–¹æ¡ˆ|æäº¤æŠ€æœ¯æ–¹æ¡ˆ/).should('be.visible').click()
          cy.wait(500)
          
          // å¦‚æœæœ‰ç¡®è®¤å¯¹è¯æ¡†ï¼Œå¡«å†™æäº¤è¯´æ˜
          cy.get('body').then(($modal) => {
            if ($modal.text().includes('æäº¤è¯´æ˜') || $modal.text().includes('å¤‡æ³¨')) {
              cy.get('textarea[name="submitNotes"]').clear().type('æŠ€æœ¯é€‰å‹å·²å®Œæˆï¼Œå»ºè®®é‡‡ç”¨AT-150å’ŒGY-200ç»„åˆæ–¹æ¡ˆï¼Œå¯æ»¡è¶³å®¢æˆ·å…¨éƒ¨æŠ€æœ¯è¦æ±‚ã€‚')
              cy.contains('button', /ç¡®è®¤æäº¤|ç¡®å®š/).click()
            } else {
              // å¦‚æœæ²¡æœ‰å¯¹è¯æ¡†ï¼Œç›´æ¥ç¡®è®¤
              cy.get('.ant-modal').then(($dialog) => {
                if ($dialog.length > 0) {
                  cy.contains('button', 'ç¡®è®¤').click()
                }
              })
            }
          })
          
          cy.wait(1000)
          
          // éªŒè¯æäº¤æˆåŠŸ
          cy.get('body').then(($result) => {
            if ($result.text().includes('æäº¤æˆåŠŸ') || $result.text().includes('æˆåŠŸ')) {
              cy.log('âœ… é€‰å‹æ–¹æ¡ˆæäº¤æˆåŠŸ')
            }
          })
        } else {
          cy.log('â„¹ï¸ æœªæ‰¾åˆ°æäº¤æŒ‰é’®ï¼Œå¯èƒ½å·²æäº¤æˆ–ç•Œé¢ä¸åŒ')
        }
      })
    })

    it('Scene 2.7 - æŠ€æœ¯å·¥ç¨‹å¸ˆç™»å‡ºï¼Œç­‰å¾…å•†åŠ¡å·¥ç¨‹å¸ˆæ¥æ‰‹', () => {
      cy.log('ğŸ”§ æŠ€æœ¯å·¥ç¨‹å¸ˆå®Œæˆäº†é€‰å‹å·¥ä½œ')
      cy.logout()
      cy.log('âœ… æŠ€æœ¯å·¥ç¨‹å¸ˆå·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬ä¸‰å¹•ï¼šå•†åŠ¡å·¥ç¨‹å¸ˆè¿›è¡ŒBOMå’ŒæŠ¥ä»·
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šå•†åŠ¡å·¥ç¨‹å¸ˆ åˆ˜å·¥ æ”¶åˆ°æŠ€æœ¯é€‰å‹é€šçŸ¥ï¼Œä»–éœ€è¦æ ¹æ®é€‰å‹
  // ç»“æœç”Ÿæˆè¯¦ç»†çš„BOMæ¸…å•ï¼Œæ ¸ç®—æˆæœ¬ï¼Œå¹¶åˆ¶ä½œæ­£å¼æŠ¥ä»·å•ã€‚
  // è¿™æ˜¯ä¸€ä¸ªéœ€è¦å•†ä¸šæ•æ„Ÿåº¦å’Œæˆæœ¬æ§åˆ¶èƒ½åŠ›çš„å…³é”®ç¯èŠ‚ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 3: Business Engineer Creates BOM and Quote', () => {
    
    it('Scene 3.1 - å•†åŠ¡å·¥ç¨‹å¸ˆç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ’¼ è§’è‰²ç™»åœº: å•†åŠ¡å·¥ç¨‹å¸ˆ')
      cy.loginAs('salesEngineer')
      
      cy.url().should('include', '/dashboard')
      cy.contains('å•†åŠ¡å·¥ç¨‹å¸ˆ').should('be.visible')
      
      cy.log('âœ… å•†åŠ¡å·¥ç¨‹å¸ˆæˆåŠŸç™»å½•')
    })

    it('Scene 3.2 - åœ¨ä»ªè¡¨ç›˜æŸ¥çœ‹å¾…æŠ¥ä»·é¡¹ç›®', () => {
      cy.log('ğŸ“Š å•†åŠ¡å·¥ç¨‹å¸ˆæŸ¥çœ‹å¾…æŠ¥ä»·é¡¹ç›®...')
      
      cy.visit('/dashboard')
      cy.wait(1000)
      
      // æŸ¥æ‰¾å¾…æŠ¥ä»·é¡¹ç›®
      cy.get('body').then(($body) => {
        if ($body.text().includes(projectName)) {
          cy.log('âœ… åœ¨ä»ªè¡¨ç›˜ä¸Šçœ‹åˆ°äº†å¾…æŠ¥ä»·é¡¹ç›®')
        }
      })
    })

    it('Scene 3.3 - è¿›å…¥é¡¹ç›®å¹¶æŸ¥çœ‹é€‰å‹ç»“æœ', () => {
      cy.log('ğŸ” å•†åŠ¡å·¥ç¨‹å¸ˆæŸ¥çœ‹æŠ€æœ¯é€‰å‹ç»“æœ...')
      
      cy.visit('/projects')
      cy.contains(projectName).should('be.visible').click()
      cy.wait(1000)
      
      // éªŒè¯å¯ä»¥çœ‹åˆ°"é€‰å‹æ˜ç»†"å’Œ"BOMæ¸…å•"ä¸¤ä¸ªæ ‡ç­¾
      cy.contains('.ant-tabs-tab', 'é€‰å‹æ˜ç»†').should('be.visible')
      cy.contains('.ant-tabs-tab', 'BOMæ¸…å•').should('be.visible')
      cy.log('âœ… ç¡®è®¤å¯ä»¥è®¿é—®é€‰å‹æ˜ç»†å’ŒBOMæ¸…å•æ ‡ç­¾')
      
      // æŸ¥çœ‹é€‰å‹æ˜ç»†
      cy.contains('.ant-tabs-tab', 'é€‰å‹æ˜ç»†').click()
      cy.wait(500)
      
      // éªŒè¯é€‰å‹æ•°æ®å­˜åœ¨
      cy.get('.ant-table-tbody').should('exist')
      cy.log('âœ… é€‰å‹æ•°æ®å·²åŠ è½½')
    })

    it('Scene 3.4 - åˆ‡æ¢åˆ°BOMæ¸…å•å¹¶ç”ŸæˆBOM', () => {
      cy.log('ğŸ“¦ å•†åŠ¡å·¥ç¨‹å¸ˆç”ŸæˆBOMæ¸…å•...')
      
      // åˆ‡æ¢åˆ°BOMæ¸…å•æ ‡ç­¾
      cy.contains('.ant-tabs-tab', 'BOMæ¸…å•').click()
      cy.wait(500)
      
      // ç‚¹å‡»"ä»é€‰å‹è‡ªåŠ¨ç”Ÿæˆ"æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('ä»é€‰å‹è‡ªåŠ¨ç”Ÿæˆ')) {
          cy.contains('button', 'ä»é€‰å‹è‡ªåŠ¨ç”Ÿæˆ').should('be.visible').click()
          cy.wait(500)
          
          // ç¡®è®¤ç”Ÿæˆ
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0 && $modal.text().includes('ç¡®å®š')) {
              cy.contains('.ant-modal button', 'ç¡®å®š').click()
              cy.wait(2000)
            }
          })
          
          cy.log('âœ… BOMæ¸…å•ç”ŸæˆæˆåŠŸ')
        } else {
          cy.log('â„¹ï¸ BOMå¯èƒ½å·²ç»ç”Ÿæˆ')
        }
      })
      
      // éªŒè¯BOMè¡¨æ ¼ä¸­æœ‰æ•°æ®
      cy.get('.ant-table-tbody tr').should('have.length.greaterThan', 0)
      cy.log('âœ… BOMæ•°æ®å·²åŠ è½½')
    })

    it('Scene 3.5 - éªŒè¯å•†åŠ¡å·¥ç¨‹å¸ˆå¯ä»¥çœ‹åˆ°æˆæœ¬åˆ—', () => {
      cy.log('ğŸ’° éªŒè¯å•†åŠ¡å·¥ç¨‹å¸ˆçš„æˆæœ¬æŸ¥çœ‹æƒé™...')
      
      // ç¡®ä¿åœ¨BOMæ¸…å•æ ‡ç­¾
      cy.contains('.ant-tabs-tab', 'BOMæ¸…å•').click()
      cy.wait(500)
      
      // éªŒè¯ï¼šå•†åŠ¡å·¥ç¨‹å¸ˆåº”è¯¥èƒ½çœ‹åˆ°æˆæœ¬ç›¸å…³åˆ—
      cy.get('.ant-table-thead').then(($thead) => {
        const headerText = $thead.text()
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æˆæœ¬ã€å•ä»·ç­‰åˆ—
        if (headerText.includes('æˆæœ¬') || headerText.includes('å•ä»·') || headerText.includes('ä»·æ ¼')) {
          cy.log('âœ… ç¡®è®¤ï¼šå•†åŠ¡å·¥ç¨‹å¸ˆå¯ä»¥çœ‹åˆ°æˆæœ¬åˆ—')
        } else {
          cy.log('âš ï¸ æ³¨æ„ï¼šæœªæ‰¾åˆ°æ˜æ˜¾çš„æˆæœ¬åˆ—ï¼Œå¯èƒ½åˆ—åä¸åŒ')
        }
      })
      
      // éªŒè¯ï¼šå¯ä»¥ç¼–è¾‘BOM
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ‰‹åŠ¨æ·»åŠ è¡Œ') || $body.text().includes('ç¼–è¾‘')) {
          cy.log('âœ… ç¡®è®¤ï¼šå•†åŠ¡å·¥ç¨‹å¸ˆæœ‰BOMç¼–è¾‘æƒé™')
        }
      })
    })

    it('Scene 3.6 - ç”Ÿæˆé¡¹ç›®æŠ¥ä»·', () => {
      cy.log('ğŸ’° å•†åŠ¡å·¥ç¨‹å¸ˆç”Ÿæˆæ­£å¼æŠ¥ä»·...')
      
      // æŸ¥æ‰¾ç”ŸæˆæŠ¥ä»·æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('ç”ŸæˆæŠ¥ä»·')) {
          cy.contains('button', 'ç”ŸæˆæŠ¥ä»·').click()
          cy.wait(500)
          
          // å¡«å†™æŠ¥ä»·ä¿¡æ¯
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              // æœ‰æ•ˆæœŸ
              cy.get('input[name="validityPeriod"]').clear().type('30')
              
              // äº¤è´§æœŸ
              cy.get('input[name="deliveryTime"]').clear().type('45')
              
              // ä»˜æ¬¾æ¡ä»¶
              cy.get('input[name="paymentTerms"]').clear().type('é¢„ä»˜30%ï¼Œå‘è´§å‰70%')
              
              // å¤‡æ³¨
              cy.get('textarea[name="notes"]').clear().type('æœ¬æŠ¥ä»·åŒ…å«è®¾å¤‡ã€æ ‡å‡†é™„ä»¶åŠæŠ€æœ¯æœåŠ¡ï¼Œä¸å«è¿è´¹å’Œå®‰è£…è´¹ç”¨')
              
              // ç¡®è®¤ç”Ÿæˆ
              cy.contains('.ant-modal button', 'ç”ŸæˆæŠ¥ä»·').click()
              cy.wait(2000)
              
              cy.log('âœ… æŠ¥ä»·ç”ŸæˆæˆåŠŸ')
            }
          })
        } else {
          cy.log('â„¹ï¸ æŠ¥ä»·å¯èƒ½å·²ç»ç”Ÿæˆæˆ–æŒ‰é’®ä½ç½®ä¸åŒ')
        }
      })
    })

    it('Scene 3.7 - å®ŒæˆæŠ¥ä»·å¹¶é€šçŸ¥é”€å”®ç»ç†', () => {
      cy.log('ğŸ“¤ å•†åŠ¡å·¥ç¨‹å¸ˆå®ŒæˆæŠ¥ä»·å¹¶é€šçŸ¥é”€å”®ç»ç†...')
      
      cy.get('body').then(($body) => {
        if ($body.text().includes('å®ŒæˆæŠ¥ä»·') || $body.text().includes('é€šçŸ¥é”€å”®')) {
          cy.contains('button', /å®ŒæˆæŠ¥ä»·|é€šçŸ¥é”€å”®/).click()
          cy.wait(500)
          
          // å¦‚æœæœ‰ç¡®è®¤å¯¹è¯æ¡†
          cy.get('body').then(($modal) => {
            if ($modal.text().includes('ç¡®è®¤') || $modal.text().includes('å¤‡æ³¨')) {
              cy.get('textarea').then(($textarea) => {
                if ($textarea.length > 0) {
                  cy.wrap($textarea).clear().type('æŠ¥ä»·å·²å®Œæˆï¼Œæ€»é‡‘é¢çº¦85ä¸‡å…ƒï¼Œå»ºè®®å°½å¿«æäº¤å®¢æˆ·å®¡æ ¸ã€‚åˆ©æ¶¦ç‡ç¬¦åˆå…¬å¸è¦æ±‚ã€‚')
                }
              })
              cy.contains('button', /ç¡®è®¤|æäº¤/).click()
              cy.wait(1000)
            }
          })
          
          cy.log('âœ… æŠ¥ä»·å·²æäº¤ç»™é”€å”®ç»ç†')
        }
      })
    })

    it('Scene 3.8 - å•†åŠ¡å·¥ç¨‹å¸ˆç™»å‡º', () => {
      cy.log('ğŸ’¼ å•†åŠ¡å·¥ç¨‹å¸ˆå®Œæˆäº†æŠ¥ä»·å·¥ä½œ')
      cy.logout()
      cy.log('âœ… å•†åŠ¡å·¥ç¨‹å¸ˆå·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬å››å¹•ï¼šé”€å”®ç»ç†å®¡æ‰¹æŠ¥ä»·å¹¶æ¨è¿›é¡¹ç›®
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šé”€å”®ç»ç† å¼ æ€» æ”¶åˆ°æŠ¥ä»·é€šçŸ¥åï¼Œä»”ç»†å®¡æ ¸äº†æŠ¥ä»·å•ã€‚
  // ç»è¿‡å‡ å¤©çš„å®¢æˆ·æ²Ÿé€šå’Œè°ˆåˆ¤ï¼Œå®¢æˆ·æœ€ç»ˆæ¥å—äº†æˆ‘ä»¬çš„æŠ¥ä»·ã€‚
  // å¼ æ€»åœ¨ç³»ç»Ÿä¸­å°†é¡¹ç›®æ ‡è®°ä¸º"èµ¢å•"ï¼Œå¹¶ç”Ÿæˆæ­£å¼çš„é”€å”®è®¢å•ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 4: Sales Manager Reviews Quote and Wins Deal', () => {
    
    it('Scene 4.1 - é”€å”®ç»ç†å†æ¬¡ç™»å½•', () => {
      cy.log('ğŸ‘” è§’è‰²å†æ¬¡ç™»åœº: é”€å”®ç»ç†')
      cy.loginAs('salesManager')
      
      cy.url().should('include', '/dashboard')
      cy.log('âœ… é”€å”®ç»ç†å†æ¬¡ç™»å½•')
    })

    it('Scene 4.2 - æŸ¥çœ‹å¾…å®¡æ‰¹çš„æŠ¥ä»·', () => {
      cy.log('ğŸ“‹ é”€å”®ç»ç†æŸ¥çœ‹å¾…å®¡æ‰¹æŠ¥ä»·...')
      
      cy.visit('/projects')
      cy.contains(projectName).should('be.visible').click()
      cy.wait(1000)
      
      // éªŒè¯å¯ä»¥çœ‹åˆ°æŠ¥ä»·ä¿¡æ¯
      cy.get('body').should('contain', projectName)
      cy.log('âœ… æŠ¥ä»·ä¿¡æ¯å·²åŠ è½½')
    })

    it('Scene 4.3 - éªŒè¯é”€å”®ç»ç†çš„BOMæƒé™ï¼ˆåªè¯»ï¼Œçœ‹ä¸åˆ°æˆæœ¬ï¼‰', () => {
      cy.log('ğŸ”’ éªŒè¯é”€å”®ç»ç†çš„BOMæŸ¥çœ‹æƒé™...')
      
      // åˆ‡æ¢åˆ°BOMæ¸…å•æ ‡ç­¾
      cy.get('body').then(($body) => {
        if ($body.text().includes('BOMæ¸…å•')) {
          cy.contains('.ant-tabs-tab', 'BOMæ¸…å•').click()
          cy.wait(500)
          
          // éªŒè¯ï¼šé”€å”®ç»ç†ä¸åº”è¯¥çœ‹åˆ°æˆæœ¬åˆ—ï¼ˆå•†ä¸šæ•æ„Ÿä¿¡æ¯ï¼‰
          cy.get('.ant-table-thead').then(($thead) => {
            const headerText = $thead.text()
            
            if (!headerText.includes('æˆæœ¬ä»·')) {
              cy.log('âœ… ç¡®è®¤ï¼šé”€å”®ç»ç†çœ‹ä¸åˆ°æˆæœ¬ä»·åˆ—ï¼ˆæƒé™æ­£ç¡®ï¼‰')
            } else {
              cy.log('âš ï¸ æ³¨æ„ï¼šé”€å”®ç»ç†å¯ä»¥çœ‹åˆ°æˆæœ¬ä»·ï¼Œæƒé™å¯èƒ½éœ€è¦è°ƒæ•´')
            }
          })
          
          // éªŒè¯ï¼šé”€å”®ç»ç†ä¸åº”è¯¥çœ‹åˆ°ç¼–è¾‘æŒ‰é’®
          cy.get('body').then(($editCheck) => {
            if (!$editCheck.text().includes('æ‰‹åŠ¨æ·»åŠ è¡Œ') && !$editCheck.text().includes('ä»é€‰å‹è‡ªåŠ¨ç”Ÿæˆ')) {
              cy.log('âœ… ç¡®è®¤ï¼šé”€å”®ç»ç†æ²¡æœ‰BOMç¼–è¾‘æƒé™ï¼ˆæƒé™æ­£ç¡®ï¼‰')
            }
          })
        }
      })
    })

    it('Scene 4.4 - å®¡æ‰¹æŠ¥ä»·', () => {
      cy.log('âœ… é”€å”®ç»ç†å®¡æ‰¹æŠ¥ä»·...')
      
      cy.get('body').then(($body) => {
        if ($body.text().includes('å®¡æ‰¹æŠ¥ä»·') || $body.text().includes('å®¡æ‰¹')) {
          cy.contains('button', /å®¡æ‰¹æŠ¥ä»·|å®¡æ‰¹/).click()
          cy.wait(500)
          
          // é€‰æ‹©é€šè¿‡
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              cy.contains('button', 'é€šè¿‡').click()
              
              // å¡«å†™å®¡æ‰¹æ„è§
              cy.get('textarea[name="approvalComments"]').clear().type('æŠ¥ä»·å·²å®¡æ ¸é€šè¿‡ï¼Œä»·æ ¼åˆç†ï¼Œåˆ©æ¶¦ç‡å¯æ¥å—ã€‚å·²ä¸å®¢æˆ·åˆæ­¥æ²Ÿé€šï¼Œå®¢æˆ·è¡¨ç¤ºæ»¡æ„ã€‚å¯ä»¥æ­£å¼æäº¤ã€‚')
              
              cy.contains('.ant-modal button', 'ç¡®è®¤').click()
              cy.wait(1000)
              
              cy.log('âœ… æŠ¥ä»·å®¡æ‰¹é€šè¿‡')
            }
          })
        }
      })
    })

    it('Scene 4.5 - æ ‡è®°é¡¹ç›®ä¸ºèµ¢å•', () => {
      cy.log('ğŸ‰ é”€å”®ç»ç†æ ‡è®°é¡¹ç›®ä¸ºèµ¢å•...')
      
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ ‡è®°ä¸ºèµ¢å•') || $body.text().includes('èµ¢å•')) {
          cy.contains('button', /æ ‡è®°ä¸ºèµ¢å•|èµ¢å•/).click()
          cy.wait(500)
          
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              // å¡«å†™èµ¢å•è¯´æ˜
              cy.get('textarea[name="winNotes"]').clear().type('å®¢æˆ·å·²ç¡®è®¤æ¥å—æˆ‘ä»¬çš„æŠ¥ä»·ï¼Œç­¾è®¢æ„å‘ä¹¦ã€‚é¢„è®¡æœ¬æœˆåº•ç­¾è®¢æ­£å¼åˆåŒã€‚å®¢æˆ·è¦æ±‚å°½å¿«å®‰æ’ç”Ÿäº§ã€‚')
              
              cy.contains('.ant-modal button', 'ç¡®è®¤').click()
              cy.wait(1000)
              
              cy.log('âœ… é¡¹ç›®æ ‡è®°ä¸ºèµ¢å•æˆåŠŸ')
            }
          })
        } else {
          // å°è¯•é€šè¿‡çŠ¶æ€ä¸‹æ‹‰æ¡†æ›´æ–°
          cy.get('body').then(($status) => {
            if ($status.text().includes('é¡¹ç›®çŠ¶æ€') || $status.find('.ant-select').length > 0) {
              cy.log('é€šè¿‡çŠ¶æ€ä¸‹æ‹‰æ¡†æ›´æ–°é¡¹ç›®çŠ¶æ€...')
              // è¿™é‡Œå¯ä»¥æ·»åŠ é€šè¿‡ä¸‹æ‹‰æ¡†æ›´æ–°çŠ¶æ€çš„é€»è¾‘
            }
          })
        }
      })
    })

    it('Scene 4.6 - ç”Ÿæˆé”€å”®è®¢å•', () => {
      cy.log('ğŸ“ é”€å”®ç»ç†ç”Ÿæˆé”€å”®è®¢å•...')
      
      cy.get('body').then(($body) => {
        if ($body.text().includes('ç”ŸæˆåˆåŒè®¢å•') || $body.text().includes('åˆ›å»ºè®¢å•')) {
          cy.contains('button', /ç”ŸæˆåˆåŒè®¢å•|åˆ›å»ºè®¢å•/).click()
          cy.wait(500)
          
          // å¡«å†™è®¢å•ä¿¡æ¯
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              cy.log('ğŸ“ å¡«å†™è®¢å•ä¿¡æ¯...')
              
              // POå·
              cy.get('input[name="poNumber"]').clear().type('PO-2025-001')
              
              // åˆåŒå·
              cy.get('input[name="contractNumber"]').clear().type('CONTRACT-2025-001')
              
              // äº¤è´§åœ°å€
              cy.get('input[name="deliveryAddress"]').clear().type('åŒ—äº¬å¸‚æœé˜³åŒºå·¥ä¸šå›­åŒº8å·')
              
              // ç‰¹æ®Šè¦æ±‚
              cy.get('textarea[name="specialRequirements"]').then(($textarea) => {
                if ($textarea.length > 0) {
                  cy.wrap($textarea).clear().type('1. éœ€è¦æä¾›ä¸­è‹±æ–‡æ“ä½œæ‰‹å†Œ\n2. æä¾›ç°åœºå®‰è£…æŒ‡å¯¼\n3. æä¾›1å¹´è´¨ä¿æœåŠ¡')
                }
              })
              
              // æäº¤è®¢å•
              cy.contains('.ant-modal button', /åˆ›å»ºè®¢å•|ç¡®è®¤/).click()
              cy.wait(2000)
              
              cy.log('âœ… é”€å”®è®¢å•åˆ›å»ºæˆåŠŸ')
            }
          })
          
          // éªŒè¯è®¢å•åˆ›å»ºæˆåŠŸçš„æç¤º
          cy.get('body').then(($result) => {
            if ($result.text().includes('è®¢å•åˆ›å»ºæˆåŠŸ')) {
              cy.log('âœ… ç¡®è®¤ï¼šè®¢å•åˆ›å»ºæˆåŠŸæ¶ˆæ¯å·²æ˜¾ç¤º')
            }
          })
        }
      })
    })

    it('Scene 4.7 - ä¿å­˜è®¢å•å·ä»¥ä¾›åç»­ä½¿ç”¨', () => {
      cy.log('ğŸ“Œ ä¿å­˜è®¢å•å·...')
      
      // è·³è½¬åˆ°è®¢å•ç®¡ç†é¡µé¢è·å–è®¢å•å·
      cy.visit('/orders')
      cy.wait(2000)
      
      // æŸ¥æ‰¾æœ€æ–°çš„è®¢å•ï¼ˆåº”è¯¥æ˜¯æˆ‘ä»¬åˆšåˆ›å»ºçš„ï¼‰
      cy.get('.ant-table-tbody tr').first().then(($row) => {
        // é€šå¸¸è®¢å•å·åœ¨ç¬¬ä¸€åˆ—
        cy.wrap($row).find('td').first().invoke('text').then((text) => {
          orderNumber = text.trim()
          cy.log(`ğŸ“Œ è®¢å•å·å·²ä¿å­˜: ${orderNumber}`)
        })
      })
    })

    it('Scene 4.8 - éªŒè¯é”€å”®ç»ç†å¯ä»¥æŸ¥çœ‹ç”Ÿäº§æ’æœŸï¼ˆåªè¯»ï¼‰', () => {
      cy.log('ğŸ” éªŒè¯é”€å”®ç»ç†çš„ç”Ÿäº§æ’æœŸæŸ¥çœ‹æƒé™...')
      
      cy.visit('/production-schedule')
      cy.wait(1000)
      
      // éªŒè¯ï¼šé”€å”®ç»ç†å¯ä»¥è®¿é—®é¡µé¢
      cy.contains('ç”Ÿäº§æ’æœŸ').should('be.visible')
      cy.log('âœ… é”€å”®ç»ç†å¯ä»¥è®¿é—®ç”Ÿäº§æ’æœŸé¡µé¢')
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°åªè¯»æ¨¡å¼æç¤º
      cy.get('body').then(($body) => {
        if ($body.text().includes('åªè¯»æ¨¡å¼')) {
          cy.log('âœ… ç¡®è®¤ï¼šé”€å”®ç»ç†å¤„äºåªè¯»æ¨¡å¼ï¼ˆæƒé™æ­£ç¡®ï¼‰')
        }
      })
      
      // éªŒè¯ï¼šä¸åº”è¯¥çœ‹åˆ°"æ›´æ–°çŠ¶æ€"ç­‰ä¿®æ”¹æŒ‰é’®
      cy.get('body').then(($body) => {
        if (!$body.text().includes('å¼€å§‹ç”Ÿäº§') && !$body.text().includes('æš‚åœç”Ÿäº§')) {
          cy.log('âœ… ç¡®è®¤ï¼šé”€å”®ç»ç†æ²¡æœ‰ç”Ÿäº§çŠ¶æ€ä¿®æ”¹æƒé™')
        }
      })
    })

    it('Scene 4.9 - é”€å”®ç»ç†ç™»å‡º', () => {
      cy.log('ğŸ‘” é”€å”®ç»ç†å®Œæˆäº†å•†åŠ¡å·¥ä½œï¼Œé¡¹ç›®è¿›å…¥ç”Ÿäº§é˜¶æ®µ')
      cy.logout()
      cy.log('âœ… é”€å”®ç»ç†å·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬äº”å¹•ï¼šç”Ÿäº§è®¡åˆ’å‘˜å®‰æ’ç”Ÿäº§
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šç”Ÿäº§è®¡åˆ’å‘˜ èµµå·¥ æ”¶åˆ°æ–°è®¢å•é€šçŸ¥åï¼Œç«‹å³åœ¨ç³»ç»Ÿä¸­
  // åˆ›å»ºç”Ÿäº§è®¢å•ï¼Œå®‰æ’ç”Ÿäº§è®¡åˆ’ï¼Œåè°ƒè½¦é—´èµ„æºï¼Œå¼€å§‹ç”Ÿäº§ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 5: Production Planner Schedules Production', () => {
    
    it('Scene 5.1 - ç”Ÿäº§è®¡åˆ’å‘˜ç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ­ è§’è‰²ç™»åœº: ç”Ÿäº§è®¡åˆ’å‘˜')
      cy.loginAs('productionPlanner')
      
      cy.url().should('include', '/dashboard')
      cy.contains('ç”Ÿäº§è®¡åˆ’å‘˜').should('be.visible')
      
      cy.log('âœ… ç”Ÿäº§è®¡åˆ’å‘˜æˆåŠŸç™»å½•')
    })

    it('Scene 5.2 - éªŒè¯ç”Ÿäº§è®¡åˆ’å‘˜æ— æ³•è®¿é—®ä¾›åº”å•†ç®¡ç†', () => {
      cy.log('ğŸ”’ éªŒè¯ç”Ÿäº§è®¡åˆ’å‘˜çš„æƒé™è¾¹ç•Œ...')
      
      cy.visit('/suppliers')
      cy.wait(1000)
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°æ— æƒè®¿é—®æç¤º
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ— æƒè®¿é—®') || $body.text().includes('403')) {
          cy.log('âœ… ç¡®è®¤ï¼šç”Ÿäº§è®¡åˆ’å‘˜æ— æ³•è®¿é—®ä¾›åº”å•†ç®¡ç†ï¼ˆæƒé™æ­£ç¡®ï¼‰')
        } else {
          cy.log('âš ï¸ æ³¨æ„ï¼šç”Ÿäº§è®¡åˆ’å‘˜å¯ä»¥è®¿é—®ä¾›åº”å•†ç®¡ç†ï¼Œæƒé™å¯èƒ½éœ€è¦æ£€æŸ¥')
        }
      })
    })

    it('Scene 5.3 - æŸ¥çœ‹è®¢å•åˆ—è¡¨å¹¶æ‰¾åˆ°å¾…ç”Ÿäº§è®¢å•', () => {
      cy.log('ğŸ“‹ ç”Ÿäº§è®¡åˆ’å‘˜æŸ¥çœ‹å¾…ç”Ÿäº§è®¢å•...')
      
      cy.visit('/orders')
      cy.wait(1000)
      
      // éªŒè¯å¯ä»¥çœ‹åˆ°è®¢å•
      if (orderNumber) {
        cy.contains(orderNumber).should('be.visible')
        cy.log(`âœ… æ‰¾åˆ°è®¢å•: ${orderNumber}`)
      } else {
        cy.log('âš ï¸ è®¢å•å·æœªä¿å­˜ï¼Œå°è¯•æŸ¥æ‰¾æœ€æ–°è®¢å•')
        cy.get('.ant-table-tbody tr').first().should('exist')
      }
    })

    it('Scene 5.4 - åˆ›å»ºç”Ÿäº§è®¢å•', () => {
      cy.log('ğŸ­ ç”Ÿäº§è®¡åˆ’å‘˜åˆ›å»ºç”Ÿäº§è®¢å•...')
      
      if (orderNumber) {
        // æ‰¾åˆ°è®¢å•å¹¶ç‚¹å‡»æŸ¥çœ‹
        cy.contains(orderNumber).parent().find('button').contains('æŸ¥çœ‹').click()
        cy.wait(1000)
        
        // ç‚¹å‡»åˆ›å»ºç”Ÿäº§è®¢å•æŒ‰é’®
        cy.get('body').then(($body) => {
          if ($body.text().includes('åˆ›å»ºç”Ÿäº§è®¢å•')) {
            cy.contains('button', 'åˆ›å»ºç”Ÿäº§è®¢å•').click()
            cy.wait(500)
            
            // å¡«å†™ç”Ÿäº§è®¡åˆ’ä¿¡æ¯
            cy.get('.ant-modal').then(($modal) => {
              if ($modal.length > 0) {
                cy.log('ğŸ“ å¡«å†™ç”Ÿäº§è®¡åˆ’ä¿¡æ¯...')
                
                // ä¼˜å…ˆçº§
                cy.get('select[name="priority"]').select('Normal')
                
                // è®¡åˆ’å¼€å§‹æ—¥æœŸ
                cy.get('input[name="plannedStartDate"]').type('2025-11-01')
                
                // è®¡åˆ’å®Œæˆæ—¥æœŸ
                cy.get('input[name="plannedEndDate"]').type('2025-11-30')
                
                // å¤‡æ³¨
                cy.get('textarea[name="notes"]').then(($textarea) => {
                  if ($textarea.length > 0) {
                    cy.wrap($textarea).clear().type('æŒ‰æ ‡å‡†å·¥è‰ºæµç¨‹ç”Ÿäº§ï¼Œæ³¨æ„è´¨é‡æ§åˆ¶ï¼Œé¢„è®¡éœ€è¦30ä¸ªå·¥ä½œæ—¥å®Œæˆ')
                  }
                })
                
                // ç¡®è®¤åˆ›å»º
                cy.contains('.ant-modal button', /ç¡®è®¤åˆ›å»º|åˆ›å»º/).click()
                cy.wait(2000)
                
                cy.log('âœ… ç”Ÿäº§è®¢å•åˆ›å»ºæˆåŠŸ')
              }
            })
          }
        })
      } else {
        cy.log('âš ï¸ æ— æ³•åˆ›å»ºç”Ÿäº§è®¢å•ï¼šè®¢å•å·æœªä¿å­˜')
      }
    })

    it('Scene 5.5 - åœ¨ç”Ÿäº§æ’æœŸé¡µé¢æŸ¥çœ‹æ–°åˆ›å»ºçš„ç”Ÿäº§è®¢å•', () => {
      cy.log('ğŸ“Š æŸ¥çœ‹ç”Ÿäº§æ’æœŸ...')
      
      cy.visit('/production-schedule')
      cy.wait(2000)
      
      // éªŒè¯å¯ä»¥çœ‹åˆ°ç”Ÿäº§è®¢å•
      cy.get('.ant-table-tbody tr').should('have.length.greaterThan', 0)
      cy.log('âœ… ç”Ÿäº§è®¢å•åˆ—è¡¨å·²åŠ è½½')
      
      // ä¿å­˜ç”Ÿäº§è®¢å•å·
      cy.get('.ant-table-tbody tr').first().then(($row) => {
        cy.wrap($row).find('td').first().invoke('text').then((text) => {
          productionOrderNumber = text.trim()
          cy.log(`ğŸ“Œ ç”Ÿäº§è®¢å•å·å·²ä¿å­˜: ${productionOrderNumber}`)
        })
      })
    })

    it('Scene 5.6 - å¼€å§‹ç”Ÿäº§', () => {
      cy.log('â–¶ï¸ ç”Ÿäº§è®¡åˆ’å‘˜å¯åŠ¨ç”Ÿäº§...')
      
      if (productionOrderNumber) {
        // æ‰¾åˆ°ç”Ÿäº§è®¢å•å¹¶ç‚¹å‡»æ“ä½œ
        cy.contains('td', productionOrderNumber)
          .parent()
          .find('[class*="ant-dropdown-trigger"]')
          .click()
        
        cy.wait(500)
        
        // ç‚¹å‡»"å¼€å§‹ç”Ÿäº§"
        cy.contains('å¼€å§‹ç”Ÿäº§').click()
        cy.wait(1000)
        
        // éªŒè¯çŠ¶æ€å·²æ›´æ–°
        cy.contains('ç”Ÿäº§ä¸­').should('be.visible')
        cy.log('âœ… ç”Ÿäº§å·²å¯åŠ¨')
      } else {
        cy.log('âš ï¸ æ— æ³•å¯åŠ¨ç”Ÿäº§ï¼šç”Ÿäº§è®¢å•å·æœªä¿å­˜')
      }
    })

    it('Scene 5.7 - æ›´æ–°ç”Ÿäº§è¿›åº¦', () => {
      cy.log('ğŸ“Š æ›´æ–°ç”Ÿäº§è¿›åº¦...')
      
      // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´æ–°ç”Ÿäº§è¿›åº¦çš„é€»è¾‘
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ›´æ–°è¿›åº¦')) {
          cy.log('å‘ç°æ›´æ–°è¿›åº¦åŠŸèƒ½ï¼Œæ‰§è¡Œæ›´æ–°...')
          // æ·»åŠ æ›´æ–°è¿›åº¦çš„ä»£ç 
        } else {
          cy.log('â„¹ï¸ å½“å‰é¡µé¢æ²¡æœ‰æ›´æ–°è¿›åº¦åŠŸèƒ½')
        }
      })
    })

    it('Scene 5.8 - ç”Ÿäº§è®¡åˆ’å‘˜ç™»å‡º', () => {
      cy.log('ğŸ­ ç”Ÿäº§è®¡åˆ’å‘˜å®Œæˆäº†æ’æœŸå·¥ä½œ')
      cy.logout()
      cy.log('âœ… ç”Ÿäº§è®¡åˆ’å‘˜å·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬å…­å¹•ï¼šé‡‡è´­ä¸“å‘˜ç®¡ç†ä¾›åº”å•†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šé‡‡è´­ä¸“å‘˜ å­™å·¥ éœ€è¦ä¸ºç”Ÿäº§å‡†å¤‡åŸææ–™å’Œé›¶éƒ¨ä»¶ã€‚
  // å¥¹ç™»å½•ç³»ç»ŸæŸ¥çœ‹ä¾›åº”å•†ä¿¡æ¯ï¼Œç¡®ä¿ä¾›åº”é“¾ç¨³å®šã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 6: Procurement Specialist Manages Suppliers', () => {
    
    it('Scene 6.1 - é‡‡è´­ä¸“å‘˜ç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ“¦ è§’è‰²ç™»åœº: é‡‡è´­ä¸“å‘˜')
      cy.loginAs('procurementSpecialist')
      
      cy.url().should('include', '/dashboard')
      cy.contains('é‡‡è´­ä¸“å‘˜').should('be.visible')
      
      cy.log('âœ… é‡‡è´­ä¸“å‘˜æˆåŠŸç™»å½•')
    })

    it('Scene 6.2 - è®¿é—®ä¾›åº”å•†ç®¡ç†é¡µé¢', () => {
      cy.log('ğŸ‘¥ é‡‡è´­ä¸“å‘˜æŸ¥çœ‹ä¾›åº”å•†åˆ—è¡¨...')
      
      cy.visit('/suppliers')
      cy.wait(1000)
      
      // éªŒè¯ï¼šé‡‡è´­ä¸“å‘˜å¯ä»¥è®¿é—®ä¾›åº”å•†ç®¡ç†
      cy.contains('ä¾›åº”å•†ç®¡ç†').should('be.visible')
      cy.log('âœ… é‡‡è´­ä¸“å‘˜å¯ä»¥è®¿é—®ä¾›åº”å•†ç®¡ç†é¡µé¢')
      
      // éªŒè¯ï¼šå¯ä»¥çœ‹åˆ°ä¾›åº”å•†åˆ—è¡¨
      cy.get('.ant-table-tbody').should('exist')
      cy.log('âœ… ä¾›åº”å•†åˆ—è¡¨å·²åŠ è½½')
    })

    it('Scene 6.3 - éªŒè¯é‡‡è´­ä¸“å‘˜æœ‰ç¼–è¾‘æƒé™', () => {
      cy.log('ğŸ” éªŒè¯é‡‡è´­ä¸“å‘˜çš„æ“ä½œæƒé™...')
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°"æ–°å»ºä¾›åº”å•†"æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ–°å»ºä¾›åº”å•†') || $body.text().includes('æ·»åŠ ä¾›åº”å•†')) {
          cy.log('âœ… ç¡®è®¤ï¼šé‡‡è´­ä¸“å‘˜æœ‰æ–°å»ºä¾›åº”å•†æƒé™')
        }
      })
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°ç¼–è¾‘æŒ‰é’®
      cy.get('.ant-table-tbody tr').first().then(($row) => {
        if ($row.find('button').length > 0) {
          cy.log('âœ… ç¡®è®¤ï¼šé‡‡è´­ä¸“å‘˜æœ‰ç¼–è¾‘ä¾›åº”å•†æƒé™')
        }
      })
    })

    it('Scene 6.4 - éªŒè¯é‡‡è´­ä¸“å‘˜æ— æ³•è®¿é—®ç”Ÿäº§æ’æœŸ', () => {
      cy.log('ğŸ”’ éªŒè¯é‡‡è´­ä¸“å‘˜çš„æƒé™è¾¹ç•Œ...')
      
      cy.visit('/production-schedule')
      cy.wait(1000)
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°æ— æƒè®¿é—®æç¤º
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ— æƒè®¿é—®') || $body.text().includes('403')) {
          cy.log('âœ… ç¡®è®¤ï¼šé‡‡è´­ä¸“å‘˜æ— æ³•è®¿é—®ç”Ÿäº§æ’æœŸï¼ˆæƒé™æ­£ç¡®ï¼‰')
        } else {
          cy.log('âš ï¸ æ³¨æ„ï¼šé‡‡è´­ä¸“å‘˜å¯ä»¥è®¿é—®ç”Ÿäº§æ’æœŸï¼Œæƒé™å¯èƒ½éœ€è¦æ£€æŸ¥')
        }
      })
    })

    it('Scene 6.5 - é‡‡è´­ä¸“å‘˜ç™»å‡º', () => {
      cy.log('ğŸ“¦ é‡‡è´­ä¸“å‘˜å®Œæˆäº†ä¾›åº”å•†æ£€æŸ¥')
      cy.logout()
      cy.log('âœ… é‡‡è´­ä¸“å‘˜å·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬ä¸ƒå¹•ï¼šå”®åå·¥ç¨‹å¸ˆå¤„ç†æœåŠ¡å·¥å•
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šæ—¶é—´è¿‡å»äº†3ä¸ªæœˆï¼Œè®¾å¤‡å·²ç»äº¤ä»˜å¹¶æŠ•å…¥ä½¿ç”¨ã€‚
  // å®¢æˆ·æŠ¥å‘Šäº†ä¸€ä¸ªå°é—®é¢˜ï¼Œå”®åå·¥ç¨‹å¸ˆ å‘¨å·¥ ç«‹å³åˆ›å»ºå·¥å•å¹¶è·Ÿè¿›ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 7: After-sales Engineer Handles Service Ticket', () => {
    
    it('Scene 7.1 - å”®åå·¥ç¨‹å¸ˆç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ« è§’è‰²ç™»åœº: å”®åå·¥ç¨‹å¸ˆ')
      cy.loginAs('aftersalesEngineer')
      
      cy.url().should('include', '/dashboard')
      cy.contains('å”®åå·¥ç¨‹å¸ˆ').should('be.visible')
      
      cy.log('âœ… å”®åå·¥ç¨‹å¸ˆæˆåŠŸç™»å½•')
    })

    it('Scene 7.2 - éªŒè¯é»˜è®¤æ˜¾ç¤º"æˆ‘çš„å·¥å•"', () => {
      cy.log('ğŸ« éªŒè¯å”®åå·¥ç¨‹å¸ˆçš„å·¥å•ç­›é€‰...')
      
      cy.visit('/service-center')
      cy.wait(1000)
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°"æˆ‘çš„å·¥å•"ç›¸å…³æç¤ºæˆ–æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('æˆ‘çš„å·¥å•')) {
          cy.log('âœ… ç¡®è®¤ï¼šé»˜è®¤æ˜¾ç¤º"æˆ‘çš„å·¥å•"ç­›é€‰')
        } else {
          cy.log('â„¹ï¸ æœªæ‰¾åˆ°"æˆ‘çš„å·¥å•"æç¤ºï¼Œå¯èƒ½ç•Œé¢ä¸åŒ')
        }
      })
    })

    it('Scene 7.3 - åˆ›å»ºæ–°çš„æœåŠ¡å·¥å•', () => {
      cy.log('ğŸ« å”®åå·¥ç¨‹å¸ˆåˆ›å»ºæœåŠ¡å·¥å•...')
      
      cy.visit('/service-center')
      cy.wait(1000)
      
      // ç‚¹å‡»åˆ›å»ºå·¥å•æŒ‰é’®
      cy.get('body').then(($body) => {
        if ($body.text().includes('åˆ›å»ºå·¥å•')) {
          cy.contains('button', 'åˆ›å»ºå·¥å•').click()
          cy.wait(500)
          
          // å¡«å†™å·¥å•ä¿¡æ¯
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              cy.log('ğŸ“ å¡«å†™å·¥å•ä¿¡æ¯...')
              
              // å·¥å•ç±»å‹
              cy.get('select[name="ticketType"]').select('Maintenance')
              
              // ä¼˜å…ˆçº§
              cy.get('select[name="priority"]').select('High')
              
              // å®¢æˆ·åç§°
              cy.get('input[name="customerName"]').type(clientName)
              
              // å®¢æˆ·ç”µè¯
              cy.get('input[name="customerPhone"]').type(contactPhone)
              
              // é—®é¢˜æ ‡é¢˜
              cy.get('input[name="issueTitle"]').type('æ‰§è¡Œå™¨å®šæœŸç»´æŠ¤æ£€æŸ¥')
              
              // é—®é¢˜æè¿°
              cy.get('textarea[name="issueDescription"]').type('å®¢æˆ·è¦æ±‚å¯¹å·²å®‰è£…çš„AT-150å’ŒGY-200æ‰§è¡Œå™¨è¿›è¡Œå­£åº¦ä¾‹è¡Œç»´æŠ¤æ£€æŸ¥ï¼Œç¡®ä¿è®¾å¤‡æ­£å¸¸è¿è¡Œã€‚')
              
              // æäº¤å·¥å•
              cy.contains('.ant-modal button', /åˆ›å»º|æäº¤/).click()
              cy.wait(2000)
              
              cy.log('âœ… æœåŠ¡å·¥å•åˆ›å»ºæˆåŠŸ')
            }
          })
        }
      })
    })

    it('Scene 7.4 - æŸ¥çœ‹å·¥å•è¯¦æƒ…å¹¶æ·»åŠ è·Ÿè¿›è®°å½•', () => {
      cy.log('ğŸ“ æ·»åŠ è·Ÿè¿›è®°å½•...')
      
      cy.visit('/service-center')
      cy.wait(1000)
      
      // ç‚¹å‡»ç¬¬ä¸€ä¸ªå·¥å•çš„æŸ¥çœ‹æŒ‰é’®
      cy.get('.ant-table-tbody tr').first().find('button').contains('æŸ¥çœ‹').click()
      cy.wait(1000)
      
      // æ·»åŠ è·Ÿè¿›è®°å½•
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ·»åŠ è·Ÿè¿›')) {
          cy.contains('button', 'æ·»åŠ è·Ÿè¿›').click()
          cy.wait(500)
          
          cy.get('.ant-modal').then(($modal) => {
            if ($modal.length > 0) {
              // è·Ÿè¿›ç±»å‹
              cy.get('select[name="type"]').select('Call')
              
              // è·Ÿè¿›å†…å®¹
              cy.get('textarea[name="content"]').type('å·²ä¸å®¢æˆ·è”ç³»ï¼Œç¡®è®¤ç»´æŠ¤æ—¶é—´ä¸ºä¸‹å‘¨ä¸‰ä¸Šåˆ9ç‚¹ï¼Œå®¢æˆ·ç°åœºè´Ÿè´£äººï¼šæå·¥')
              
              // æäº¤
              cy.contains('.ant-modal button', 'æ·»åŠ ').click()
              cy.wait(1000)
              
              cy.log('âœ… è·Ÿè¿›è®°å½•æ·»åŠ æˆåŠŸ')
            }
          })
        }
      })
    })

    it('Scene 7.5 - éªŒè¯å”®åå·¥ç¨‹å¸ˆæ— æ³•è®¿é—®ä¾›åº”å•†ç®¡ç†', () => {
      cy.log('ğŸ”’ éªŒè¯å”®åå·¥ç¨‹å¸ˆçš„æƒé™è¾¹ç•Œ...')
      
      cy.visit('/suppliers')
      cy.wait(1000)
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°æ— æƒè®¿é—®æç¤º
      cy.get('body').then(($body) => {
        if ($body.text().includes('æ— æƒè®¿é—®') || $body.text().includes('403')) {
          cy.log('âœ… ç¡®è®¤ï¼šå”®åå·¥ç¨‹å¸ˆæ— æ³•è®¿é—®ä¾›åº”å•†ç®¡ç†ï¼ˆæƒé™æ­£ç¡®ï¼‰')
        }
      })
    })

    it('Scene 7.6 - å”®åå·¥ç¨‹å¸ˆç™»å‡º', () => {
      cy.log('ğŸ« å”®åå·¥ç¨‹å¸ˆå®Œæˆäº†å·¥å•åˆ›å»º')
      cy.logout()
      cy.log('âœ… å”®åå·¥ç¨‹å¸ˆå·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç¬¬å…«å¹•ï¼šç®¡ç†å‘˜å…¨å±€ç›‘æ§
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šç®¡ç†å‘˜ ç³»ç»Ÿç®¡ç†å‘˜ éœ€è¦æŸ¥çœ‹æ•´ä¸ªé¡¹ç›®çš„è¿›å±•æƒ…å†µï¼Œ
  // ç¡®ä¿æ‰€æœ‰æµç¨‹é¡ºåˆ©è¿›è¡Œï¼Œå„è§’è‰²ååŒè‰¯å¥½ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Act 8: Administrator Global Monitoring', () => {
    
    it('Scene 8.1 - ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿ', () => {
      cy.log('ğŸ‘‘ è§’è‰²ç™»åœº: ç³»ç»Ÿç®¡ç†å‘˜')
      cy.loginAs('admin')
      
      cy.url().should('include', '/dashboard')
      cy.contains('ç®¡ç†å‘˜').should('be.visible')
      
      cy.log('âœ… ç®¡ç†å‘˜æˆåŠŸç™»å½•')
    })

    it('Scene 8.2 - éªŒè¯ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰é¡µé¢', () => {
      cy.log('ğŸ”“ éªŒè¯ç®¡ç†å‘˜çš„å…¨å±€è®¿é—®æƒé™...')
      
      const pages = [
        { path: '/projects', title: 'é¡¹ç›®ç®¡ç†' },
        { path: '/orders', title: 'è®¢å•ç®¡ç†' },
        { path: '/production-schedule', title: 'ç”Ÿäº§æ’æœŸ' },
        { path: '/suppliers', title: 'ä¾›åº”å•†ç®¡ç†' },
        { path: '/service-center', title: 'å”®åæœåŠ¡' }
      ]
      
      pages.forEach((page) => {
        cy.visit(page.path)
        cy.wait(500)
        cy.contains(page.title).should('be.visible')
        cy.log(`âœ… ç®¡ç†å‘˜å¯ä»¥è®¿é—®: ${page.title}`)
      })
    })

    it('Scene 8.3 - æŸ¥çœ‹é¡¹ç›®æ•´ä½“çŠ¶æ€', () => {
      cy.log('ğŸ“Š ç®¡ç†å‘˜æŸ¥çœ‹é¡¹ç›®çŠ¶æ€...')
      
      cy.visit('/projects')
      cy.wait(1000)
      
      // æŸ¥æ‰¾æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®
      if (projectName) {
        cy.contains('td', projectName).should('be.visible')
        
        // éªŒè¯é¡¹ç›®çŠ¶æ€
        cy.contains('td', projectName).parent().then(($row) => {
          const rowText = $row.text()
          if (rowText.includes('èµ¢å•') || rowText.includes('Won')) {
            cy.log('âœ… é¡¹ç›®çŠ¶æ€ä¸º"èµ¢å•"')
          }
        })
      }
    })

    it('Scene 8.4 - æŸ¥çœ‹ç”Ÿäº§è®¢å•ï¼ˆå®Œæ•´æƒé™ï¼‰', () => {
      cy.log('ğŸ­ ç®¡ç†å‘˜æŸ¥çœ‹ç”Ÿäº§è®¢å•...')
      
      cy.visit('/production-schedule')
      cy.wait(1000)
      
      // éªŒè¯ï¼šä¸åº”è¯¥çœ‹åˆ°åªè¯»æ¨¡å¼æç¤º
      cy.get('body').then(($body) => {
        if (!$body.text().includes('åªè¯»æ¨¡å¼')) {
          cy.log('âœ… ç¡®è®¤ï¼šç®¡ç†å‘˜å¤„äºå®Œæ•´æƒé™æ¨¡å¼')
        }
      })
      
      // éªŒè¯ï¼šåº”è¯¥çœ‹åˆ°æ“ä½œæŒ‰é’®
      cy.get('.ant-table-tbody tr').first().find('button').should('exist')
      cy.log('âœ… ç®¡ç†å‘˜æœ‰ç”Ÿäº§è®¢å•æ“ä½œæƒé™')
    })

    it('Scene 8.5 - å®Œæˆç”Ÿäº§è®¢å•', () => {
      cy.log('âœ… ç®¡ç†å‘˜æ ‡è®°ç”Ÿäº§è®¢å•å®Œæˆ...')
      
      if (productionOrderNumber) {
        cy.visit('/production-schedule')
        cy.wait(1000)
        
        // æ‰¾åˆ°ç”Ÿäº§è®¢å•å¹¶æ ‡è®°å®Œæˆ
        cy.contains('td', productionOrderNumber)
          .parent()
          .find('[class*="ant-dropdown-trigger"]')
          .click()
        
        cy.wait(500)
        
        cy.contains('æ ‡è®°å®Œæˆ').click()
        cy.wait(1000)
        
        // éªŒè¯çŠ¶æ€å·²æ›´æ–°
        cy.contains('å·²å®Œæˆ').should('be.visible')
        cy.log('âœ… ç”Ÿäº§è®¢å•å·²æ ‡è®°ä¸ºå®Œæˆ')
      } else {
        cy.log('âš ï¸ ç”Ÿäº§è®¢å•å·æœªä¿å­˜ï¼Œè·³è¿‡å®Œæˆæ“ä½œ')
      }
    })

    it('Scene 8.6 - æŸ¥çœ‹å”®åå·¥å•', () => {
      cy.log('ğŸ« ç®¡ç†å‘˜æŸ¥çœ‹å”®åå·¥å•...')
      
      cy.visit('/service-center')
      cy.wait(1000)
      
      // éªŒè¯å¯ä»¥çœ‹åˆ°å·¥å•åˆ—è¡¨
      cy.get('.ant-table-tbody').should('exist')
      cy.log('âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å”®åå·¥å•')
    })

    it('Scene 8.7 - ç®¡ç†å‘˜ç™»å‡º', () => {
      cy.log('ğŸ‘‘ ç®¡ç†å‘˜å®Œæˆäº†å…¨å±€ç›‘æ§')
      cy.logout()
      cy.log('âœ… ç®¡ç†å‘˜å·²ç™»å‡º')
    })
  })

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ­ ç»ˆå¹•ï¼šæ•°æ®éªŒè¯å’Œæ€»ç»“
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 
  // åœºæ™¯ï¼šæµ‹è¯•å³å°†ç»“æŸï¼Œè®©æˆ‘ä»¬éªŒè¯æ•´ä¸ªæµç¨‹çš„å®Œæ•´æ€§å’Œæ•°æ®ä¸€è‡´æ€§ã€‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  context('ğŸ¬ Finale: Data Verification and Summary', () => {
    
    before(() => {
      cy.loginAs('admin')
    })

    it('Epilogue 1 - éªŒè¯é¡¹ç›®æ•°æ®å®Œæ•´æ€§', () => {
      cy.log('ğŸ” éªŒè¯é¡¹ç›®æ•°æ®...')
      
      if (projectId) {
        cy.visit(`/projects/${projectId}`)
        cy.wait(1000)
        
        // éªŒè¯é¡¹ç›®åŸºæœ¬ä¿¡æ¯
        cy.contains(projectName).should('be.visible')
        cy.contains(clientName).should('be.visible')
        cy.log('âœ… é¡¹ç›®åŸºæœ¬ä¿¡æ¯å®Œæ•´')
        
        // éªŒè¯é€‰å‹æ•°æ®
        cy.contains('.ant-tabs-tab', 'é€‰å‹æ˜ç»†').click()
        cy.wait(500)
        cy.get('.ant-table-tbody tr').should('have.length.greaterThan', 0)
        cy.log('âœ… é€‰å‹æ•°æ®å­˜åœ¨')
        
        // éªŒè¯BOMæ•°æ®
        cy.contains('.ant-tabs-tab', 'BOMæ¸…å•').click()
        cy.wait(500)
        cy.get('.ant-table-tbody tr').should('have.length.greaterThan', 0)
        cy.log('âœ… BOMæ•°æ®å­˜åœ¨')
      }
    })

    it('Epilogue 2 - éªŒè¯è®¢å•çŠ¶æ€', () => {
      cy.log('ğŸ” éªŒè¯è®¢å•çŠ¶æ€...')
      
      if (orderNumber) {
        cy.visit('/orders')
        cy.wait(1000)
        cy.contains(orderNumber).should('be.visible')
        cy.log('âœ… è®¢å•å­˜åœ¨äºç³»ç»Ÿä¸­')
      } else {
        cy.log('â„¹ï¸ è®¢å•å·æœªä¿å­˜ï¼Œè·³è¿‡éªŒè¯')
      }
    })

    it('Epilogue 3 - éªŒè¯ç”Ÿäº§è®¢å•çŠ¶æ€', () => {
      cy.log('ğŸ” éªŒè¯ç”Ÿäº§è®¢å•çŠ¶æ€...')
      
      if (productionOrderNumber) {
        cy.visit('/production-schedule')
        cy.wait(1000)
        cy.contains(productionOrderNumber).should('be.visible')
        cy.log('âœ… ç”Ÿäº§è®¢å•å­˜åœ¨äºç³»ç»Ÿä¸­')
      } else {
        cy.log('â„¹ï¸ ç”Ÿäº§è®¢å•å·æœªä¿å­˜ï¼Œè·³è¿‡éªŒè¯')
      }
    })

    it('Epilogue 4 - éªŒè¯å”®åå·¥å•', () => {
      cy.log('ğŸ” éªŒè¯å”®åå·¥å•...')
      
      cy.visit('/service-center')
      cy.wait(1000)
      cy.get('.ant-table-tbody tr').should('exist')
      cy.log('âœ… å”®åå·¥å•å­˜åœ¨äºç³»ç»Ÿä¸­')
    })

    it('Epilogue 5 - æµ‹è¯•æ•°æ®æ±‡æ€»', () => {
      cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
      cy.log('ğŸ“Š æµ‹è¯•å®Œæˆï¼ä»¥ä¸‹æ˜¯å®Œæ•´çš„æ•°æ®æ±‡æ€»ï¼š')
      cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
      cy.log(`ğŸ“‹ é¡¹ç›®åç§°: ${projectName}`)
      cy.log(`ğŸ¢ å®¢æˆ·åç§°: ${clientName}`)
      cy.log(`ğŸ“Œ é¡¹ç›®ID: ${projectId || 'N/A'}`)
      cy.log(`ğŸ“ è®¢å•å·: ${orderNumber || 'N/A'}`)
      cy.log(`ğŸ­ ç”Ÿäº§è®¢å•å·: ${productionOrderNumber || 'N/A'}`)
      cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
      cy.log('ğŸ­ æ¼”å‡ºè§’è‰²ï¼š')
      cy.log('   ğŸ‘” é”€å”®ç»ç† - é¡¹ç›®å‘èµ·å’Œå•†åŠ¡ç®¡ç†')
      cy.log('   ğŸ”§ æŠ€æœ¯å·¥ç¨‹å¸ˆ - æŠ€æœ¯é€‰å‹å’Œæ–¹æ¡ˆè®¾è®¡')
      cy.log('   ğŸ’¼ å•†åŠ¡å·¥ç¨‹å¸ˆ - BOMç®¡ç†å’ŒæŠ¥ä»·')
      cy.log('   ğŸ­ ç”Ÿäº§è®¡åˆ’å‘˜ - ç”Ÿäº§æ’æœŸå’Œè¿›åº¦ç®¡ç†')
      cy.log('   ğŸ“¦ é‡‡è´­ä¸“å‘˜ - ä¾›åº”å•†ç®¡ç†')
      cy.log('   ğŸ« å”®åå·¥ç¨‹å¸ˆ - å”®åæœåŠ¡')
      cy.log('   ğŸ‘‘ ç®¡ç†å‘˜ - å…¨å±€ç›‘æ§')
      cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
      cy.log('ğŸŠ æ­å–œï¼å¤šè§’è‰²ååŒå·¥ä½œæµæµ‹è¯•åœ†æ»¡å®Œæˆï¼')
      cy.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    })

    after(() => {
      cy.logout()
    })
  })
})
