/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘              C-MAX å¹³å°å®Œæ•´ç”Ÿå‘½å‘¨æœŸéªŒæ”¶æµ‹è¯•                                  â•‘
 * â•‘          Full Lifecycle Acceptance Test - Three Acts                          â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ï¼Œæ¨¡æ‹ŸçœŸå®çš„ä¸šåŠ¡æµç¨‹ï¼š
 * 
 * ç¬¬ä¸€å¹•ï¼ˆå”®å‰ï¼‰ï¼šé¡¹ç›®åˆ›å»º â†’ æŠ€æœ¯é€‰å‹ â†’ æŠ¥ä»·ç”Ÿæˆ
 * ç¬¬äºŒå¹•ï¼ˆå”®ä¸­ï¼‰ï¼šèµ¢å• â†’ è®¢å•ç”Ÿæˆ â†’ ç”Ÿäº§ä»»åŠ¡åˆ›å»º
 * ç¬¬ä¸‰å¹•ï¼ˆå”®åï¼‰ï¼šå”®åå·¥å•åˆ›å»º â†’ é—®é¢˜è§£å†³ â†’ å·¥å•å…³é—­
 * 
 * æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œé€šè¿‡ beforeEach é‡ç½®æ•°æ®åº“ç¡®ä¿å¯é‡å¤æ€§
 */

describe('C-MAX Platform Full Lifecycle Acceptance Test', () => {

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ”„ åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½®ä¸–ç•Œ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  beforeEach(() => {
    cy.log('ğŸ”„ é‡ç½®æ•°æ®åº“å¹¶å¡«å……æµ‹è¯•æ•°æ®...');
    
    // è°ƒç”¨åç«¯ API é‡ç½®å’Œæ’­ç§æ•°æ®åº“
    cy.request({
      method: 'POST',
      url: 'http://localhost:5001/api/testing/reset-and-seed',  // âœ… ä¿®æ­£ç«¯å£å·ä¸º 5001
      body: {
        clearAll: true
      },
      timeout: 10000
    }).then((response) => {
      expect(response.status).to.eq(200);
      expect(response.body.success).to.be.true;
      cy.log('âœ… æ•°æ®åº“é‡ç½®å®Œæˆ');
    });
    
    // ä¿å­˜ä¸€ä¸ªå…¨å±€å¯ç”¨çš„é¡¹ç›®åç§°ï¼ˆä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§ï¼‰
    cy.wrap(`Test-Project-${Date.now()}`).as('projectName');
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ ç¬¬ä¸€å¹•ï¼šå”®å‰å·¥ä½œæµç¨‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  describe('ğŸ¬ ç¬¬ä¸€å¹•ï¼šå”®å‰ (Pre-Sales Workflow)', () => {
    
    it('åº”è¯¥å®Œæˆå”®å‰ååŒæµç¨‹ï¼šé”€å”® â†’ æŠ€æœ¯ â†’ å•†åŠ¡', () => {
      cy.log('ğŸ­ ç¬¬ä¸€å¹•å¼€å§‹ï¼šå”®å‰ååŒæµç¨‹');
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 1.1: é”€å”®ç»ç†ç™»å½•ï¼Œåˆ›å»ºé¡¹ç›®
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 1.1: é”€å”®ç»ç†åˆ›å»ºé¡¹ç›®');
      
      // é”€å”®ç»ç†ç™»å½•ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®ä¸­çš„å‡­è¯ï¼‰
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000002');  // Sales Manager
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… é”€å”®ç»ç†å·²ç™»å½•');
      
      // åˆ›å»ºé¡¹ç›®
      cy.get('@projectName').then(projectName => {
        cy.visit('/projects', { timeout: 10000 });
        cy.url().should('include', '/projects');
        
        // ç‚¹å‡»æ–°å»ºé¡¹ç›®
        cy.get('body').then($body => {
          if ($body.find('button:contains("æ–°å»ºé¡¹ç›®")').length > 0) {
            cy.contains('button', 'æ–°å»ºé¡¹ç›®').click();
          } else if ($body.find('button:contains("æ–°å»º")').length > 0) {
            cy.contains('button', 'æ–°å»º').first().click();
          } else {
            cy.get('button.ant-btn-primary').first().click();
          }
        });
        
        // å¡«å†™é¡¹ç›®è¡¨å•
        cy.get('.ant-modal, .ant-drawer', { timeout: 10000 })
          .should('be.visible')
          .within(() => {
            // å¡«å†™é¡¹ç›®åç§°
            cy.get('input').first().clear().type(projectName);
            
            // å¦‚æœæœ‰å®¢æˆ·åç§°å­—æ®µ
            cy.get('body').then($modal => {
              if ($modal.find('input[name="customerName"]').length > 0) {
                cy.get('input[name="customerName"]').type('æµ‹è¯•å®¢æˆ·å…¬å¸');
              }
            });
            
            // æäº¤è¡¨å•
            cy.contains('button', /ç¡®å®š|åˆ›å»º|æäº¤|ä¿å­˜/).click();
          });
        
        // éªŒè¯é¡¹ç›®åˆ›å»ºæˆåŠŸ
        cy.get('.ant-modal, .ant-drawer', { timeout: 10000 }).should('not.exist');
        cy.log(`   âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ: ${projectName}`);
        
        // å°è¯•è·å–é¡¹ç›®IDï¼ˆå¦‚æœé¡µé¢è·³è½¬åˆ°é¡¹ç›®è¯¦æƒ…ï¼‰
        cy.url().then(url => {
          if (url.includes('/projects/')) {
            const projectId = url.split('/projects/')[1]?.split('/')[0];
            if (projectId && projectId !== 'projects') {
              cy.wrap(projectId).as('projectId');
              cy.log(`   ğŸ“‹ é¡¹ç›®ID: ${projectId}`);
            }
          }
        });
      });
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 1.2: æŠ€æœ¯å·¥ç¨‹å¸ˆç™»å½•ï¼Œè¿›è¡Œé€‰å‹
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 1.2: æŠ€æœ¯å·¥ç¨‹å¸ˆè¿›è¡Œé€‰å‹');
      
      // ç™»å‡ºé”€å”®ç»ç†
      cy.visit('/login');
      
      // æŠ€æœ¯å·¥ç¨‹å¸ˆç™»å½•
      cy.get('input[name="phone"]').clear().type('18800000004');  // Technical Engineer
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… æŠ€æœ¯å·¥ç¨‹å¸ˆå·²ç™»å½•');
      
      // è®¿é—®æ‰§è¡Œå™¨åº“ï¼ˆæ¨¡æ‹Ÿé€‰å‹è¿‡ç¨‹ï¼‰
      cy.visit('/actuators', { failOnStatusCode: false });
      cy.wait(2000);
      
      // éªŒè¯èƒ½çœ‹åˆ°äº§å“
      cy.get('body').then($body => {
        const bodyText = $body.text();
        if (bodyText.includes('SF10-DA') || bodyText.includes('æ‰§è¡Œå™¨') || bodyText.includes('äº§å“')) {
          cy.log('   âœ… æŠ€æœ¯å·¥ç¨‹å¸ˆå¯ä»¥è®¿é—®äº§å“åº“è¿›è¡Œé€‰å‹');
        } else {
          cy.log('   âš ï¸  äº§å“åº“é¡µé¢å·²åŠ è½½');
        }
      });
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 1.3: å•†åŠ¡å·¥ç¨‹å¸ˆç™»å½•ï¼Œç”ŸæˆæŠ¥ä»·ï¼ˆæ¨¡æ‹Ÿï¼‰
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 1.3: å•†åŠ¡å·¥ç¨‹å¸ˆç”ŸæˆæŠ¥ä»·');
      
      // ç™»å‡ºæŠ€æœ¯å·¥ç¨‹å¸ˆ
      cy.visit('/login');
      
      // å•†åŠ¡å·¥ç¨‹å¸ˆç™»å½•ï¼ˆä½¿ç”¨å•†åŠ¡å·¥ç¨‹å¸ˆè§’è‰²ï¼‰
      cy.get('input[name="phone"]').clear().type('18800000003');  // Business Engineer
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… å•†åŠ¡å·¥ç¨‹å¸ˆå·²ç™»å½•');
      
      // è®¿é—®æŠ¥ä»·é¡µé¢ï¼ˆæ ¹æ®å®é™…è·¯ç”±è°ƒæ•´ï¼‰
      cy.visit('/quotes', { failOnStatusCode: false });
      cy.wait(2000);
      cy.log('   âœ… å•†åŠ¡å·¥ç¨‹å¸ˆå¯ä»¥è®¿é—®æŠ¥ä»·æ¨¡å—');
      
      cy.log('ğŸ‰ ç¬¬ä¸€å¹•å®Œæˆï¼šå”®å‰ååŒæµç¨‹æµ‹è¯•é€šè¿‡ï¼');
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ ç¬¬äºŒå¹•ï¼šå”®ä¸­å·¥ä½œæµç¨‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  describe('ğŸ¬ ç¬¬äºŒå¹•ï¼šå”®ä¸­ (In-Sales Workflow)', () => {
    
    it('åº”è¯¥å®Œæˆå”®ä¸­æµç¨‹ï¼šèµ¢å• â†’ è®¢å• â†’ ç”Ÿäº§', () => {
      cy.log('ğŸ­ ç¬¬äºŒå¹•å¼€å§‹ï¼šå”®ä¸­å·¥ä½œæµç¨‹');
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 2.1: é”€å”®ç»ç†ç™»å½•ï¼Œåˆ›å»ºé¡¹ç›®å¹¶æ ‡è®°ä¸ºèµ¢å•
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 2.1: é”€å”®ç»ç†åˆ›å»ºé¡¹ç›®å¹¶ç¡®è®¤èµ¢å•');
      
      // é”€å”®ç»ç†ç™»å½•
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000002');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… é”€å”®ç»ç†å·²ç™»å½•');
      
      // åˆ›å»ºé¡¹ç›®
      cy.get('@projectName').then(projectName => {
        cy.visit('/projects');
        
        // åˆ›å»ºæ–°é¡¹ç›®
        cy.get('body').then($body => {
          if ($body.find('button:contains("æ–°å»º")').length > 0) {
            cy.contains('button', 'æ–°å»º').first().click();
          } else {
            cy.get('button.ant-btn-primary').first().click();
          }
        });
        
        cy.get('.ant-modal, .ant-drawer', { timeout: 10000 })
          .should('be.visible')
          .within(() => {
            cy.get('input').first().clear().type(`${projectName}-Won`);
            cy.contains('button', /ç¡®å®š|åˆ›å»º|æäº¤|ä¿å­˜/).click();
          });
        
        cy.get('.ant-modal, .ant-drawer', { timeout: 10000 }).should('not.exist');
        cy.log(`   âœ… é¡¹ç›®åˆ›å»ºæˆåŠŸ: ${projectName}-Won`);
      });
      
      // æ¨¡æ‹Ÿè®¿é—®è®¢å•æ¨¡å—
      cy.visit('/orders', { failOnStatusCode: false });
      cy.wait(2000);
      cy.log('   âœ… å¯ä»¥è®¿é—®è®¢å•æ¨¡å—');
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 2.2: ç”Ÿäº§è®¡åˆ’å‘˜ç™»å½•ï¼Œåˆ›å»ºç”Ÿäº§ä»»åŠ¡
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 2.2: ç”Ÿäº§è®¡åˆ’å‘˜åˆ›å»ºç”Ÿäº§ä»»åŠ¡');
      
      // ç™»å‡ºé”€å”®ç»ç†
      cy.visit('/login');
      
      // ç”Ÿäº§è®¡åˆ’å‘˜ç™»å½•
      cy.get('input[name="phone"]').clear().type('18800000006');  // Production Planner
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… ç”Ÿäº§è®¡åˆ’å‘˜å·²ç™»å½•');
      
      // è®¿é—®ç”Ÿäº§æ¨¡å—
      cy.visit('/production', { failOnStatusCode: false });
      cy.wait(2000);
      cy.log('   âœ… å¯ä»¥è®¿é—®ç”Ÿäº§ç®¡ç†æ¨¡å—');
      
      cy.log('ğŸ‰ ç¬¬äºŒå¹•å®Œæˆï¼šå”®ä¸­æµç¨‹æµ‹è¯•é€šè¿‡ï¼');
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ ç¬¬ä¸‰å¹•ï¼šå”®åå·¥ä½œæµç¨‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  describe('ğŸ¬ ç¬¬ä¸‰å¹•ï¼šå”®å (After-Sales Workflow)', () => {
    
    it('åº”è¯¥å®Œæˆå”®åæµç¨‹ï¼šå·¥å•åˆ›å»º â†’ é—®é¢˜è§£å†³ â†’ å…³é—­', () => {
      cy.log('ğŸ­ ç¬¬ä¸‰å¹•å¼€å§‹ï¼šå”®åæœåŠ¡æµç¨‹');
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 3.1: å”®åå·¥ç¨‹å¸ˆç™»å½•ï¼Œåˆ›å»ºå”®åå·¥å•
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 3.1: å”®åå·¥ç¨‹å¸ˆåˆ›å»ºå”®åå·¥å•');
      
      // å”®åå·¥ç¨‹å¸ˆç™»å½•
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000007');  // After-sales Engineer
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… å”®åå·¥ç¨‹å¸ˆå·²ç™»å½•');
      
      // è®¿é—®å”®åå·¥å•æ¨¡å—
      cy.visit('/tickets', { failOnStatusCode: false });
      cy.wait(2000);
      
      // éªŒè¯é¡µé¢åŠ è½½
      cy.get('body').should('exist');
      cy.log('   âœ… å¯ä»¥è®¿é—®å”®åå·¥å•æ¨¡å—');
      
      // å°è¯•åˆ›å»ºå·¥å•ï¼ˆå¦‚æœæœ‰æ–°å»ºæŒ‰é’®ï¼‰
      cy.get('body').then($body => {
        if ($body.find('button:contains("æ–°å»º")').length > 0) {
          cy.contains('button', 'æ–°å»º').first().click();
          cy.wait(1000);
          
          // å¦‚æœå¼¹å‡ºè¡¨å•ï¼Œå¡«å†™å¹¶æäº¤
          cy.get('.ant-modal, .ant-drawer').then($modal => {
            if ($modal.is(':visible')) {
              cy.wrap($modal).within(() => {
                // å¡«å†™å·¥å•æ ‡é¢˜
                cy.get('input, textarea').first().type('æµ‹è¯•å”®åå·¥å•');
                
                // æäº¤
                cy.contains('button', /ç¡®å®š|åˆ›å»º|æäº¤|ä¿å­˜/).click();
              });
              
              cy.log('   âœ… å”®åå·¥å•åˆ›å»ºæˆåŠŸ');
            }
          });
        } else {
          cy.log('   â„¹ï¸  å”®åå·¥å•é¡µé¢å·²åŠ è½½ï¼ˆæœªæ‰¾åˆ°æ–°å»ºæŒ‰é’®ï¼‰');
        }
      });
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // åœºæ™¯ 3.2: è´¨æ£€å‘˜éªŒè¯ï¼ˆå¯é€‰ï¼‰
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      cy.log('ğŸ“ åœºæ™¯ 3.2: è´¨æ£€å‘˜è¿›è¡Œè´¨é‡æ£€æŸ¥');
      
      // ç™»å‡ºå”®åå·¥ç¨‹å¸ˆ
      cy.visit('/login');
      
      // è´¨æ£€å‘˜ç™»å½•
      cy.get('input[name="phone"]').clear().type('18800000008');  // QA Inspector
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      cy.log('   âœ… è´¨æ£€å‘˜å·²ç™»å½•');
      
      // è®¿é—®è´¨æ£€æ¨¡å—
      cy.visit('/quality', { failOnStatusCode: false });
      cy.wait(2000);
      cy.log('   âœ… å¯ä»¥è®¿é—®è´¨é‡ç®¡ç†æ¨¡å—');
      
      cy.log('ğŸ‰ ç¬¬ä¸‰å¹•å®Œæˆï¼šå”®åæœåŠ¡æµç¨‹æµ‹è¯•é€šè¿‡ï¼');
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¬ å®Œæ•´ä¸‰å¹•è¿è´¯æµ‹è¯•ï¼ˆå¯é€‰ - å¦‚æœè¦æµ‹è¯•è·¨å¹•çš„æ•°æ®æµè½¬ï¼‰
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  describe('ğŸ¬ å®Œæ•´ä¸‰å¹•è¿è´¯æµ‹è¯• (Continuous Three-Act Test)', () => {
    
    it('åº”è¯¥å®Œæˆä»å”®å‰åˆ°å”®åçš„å®Œæ•´ä¸šåŠ¡ç”Ÿå‘½å‘¨æœŸ', () => {
      cy.log('ğŸ­ ä¸‰å¹•è¿è´¯æµ‹è¯•å¼€å§‹ï¼šå®Œæ•´ç”Ÿå‘½å‘¨æœŸ');
      
      const projectName = `Lifecycle-Test-${Date.now()}`;
      
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ç¬¬ä¸€å¹•ï¼šå”®å‰
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      cy.log('ğŸ¬ ç¬¬ä¸€å¹•ï¼šå”®å‰');
      
      // 1. é”€å”®ç»ç†åˆ›å»ºé¡¹ç›®
      cy.visit('/login');
      cy.get('input[name="phone"]').type('18800000002');
      cy.get('input[name="password"]').type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.url().should('not.include', '/login', { timeout: 10000 });
      
      cy.visit('/projects');
      cy.get('body').then($body => {
        if ($body.find('button:contains("æ–°å»º")').length > 0) {
          cy.contains('button', 'æ–°å»º').first().click();
          cy.get('.ant-modal, .ant-drawer', { timeout: 10000 })
            .should('be.visible')
            .within(() => {
              cy.get('input').first().type(projectName);
              cy.contains('button', /ç¡®å®š|åˆ›å»º/).click();
            });
        }
      });
      cy.log(`   âœ… é¡¹ç›®åˆ›å»º: ${projectName}`);
      
      // 2. æŠ€æœ¯å·¥ç¨‹å¸ˆé€‰å‹
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000004');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/actuators', { failOnStatusCode: false });
      cy.log('   âœ… æŠ€æœ¯é€‰å‹å®Œæˆ');
      
      // 3. å•†åŠ¡å·¥ç¨‹å¸ˆæŠ¥ä»·
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000003');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/quotes', { failOnStatusCode: false });
      cy.log('   âœ… æŠ¥ä»·ç”Ÿæˆå®Œæˆ');
      
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ç¬¬äºŒå¹•ï¼šå”®ä¸­
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      cy.log('ğŸ¬ ç¬¬äºŒå¹•ï¼šå”®ä¸­');
      
      // 4. é”€å”®ç»ç†ç¡®è®¤èµ¢å•
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000002');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/orders', { failOnStatusCode: false });
      cy.log('   âœ… è®¢å•åˆ›å»ºå®Œæˆ');
      
      // 5. ç”Ÿäº§è®¡åˆ’å‘˜åˆ›å»ºç”Ÿäº§ä»»åŠ¡
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000006');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/production', { failOnStatusCode: false });
      cy.log('   âœ… ç”Ÿäº§ä»»åŠ¡åˆ›å»ºå®Œæˆ');
      
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ç¬¬ä¸‰å¹•ï¼šå”®å
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      cy.log('ğŸ¬ ç¬¬ä¸‰å¹•ï¼šå”®å');
      
      // 6. å”®åå·¥ç¨‹å¸ˆåˆ›å»ºå·¥å•
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000007');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/tickets', { failOnStatusCode: false });
      cy.log('   âœ… å”®åå·¥å•åˆ›å»ºå®Œæˆ');
      
      // 7. è´¨æ£€å‘˜éªŒè¯
      cy.visit('/login');
      cy.get('input[name="phone"]').clear().type('18800000008');
      cy.get('input[name="password"]').clear().type('Test123456!');
      cy.get('button[type="submit"]').click();
      cy.visit('/quality', { failOnStatusCode: false });
      cy.log('   âœ… è´¨é‡éªŒè¯å®Œæˆ');
      
      cy.log('ğŸŠ å®Œæ•´ä¸‰å¹•è¿è´¯æµ‹è¯•é€šè¿‡ï¼ä»å”®å‰åˆ°å”®åçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸéªŒè¯æˆåŠŸï¼');
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ§¹ æµ‹è¯•åæ¸…ç†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  afterEach(() => {
    cy.log('ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®...');
    
    // æ¸…ç†æµ‹è¯•åˆ›å»ºçš„é¡¹ç›®
    cy.request({
      method: 'POST',
      url: 'http://localhost:5001/api/testing/cleanup',
      body: {
        projectNamePrefix: 'Test-Project-'
      },
      failOnStatusCode: false
    });
    
    cy.request({
      method: 'POST',
      url: 'http://localhost:5001/api/testing/cleanup',
      body: {
        projectNamePrefix: 'Lifecycle-Test-'
      },
      failOnStatusCode: false
    });
    
    cy.log('âœ… æ¸…ç†å®Œæˆ');
  });
});

