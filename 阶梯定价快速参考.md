# é˜¶æ¢¯å®šä»· - å¿«é€Ÿå‚è€ƒå¡ç‰‡

> **å¿«é€ŸæŸ¥é˜…æ–°çš„ä»·æ ¼ç»“æ„å’Œä½¿ç”¨æ–¹æ³•**

---

## ğŸ“¦ æ–°çš„æ•°æ®ç»“æ„

### æ‰§è¡Œå™¨æ¨¡å‹ (Actuator)

```javascript
{
  model_base: "AT-SR52K8",
  series: "AT",
  
  // âœ… ä¸»è¦ä»·æ ¼å­—æ®µ - é˜¶æ¢¯å®šä»·
  price_tiers: [
    {
      min_quantity: 1,      // èµ·è®¢é‡
      unit_price: 5280,     // å•ä»·
      price_type: 'normal', // ä»·æ ¼ç±»å‹
      notes: 'å•ä»¶ä»·æ ¼'     // å¤‡æ³¨
    },
    {
      min_quantity: 5,
      unit_price: 5016,     // 5% æŠ˜æ‰£
      price_type: 'normal',
      notes: '5-9ä»¶'
    },
    {
      min_quantity: 10,
      unit_price: 4752,     // 10% æŠ˜æ‰£
      price_type: 'normal',
      notes: '10ä»¶ä»¥ä¸Š'
    }
  ],
  
  // âœ… æ‰‹åŠ¨æ“ä½œè£…ç½®
  manual_override: {
    model: "SD-1",
    price: 860
  },
  
  // âœ… é…ä»¶ä»·æ ¼
  accessories_pricing: {
    seal_kit_price: 12
  }
}
```

---

## ğŸ¯ å¸¸ç”¨æ–¹æ³•

### 1. è·å–æŒ‡å®šæ•°é‡çš„ä»·æ ¼

```javascript
const actuator = await Actuator.findById(id);

// é‡‡è´­ 8 ä»¶
const priceInfo = actuator.getPriceByQuantity(8);

// è¿”å›:
{
  unit_price: 5016,       // å•ä»·
  min_quantity: 5,        // é€‚ç”¨æ¡£ä½
  total_price: 40128,     // æ€»ä»· (5016 Ã— 8)
  price_type: 'normal',
  notes: '5-9ä»¶'
}
```

### 2. è·å–æ‰€æœ‰ä»·æ ¼æ¡£ä½

```javascript
const tiers = actuator.getAllPriceTiers();

// è¿”å›ï¼ˆæŒ‰ min_quantity å‡åºï¼‰:
[
  { min_quantity: 1, unit_price: 5280, ... },
  { min_quantity: 5, unit_price: 5016, ... },
  { min_quantity: 10, unit_price: 4752, ... }
]
```

### 3. æ”¯æŒä¸åŒä»·æ ¼ç±»å‹

```javascript
// è·å–é«˜æ¸©å‹å·çš„ä»·æ ¼ï¼ˆ10ä»¶ï¼‰
const price = actuator.getPriceByQuantity(10, 'high_temp');
```

---

## ğŸ”§ API è·¯ç”±ç¤ºä¾‹

### è·å–æ‰§è¡Œå™¨ä»·æ ¼

```http
GET /api/actuators/:id/price?quantity=10&price_type=normal

Response:
{
  "success": true,
  "data": {
    "actuator_model": "AT-SR52K8",
    "quantity": 10,
    "unit_price": 4752,
    "total_price": 47520,
    "min_quantity": 10,
    "price_type": "normal"
  }
}
```

### è·å–æ‰€æœ‰ä»·æ ¼æ¡£ä½

```http
GET /api/actuators/:id/price-tiers

Response:
{
  "success": true,
  "data": {
    "actuator_model": "AT-SR52K8",
    "price_tiers": [
      { "min_quantity": 1, "unit_price": 5280, ... },
      { "min_quantity": 5, "unit_price": 5016, ... },
      { "min_quantity": 10, "unit_price": 4752, ... }
    ]
  }
}
```

---

## ğŸ“Š ä»·æ ¼ç±»å‹ (price_type)

| ç±»å‹ | å€¼ | è¯´æ˜ | ä»·æ ¼ç¤ºä¾‹ |
|------|---|------|----------|
| æ ‡å‡†å‹ | `'normal'` | å¸¸è§„æ¸©åº¦ -20~80Â°C | Â¥5,280 |
| ä½æ¸©å‹ | `'low_temp'` | ä½æ¸© -40~80Â°C | Â¥6,336 (+20%) |
| é«˜æ¸©å‹ | `'high_temp'` | é«˜æ¸© -20~150Â°C | Â¥6,336 (+20%) |
| é€šç”¨ | `'standard'` | é»˜è®¤ä»·æ ¼ | Â¥5,280 |

---

## ğŸ’¡ å…¸å‹é…ç½®ç¤ºä¾‹

### æ ‡å‡†é˜¶æ¢¯å®šä»·ï¼ˆæ¨èï¼‰

```javascript
price_tiers: [
  { min_quantity: 1,  unit_price: 5280 },  // åŸºç¡€ä»·
  { min_quantity: 5,  unit_price: 5016 },  // -5%
  { min_quantity: 10, unit_price: 4752 },  // -10%
  { min_quantity: 20, unit_price: 4488 }   // -15%
]
```

### æ”¯æŒå¤šæ¸©åº¦ç­‰çº§

```javascript
price_tiers: [
  // æ ‡å‡†å‹
  { min_quantity: 1,  unit_price: 5280, price_type: 'normal' },
  { min_quantity: 10, unit_price: 4752, price_type: 'normal' },
  
  // é«˜æ¸©å‹ï¼ˆ+20%ï¼‰
  { min_quantity: 1,  unit_price: 6336, price_type: 'high_temp' },
  { min_quantity: 10, unit_price: 5702, price_type: 'high_temp' }
]
```

---

## ğŸ”„ è¿ç§»å‘½ä»¤

### ä»æ—§æ•°æ®è¿ç§»

```bash
cd backend
node scripts/migrate_pricing_to_tiers.js
```

### å¯¼å…¥æ–°æ ¼å¼æ•°æ®

```bash
cd backend
node scripts/import_actuators_with_tiers.js data/actuators.csv
```

---

## âš™ï¸ å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

### React ç»„ä»¶

```jsx
import { useEffect, useState } from 'react';
import { actuatorsAPI } from '../services/api';

function PriceDisplay({ actuatorId, quantity }) {
  const [price, setPrice] = useState(null);
  
  useEffect(() => {
    const fetchPrice = async () => {
      const response = await actuatorsAPI.getPrice(actuatorId, quantity);
      setPrice(response.data);
    };
    fetchPrice();
  }, [actuatorId, quantity]);
  
  return (
    <div>
      <p>å•ä»·: Â¥{price?.unit_price}</p>
      <p>æ€»ä»·: Â¥{price?.total_price}</p>
      <small>é€‚ç”¨æ¡£ä½: {price?.min_quantity}ä»¶èµ·</small>
    </div>
  );
}
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### åˆ›å»ºæ–°æ‰§è¡Œå™¨æ—¶

- [ ] é…ç½®è‡³å°‘ 3 ä¸ªä»·æ ¼æ¡£ä½
- [ ] è®¾ç½®åˆç†çš„æŠ˜æ‰£å¹…åº¦ï¼ˆé€šå¸¸ 5%, 10%, 15%ï¼‰
- [ ] æ·»åŠ  notes è¯´æ˜æ¯ä¸ªæ¡£ä½
- [ ] é…ç½® manual_overrideï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] é…ç½® accessories_pricing

### API è°ƒç”¨æ—¶

- [ ] ä¼ é€’æ­£ç¡®çš„ quantity å‚æ•°
- [ ] æŒ‡å®š price_typeï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] å¤„ç†å¯èƒ½çš„ null è¿”å›å€¼
- [ ] æ˜¾ç¤ºé€‚ç”¨çš„ä»·æ ¼æ¡£ä½ä¿¡æ¯

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¿«é€Ÿè®¡ç®—æ‰¹é‡æŠ˜æ‰£ï¼Ÿ

```javascript
const basePrice = 5280;
const discount = 0.10;  // 10% æŠ˜æ‰£
const discountedPrice = basePrice * (1 - discount);  // 4752
```

### Q: å¦‚æœæ‰§è¡Œå™¨æ²¡æœ‰é…ç½® price_tiers æ€ä¹ˆåŠï¼Ÿ

```javascript
const priceInfo = actuator.getPriceByQuantity(10);

if (!priceInfo) {
  console.log('æ­¤æ‰§è¡Œå™¨æœªé…ç½®ä»·æ ¼ä¿¡æ¯');
  // é™çº§å¤„ç†ï¼šä½¿ç”¨æ—§çš„ pricing å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ï¼‰
}
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ä»·æ ¼æ¡£ä½ï¼Ÿ

```javascript
const actuator = await Actuator.findById(id);

actuator.price_tiers.push({
  min_quantity: 50,
  unit_price: 4200,  // 20% æŠ˜æ‰£
  price_type: 'normal',
  notes: '50ä»¶ä»¥ä¸Šäº«å—20%æŠ˜æ‰£'
});

await actuator.save();
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- ğŸ“– [å®Œæ•´å‡çº§æ–‡æ¡£](./é˜¶æ¢¯å®šä»·å‡çº§è¯´æ˜.md)
- ğŸ“§ æŠ€æœ¯æ”¯æŒ: tech@cmax.com
- ğŸ’¬ å¼€å‘å›¢é˜Ÿ: dev@cmax.com

---

**ç‰ˆæœ¬**: v2.1.0 | **æ›´æ–°**: 2025-10-27

