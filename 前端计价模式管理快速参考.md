# 前端计价模式管理快速参考 ⚡

## 🎯 功能概述

管理员可以在数据管理面板为产品设置两种计价模式：
- **固定单价** - 单一价格
- **阶梯报价** - 根据数量不同价格不同

---

## 📍 访问路径

```
管理员面板 → 数据管理 → 执行器管理 / 配件管理 → 新增 / 编辑
```

---

## 🔧 操作指南

### 1️⃣ 新增固定价格产品

```
1. 点击 "新增执行器" 或 "新增配件"
2. 填写基本信息
3. 价格设置区域：
   ◉ 固定单价 (Fixed Price)
   ○ 阶梯报价 (Tiered Pricing)
4. 输入基础价格：¥ 1200
5. 点击 "确定"
```

**数据结构**:
```json
{
  "pricing_model": "fixed",
  "base_price": 1200
}
```

---

### 2️⃣ 新增阶梯价格产品

```
1. 点击 "新增执行器" 或 "新增配件"
2. 填写基本信息
3. 价格设置区域：
   ○ 固定单价 (Fixed Price)
   ◉ 阶梯报价 (Tiered Pricing)
4. 输入基础价格（可选）：¥ 2500
5. 添加价格阶梯：
   - 第1档：1 件 → ¥2500 → 标准
   - 第2档：10 件 → ¥2300 → 优惠
   - 第3档：50 件 → ¥2100 → 优惠
6. 点击 "确定"
```

**数据结构**:
```json
{
  "pricing_model": "tiered",
  "base_price": 2500,
  "price_tiers": [
    { "min_quantity": 1, "unit_price": 2500, "price_type": "normal" },
    { "min_quantity": 10, "unit_price": 2300, "price_type": "low" },
    { "min_quantity": 50, "unit_price": 2100, "price_type": "low" }
  ]
}
```

---

### 3️⃣ 编辑产品计价模式

```
1. 点击产品行的 "编辑" 按钮
2. 系统自动加载现有计价模式和价格
3. 可以：
   - 修改价格
   - 切换计价模式
   - 添加/删除价格阶梯
4. 点击 "确定" 保存
```

---

## 🎨 界面元素

### 计价模式选择器

```
价格设置
─────────────────────────

计价模式 *
◉ 固定单价 (Fixed Price)
○ 阶梯报价 (Tiered Pricing)
```

### 固定价格输入框

```
基础价格 *
┌─────────────────────┐
│ ¥ 1200              │
└─────────────────────┘
```

### 阶梯价格动态列表

```
基础价格（可选） ⓘ
┌─────────────────────┐
│ ¥ 2500              │
└─────────────────────┘

价格阶梯
┌──────┬──────────┬────────┬──┐
│ 1    │ ¥ 2500   │ 标准   │ - │  ← 第1档
├──────┼──────────┼────────┼──┤
│ 10   │ ¥ 2300   │ 优惠   │ - │  ← 第2档
├──────┼──────────┼────────┼──┤
│ 50   │ ¥ 2100   │ 优惠   │ - │  ← 第3档
└──────┴──────────┴────────┴──┘
   ↑       ↑         ↑      ↑
 最小数量  单价   价格类型  删除

┌─────────────────────────┐
│ ＋ 添加价格阶梯         │
└─────────────────────────┘
```

### 表格显示

```
执行器管理

型号         作用类型  计价模式      基础价格    操作
──────────────────────────────────────────────────
SF025       [DA]      [固定价格]    ¥1,200     编辑 删除
AT-SR52K8   [SR]      [阶梯价格]    ¥2,500     编辑 删除
GY-63       [DA]      [阶梯价格]    ¥3,500     编辑 删除
```

---

## 📋 字段说明

### pricing_model (计价模式) *必填*

| 值      | 说明                   | 标签显示   |
|---------|----------------------|------------|
| fixed   | 固定单价，不随数量变化 | 🔵 固定价格 |
| tiered  | 阶梯报价，数量越多越便宜 | 🟢 阶梯价格 |

### base_price (基础价格)

| 计价模式 | 是否必填 | 说明 |
|----------|----------|------|
| fixed    | ✅ 必填  | 产品的销售单价 |
| tiered   | ⚠️ 可选  | 用于快速查询和排序，建议填写 |

### price_tiers (价格阶梯)

只在 `tiered` 模式下显示，至少需要一个阶梯。

每个阶梯包含：

| 字段          | 类型   | 必填 | 说明                    | 示例  |
|---------------|--------|------|------------------------|-------|
| min_quantity  | Number | ✅   | 最小数量（≥ 1）         | 10    |
| unit_price    | Number | ✅   | 单价（≥ 0）            | 2300  |
| price_type    | String | ❌   | 价格类型（标准/优惠/高价）| low   |

---

## ⚡ 快捷操作

### 添加价格阶梯

1. 点击 **"＋ 添加价格阶梯"** 按钮
2. 输入 **最小数量**、**单价**、**价格类型**
3. 可以添加多个阶梯

### 删除价格阶梯

点击每行右侧的 **"-"** 图标

### 切换计价模式

1. 选择不同的 Radio 选项
2. 表单会自动切换显示对应的输入组件
3. 注意：切换会清空当前输入的价格数据

---

## ✅ 表单验证

### 固定价格模式

- ✅ `pricing_model` = 'fixed'
- ✅ `base_price` 必填
- ✅ `base_price` ≥ 0

### 阶梯价格模式

- ✅ `pricing_model` = 'tiered'
- ✅ `price_tiers` 至少一个阶梯
- ✅ 每个阶梯的 `min_quantity` 必填且 ≥ 1
- ✅ 每个阶梯的 `unit_price` 必填且 ≥ 0
- ✅ `price_type` 可选（标准/优惠/高价）

---

## 💡 最佳实践

### 1. 基础价格设置建议

- **固定价格**: 填写实际销售价格
- **阶梯价格**: 建议填写标准价格（最常见的价格档位），方便列表排序

### 2. 阶梯设置建议

```
推荐配置：
- 第1档：1 件起  → 标准价格（零售价）
- 第2档：10 件起 → 小批量优惠（-8%）
- 第3档：50 件起 → 大批量优惠（-15%）
```

### 3. 价格类型选择

| 类型   | 使用场景              | 建议折扣  |
|--------|----------------------|-----------|
| 标准   | 零售价、小批量订单    | 0%        |
| 优惠   | 批量订单、长期客户    | -5% ~ -15% |
| 高价   | 紧急订单、小订单加价  | +10% ~ +20% |

---

## 🔍 常见问题

### Q1: 基础价格和价格阶梯有什么区别？

**A**: 
- **基础价格** (`base_price`): 用于列表显示、排序和快速查询
- **价格阶梯** (`price_tiers`): 实际计价时使用，根据数量匹配合适的档位

### Q2: 阶梯价格模式下，基础价格必须填吗？

**A**: 不是必填的，但**强烈建议**填写。如果不填，列表中的价格列会显示为空。

### Q3: 如何让价格随数量递减？

**A**: 使用阶梯价格模式，设置多个档位，数量越大的档位单价越低。

示例：
```
1 件  → ¥100
10 件 → ¥90
50 件 → ¥80
```

### Q4: 可以设置多少个价格阶梯？

**A**: 没有限制，但建议 **3-5 个阶梯** 即可满足大部分需求。

### Q5: 如何把现有的固定价格产品改为阶梯价格？

**A**: 
1. 编辑产品
2. 切换计价模式为 "阶梯报价"
3. 保留原价格作为基础价格
4. 添加多个价格阶梯
5. 保存

---

## 🎯 使用场景

### 场景 1：标准产品（固定价格）

```
产品：SF025 执行器
定价：单一价格 ¥1,200
适用：价格稳定，不做批量优惠
```

**设置**:
```
计价模式：固定单价
基础价格：1200
```

---

### 场景 2：热销产品（阶梯价格）

```
产品：AT-SR52K8 执行器
定价：批量优惠
适用：鼓励客户增加订购数量
```

**设置**:
```
计价模式：阶梯报价
基础价格：2500
价格阶梯：
  - 1-9 件：¥2,500/件
  - 10-49 件：¥2,300/件（-8%）
  - 50+ 件：¥2,100/件（-16%）
```

---

### 场景 3：配件产品（灵活定价）

```
产品：双作用电磁阀
定价：根据订单大小调整
适用：配件可批量优惠
```

**设置**:
```
计价模式：阶梯报价
基础价格：300
价格阶梯：
  - 1-9 件：¥300/件
  - 10-49 件：¥280/件（-6.7%）
  - 50-99 件：¥260/件（-13.3%）
  - 100+ 件：¥240/件（-20%）
```

---

## 📊 数据提交

### 固定价格提交数据

```json
{
  "model_base": "SF025",
  "body_size": "SF025",
  "action_type": "DA",
  "pricing_model": "fixed",
  "base_price": 1200
}
```

### 阶梯价格提交数据

```json
{
  "model_base": "AT-SR52K8",
  "body_size": "52",
  "action_type": "SR",
  "pricing_model": "tiered",
  "base_price": 2500,
  "price_tiers": [
    {
      "min_quantity": 1,
      "unit_price": 2500,
      "price_type": "normal"
    },
    {
      "min_quantity": 10,
      "unit_price": 2300,
      "price_type": "low"
    },
    {
      "min_quantity": 50,
      "unit_price": 2100,
      "price_type": "low"
    }
  ]
}
```

---

## 🛠️ 技术细节

### 文件位置

```
frontend/src/pages/AdminPanel.jsx
```

### 关键状态

```javascript
const [pricingModel, setPricingModel] = useState('fixed')
```

### 表单字段

| 字段名        | 固定模式 | 阶梯模式 |
|---------------|----------|----------|
| pricing_model | ✅       | ✅       |
| base_price    | ✅ 必填  | ❌ 可选  |
| price_tiers   | ❌       | ✅ 必填  |

---

## ✅ 测试检查表

- [ ] 新增固定价格产品
- [ ] 新增阶梯价格产品
- [ ] 编辑固定价格产品
- [ ] 编辑阶梯价格产品
- [ ] 从固定价格切换到阶梯价格
- [ ] 从阶梯价格切换到固定价格
- [ ] 添加多个价格阶梯
- [ ] 删除价格阶梯
- [ ] 表单验证正常
- [ ] 表格显示正确的计价模式标签

---

## 📞 相关文档

- **完整功能报告**: `前端计价模式管理功能完成报告.md`
- **定价函数升级**: `定价函数升级完成报告.md`
- **数据处理脚本**: `数据处理脚本更新报告.md`

---

**管理员现在可以轻松管理产品的计价模式！** 🎉

**日期**: 2025-10-28  
**团队**: C-MAX 技术团队

