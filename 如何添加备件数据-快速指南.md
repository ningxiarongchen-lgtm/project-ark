# 🔧 如何添加备件数据 - 快速指南

## 🎯 问题

智慧选型界面没有显示备件维修包信息（密封套件、活塞密封圈等）

## ✅ 解决方案

运行自动化脚本为所有执行器添加备件数据

---

## 📝 操作步骤

### 步骤1: 进入backend目录

```bash
cd "/Users/hexiaoxiao/Desktop/Model Selection System/backend"
```

### 步骤2: 运行备件数据添加脚本

```bash
./add-spare-parts.sh
```

**或者直接运行Node.js脚本**:
```bash
node add-spare-parts-data.js
```

### 步骤3: 查看执行结果

脚本会显示处理进度：

```
========================================
为执行器添加备件维修包数据
========================================

📦 找到 50 个执行器

✅ 更新 SF050-DA - SF系列, DA型
   密封套件: ¥2500
   其他备件: 3 个

✅ 更新 AT063-SR-K8 - AT系列, SR型
   密封套件: ¥2000
   其他备件: 4 个 (含弹簧组件)

...

========================================
✅ 备件数据添加完成！
   更新: 48 个
   跳过: 2 个 (已有数据)
========================================
```

### 步骤4: 重启后端服务（可选）

如果后端正在运行，重启以确保数据刷新：

```bash
pm2 restart backend
# 或
npm start
```

### 步骤5: 验证结果

1. 打开浏览器访问智慧选型页面
2. 进行一次选型操作
3. 查看推荐结果，应该能看到备件维修包信息

---

## 📊 添加的备件数据

### SF系列（拨叉式）
- **密封套件**: ¥2,500
- **轭架轴承**: ¥800
- **活塞密封**: ¥600
- **端盖密封**: ¥400
- **弹簧组件**: ¥1,500（仅单作用SR型）

### AT系列（齿轮齿条式）
- **密封套件**: ¥2,000
- **齿轮组件**: ¥1,200
- **轴承套件**: ¥800
- **活塞密封圈**: ¥600
- **弹簧组件**: ¥1,500（仅单作用SR型）

### GY系列（齿轮齿条式）
- **密封套件**: ¥2,200
- **齿轮组件**: ¥1,300
- **轴承套件**: ¥900
- **活塞密封圈**: ¥700
- **弹簧组件**: ¥1,500（仅单作用SR型）

---

## 🎨 界面显示效果

### 推荐列表中
```
┌─────────────────────────────────┐
│ 1. AT063-DA    [推荐] ¥15,000  │
│                                 │
│ 实际扭矩：65 Nm                 │
│ 扭矩裕度：30.0%                 │
│                                 │
│ ┌─ 💼 备件维修包 ───────────┐  │
│ │ 密封套件：¥2,000          │  │
│ │ 齿轮组件：¥1,200          │  │
│ │ 轴承套件：¥800            │  │
│ │ ...及其他 1 个备件         │  │
│ └───────────────────────────┘  │
│                                 │
│     [ 选择此型号 ]              │
└─────────────────────────────────┘
```

### 配置汇总Modal中
```
┌─ 选型配置汇总 ────────────┐
│                            │
│ 执行器型号：AT063-DA       │
│ 价格：¥15,000              │
│ 扭矩：65 Nm                │
│                            │
│ ──────────────────────────│
│                            │
│ 💼 备件维修包：            │
│ • 密封套件：¥2,000         │
│ • 齿轮组件：¥1,200         │
│ • 轴承套件：¥800           │
│ • 活塞密封圈：¥600         │
│                            │
│ ──────────────────────────│
└────────────────────────────┘
```

---

## 🔍 故障排查

### 问题1: 脚本运行失败
**错误**: `Cannot find module 'mongoose'`

**解决**:
```bash
cd backend
npm install
```

### 问题2: 数据库连接失败
**错误**: `MongoDB 连接失败`

**解决**:
1. 检查MongoDB是否运行: `brew services list | grep mongodb`
2. 启动MongoDB: `brew services start mongodb-community`
3. 检查.env文件中的MONGODB_URI配置

### 问题3: 界面仍不显示备件
**可能原因**:
1. 后端未重启 - 运行 `pm2 restart backend`
2. 浏览器缓存 - 清除缓存或硬刷新（Cmd+Shift+R）
3. 选型的执行器没有备件数据 - 重新运行脚本

---

## 🔧 手动添加备件数据

如果需要手动为特定执行器添加备件：

### 方法1: MongoDB Shell
```javascript
// 连接数据库
use cmax

// 更新单个执行器
db.actuators.updateOne(
  { model_base: "AT063-DA" },
  {
    $set: {
      spare_parts: {
        seal_kit_price: 2000,
        other_parts: [
          {
            part_name: "齿轮组件",
            part_number: "AT-GEAR-01",
            price: 1200
          },
          {
            part_name: "轴承套件",
            part_number: "AT-BEAR-01",
            price: 800
          }
        ]
      }
    }
  }
)
```

### 方法2: 通过数据管理界面
1. 登录系统
2. 进入"数据管理" → "执行器管理"
3. 选择要编辑的执行器
4. 找到"备件信息"栏
5. 添加密封套件价格和其他备件信息
6. 保存

---

## 📞 需要帮助？

如果遇到问题：
1. 检查上面的故障排查部分
2. 查看 `backend/add-spare-parts-data.js` 脚本内容
3. 查看 `备件维修包功能-说明.md` 详细文档
4. 联系技术支持

---

## ✅ 验证清单

运行脚本后，请检查：

- [ ] 脚本执行成功，显示"✅ 备件数据添加完成"
- [ ] 更新的执行器数量正确
- [ ] 后端服务已重启
- [ ] 浏览器清除了缓存
- [ ] 智慧选型页面能正常访问
- [ ] 进行选型后，推荐结果显示备件信息
- [ ] 备件价格显示正确
- [ ] 配置汇总Modal也显示备件信息

---

**最后更新**: 2025-10-30  
**状态**: ✅ 可用

