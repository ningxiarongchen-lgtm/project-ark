# BOM版本历史与对比 - 快速参考

## 快速操作指南

### 查看历史版本

```
1. 进入项目详情页
2. 切换到"BOM清单"Tab
3. 点击"📜 历史版本与对比"按钮
4. 左侧显示所有历史版本
```

### 查看单个版本详情

```
1. 打开版本历史Modal
2. 勾选1个版本
3. 右侧显示该版本的完整内容
```

### 对比两个版本

```
1. 打开版本历史Modal
2. 勾选第1个版本（例如版本3）
3. 勾选第2个版本（例如版本5）
4. 右侧自动显示并排对比
5. 差异以颜色高亮：
   🟢 绿色 = 新增
   🔴 红色 = 删除
   🟠 橙色 = 修改
```

### 恢复到历史版本

```
1. 找到要恢复的版本
2. 点击"恢复"按钮
3. 确认操作
4. BOM数据已恢复
5. 点击"保存BOM"创建新版本
```

---

## 版本信息说明

### 版本卡片显示内容

```
┌─────────────────────────┐
│ ☑ 版本 5        [恢复] │
│ 2025-10-27 14:30:22     │
│ 创建者: 张三            │
│ 手动保存                │
│ ───────────────────     │
│ 🔷 5个型号             │
│ 🟢 20台                │
│ 🟠 ¥105,600            │
└─────────────────────────┘
```

- **版本号:** 自动递增（1, 2, 3...）
- **时间:** 创建时间
- **创建者:** 保存者用户名
- **描述:** 保存说明
- **统计:** 型号数、总数量、总价

---

## 差异对比说明

### 差异类型

| 类型 | 颜色 | 说明 |
|------|------|------|
| 新增 | 🟢 绿色 | 在新版本中新增的型号 |
| 删除 | 🔴 红色 | 在新版本中删除的型号 |
| 修改 | 🟠 橙色 | 数量/价格/备注有变化 |

### 对比视图布局

```
┌──────────────────────────────────────┐
│ 差异统计: 新增2 删除1 修改3          │
├──────────────────────────────────────┤
│ 版本3        │     版本5             │
├──────────────┼──────────────────────┤
│ SF050  3台   │ SF050  5台    🟠修改 │
│ SF075  2台   │ (已删除)      🔴删除 │
│ (未创建)     │ SF100  3台    🟢新增 │
└──────────────┴──────────────────────┘
```

---

## 常见问题

### Q: 版本何时创建？
**A:** 每次点击"保存BOM"时自动创建版本快照。

### Q: 最多可以保存多少个版本？
**A:** 建议保留最近50个版本，超过后自动删除最旧版本。

### Q: 恢复版本后会自动保存吗？
**A:** 不会。恢复后需要手动点击"保存BOM"。

### Q: 可以删除某个版本吗？
**A:** 当前版本不支持删除单个版本，只能清空整个历史。

### Q: 版本对比最多能选几个？
**A:** 最多选择2个版本进行对比。

### Q: 如何知道版本之间有什么变化？
**A:** 勾选2个版本，查看右侧的差异统计和详情。

---

## 典型工作流

### 工作流1: 日常编辑保存

```
编辑BOM → 保存BOM → 自动创建版本 ✅
  ↓
版本号自动递增
版本历史自动记录
```

### 工作流2: 版本回退

```
发现错误 → 打开版本历史 → 找到正确版本
  ↓
点击"恢复" → 确认 → 数据已恢复
  ↓
检查数据 → 保存BOM → 创建新版本 ✅
```

### 工作流3: 变更审查

```
需要审查变更 → 打开版本历史
  ↓
选择旧版本(版本3)
选择新版本(版本5)
  ↓
查看并排对比
查看差异统计
  ↓
导出报告（可选）✅
```

---

## 键盘快捷键

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 打开版本历史 | - | 点击按钮 |
| 关闭Modal | ESC | 或点击右上角X |
| 确认恢复 | Enter | 在确认对话框中 |
| 取消恢复 | ESC | 在确认对话框中 |

---

## 最佳实践

### ✅ 推荐

1. **定期保存** - 重要修改后及时保存
2. **查看对比** - 保存前对比当前版本和历史版本
3. **谨慎恢复** - 恢复前先查看版本详情
4. **添加描述** - 在保存时添加有意义的描述

### ❌ 避免

1. **频繁保存** - 避免无意义的版本累积
2. **盲目恢复** - 恢复前务必查看版本内容
3. **忽略对比** - 修改前后应对比差异
4. **清空历史** - 除非确实需要，否则保留历史

---

## 数据结构参考

### 版本快照结构

```json
{
  "version_number": 5,
  "timestamp": "2025-10-27T14:30:22.000Z",
  "created_by": "张三",
  "description": "手动保存",
  "bom_data": [
    {
      "actuator_model": "SF050-DA",
      "total_quantity": 5,
      "unit_price": 5280,
      "total_price": 26400,
      "notes": ""
    }
  ],
  "statistics": {
    "total_models": 5,
    "total_quantity": 20,
    "total_price": 105600
  }
}
```

### 差异对比结果

```json
{
  "added": [
    {
      "actuator_model": "SF100-DA",
      "total_quantity": 3,
      "unit_price": 8500,
      "total_price": 25500
    }
  ],
  "removed": [
    {
      "actuator_model": "SF075-DA",
      "total_quantity": 2,
      "unit_price": 6800,
      "total_price": 13600
    }
  ],
  "modified": [
    {
      "model": "SF050-DA",
      "old": {
        "total_quantity": 3,
        "unit_price": 5280,
        "total_price": 15840
      },
      "new": {
        "total_quantity": 5,
        "unit_price": 5280,
        "total_price": 26400
      }
    }
  ]
}
```

---

## 状态说明

### 按钮状态

| 状态 | 显示 | 说明 |
|------|------|------|
| 正常 | 📜 历史版本与对比 (5) | 有5个版本 |
| 禁用 | 📜 历史版本与对比 | 无版本历史 |
| 加载 | 📜 加载中... | 正在加载版本 |

### 版本卡片状态

| 状态 | 样式 | 说明 |
|------|------|------|
| 未选中 | 灰色边框 | 普通状态 |
| 已选中 | 蓝色边框 + 加粗 | 已勾选 |
| 悬停 | 阴影效果 | 鼠标悬停 |

---

## 权限说明

### 查看权限

- ✅ 所有项目成员可以查看版本历史
- ✅ 所有项目成员可以对比版本

### 编辑权限

- ⚠️ 恢复版本需要编辑权限
- ⚠️ 创建版本需要保存BOM权限

---

## 技术支持

### 相关文件

- **前端:** `frontend/src/pages/ProjectDetails.jsx`
- **样式:** `frontend/src/pages/ProjectDetails.css`
- **文档:** `BOM版本历史与对比功能完成报告.md`

### 相关函数

```javascript
// 版本管理
handleOpenVersionComparison()    // 打开版本对比Modal
handleSelectVersion()            // 选择版本
handleRestoreVersion()           // 恢复版本

// 对比算法
compareBOMVersions()             // 对比两个版本

// 保存
handleSaveBOM()                  // 保存时创建版本
```

---

**更新时间:** 2025-10-27  
**版本:** v1.0

