# 前端选型界面升级报告

## 🎯 升级目标

升级前端选型界面以支持三种系列执行器的选型：
- **SF 系列** - Scotch Yoke（拨叉式/气动叶片式）
- **AT 系列** - Rack & Pinion（齿轮齿条式）
- **GY 系列** - Rack & Pinion（齿轮齿条式）

## ✅ 完成的工作

### 1. 添加"执行机构类型"选择器

**位置**: 表单最顶端（基本参数面板内）

**实现代码**:
```jsx
<Form.Item
  label="执行机构类型"
  name="mechanism"
  rules={[{ required: true, message: '请选择执行机构类型' }]}
>
  <Radio.Group buttonStyle="solid">
    <Radio.Button value="Scotch Yoke">拨叉式 (SF系列)</Radio.Button>
    <Radio.Button value="Rack & Pinion">齿轮齿条式 (AT/GY系列)</Radio.Button>
  </Radio.Group>
</Form.Item>
```

**特性**:
- ✅ 必填字段
- ✅ 默认值：`'Scotch Yoke'`
- ✅ 使用 Radio.Group 提供两个选项
- ✅ buttonStyle="solid" 提供现代化的按钮样式

### 2. 条件化显示"拨叉类型偏好"

**实现逻辑**:
```jsx
<Form.Item noStyle shouldUpdate={(prevValues, currentValues) => 
  prevValues.mechanism !== currentValues.mechanism
}>
  {({ getFieldValue }) => 
    getFieldValue('mechanism') === 'Scotch Yoke' ? (
      <Form.Item
        label="拨叉类型偏好"
        name="yoke_preference"
        tooltip="对称轭架：标准配置；倾斜轭架：扭矩更大；自动：系统自动推荐"
      >
        <Radio.Group>
          <Radio.Button value="Auto">自动推荐</Radio.Button>
          <Radio.Button value="Symmetric">对称轭架</Radio.Button>
          <Radio.Button value="Canted">倾斜轭架</Radio.Button>
        </Radio.Group>
      </Form.Item>
    ) : null
  }
</Form.Item>
```

**行为**:
- ✅ 仅在选择"**拨叉式 (SF系列)**"时显示
- ✅ 选择"齿轮齿条式"时自动隐藏
- ✅ 使用 `Form.Item` 的 `shouldUpdate` 实现响应式更新
- ✅ 添加了 tooltip 提示信息

### 3. 更新表单初始值

**修改前**:
```jsx
initialValues={{
  yoke_type: 'symmetric',
  needs_manual_override: false,
  max_rotation_angle: 90
}}
```

**修改后**:
```jsx
initialValues={{
  mechanism: 'Scotch Yoke',           // 新增
  yoke_type: 'symmetric',
  yoke_preference: 'Auto',             // 新增
  needs_manual_override: false,
  max_rotation_angle: 90
}}
```

## 📊 UI 效果

### Scotch Yoke（拨叉式）选中时

```
┌─────────────────────────────────────┐
│ 执行机构类型                        │
│ ┌─────────────┐ ┌───────────────┐   │
│ │ 拨叉式(SF)  │ │齿轮齿条式(AT/GY)│ │
│ └─────────────┘ └───────────────┘   │
│                                     │
│ 位号标识（可选）                    │
│ [输入框]                            │
│                                     │
│ 需求扭矩 (Nm)                       │
│ [输入框]                            │
│                                     │
│ ...                                 │
│                                     │
│ 拨叉类型偏好 ⓘ                      │
│ ┌────┐ ┌────┐ ┌────┐                │
│ │自动│ │对称│ │倾斜│               │
│ └────┘ └────┘ └────┘                │
└─────────────────────────────────────┘
```

### Rack & Pinion（齿轮齿条式）选中时

```
┌─────────────────────────────────────┐
│ 执行机构类型                        │
│ ┌───────────┐ ┌─────────────────┐   │
│ │拨叉式(SF) │ │ 齿轮齿条式(AT/GY)│  │
│ └───────────┘ └─────────────────┘   │
│                                     │
│ 位号标识（可选）                    │
│ [输入框]                            │
│                                     │
│ 需求扭矩 (Nm)                       │
│ [输入框]                            │
│                                     │
│ ...                                 │
│                                     │
│ [拨叉类型偏好 - 已隐藏]             │
└─────────────────────────────────────┘
```

## 🔄 用户交互流程

### 流程 1: SF 系列选型

1. 用户选择"**拨叉式 (SF系列)**"
2. 显示"拨叉类型偏好"选项
3. 用户可以选择：
   - **自动推荐**：系统自动选择最合适的轭架类型
   - **对称轭架**：强制使用对称轭架
   - **倾斜轭架**：强制使用倾斜轭架（扭矩更大）
4. 填写其他参数（扭矩、压力等）
5. 点击"开始选型"

### 流程 2: AT/GY 系列选型

1. 用户选择"**齿轮齿条式 (AT/GY系列)**"
2. "拨叉类型偏好"自动隐藏
3. 填写参数（扭矩、压力等）
4. 点击"开始选型"

## 📝 表单数据结构

### Scotch Yoke 提交数据

```javascript
{
  mechanism: "Scotch Yoke",
  required_torque: 500,
  working_pressure: 0.5,
  working_angle: 0,
  yoke_preference: "Auto",         // 会被发送到后端
  action_type_preference: "DA",
  needs_manual_override: false
}
```

### Rack & Pinion 提交数据

```javascript
{
  mechanism: "Rack & Pinion",
  required_torque: 10,
  working_pressure: 0.5,
  action_type_preference: "DA",
  needs_manual_override: false
  // 注意：yoke_preference 字段存在但会被后端忽略
}
```

## 🎨 样式特性

### Radio.Group 样式

```jsx
<Radio.Group buttonStyle="solid">
  // 现代化的按钮样式
  // 选中状态有明显的视觉反馈
  // 响应式设计，适配移动端
</Radio.Group>
```

### Tooltip 提示

```jsx
tooltip="对称轭架：标准配置；倾斜轭架：扭矩更大；自动：系统自动推荐"
```

- ✅ 鼠标悬停显示帮助信息
- ✅ 帮助用户理解不同选项的含义

## 🔧 技术实现细节

### 条件渲染实现

使用 Ant Design Form 的 `shouldUpdate` 和渲染函数：

```jsx
<Form.Item 
  noStyle 
  shouldUpdate={(prevValues, currentValues) => 
    prevValues.mechanism !== currentValues.mechanism
  }
>
  {({ getFieldValue }) => 
    getFieldValue('mechanism') === 'Scotch Yoke' ? (
      // 显示内容
    ) : null
  }
</Form.Item>
```

**优势**:
- ✅ 响应式更新，无需手动监听
- ✅ 性能优化，只在 `mechanism` 改变时重新渲染
- ✅ 符合 Ant Design 最佳实践

### 表单验证

```jsx
rules={[{ required: true, message: '请选择执行机构类型' }]}
```

- ✅ 必填验证
- ✅ 友好的错误提示
- ✅ 自动阻止提交无效数据

## 📱 响应式设计

界面已适配不同屏幕尺寸：
- **桌面端**: 完整显示所有选项
- **平板**: 自适应布局
- **手机**: 垂直排列，按钮全宽显示

## ⚠️ 注意事项

### 1. 字段名称映射

| 前端字段 | 后端字段 | 说明 |
|----------|----------|------|
| `mechanism` | `mechanism` | 直接传递 |
| `yoke_preference` | `yoke_preference` | 仅 SF 系列使用 |

### 2. 后端兼容性

- 后端已更新为支持 `mechanism` 参数
- `yoke_preference` 在选择 Rack & Pinion 时会被后端忽略
- 无需前端额外处理数据清理

### 3. 默认值

- 默认选择"拨叉式 (SF系列)"以保持向后兼容
- 默认"拨叉类型偏好"为"自动推荐"

## 🧪 测试建议

### 功能测试

1. **切换机构类型**
   - [ ] 选择 SF 系列 → 显示拨叉偏好
   - [ ] 选择 AT/GY 系列 → 隐藏拨叉偏好
   - [ ] 来回切换多次，确保显示/隐藏正常

2. **表单验证**
   - [ ] 未选择机构类型 → 显示错误提示
   - [ ] 已选择 → 验证通过

3. **数据提交**
   - [ ] SF 系列提交包含 `yoke_preference`
   - [ ] AT/GY 系列提交不影响 `yoke_preference`

### UI 测试

1. **视觉效果**
   - [ ] 按钮样式美观
   - [ ] 选中状态清晰
   - [ ] Tooltip 正常显示

2. **响应式**
   - [ ] 桌面端显示正常
   - [ ] 移动端显示正常
   - [ ] 不同分辨率适配良好

## 🚀 后续优化建议

### 短期
- [ ] 添加机构类型的图标或图片说明
- [ ] 为不同系列显示不同的参数提示
- [ ] 根据机构类型调整压力选项

### 中期
- [ ] 添加机构类型对比功能
- [ ] 智能推荐机构类型
- [ ] 历史选型记录显示机构类型

### 长期
- [ ] 可视化展示不同机构类型的特点
- [ ] 3D 模型预览
- [ ] 选型向导模式

## ✨ 总结

本次升级成功实现了：

1. **用户体验** ✅
   - 清晰的机构类型选择
   - 智能的条件显示
   - 友好的提示信息

2. **技术实现** ✅
   - 响应式表单设计
   - 优雅的条件渲染
   - 符合 React/Ant Design 最佳实践

3. **功能完整** ✅
   - 支持三种系列选型
   - 向后兼容
   - 数据验证完善

前端界面现在可以完美配合后端选型引擎，为用户提供**全系列执行器的智能选型服务**！

---

**完成时间**: 2025-10-27  
**版本**: v3.0  
**状态**: ✅ 已完成  
**开发团队**: C-MAX 开发团队

