# å®šä»·æ¨¡å¼æ•°æ®å¤„ç†å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ ç›®å½•
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [æ•°æ®å¯¼å…¥](#æ•°æ®å¯¼å…¥)
- [æ•°æ®è¿ç§»](#æ•°æ®è¿ç§»)
- [CSV æ ¼å¼ç¤ºä¾‹](#csv-æ ¼å¼ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ ¸å¿ƒæ¦‚å¿µ

### å®šä»·æ¨¡å¼ï¼ˆpricing_modelï¼‰

ç³»ç»Ÿæ”¯æŒä¸¤ç§å®šä»·æ¨¡å¼ï¼š

| æ¨¡å¼ | å€¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|-----|-----|------|---------|
| å›ºå®šä»·æ ¼ | `'fixed'` | å•ä¸€ä»·æ ¼ï¼Œä¸è®ºæ•°é‡ | SFç³»åˆ—ã€æ ‡å‡†äº§å“ |
| é˜¶æ¢¯ä»·æ ¼ | `'tiered'` | æ ¹æ®æ•°é‡ä¸åŒä»·æ ¼ä¸åŒ | AT/GYç³»åˆ—ã€æ‰¹é‡ä¼˜æƒ  |

### æ•°æ®ç»“æ„

```javascript
// å›ºå®šä»·æ ¼æ¨¡å¼
{
  model_base: "SF025",
  pricing_model: "fixed",
  base_price: 1200
}

// é˜¶æ¢¯ä»·æ ¼æ¨¡å¼
{
  model_base: "AT-SR52K8",
  pricing_model: "tiered",
  base_price: 2500,  // ä¿ç•™åŸºç¡€ä»·æ ¼
  price_tiers: [
    { min_quantity: 1, unit_price: 2500 },
    { min_quantity: 10, unit_price: 2300 },
    { min_quantity: 50, unit_price: 2100 }
  ]
}
```

---

## æ•°æ®å¯¼å…¥

### æ–¹å¼ä¸€ï¼šå¯¼å…¥å›ºå®šä»·æ ¼äº§å“ï¼ˆSFç³»åˆ—ï¼‰

```bash
cd backend
node seed.js
```

**CSV æ ¼å¼**:
```csv
model_base,series,base_price
SF025,SF,1200
SF040,SF,1500
```

**è‡ªåŠ¨å¤„ç†**:
- âœ… è‡ªåŠ¨è®¾ç½® `pricing_model = 'fixed'`
- âœ… ä»·æ ¼å­˜å…¥ `base_price`

---

### æ–¹å¼äºŒï¼šå¯¼å…¥é˜¶æ¢¯ä»·æ ¼äº§å“ï¼ˆAT/GYç³»åˆ— - åŸºç¡€ç‰ˆï¼‰

```bash
cd backend
node seed_at_gy.js
```

**CSV æ ¼å¼ï¼ˆå›ºå®šä»·æ ¼ï¼‰**:
```csv
model_base,series,base_price
AT-SR52K8,AT,2500
```

**CSV æ ¼å¼ï¼ˆé˜¶æ¢¯ä»·æ ¼ï¼‰**:
```csv
model_base,series,qty_1,price_1,qty_2,price_2,qty_3,price_3
AT-SR52K8,AT,1,2500,10,2300,50,2100
```

**è‡ªåŠ¨å¤„ç†**:
- âœ… æ£€æµ‹æ˜¯å¦æœ‰ `qty_X` å’Œ `price_X` åˆ—
- âœ… æœ‰ï¼šè®¾ç½® `pricing_model = 'tiered'`ï¼Œè§£æåˆ° `price_tiers`
- âœ… æ— ï¼šè®¾ç½® `pricing_model = 'fixed'`ï¼Œä»·æ ¼å­˜å…¥ `base_price`

---

### æ–¹å¼ä¸‰ï¼šå¯¼å…¥å®Œæ•´ä»·æ ¼äº§å“ï¼ˆAT/GYç³»åˆ— - æœ€ç»ˆç‰ˆï¼‰

```bash
cd backend
node seed_at_gy_final.js
```

**CSV æ ¼å¼ï¼ˆå¤šä»·æ ¼æ¡£ä½ï¼‰**:
```csv
model_base,series,base_price_low,base_price_normal,base_price_high
AT-SR52K8,AT,2300,2500,2700
```

**è‡ªåŠ¨å¤„ç†**:
- âœ… æ£€æµ‹åˆ° `base_price_low` å’Œ `base_price_high`
- âœ… è‡ªåŠ¨è½¬æ¢ä¸ºé˜¶æ¢¯ä»·æ ¼æ¨¡å¼
- âœ… ç”Ÿæˆ 3 ä¸ªä»·æ ¼æ¡£ä½
- âœ… ä¿ç•™ `base_price`ï¼ˆä½¿ç”¨ `base_price_normal`ï¼‰
- âœ… ä¿ç•™åŸå§‹ä»·æ ¼åˆ° `pricing` å¯¹è±¡ï¼ˆå‘åå…¼å®¹ï¼‰

---

## æ•°æ®è¿ç§»

### è¿ç§»ç°æœ‰æ•°æ®ï¼ˆæ·»åŠ  pricing_model å­—æ®µï¼‰

```bash
cd backend
node migration_price_tiers.js
```

**åŠŸèƒ½**:
1. âœ… éå†æ‰€æœ‰æ‰§è¡Œå™¨å’Œé…ä»¶æ–‡æ¡£
2. âœ… **ä¿ç•™** åŸæœ‰çš„ `base_price` å­—æ®µ
3. âœ… **æ–°å¢** `pricing_model` å­—æ®µ
4. âœ… æ™ºèƒ½åˆ¤æ–­å®šä»·æ¨¡å¼ï¼š
   - æœ‰ `price_tiers` â†’ `'tiered'`
   - æœ‰ `base_price_low/high` â†’ `'tiered'`
   - å…¶ä»–æƒ…å†µ â†’ `'fixed'`ï¼ˆé»˜è®¤ï¼‰

**é¢„æœŸç»“æœ**:
- SF ç³»åˆ—äº§å“ â†’ `pricing_model: 'fixed'`
- AT/GY å•ä»·äº§å“ â†’ `pricing_model: 'fixed'`
- AT/GY é˜¶æ¢¯ä»·æ ¼äº§å“ â†’ `pricing_model: 'tiered'`

---

## CSV æ ¼å¼ç¤ºä¾‹

### 1ï¸âƒ£ å›ºå®šä»·æ ¼ï¼ˆæœ€ç®€å•ï¼‰

```csv
model_base,series,action_type,base_price
SF025,SF,DA,1200
SF040,SF,SR,1500
SF063,SF,DA,2300
```

**ç»“æœ**: `pricing_model = 'fixed'`, `base_price` = CSVä¸­çš„ä»·æ ¼

---

### 2ï¸âƒ£ é˜¶æ¢¯ä»·æ ¼ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰

```csv
model_base,series,qty_1,price_1,qty_2,price_2,qty_3,price_3
AT-SR52K8,AT,1,2500,10,2300,50,2100
AT-DA63,AT,1,3200,20,3000,100,2800
```

**ç»“æœ**: 
```javascript
pricing_model = 'tiered'
base_price = 2500  // ç¬¬ä¸€æ¡£ä»·æ ¼
price_tiers = [
  { min_quantity: 1, unit_price: 2500 },
  { min_quantity: 10, unit_price: 2300 },
  { min_quantity: 50, unit_price: 2100 }
]
```

---

### 3ï¸âƒ£ é˜¶æ¢¯ä»·æ ¼ï¼ˆä½/æ ‡å‡†/é«˜æ ¼å¼ï¼‰

```csv
model_base,series,base_price_low,base_price_normal,base_price_high
GY-63,GY,3500,4000,4500
AT-SR52K8,AT,2300,2500,2700
```

**ç»“æœ**: 
```javascript
pricing_model = 'tiered'
base_price = 4000  // æ ‡å‡†ä»·æ ¼
price_tiers = [
  { min_quantity: 10, unit_price: 3500, price_type: 'low', notes: 'å¤§æ‰¹é‡ä¼˜æƒ ä»·' },
  { min_quantity: 1, unit_price: 4000, price_type: 'normal', notes: 'æ ‡å‡†ä»·æ ¼' },
  { min_quantity: 1, unit_price: 4500, price_type: 'high', notes: 'å°æ‰¹é‡ä»·æ ¼' }
]
pricing = {  // å‘åå…¼å®¹
  base_price_normal: 4000,
  base_price_low: 3500,
  base_price_high: 4500
}
```

---

### 4ï¸âƒ£ é˜¶æ¢¯ä»·æ ¼ï¼ˆå®Œæ•´æ ¼å¼ï¼Œå¸¦å¤‡æ³¨ï¼‰

```csv
model_base,series,qty_1,price_1,price_type_1,notes_1,qty_2,price_2,price_type_2,notes_2
AT-SR52K8,AT,1,2500,normal,æ ‡å‡†ä»·,50,2100,low,æ‰¹é‡ä¼˜æƒ 
```

**ç»“æœ**: 
```javascript
price_tiers = [
  { 
    min_quantity: 1, 
    unit_price: 2500, 
    price_type: 'normal', 
    notes: 'æ ‡å‡†ä»·' 
  },
  { 
    min_quantity: 50, 
    unit_price: 2100, 
    price_type: 'low', 
    notes: 'æ‰¹é‡ä¼˜æƒ ' 
  }
]
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ¤æ–­æˆ‘çš„äº§å“åº”è¯¥ç”¨å“ªç§å®šä»·æ¨¡å¼ï¼Ÿ

**A**: 
- **å›ºå®šä»·æ ¼**: ä»·æ ¼ä¸éšæ•°é‡å˜åŒ–ï¼ˆå¦‚ SF ç³»åˆ—ï¼‰
- **é˜¶æ¢¯ä»·æ ¼**: ä¹°çš„è¶Šå¤šï¼Œå•ä»·è¶Šä½ï¼ˆå¦‚ AT/GY ç³»åˆ—æ‰¹é‡é‡‡è´­ï¼‰

---

### Q2: æˆ‘çš„ CSV åªæœ‰ä¸€ä¸ª `base_price` åˆ—ï¼Œä¼šè¢«è¯†åˆ«ä¸ºä»€ä¹ˆæ¨¡å¼ï¼Ÿ

**A**: è‡ªåŠ¨è¯†åˆ«ä¸º **å›ºå®šä»·æ ¼æ¨¡å¼** (`'fixed'`)

---

### Q3: å¦‚æœæˆ‘æœ‰ `base_price_low` å’Œ `base_price_high`ï¼Œä¼šæ€æ ·ï¼Ÿ

**A**: è‡ªåŠ¨è¯†åˆ«ä¸º **é˜¶æ¢¯ä»·æ ¼æ¨¡å¼** (`'tiered'`)ï¼Œå¹¶ç”Ÿæˆ 3 ä¸ªä»·æ ¼æ¡£ä½ï¼š
- ä½ä»·ï¼ˆæ•°é‡ â‰¥ 10ï¼‰
- æ ‡å‡†ä»·ï¼ˆæ•°é‡ â‰¥ 1ï¼‰
- é«˜ä»·ï¼ˆæ•°é‡ â‰¥ 1ï¼Œå°æ‰¹é‡ï¼‰

---

### Q4: é˜¶æ¢¯ä»·æ ¼æ¨¡å¼è¿˜ä¼šä¿ç•™ `base_price` å—ï¼Ÿ

**A**: **ä¼š**ï¼å³ä½¿æ˜¯é˜¶æ¢¯ä»·æ ¼ï¼Œä¹Ÿä¼šä¿ç•™ `base_price`ï¼ˆä½¿ç”¨æ ‡å‡†ä»·æ ¼æˆ–ç¬¬ä¸€æ¡£ä»·æ ¼ï¼‰ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢ã€‚

---

### Q5: å¦‚æœé˜¶æ¢¯ä»·æ ¼è§£æå¤±è´¥ä¼šæ€æ ·ï¼Ÿ

**A**: è‡ªåŠ¨å›é€€åˆ°å›ºå®šä»·æ ¼æ¨¡å¼ï¼Œä½¿ç”¨ `base_price` æˆ– `base_price_normal`ã€‚

---

### Q6: å¯¼å…¥æ•°æ®åå¦‚ä½•éªŒè¯ï¼Ÿ

**A**: 
```bash
# æ–¹æ³•1: ä½¿ç”¨ MongoDB Shell
mongosh
use cmax-actuators
db.actuators.find({ pricing_model: { $exists: false } }).count()  # åº”ä¸º 0
db.actuators.find({ pricing_model: 'fixed' }).count()
db.actuators.find({ pricing_model: 'tiered' }).count()

# æ–¹æ³•2: ä½¿ç”¨ API
curl http://localhost:3000/api/actuators?series=SF  # æŸ¥çœ‹ SF ç³»åˆ—
curl http://localhost:3000/api/actuators?series=AT  # æŸ¥çœ‹ AT ç³»åˆ—
```

---

### Q7: æˆ‘å·²ç»å¯¼å…¥äº†æ•°æ®ï¼Œä½†æ²¡æœ‰ `pricing_model` å­—æ®µï¼Œæ€ä¹ˆåŠï¼Ÿ

**A**: è¿è¡Œè¿ç§»è„šæœ¬ï¼š
```bash
cd backend
node migration_price_tiers.js
```

---

### Q8: è¿ç§»è„šæœ¬ä¼šåˆ é™¤æˆ‘çš„ `base_price` å—ï¼Ÿ

**A**: **ä¸ä¼š**ï¼æ–°ç‰ˆè¿ç§»è„šæœ¬ï¼ˆv2.0.0ï¼‰ä¼šä¿ç•™æ‰€æœ‰ç°æœ‰å­—æ®µï¼Œåªæ·»åŠ  `pricing_model`ã€‚

---

### Q9: æ”¯æŒçš„ä»·æ ¼å­—æ®µåˆ«åæœ‰å“ªäº›ï¼Ÿ

**A**: 
```javascript
// åŸºç¡€ä»·æ ¼
base_price, price

// é˜¶æ¢¯ä»·æ ¼ - æ•°é‡
qty_1, qty_2, ..., qty_5
min_quantity_1, min_quantity_2, ..., min_quantity_5

// é˜¶æ¢¯ä»·æ ¼ - å•ä»·
price_1, price_2, ..., price_5
unit_price_1, unit_price_2, ..., unit_price_5

// å¤šæ¡£ä½ä»·æ ¼
base_price_low, base_price_normal, base_price_high
```

---

### Q10: å¯ä»¥æ··åˆä½¿ç”¨ä¸¤ç§å®šä»·æ¨¡å¼å—ï¼Ÿ

**A**: **å¯ä»¥**ï¼SF ç³»åˆ—ç”¨å›ºå®šä»·æ ¼ï¼ŒAT/GY ç³»åˆ—ç”¨é˜¶æ¢¯ä»·æ ¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ã€‚

---

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### Step 1: å‡†å¤‡ CSV æ•°æ®

æ ¹æ®äº§å“ç‰¹æ€§é€‰æ‹©æ ¼å¼ï¼š
- SF ç³»åˆ— â†’ åªéœ€ `base_price` åˆ—
- AT/GY ç³»åˆ—ï¼ˆå•ä»·ï¼‰â†’ åªéœ€ `base_price` åˆ—
- AT/GY ç³»åˆ—ï¼ˆé˜¶æ¢¯ï¼‰â†’ éœ€è¦ `qty_X` å’Œ `price_X` åˆ—

### Step 2: è¿è¡Œå¯¼å…¥è„šæœ¬

```bash
cd backend

# SF ç³»åˆ—
node seed.js

# AT/GY ç³»åˆ—
node seed_at_gy_final.js
```

### Step 3: éªŒè¯æ•°æ®

```bash
# è¿æ¥æ•°æ®åº“
mongosh
use cmax-actuators

# æ£€æŸ¥ pricing_model å­—æ®µ
db.actuators.find({}, { model_base: 1, pricing_model: 1, base_price: 1 }).pretty()
```

### Step 4: æµ‹è¯• API

```bash
# æµ‹è¯•å›ºå®šä»·æ ¼
curl http://localhost:3000/api/actuators/price?model=SF025&quantity=5

# æµ‹è¯•é˜¶æ¢¯ä»·æ ¼
curl http://localhost:3000/api/actuators/price?model=AT-SR52K8&quantity=50
```

---

## ğŸ“Š è„šæœ¬å¯¹æ¯”è¡¨

| è„šæœ¬ | ç”¨é€” | æ”¯æŒæ ¼å¼ | å®šä»·æ¨¡å¼åˆ¤æ–­ |
|-----|------|---------|------------|
| `seed.js` | SFç³»åˆ—å¯¼å…¥ | å›ºå®šä»·æ ¼ã€é˜¶æ¢¯ä»·æ ¼ | âœ… è‡ªåŠ¨ |
| `seed_at_gy.js` | AT/GYåŸºç¡€å¯¼å…¥ | å›ºå®šä»·æ ¼ã€é˜¶æ¢¯ä»·æ ¼ | âœ… è‡ªåŠ¨ |
| `seed_at_gy_final.js` | AT/GYå®Œæ•´å¯¼å…¥ | å›ºå®šã€é˜¶æ¢¯ã€å¤šæ¡£ä½ | âœ… è‡ªåŠ¨ï¼ˆé«˜çº§ï¼‰ |
| `migration_price_tiers.js` | ç°æœ‰æ•°æ®è¿ç§» | - | âœ… æ™ºèƒ½åˆ¤æ–­ |

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- è¯¦ç»†æ–‡æ¡£: `æ•°æ®å¤„ç†è„šæœ¬æ›´æ–°æŠ¥å‘Š.md`
- æ¨¡å‹å®šä¹‰: `backend/models/Actuator.js`
- API æ–‡æ¡£: `APIæ¥å£æ–‡æ¡£.md`

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°**: 2025-10-28  
**ç»´æŠ¤**: C-MAX æŠ€æœ¯å›¢é˜Ÿ

