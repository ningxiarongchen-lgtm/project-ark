# é‡‡è´­è®¢å•åŠŸèƒ½æµ‹è¯•æŒ‡å—

## å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

1. âœ… åç«¯æœåŠ¡å·²å¯åŠ¨
2. âœ… MongoDB æ•°æ®åº“å·²è¿æ¥
3. âœ… å·²æœ‰æµ‹è¯•è´¦å·ï¼ˆç®¡ç†å‘˜æˆ–é‡‡è´­ä¸“å‘˜ï¼‰
4. âœ… å·²æœ‰è‡³å°‘ä¸€ä¸ªä¾›åº”å•†æ•°æ®

---

## æµ‹è¯•æµç¨‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
npm start
```

éªŒè¯å¯åŠ¨æˆåŠŸï¼š
```bash
curl http://localhost:5000/api/health
```

### 2. è·å–è®¤è¯Token

```bash
# ç™»å½•è·å–token
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "your_password"
  }'
```

ä¿å­˜å“åº”ä¸­çš„ `token` å­—æ®µï¼Œåç»­è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨ã€‚

### 3. æŸ¥çœ‹ä¾›åº”å•†åˆ—è¡¨

```bash
# æ›¿æ¢ YOUR_TOKEN ä¸ºå®é™…token
curl http://localhost:5000/api/suppliers \
  -H "Authorization: Bearer YOUR_TOKEN"
```

è®°å½•ä¸€ä¸ªä¾›åº”å•†çš„ `_id`ï¼Œç”¨äºåˆ›å»ºé‡‡è´­è®¢å•ã€‚

### 4. åˆ›å»ºé‡‡è´­è®¢å•

```bash
curl -X POST http://localhost:5000/api/purchase-orders \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "supplier_id": "SUPPLIER_ID_HERE",
    "items": [
      {
        "product_name": "ATæ‰§è¡Œå™¨",
        "product_code": "AT-10",
        "specification": "10NM",
        "quantity": 5,
        "unit": "ä»¶",
        "unit_price": 2000,
        "notes": "ä¼˜è´¨äº§å“"
      },
      {
        "product_name": "GYæ‰§è¡Œå™¨",
        "product_code": "GY-20",
        "specification": "20NM",
        "quantity": 3,
        "unit": "ä»¶",
        "unit_price": 3000
      }
    ],
    "expected_delivery_date": "2025-11-30",
    "payment_terms": "è´§åˆ°ä»˜æ¬¾",
    "shipping_address": "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºå¼ æ±Ÿè·¯123å·",
    "contact_person": "æå·¥",
    "contact_phone": "13800138000",
    "notes": "è¯·æŒ‰æ—¶äº¤è´§",
    "status": "draft"
  }'
```

è®°å½•å“åº”ä¸­çš„è®¢å• `_id` å’Œ `order_number`ã€‚

### 5. æŸ¥çœ‹æ‰€æœ‰é‡‡è´­è®¢å•

```bash
curl http://localhost:5000/api/purchase-orders \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 6. æŸ¥çœ‹å•ä¸ªé‡‡è´­è®¢å•è¯¦æƒ…

```bash
curl http://localhost:5000/api/purchase-orders/ORDER_ID_HERE \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 7. æ›´æ–°é‡‡è´­è®¢å•çŠ¶æ€

#### æäº¤å®¡æ ¸ï¼ˆdraft â†’ pendingï¼‰

```bash
curl -X PATCH http://localhost:5000/api/purchase-orders/ORDER_ID_HERE/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"status": "pending"}'
```

#### ç¡®è®¤è®¢å•ï¼ˆpending â†’ confirmedï¼‰

```bash
curl -X PATCH http://localhost:5000/api/purchase-orders/ORDER_ID_HERE/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"status": "confirmed"}'
```

#### å‘è´§ï¼ˆconfirmed â†’ shippedï¼‰

```bash
curl -X PATCH http://localhost:5000/api/purchase-orders/ORDER_ID_HERE/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"status": "shipped"}'
```

#### æ”¶è´§ï¼ˆshipped â†’ receivedï¼‰

```bash
curl -X PATCH http://localhost:5000/api/purchase-orders/ORDER_ID_HERE/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"status": "received"}'
```

### 8. æ›´æ–°é‡‡è´­è®¢å•ä¿¡æ¯

```bash
curl -X PUT http://localhost:5000/api/purchase-orders/ORDER_ID_HERE \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "expected_delivery_date": "2025-12-15",
    "notes": "å»¶æœŸäº¤è´§"
  }'
```

### 9. æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```bash
curl http://localhost:5000/api/purchase-orders/stats/summary \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 10. æŒ‰ä¾›åº”å•†æŸ¥è¯¢è®¢å•

```bash
curl http://localhost:5000/api/purchase-orders/supplier/SUPPLIER_ID_HERE \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 11. é«˜çº§æŸ¥è¯¢ï¼ˆå¸¦ç­›é€‰æ¡ä»¶ï¼‰

#### æŒ‰çŠ¶æ€ç­›é€‰

```bash
curl "http://localhost:5000/api/purchase-orders?status=confirmed" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰

```bash
curl "http://localhost:5000/api/purchase-orders?start_date=2025-10-01&end_date=2025-10-31" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### æœç´¢è®¢å•

```bash
curl "http://localhost:5000/api/purchase-orders?search=PO2025" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 12. åˆ é™¤é‡‡è´­è®¢å•ï¼ˆä»…è‰ç¨¿çŠ¶æ€ï¼‰

```bash
curl -X DELETE http://localhost:5000/api/purchase-orders/ORDER_ID_HERE \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ä½¿ç”¨ Postman æµ‹è¯•

### 1. å¯¼å…¥ç¯å¢ƒå˜é‡

åˆ›å»ºç¯å¢ƒï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```
base_url = http://localhost:5000
token = YOUR_TOKEN_HERE
supplier_id = YOUR_SUPPLIER_ID
order_id = YOUR_ORDER_ID
```

### 2. åˆ›å»ºè¯·æ±‚é›†åˆ

#### è·å–æ‰€æœ‰è®¢å•
- Method: GET
- URL: `{{base_url}}/api/purchase-orders`
- Headers: `Authorization: Bearer {{token}}`

#### åˆ›å»ºè®¢å•
- Method: POST
- URL: `{{base_url}}/api/purchase-orders`
- Headers: 
  - `Authorization: Bearer {{token}}`
  - `Content-Type: application/json`
- Body (raw JSON):
```json
{
  "supplier_id": "{{supplier_id}}",
  "items": [
    {
      "product_name": "æµ‹è¯•äº§å“",
      "quantity": 10,
      "unit_price": 100
    }
  ],
  "notes": "æµ‹è¯•è®¢å•"
}
```

---

## JavaScript/å‰ç«¯é›†æˆç¤ºä¾‹

### ä½¿ç”¨ Axios

```javascript
import axios from 'axios';

// é…ç½®åŸºç¡€URLå’Œæ‹¦æˆªå™¨
const api = axios.create({
  baseURL: 'http://localhost:5000/api',
});

// æ·»åŠ tokenåˆ°æ‰€æœ‰è¯·æ±‚
api.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// é‡‡è´­è®¢å•APIæ–¹æ³•
const purchaseOrdersAPI = {
  // è·å–æ‰€æœ‰è®¢å•
  getAll: (params) => api.get('/purchase-orders', { params }),
  
  // è·å–å•ä¸ªè®¢å•
  getById: (id) => api.get(`/purchase-orders/${id}`),
  
  // åˆ›å»ºè®¢å•
  create: (data) => api.post('/purchase-orders', data),
  
  // æ›´æ–°è®¢å•
  update: (id, data) => api.put(`/purchase-orders/${id}`, data),
  
  // åˆ é™¤è®¢å•
  delete: (id) => api.delete(`/purchase-orders/${id}`),
  
  // æ›´æ–°çŠ¶æ€
  updateStatus: (id, status) => 
    api.patch(`/purchase-orders/${id}/status`, { status }),
  
  // è·å–ç»Ÿè®¡
  getStats: () => api.get('/purchase-orders/stats/summary'),
  
  // æŒ‰ä¾›åº”å•†æŸ¥è¯¢
  getBySupplier: (supplierId) => 
    api.get(`/purchase-orders/supplier/${supplierId}`)
};

// ä½¿ç”¨ç¤ºä¾‹
async function testPurchaseOrders() {
  try {
    // åˆ›å»ºè®¢å•
    const newOrder = await purchaseOrdersAPI.create({
      supplier_id: '507f1f77bcf86cd799439012',
      items: [{
        product_name: 'ATæ‰§è¡Œå™¨',
        quantity: 5,
        unit_price: 2000
      }]
    });
    console.log('è®¢å•åˆ›å»ºæˆåŠŸ:', newOrder.data);
    
    // è·å–æ‰€æœ‰è®¢å•
    const orders = await purchaseOrdersAPI.getAll();
    console.log('æ‰€æœ‰è®¢å•:', orders.data);
    
    // æ›´æ–°çŠ¶æ€
    await purchaseOrdersAPI.updateStatus(
      newOrder.data.data._id, 
      'confirmed'
    );
    console.log('çŠ¶æ€æ›´æ–°æˆåŠŸ');
    
    // è·å–ç»Ÿè®¡
    const stats = await purchaseOrdersAPI.getStats();
    console.log('ç»Ÿè®¡ä¿¡æ¯:', stats.data);
    
  } catch (error) {
    console.error('é”™è¯¯:', error.response?.data || error.message);
  }
}
```

---

## æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] âœ… è·å–æ‰€æœ‰é‡‡è´­è®¢å•
- [ ] âœ… è·å–å•ä¸ªé‡‡è´­è®¢å•è¯¦æƒ…
- [ ] âœ… åˆ›å»ºæ–°é‡‡è´­è®¢å•
- [ ] âœ… æ›´æ–°é‡‡è´­è®¢å•ä¿¡æ¯
- [ ] âœ… åˆ é™¤è‰ç¨¿è®¢å•
- [ ] âœ… æ›´æ–°è®¢å•çŠ¶æ€

### çŠ¶æ€æµè½¬æµ‹è¯•

- [ ] âœ… draft â†’ pending
- [ ] âœ… pending â†’ confirmedï¼ˆè®°å½•å®¡æ‰¹ä¿¡æ¯ï¼‰
- [ ] âœ… confirmed â†’ shipped
- [ ] âœ… shipped â†’ receivedï¼ˆè®°å½•äº¤è´§æ—¥æœŸï¼‰
- [ ] âœ… ä»»æ„çŠ¶æ€ â†’ cancelled

### ä¸šåŠ¡é€»è¾‘æµ‹è¯•

- [ ] âœ… è®¢å•å·è‡ªåŠ¨ç”Ÿæˆä¸”å”¯ä¸€
- [ ] âœ… é‡‘é¢è‡ªåŠ¨è®¡ç®—æ­£ç¡®
- [ ] âœ… æ— æ³•ä¸ºé»‘åå•ä¾›åº”å•†åˆ›å»ºè®¢å•
- [ ] âœ… å·²å®Œæˆ/å·²å–æ¶ˆçš„è®¢å•æ— æ³•ä¿®æ”¹
- [ ] âœ… åªèƒ½åˆ é™¤è‰ç¨¿çŠ¶æ€è®¢å•
- [ ] âœ… ç¡®è®¤æ—¶è®°å½•å®¡æ‰¹äººå’Œæ—¶é—´
- [ ] âœ… æ”¶è´§æ—¶æ›´æ–°ä¾›åº”å•†äº¤æ˜“æ€»é¢

### æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•

- [ ] âœ… æŒ‰çŠ¶æ€ç­›é€‰
- [ ] âœ… æŒ‰ä¾›åº”å•†ç­›é€‰
- [ ] âœ… æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
- [ ] âœ… æœç´¢è®¢å•å·
- [ ] âœ… æ’åºåŠŸèƒ½

### æƒé™æµ‹è¯•

- [ ] âœ… ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ
- [ ] âœ… é‡‡è´­ä¸“å‘˜å¯ä»¥åˆ›å»ºã€æŸ¥çœ‹ã€æ›´æ–°è®¢å•
- [ ] âœ… é‡‡è´­ä¸“å‘˜ä¸èƒ½åˆ é™¤è®¢å•
- [ ] âœ… å…¶ä»–è§’è‰²æ— æ³•è®¿é—®

### ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•

- [ ] âœ… è®¢å•æ€»æ•°ç»Ÿè®¡
- [ ] âœ… å„çŠ¶æ€è®¢å•æ•°é‡ç»Ÿè®¡
- [ ] âœ… æ€»é‡‘é¢ç»Ÿè®¡
- [ ] âœ… æŒ‰æœˆç»Ÿè®¡
- [ ] âœ… TOPä¾›åº”å•†ç»Ÿè®¡

### é”™è¯¯å¤„ç†æµ‹è¯•

- [ ] âœ… æœªæä¾›å¿…éœ€å­—æ®µ
- [ ] âœ… ä¾›åº”å•†ä¸å­˜åœ¨
- [ ] âœ… è®¢å•ä¸å­˜åœ¨
- [ ] âœ… æ— æ•ˆçš„çŠ¶æ€å€¼
- [ ] âœ… æƒé™ä¸è¶³
- [ ] âœ… æœªè®¤è¯è®¿é—®

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. 401 æœªè®¤è¯é”™è¯¯

**åŸå› **: Tokenæ— æ•ˆæˆ–è¿‡æœŸ

**è§£å†³**:
```bash
# é‡æ–°ç™»å½•è·å–æ–°token
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@example.com", "password": "password"}'
```

### 2. 403 æƒé™ä¸è¶³é”™è¯¯

**åŸå› **: ç”¨æˆ·è§’è‰²ä¸æ­£ç¡®

**è§£å†³**: ç¡®ä¿ä½¿ç”¨ç®¡ç†å‘˜æˆ–é‡‡è´­ä¸“å‘˜è´¦å·

### 3. 404 èµ„æºä¸å­˜åœ¨

**åŸå› **: è®¢å•IDæˆ–ä¾›åº”å•†IDä¸æ­£ç¡®

**è§£å†³**: æ£€æŸ¥IDæ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿èµ„æºå­˜åœ¨

### 4. 400 é»‘åå•ä¾›åº”å•†é”™è¯¯

**åŸå› **: å°è¯•ä¸ºé»‘åå•ä¾›åº”å•†åˆ›å»ºè®¢å•

**è§£å†³**: å…ˆæ›´æ–°ä¾›åº”å•†çŠ¶æ€ä¸ºactive

```bash
curl -X PATCH http://localhost:5000/api/suppliers/SUPPLIER_ID/status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"status": "active"}'
```

### 5. 400 è®¢å•çŠ¶æ€é”™è¯¯

**åŸå› **: å°è¯•ä¿®æ”¹å·²å®Œæˆæˆ–å·²å–æ¶ˆçš„è®¢å•

**è§£å†³**: æ£€æŸ¥è®¢å•å½“å‰çŠ¶æ€ï¼Œç¡®è®¤æ˜¯å¦å…è®¸è¯¥æ“ä½œ

---

## MongoDB æ•°æ®éªŒè¯

### æŸ¥çœ‹é‡‡è´­è®¢å•æ•°æ®

```javascript
// è¿æ¥MongoDB
use model_selection_system

// æŸ¥çœ‹æ‰€æœ‰é‡‡è´­è®¢å•
db.purchaseorders.find().pretty()

// æŸ¥çœ‹æœ€æ–°è®¢å•
db.purchaseorders.find().sort({createdAt: -1}).limit(1).pretty()

// æŸ¥çœ‹ç‰¹å®šçŠ¶æ€çš„è®¢å•
db.purchaseorders.find({status: "confirmed"}).pretty()

// ç»Ÿè®¡å„çŠ¶æ€è®¢å•æ•°é‡
db.purchaseorders.aggregate([
  { $group: { _id: "$status", count: { $sum: 1 } } }
])

// æŸ¥çœ‹ä¾›åº”å•†çš„äº¤æ˜“æ€»é¢
db.suppliers.find({}, {name: 1, total_transaction_value: 1}).pretty()
```

---

## æ€§èƒ½æµ‹è¯•

### æ‰¹é‡åˆ›å»ºæµ‹è¯•æ•°æ®

```bash
# ä½¿ç”¨å¾ªç¯åˆ›å»ºå¤šä¸ªè®¢å•
for i in {1..10}; do
  curl -X POST http://localhost:5000/api/purchase-orders \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -d '{
      "supplier_id": "SUPPLIER_ID_HERE",
      "items": [{
        "product_name": "æµ‹è¯•äº§å“'$i'",
        "quantity": '$i',
        "unit_price": 100
      }]
    }'
  echo "\nè®¢å• $i åˆ›å»ºå®Œæˆ"
done
```

### å¹¶å‘æµ‹è¯•ï¼ˆä½¿ç”¨ Apache Benchï¼‰

```bash
# å®‰è£… ab
# macOS: è‡ªå¸¦
# Ubuntu: sudo apt-get install apache2-utils

# æµ‹è¯•è·å–è®¢å•åˆ—è¡¨ï¼ˆ100è¯·æ±‚ï¼Œ10å¹¶å‘ï¼‰
ab -n 100 -c 10 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/purchase-orders
```

---

## æ€»ç»“

å®Œæˆä»¥ä¸Šæµ‹è¯•åï¼Œä½ åº”è¯¥éªŒè¯äº†ï¼š

1. âœ… æ‰€æœ‰CRUDæ“ä½œæ­£å¸¸å·¥ä½œ
2. âœ… è®¢å•çŠ¶æ€æµè½¬æ­£ç¡®
3. âœ… ä¸šåŠ¡é€»è¾‘æŒ‰é¢„æœŸæ‰§è¡Œ
4. âœ… æƒé™æ§åˆ¶æœ‰æ•ˆ
5. âœ… ç»Ÿè®¡åŠŸèƒ½å‡†ç¡®
6. âœ… é”™è¯¯å¤„ç†å®Œå–„
7. âœ… æ•°æ®å®Œæ•´æ€§ä¿æŒ

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- åç«¯æ—¥å¿—è¾“å‡º
- MongoDBæ•°æ®
- APIå“åº”é”™è¯¯ä¿¡æ¯

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰

