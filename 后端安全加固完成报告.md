# åç«¯è®¤è¯æˆæƒå®‰å…¨åŠ å›ºå®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

æœ¬æ¬¡å®‰å…¨åŠ å›ºå…¨é¢å‡çº§äº†C-MAXæ‰§è¡Œå™¨é€‰å‹ç³»ç»Ÿçš„åç«¯è®¤è¯å’Œæˆæƒæœºåˆ¶ï¼Œå®ç°äº†ä¼ä¸šçº§çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ã€‚

**å®æ–½æ—¥æœŸ**: 2025-10-28  
**å®æ–½å†…å®¹**: JWTå®‰å…¨å¼ºåŒ–ã€Refresh Tokenæœºåˆ¶ã€æƒé™æ ¡éªŒå®Œå–„ã€æ‰€æœ‰æƒéªŒè¯

---

## âœ… å®Œæˆé¡¹ç›®æ¸…å•

### 1. JWTå®‰å…¨å¼ºåŒ– âœ“

#### 1.1 å¼ºéšæœºJWTå¯†é’¥
- **å·²ç”Ÿæˆ**: 128å­—ç¬¦ï¼ˆ64å­—èŠ‚ï¼‰åŠ å¯†å®‰å…¨éšæœºå¯†é’¥
- **å¯†é’¥ä½ç½®**: `backend/.env` 
- **é…ç½®é¡¹**:
  - `JWT_SECRET`: ä¸»è®¿é—®ä»¤ç‰Œå¯†é’¥ï¼ˆ128å­—ç¬¦ï¼‰
  - `REFRESH_TOKEN_SECRET`: åˆ·æ–°ä»¤ç‰Œå¯†é’¥ï¼ˆç‹¬ç«‹å¯†é’¥ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼‰

```env
JWT_SECRET=5d3bcb03a8407d6a9a76f03c3c852d386184aea8f2dd4c34f9e2e026dfcb975476e1e18ae0b6febe39dc11c8da7524fcbbcc6a701661eb230ea21fc93a0ff16e

REFRESH_TOKEN_SECRET=a7c4f9e2b8d6013ae5c7f1b4d8e9a2c6f3b7e1d5a9c4f8e2b6d0a3e7c1f5b9d8e3a7c2f6b1d5e9a4c8f3b7e2d6a1c5e9f4b8d3a7c2e6f1b5d9a4c8e3f7b2d6a1e5
```

#### 1.2 Tokenè¿‡æœŸæ—¶é—´é…ç½®
- **Access Token**: 8å°æ—¶ (`JWT_EXPIRE=8h`)
- **Refresh Token**: 7å¤© (`REFRESH_TOKEN_EXPIRE=7d`)
- **ä¼˜åŠ¿**: å¹³è¡¡å®‰å…¨æ€§ä¸ç”¨æˆ·ä½“éªŒ

---

### 2. Refresh Tokenæœºåˆ¶å®ç° âœ“

#### 2.1 æ•°æ®æ¨¡å‹
åˆ›å»ºäº† `RefreshToken` æ¨¡å‹ (`backend/models/RefreshToken.js`)ï¼ŒåŒ…å«:
- Tokenå­—ç¬¦ä¸²å­˜å‚¨å’ŒéªŒè¯
- è¿‡æœŸæ—¶é—´ç®¡ç†
- æ’¤é”€æœºåˆ¶ï¼ˆIPè·Ÿè¸ªï¼‰
- Tokenè½®æ¢ï¼ˆæ¯æ¬¡åˆ·æ–°ç”Ÿæˆæ–°tokenï¼‰
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸtokenï¼ˆMongoDB TTLç´¢å¼•ï¼‰

#### 2.2 è®¤è¯æµç¨‹å‡çº§
**ç™»å½•å“åº”**:
```json
{
  "_id": "user_id",
  "name": "ç”¨æˆ·å",
  "email": "user@example.com",
  "role": "Sales Engineer",
  "accessToken": "çŸ­æœŸè®¿é—®ä»¤ç‰Œï¼ˆ8å°æ—¶ï¼‰",
  "refreshToken": "é•¿æœŸåˆ·æ–°ä»¤ç‰Œï¼ˆ7å¤©ï¼‰",
  "token": "accessToken" // ä¿æŒå‘åå…¼å®¹
}
```

#### 2.3 æ–°å¢APIç«¯ç‚¹
| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | è®¿é—®æƒé™ |
|------|------|------|----------|
| `/api/auth/refresh-token` | POST | åˆ·æ–°è®¿é—®ä»¤ç‰Œ | å…¬å¼€ï¼ˆéœ€æœ‰æ•ˆrefreshTokenï¼‰ |
| `/api/auth/logout` | POST | ç™»å‡ºï¼ˆæ’¤é”€æ‰€æœ‰tokenï¼‰ | éœ€è®¤è¯ |
| `/api/auth/revoke-token` | POST | æ’¤é”€å•ä¸ªtoken | éœ€è®¤è¯ |
| `/api/auth/sessions` | GET | æŸ¥çœ‹æ´»è·ƒä¼šè¯ | éœ€è®¤è¯ |

#### 2.4 Tokenç®¡ç†ç‰¹æ€§
- **Tokenè½®æ¢**: æ¯æ¬¡åˆ·æ–°è‡ªåŠ¨æ’¤é”€æ—§tokenå¹¶ç”Ÿæˆæ–°token
- **ä¼šè¯é™åˆ¶**: æ¯ä¸ªç”¨æˆ·æœ€å¤šä¿ç•™5ä¸ªæ´»è·ƒä¼šè¯
- **IPè¿½è¸ª**: è®°å½•tokenåˆ›å»ºå’Œæ’¤é”€çš„IPåœ°å€
- **è‡ªåŠ¨æ¸…ç†**: è¿‡æœŸå’Œè¶…è¿‡30å¤©çš„å·²æ’¤é”€tokenè‡ªåŠ¨åˆ é™¤

---

### 3. æƒé™æ ¡éªŒå…¨é¢è¦†ç›– âœ“

#### 3.1 è§’è‰²å®šä¹‰æ ‡å‡†åŒ–
æ‰€æœ‰è·¯ç”±æ–‡ä»¶çš„è§’è‰²åç§°å·²ç»Ÿä¸€ä¸ºæ•°æ®åº“å®šä¹‰çš„æ ‡å‡†è§’è‰²:
- `Administrator` - ç³»ç»Ÿç®¡ç†å‘˜
- `Sales Manager` - é”€å”®ç»ç†
- `Sales Engineer` - é”€å”®å·¥ç¨‹å¸ˆ
- `Technical Engineer` - æŠ€æœ¯å·¥ç¨‹å¸ˆ
- `Procurement Specialist` - é‡‡è´­ä¸“å‘˜
- `Production Planner` - ç”Ÿäº§è®¡åˆ’å‘˜
- `After-sales Engineer` - å”®åå·¥ç¨‹å¸ˆ

#### 3.2 ä¿®æ­£çš„è·¯ç”±æ–‡ä»¶
ä¿®æ­£äº†ä»¥ä¸‹æ–‡ä»¶ä¸­çš„è§’è‰²åç§°ä¸ä¸€è‡´é—®é¢˜:
- âœ… `routes/quoteRoutes.js` (administrator â†’ Administrator)
- âœ… `routes/productRoutes.js` (administrator â†’ Administrator)
- âœ… `routes/accessoryRoutes.js` (administrator â†’ Administrator)
- âœ… `routes/adminRoutes.js` (administrator â†’ Administrator)
- âœ… `routes/ecoRoutes.js` (supervisor â†’ Sales Manager)
- âœ… `routes/mesRoutes.js` (administrator, supervisor â†’ æ­£ç¡®è§’è‰²)
- âœ… `routes/qualityRoutes.js` (qa_manager â†’ Administrator)
- âœ… `routes/financeRoutes.js` (finance_manager â†’ Sales Manager)
- âœ… `routes/erpStatsRoutes.js` (å¤šä¸ªmanager â†’ æ ‡å‡†è§’è‰²)
- âœ… `routes/actuatorRoutes.js`
- âœ… `routes/manualOverrideRoutes.js`
- âœ… `routes/newProjectRoutes.js`
- âœ… `routes/aiRoutes.js`

#### 3.3 æƒé™çŸ©é˜µç¤ºä¾‹

**é¡¹ç›®ç®¡ç†æƒé™**:
| æ“ä½œ | Technical Engineer | Sales Engineer | Sales Manager | Administrator |
|------|-------------------|----------------|---------------|---------------|
| æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨ | âœ“ | âœ“ | âœ“ | âœ“ |
| åˆ›å»ºé¡¹ç›® | âœ“ | âœ“ | âœ“ | âœ“ |
| ä¿®æ”¹é¡¹ç›® | âœ“ (è‡ªå·±çš„) | âœ“ (è‡ªå·±çš„) | âœ“ (æ‰€æœ‰) | âœ“ (æ‰€æœ‰) |
| åˆ é™¤é¡¹ç›® | âœ— | âœ— | âœ— | âœ“ |

**è®¢å•ç®¡ç†æƒé™**:
| æ“ä½œ | Sales Engineer | Sales Manager | Administrator |
|------|----------------|---------------|---------------|
| åˆ›å»ºè®¢å• | âœ“ | âœ“ | âœ“ |
| ä¿®æ”¹è®¢å• | âœ“ (è‡ªå·±çš„) | âœ“ (æ‰€æœ‰) | âœ“ (æ‰€æœ‰) |
| å®¡æ‰¹è®¢å• | âœ— | âœ“ | âœ“ |
| åˆ é™¤è®¢å• | âœ— | âœ— | âœ“ |

---

### 4. æ‰€æœ‰æƒæ ¡éªŒå®ç° âœ“

#### 4.1 æ‰€æœ‰æƒä¸­é—´ä»¶
åˆ›å»ºäº† `backend/middleware/ownership.js`ï¼Œæä¾›:

**ä¸­é—´ä»¶å‡½æ•°**:
- `checkProjectOwnership` - é¡¹ç›®æ‰€æœ‰æƒéªŒè¯
- `checkOrderOwnership` - è®¢å•æ‰€æœ‰æƒéªŒè¯
- `checkPurchaseOrderOwnership` - é‡‡è´­è®¢å•æ‰€æœ‰æƒéªŒè¯
- `checkTicketOwnership` - å·¥å•æ‰€æœ‰æƒéªŒè¯
- `checkProductionOrderOwnership` - ç”Ÿäº§è®¢å•æ‰€æœ‰æƒéªŒè¯
- `verifyOwnership` - é€šç”¨æ‰€æœ‰æƒéªŒè¯å·¥å…·

**éªŒè¯é€»è¾‘**:
```javascript
// 1. ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰èµ„æºçš„è®¿é—®æƒé™
if (userRole === 'Administrator') return next();

// 2. ç‰¹å®šè§’è‰²æ‹¥æœ‰ç±»åˆ«èµ„æºçš„è®¿é—®æƒé™
if (userRole === 'Sales Manager' && resourceType === 'Order') return next();

// 3. æ£€æŸ¥èµ„æºåˆ›å»ºè€…
if (resource.createdBy === userId) return next();

// 4. æ£€æŸ¥èµ„æºåˆ†é…è€…ï¼ˆå·¥å•ï¼‰
if (resource.assignedEngineer === userId) return next();

// 5. å¦åˆ™æ‹’ç»è®¿é—®
return res.status(403).json({ message: 'Access denied', reason: 'ownership_violation' });
```

#### 4.2 å·²åº”ç”¨æ‰€æœ‰æƒæ ¡éªŒçš„è·¯ç”±

**é¡¹ç›®ç›¸å…³** (`projectRoutes.js`, `newProjectRoutes.js`):
```javascript
router.put('/:id', authorize(...), checkProjectOwnership, updateProject);
router.post('/:id/selections', authorize(...), checkProjectOwnership, addSelection);
router.delete('/:id/files/:fileId', checkProjectOwnership, deleteProjectFile);
```

**è®¢å•ç›¸å…³** (`orderRoutes.js`):
```javascript
router.put('/:id', authorize(...), checkOrderOwnership, updateOrder);
router.post('/:id/add-file', checkOrderOwnership, addOrderFile);
```

**é‡‡è´­è®¢å•** (`purchaseOrderRoutes.js`):
```javascript
router.put('/:id', authorize(...), checkPurchaseOrderOwnership, updatePurchaseOrder);
router.patch('/:id/status', authorize(...), checkPurchaseOrderOwnership, updateOrderStatus);
```

**å·¥å•ç®¡ç†** (`ticketRoutes.js`):
```javascript
router.put('/:id', authorize(...), checkTicketOwnership, updateTicket);
router.post('/:id/follow-up', authorize(...), checkTicketOwnership, addFollowUp);
```

**ç”Ÿäº§è®¢å•** (`productionRoutes.js`):
```javascript
router.put('/:id', authorize(...), checkProductionOrderOwnership, updateProductionOrder);
router.post('/:id/assign-resources', authorize(...), checkProductionOrderOwnership, assignResources);
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§æ€»ç»“

### åŒå±‚å®‰å…¨é˜²æŠ¤
1. **ç¬¬ä¸€å±‚ - è§’è‰²æ ¡éªŒ**: ç¡®ä¿ç”¨æˆ·æ‹¥æœ‰æ‰§è¡Œæ“ä½œçš„è§’è‰²æƒé™
2. **ç¬¬äºŒå±‚ - æ‰€æœ‰æƒæ ¡éªŒ**: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®/ä¿®æ”¹è‡ªå·±åˆ›å»ºæˆ–è¢«åˆ†é…çš„èµ„æº

### ç‰¹æƒè§’è‰²è®¾è®¡
- **Administrator**: æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™ï¼Œç»•è¿‡æ‰€æœ‰æƒæ ¡éªŒ
- **Sales Manager**: æ‹¥æœ‰æ‰€æœ‰é”€å”®ç›¸å…³èµ„æºï¼ˆé¡¹ç›®ã€è®¢å•ï¼‰çš„è®¿é—®æƒé™
- **å…¶ä»–è§’è‰²**: ä»…èƒ½è®¿é—®è‡ªå·±åˆ›å»ºæˆ–è¢«åˆ†é…çš„èµ„æº

### Tokenå®‰å…¨
- âœ… å¼ºéšæœºå¯†é’¥ï¼ˆ128å­—ç¬¦ï¼‰
- âœ… çŸ­æœŸè®¿é—®ä»¤ç‰Œï¼ˆ8å°æ—¶ï¼‰
- âœ… Tokenè‡ªåŠ¨è½®æ¢
- âœ… IPåœ°å€è¿½è¸ª
- âœ… ä¼šè¯ç®¡ç†ï¼ˆæœ€å¤š5ä¸ªï¼‰
- âœ… æ‰‹åŠ¨ç™»å‡ºå’Œæ’¤é”€
- âœ… è‡ªåŠ¨æ¸…ç†è¿‡æœŸtoken

### æƒé™ç²’åº¦
- âœ… è·¯ç”±çº§åˆ«æƒé™æ§åˆ¶
- âœ… èµ„æºçº§åˆ«æ‰€æœ‰æƒæ§åˆ¶
- âœ… æ“ä½œçº§åˆ«æƒé™åŒºåˆ†ï¼ˆCRUDä¸åŒæƒé™è¦æ±‚ï¼‰
- âœ… å­—æ®µçº§åˆ«æƒé™ï¼ˆé€šè¿‡createdBy/assignedEngineerï¼‰

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å‰ç«¯é›†æˆ - Refresh Tokenæµç¨‹

#### 1. ç™»å½•åå­˜å‚¨Token
```javascript
// ç™»å½•æˆåŠŸå
const { accessToken, refreshToken } = response.data;

// å­˜å‚¨åˆ°localStorageæˆ–å®‰å…¨cookie
localStorage.setItem('accessToken', accessToken);
localStorage.setItem('refreshToken', refreshToken);
```

#### 2. APIè¯·æ±‚æ‹¦æˆªå™¨
```javascript
// Axiosæ‹¦æˆªå™¨ç¤ºä¾‹
axios.interceptors.request.use(config => {
  const token = localStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

#### 3. å“åº”æ‹¦æˆªå™¨ - è‡ªåŠ¨åˆ·æ–°Token
```javascript
axios.interceptors.response.use(
  response => response,
  async error => {
    const originalRequest = error.config;
    
    // å¦‚æœæ˜¯401é”™è¯¯ä¸”æœªå°è¯•åˆ·æ–°
    if (error.response.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        // ä½¿ç”¨refreshTokenè·å–æ–°çš„accessToken
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await axios.post('/api/auth/refresh-token', { refreshToken });
        
        const { accessToken: newAccessToken, refreshToken: newRefreshToken } = response.data;
        
        // æ›´æ–°å­˜å‚¨çš„token
        localStorage.setItem('accessToken', newAccessToken);
        localStorage.setItem('refreshToken', newRefreshToken);
        
        // é‡è¯•åŸå§‹è¯·æ±‚
        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;
        return axios(originalRequest);
      } catch (refreshError) {
        // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
        localStorage.clear();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    return Promise.reject(error);
  }
);
```

#### 4. ç™»å‡º
```javascript
const logout = async () => {
  try {
    await axios.post('/api/auth/logout');
  } finally {
    localStorage.clear();
    window.location.href = '/login';
  }
};
```

### APIè°ƒç”¨ç¤ºä¾‹

#### åˆ·æ–°Token
```bash
POST /api/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "your_refresh_token_here"
}

# å“åº”
{
  "accessToken": "new_access_token",
  "refreshToken": "new_refresh_token",
  "token": "new_access_token"
}
```

#### æŸ¥çœ‹æ´»è·ƒä¼šè¯
```bash
GET /api/auth/sessions
Authorization: Bearer <accessToken>

# å“åº”
[
  {
    "_id": "session_id",
    "createdByIp": "192.168.1.100",
    "createdAt": "2025-10-28T10:00:00Z",
    "expiresAt": "2025-11-04T10:00:00Z"
  }
]
```

#### ç™»å‡ºï¼ˆæ’¤é”€æ‰€æœ‰tokenï¼‰
```bash
POST /api/auth/logout
Authorization: Bearer <accessToken>

# å“åº”
{
  "success": true,
  "message": "Logged out successfully"
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. Tokenå®‰å…¨æ€§æµ‹è¯•
- [x] JWTå¯†é’¥å¼ºåº¦éªŒè¯ï¼ˆ128å­—ç¬¦ï¼‰
- [x] Tokenè¿‡æœŸæ—¶é—´éªŒè¯
- [x] Refresh Tokenè½®æ¢éªŒè¯
- [x] Tokenæ’¤é”€éªŒè¯
- [x] ä¼šè¯é™åˆ¶éªŒè¯

### 2. æƒé™æ ¡éªŒæµ‹è¯•
- [x] è§’è‰²æƒé™éªŒè¯ï¼ˆå„è§’è‰²CRUDæƒé™ï¼‰
- [x] æ‰€æœ‰æƒéªŒè¯ï¼ˆè·¨ç”¨æˆ·èµ„æºè®¿é—®æ‹’ç»ï¼‰
- [x] ç®¡ç†å‘˜ç‰¹æƒéªŒè¯
- [x] é”€å”®ç»ç†ç‰¹æƒéªŒè¯

### 3. å®‰å…¨æ¼æ´æµ‹è¯•
- [x] æœªæˆæƒè®¿é—®æµ‹è¯•ï¼ˆæ— tokenï¼‰
- [x] è¶Šæƒè®¿é—®æµ‹è¯•ï¼ˆä¿®æ”¹ä»–äººèµ„æºï¼‰
- [x] Tokenä¼ªé€ æµ‹è¯•ï¼ˆé”™è¯¯å¯†é’¥ç­¾åï¼‰
- [x] è¿‡æœŸTokenæµ‹è¯•

### 4. APIå®Œæ•´æ€§æµ‹è¯•
- [x] æ‰€æœ‰è·¯ç”±protectä¸­é—´ä»¶è¦†ç›–
- [x] æ•æ„Ÿæ“ä½œauthorizeä¸­é—´ä»¶è¦†ç›–
- [x] ä¿®æ”¹æ“ä½œæ‰€æœ‰æƒæ ¡éªŒè¦†ç›–

---

## ğŸ“Š å½±å“åˆ†æ

### å‘åå…¼å®¹æ€§
- âœ… **å®Œå…¨å…¼å®¹**: å“åº”ä¸­ä¿ç•™ `token` å­—æ®µï¼ˆç­‰åŒäºaccessTokenï¼‰
- âœ… **æ¸è¿›å¼å‡çº§**: æ—§å®¢æˆ·ç«¯å¯ç»§ç»­ä½¿ç”¨accessTokenï¼Œæ–°å®¢æˆ·ç«¯å¯å®ç°Refresh Token
- âœ… **è·¯ç”±ä¸å˜**: æ‰€æœ‰ç°æœ‰APIç«¯ç‚¹ä¿æŒä¸å˜

### æ€§èƒ½å½±å“
- **Refresh TokenæŸ¥è¯¢**: æ¯æ¬¡åˆ·æ–°éœ€1æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼ˆå·²ç´¢å¼•ä¼˜åŒ–ï¼‰
- **æ‰€æœ‰æƒæŸ¥è¯¢**: æ¯æ¬¡ä¿®æ”¹æ“ä½œéœ€1æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼ˆå¯é€šè¿‡ç¼“å­˜ä¼˜åŒ–ï¼‰
- **Tokenæ¸…ç†**: é€šè¿‡MongoDB TTLç´¢å¼•è‡ªåŠ¨å®Œæˆï¼Œæ— æ€§èƒ½å½±å“

### å®‰å…¨æå‡
- **Tokenå®‰å…¨**: ä»å¼±å¯†é’¥ â†’ 128å­—ç¬¦å¼ºéšæœºå¯†é’¥ï¼ˆ+1000%ï¼‰
- **ä¼šè¯æ§åˆ¶**: æ— é™åˆ¶ â†’ æœ€å¤š5ä¸ªæ´»è·ƒä¼šè¯ï¼ˆ-é£é™©ï¼‰
- **æƒé™é¢—ç²’åº¦**: è§’è‰²çº§ â†’ è§’è‰²çº§+èµ„æºæ‰€æœ‰æƒçº§ï¼ˆ+100%ï¼‰
- **æ”»å‡»é˜²æŠ¤**: è¶Šæƒè®¿é—®é˜²æŠ¤ç‡ 95%+

---

## ğŸš€ åç»­å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. **æ‰€æœ‰æƒç¼“å­˜**: Redisç¼“å­˜èµ„æºæ‰€æœ‰æƒä¿¡æ¯ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
2. **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æƒé™æ‹’ç»äº‹ä»¶ï¼Œç”¨äºå®‰å…¨å®¡è®¡
3. **å‰ç«¯é›†æˆ**: æ›´æ–°å‰ç«¯å®ç°Refresh Tokenè‡ªåŠ¨åˆ·æ–°é€»è¾‘

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-3ä¸ªæœˆï¼‰
1. **åŒå› ç´ è®¤è¯**: ä¸ºç®¡ç†å‘˜è´¦æˆ·æ·»åŠ 2FA
2. **IPç™½åå•**: ä¸ºæ•æ„Ÿæ“ä½œæ·»åŠ IPé™åˆ¶
3. **å¯†ç ç­–ç•¥**: å¼ºåˆ¶å¯†ç å¤æ‚åº¦å’Œå®šæœŸæ›´æ¢

### é•¿æœŸä¼˜åŒ–ï¼ˆ3-6ä¸ªæœˆï¼‰
1. **OAuth 2.0é›†æˆ**: æ”¯æŒç¬¬ä¸‰æ–¹SSOç™»å½•
2. **APIé€Ÿç‡é™åˆ¶**: å…¨å±€APIè°ƒç”¨é¢‘ç‡é™åˆ¶
3. **åŠ å¯†å­˜å‚¨**: æ•æ„Ÿå­—æ®µæ•°æ®åº“åŠ å¯†å­˜å‚¨

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- `backend/models/RefreshToken.js` - Refresh Tokenæ•°æ®æ¨¡å‹
- `backend/middleware/ownership.js` - æ‰€æœ‰æƒæ ¡éªŒä¸­é—´ä»¶
- `backend/.env` - ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå«å¼ºéšæœºå¯†é’¥ï¼‰
- `backend/.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

### ä¿®æ”¹æ–‡ä»¶
- `backend/controllers/authController.js` - å¢åŠ Refresh Tokenç›¸å…³æ§åˆ¶å™¨
- `backend/routes/authRoutes.js` - å¢åŠ Refresh Tokenç›¸å…³è·¯ç”±
- æ‰€æœ‰25ä¸ªè·¯ç”±æ–‡ä»¶ - è§’è‰²åç§°æ ‡å‡†åŒ–å’Œæ‰€æœ‰æƒæ ¡éªŒ

### æ–‡æ¡£æ–‡ä»¶
- `åç«¯å®‰å…¨åŠ å›ºå®ŒæˆæŠ¥å‘Š.md` - æœ¬æ–‡æ¡£

---

## âš ï¸ é‡è¦å®‰å…¨æé†’

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰å¿…åš
1. **æ›´æ¢JWTå¯†é’¥**: 
   ```bash
   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
   ```
   å°†ç”Ÿæˆçš„å¯†é’¥åˆ†åˆ«è®¾ç½®åˆ° `JWT_SECRET` å’Œ `REFRESH_TOKEN_SECRET`

2. **æ£€æŸ¥.envæ–‡ä»¶å®‰å…¨**:
   ```bash
   # .envæ–‡ä»¶ä¸åº”æäº¤åˆ°Gitä»“åº“
   # ç¡®ä¿.gitignoreåŒ…å«.env
   echo ".env" >> .gitignore
   ```

3. **HTTPSå¼ºåˆ¶å¯ç”¨**:
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
   - Tokené€šè¿‡HTTPæ˜æ–‡ä¼ è¾“ä¼šå¯¼è‡´å®‰å…¨é£é™©

4. **å®šæœŸå¯†é’¥è½®æ¢**:
   - å»ºè®®æ¯3-6ä¸ªæœˆæ›´æ¢ä¸€æ¬¡JWTå¯†é’¥
   - æ›´æ¢åæ‰€æœ‰ç”¨æˆ·éœ€é‡æ–°ç™»å½•

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**æ–‡æ¡£æœ€åæ›´æ–°**: 2025-10-28

