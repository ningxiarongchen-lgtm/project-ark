# 👷 车间工人完整功能配置

## 📅 更新时间
**2025-10-31 21:00**

---

## 🎯 问题说明

用户反馈：
1. ❌ 车间工人看不到具体的生产订单
2. ❌ 不知道负责哪些型号的生产
3. ❌ 不知道怎么提交"已生产"报告
4. ❌ 左侧菜单只有"仪表盘"，没有其他功能
5. ❌ 页面底部需要添加工作流程

---

## ✅ 已完成的配置

### 1. 左侧菜单配置
**文件**: `frontend/src/components/Layout/MainLayout.jsx`

```javascript
// 车间工人专属菜单
{
  key: '/shop-floor',
  label: '我的工单',
  icon: <FileDoneOutlined />,
  roles: ['Shop Floor Worker'],
}
```

✅ **车间工人应该能看到两个菜单项**：
- 📊 仪表盘
- 📋 我的工单

### 2. Dashboard工作流程
**文件**: `frontend/src/pages/ShopFloorDashboard.jsx`

✅ 已在页面底部添加4步工作流程：
1. 🟣 开始工单
2. 🟣 生产操作
3. 🔵 报告进度
4. 🟢 完成工单

### 3. 生产工单页面
**文件**: `frontend/src/pages/ShopFloorTerminal.jsx`

✅ 完整的生产工单管理页面已存在

---

## 🔍 功能详解

### 📊 仪表盘 (/dashboard)

车间工人登录后看到的Dashboard包含：

#### 统计卡片
- **今日任务**: 显示今天分配的工单数量
- **进行中**: 显示正在进行的工单数量
- **今日完成**: 显示今天完成的工单数量
- **紧急任务**: 显示高优先级工单数量

#### 今日完成率
- 进度条显示今日完成百分比
- 实时计算：已完成数量 / 计划数量

#### 今日任务列表
显示今天的工单，包括：
- 工单号
- 产品型号（model_base）
- 工序名称
- 计划数量
- 已完成数量
- 完成进度条
- 工作时间段
- 快捷操作按钮

#### 紧急任务提醒
- 显示高优先级和紧急工单
- 红色/橙色标识
- 截止时间提醒

#### 快捷操作
- 🚀 开始工作 → 跳转到"我的工单"
- ✅ 报告进度 → 跳转到"我的工单"
- ⚠️ 报告异常 → 跳转到"我的工单"

#### 工作流程说明（新增）
4步彩色卡片展示完整流程

---

### 📋 我的工单 (/shop-floor)

这是车间工人的**核心工作页面**！

#### 页面布局

##### 1. 顶部信息栏
```
🔧 车间终端
操作工: 郑工人 | 最后更新: 2025-10-31 21:00:00
[刷新按钮]
```

##### 2. 统计卡片（4个）
| 卡片 | 内容 |
|-----|------|
| 进行中的工单 | 正在执行的工单数 |
| 待开始 | 已发布但未开始的 |
| 已完成今日 | 今天完成的数量 |
| 异常工单 | 有问题需要处理的 |

##### 3. 工单列表（2个Tab）

**Tab 1: 我的任务（卡片视图）**

每个工单卡片显示：
```
┌─────────────────────────────────────┐
│ [紧急][进行中][延期] WO-20251031-001 │
│                                     │
│ 产品: AT-2000                       │
│ 工序: 装配                          │
│ 工作中心: 装配车间1                  │
│ 计划时间: 2025-10-31 08:00 ~ 17:00 │
│                                     │
│ 完成进度: ████████░░ 80%           │
│ 100 / 125 件                       │
│                                     │
│ 合格: 98    不合格: 2               │
│                                     │
│ [工艺指导] [异常记录]               │
│                                     │
│ [报告进度] [暂停] [完成] [报告异常] │
└─────────────────────────────────────┘
```

**点击卡片展开**，显示：
- 📝 工艺指导（如果有）
- ⚠️ 异常记录（如果有）
- 操作按钮

**Tab 2: 列表视图（表格视图）**

表格显示所有工单，列包括：
- 工单号
- 优先级
- 状态
- 产品
- 工序
- 工作中心
- 计划开始时间
- 进度
- 操作按钮

---

## 🔧 详细操作流程

### 1. 查看分配的生产订单

```
步骤1: 点击左侧菜单"我的工单"
    ↓
步骤2: 看到所有分配给自己的工单
    ↓
步骤3: 每个工单显示：
    - 产品型号（如: AT-2000, AT-5000）
    - 工序名称（如: 装配、测试、包装）
    - 计划数量（如: 100件）
    - 工作时间段
```

### 2. 开始生产工单

```
步骤1: 在工单卡片上点击"开始"按钮
    ↓
步骤2: 系统记录开始时间
    ↓
步骤3: 工单状态变为"进行中"
    ↓
步骤4: 卡片背景变为蓝色高亮
    ↓
步骤5: 开始按照工艺要求生产
```

### 3. 报告生产进度

```
步骤1: 点击"报告进度"按钮
    ↓
步骤2: 弹出表单，填写：
    - 完成数量: 例如 50
    - 合格数量: 例如 48
    - 不合格数量: 例如 2
    - 备注: 可选
    ↓
步骤3: 点击"确定"
    ↓
步骤4: 系统更新进度
    ↓
步骤5: 卡片上的进度条自动更新
    ↓
步骤6: 完成百分比实时显示
```

### 4. 提交"已生产"（完成工单）

```
步骤1: 生产完成后（进度100%）
    ↓
步骤2: 点击"完成"按钮
    ↓
步骤3: 系统弹出确认对话框
    ↓
步骤4: 确认完成
    ↓
步骤5: 工单状态变为"已完成"
    ↓
步骤6: 工单自动进入质检流程
    ↓
步骤7: 工单从"我的任务"列表移除
    ↓
步骤8: 统计卡片"已完成今日"数字+1
```

### 5. 报告异常

```
步骤1: 遇到问题时点击"报告异常"
    ↓
步骤2: 选择异常类型：
    - 质量问题
    - 设备故障
    - 物料短缺
    - 工具缺失
    - 其他
    ↓
步骤3: 填写详细描述
    ↓
步骤4: 提交异常
    ↓
步骤5: 系统通知生产计划员
    ↓
步骤6: 工单上显示异常标记
```

### 6. 暂停工单

```
步骤1: 需要暂停时点击"暂停"
    ↓
步骤2: 填写暂停原因
    ↓
步骤3: 确认暂停
    ↓
步骤4: 工单状态变为"暂停"
    ↓
步骤5: 可以稍后点击"恢复"继续
```

---

## 📋 工单信息详解

### 工单包含的信息

#### 基本信息
- **工单号**: WO-20251031-001（系统自动生成）
- **产品型号**: AT-2000（执行器型号）
- **工序**: 装配、测试、包装等
- **工作中心**: 装配车间1、测试间等

#### 计划信息
- **计划数量**: 100件
- **计划开始时间**: 2025-10-31 08:00
- **计划结束时间**: 2025-10-31 17:00

#### 实际信息
- **实际开始时间**: 工人点击"开始"的时间
- **实际数量**: 已完成的数量
- **合格数量**: 质量合格的数量
- **不合格数量**: 不合格品数量
- **实际结束时间**: 工人点击"完成"的时间

#### 状态信息
- **状态**: 已发布、进行中、暂停、已完成
- **优先级**: 低、正常、高、紧急
- **是否延期**: 超过计划时间会显示"延期"标记

#### 辅助信息
- **工艺指导**: 操作说明和注意事项
- **异常记录**: 设备故障、质量问题等
- **备注**: 其他说明

---

## 🎯 典型工作日示例

### 早上8:00 - 开始工作

```
1. 登录系统
2. 查看Dashboard
   - 今日任务: 3个
   - 紧急任务: 1个
3. 点击"开始工作"快捷按钮
4. 跳转到"我的工单"页面
5. 看到3个工单：
   - WO-001: AT-2000 装配（100件）紧急
   - WO-002: AT-5000 测试（50件）
   - WO-003: AT-3000 包装（80件）
```

### 上午8:10 - 开始第一个工单

```
1. 点击WO-001"开始"按钮
2. 卡片变蓝色
3. 开始装配AT-2000执行器
4. 按照工艺指导操作
```

### 上午10:00 - 报告进度

```
1. 已完成50件
2. 点击"报告进度"
3. 填写：
   - 完成数量: 50
   - 合格数量: 50
   - 不合格数量: 0
4. 提交
5. 进度条显示50%
```

### 上午10:30 - 发现设备异常

```
1. 装配设备出现故障
2. 点击"报告异常"
3. 选择"设备故障"
4. 描述: "装配机器压力不稳定"
5. 提交异常
6. 点击"暂停"工单
7. 等待维修
```

### 上午11:00 - 恢复生产

```
1. 设备修好
2. 点击"恢复"按钮
3. 继续生产
```

### 中午12:00 - 完成第一个工单

```
1. 已完成100件
2. 点击"报告进度"
3. 填写：
   - 完成数量: 100
   - 合格数量: 98
   - 不合格数量: 2
4. 进度条100%
5. 点击"完成"按钮
6. 确认完成
7. 工单进入质检流程
8. Dashboard显示"今日完成: 1"
```

### 下午 - 继续处理其他工单

```
重复上述流程处理WO-002和WO-003
```

---

## 📱 页面截图说明

### Dashboard页面
```
┌─────────────────────────────────────┐
│ 🔧 晚上好，郑工人！                  │
│ "认真做好每一件产品，质量是我们的尊严" │
│                                     │
│ 📅 2025年10月31日 Friday 20:00     │
└─────────────────────────────────────┘

┌──────┬──────┬──────┬──────┐
│今日任务│进行中  │今日完成│紧急任务│
│  3个  │  1个  │  0个  │  1个  │
└──────┴──────┴──────┴──────┘

今日完成率: ████░░░░░░ 40%

📅 今日任务（前5个）
[任务卡片列表]

🔥 紧急任务
[紧急任务时间线]

🔧 快捷操作
[开始工作] [报告进度] [报告异常]

📖 车间工人工作流程
[4步流程卡片] ← 新增
```

### 我的工单页面
```
┌─────────────────────────────────────┐
│ 🔧 车间终端                          │
│ 操作工: 郑工人 | 最后更新: 21:00:00  │
│                            [刷新]    │
└─────────────────────────────────────┘

┌──────┬──────┬──────┬──────┐
│进行中  │待开始  │今日完成│异常工单│
│  1个  │  2个  │  0个  │  0个  │
└──────┴──────┴──────┴──────┘

[我的任务 | 列表视图]

[工单卡片1 - 展开状态]
[工单卡片2]
[工单卡片3]
```

---

## ⚠️ 可能的问题和解决方案

### 问题1: 看不到"我的工单"菜单

**原因**: 
- 用户角色不是"Shop Floor Worker"
- 菜单配置问题

**解决**:
1. 检查数据库中用户角色：
```javascript
db.users.find({ phone: "13000000010" })
// 确认 role: "Shop Floor Worker"
```

2. 刷新页面（Cmd+Shift+R / Ctrl+Shift+R）

### 问题2: 点击"我的工单"报错

**原因**: 路由配置问题

**解决**:
检查 `frontend/src/App.jsx` 中是否有：
```javascript
<Route path="/shop-floor" element={
  <ProtectedRoute requiredRoles={['Shop Floor Worker', 'Administrator']}>
    <AttioLayout>
      <ShopFloorTerminal />
    </AttioLayout>
  </ProtectedRoute>
} />
```

### 问题3: 没有工单显示

**原因**: 
- 没有分配工单给该工人
- 工单状态不对

**解决**:
生产计划员需要：
1. 创建生产订单
2. 生成工单
3. 分配给具体工人

---

## 📊 数据流转

### 完整业务流程

```
商务工程师报价 → 赢单
    ↓
生产计划员创建生产订单
    ↓
生产计划员生成工单
    ↓
生产计划员分配给车间工人
    ↓
车间工人看到工单（我的工单页面）
    ↓
车间工人开始生产
    ↓
车间工人报告进度
    ↓
车间工人完成生产
    ↓
质检员质量检查
    ↓
物流专员发货
```

---

## 🎉 总结

### 车间工人的完整功能

✅ **左侧菜单**（2个）
1. 📊 仪表盘
2. 📋 我的工单

✅ **Dashboard功能**
- 统计卡片
- 今日任务列表
- 紧急任务提醒
- 快捷操作
- 工作流程说明（新增）

✅ **我的工单功能**
- 查看分配的工单
- 查看产品型号
- 查看工序要求
- 开始工单
- 报告进度
- 暂停/恢复
- 完成工单（提交"已生产"）
- 报告异常
- 查看工艺指导
- 查看异常记录

✅ **工作流程**（4步）
1. 开始工单
2. 生产操作
3. 报告进度
4. 完成工单

---

## 📞 下一步操作

### 1. 验证功能
```bash
# 登录车间工人账号
手机号: 13000000010
密码: password
```

### 2. 检查左侧菜单
- 应该看到"仪表盘"和"我的工单"两个选项

### 3. 测试完整流程
- 点击"我的工单"
- 查看工单列表
- 开始一个工单
- 报告进度
- 完成工单

### 4. 如果还有问题
请检查：
- 浏览器控制台是否有错误
- 网络请求是否正常
- 用户角色是否正确

---

**✅ 车间工人功能已完整配置！请刷新页面测试！**

