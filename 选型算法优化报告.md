# é€‰å‹ç®—æ³•ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–å¯¹é€‰å‹ç®—æ³•è¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œç¡®ä¿äº†æ‰­çŸ©è®¡ç®—é€»è¾‘çš„æ¸…æ™°æ€§ã€å‡†ç¡®æ€§å’Œå¯è¿½æº¯æ€§ã€‚

---

## âœ… æ ¸å¿ƒæ”¹è¿›

### 1. æ ‡å‡†åŒ–æ‰­çŸ©è®¡ç®—æµç¨‹

**ä½ç½®**: `backend/controllers/selectionController.js` - ç¬¬ 49-87 è¡Œ

**æ”¹è¿›å†…å®¹**:

#### a) æ–°å¢ camelCase å‚æ•°æ”¯æŒï¼ˆæ¨èä½¿ç”¨ï¼‰
```javascript
valveTorque   // é˜€é—¨æ‰­çŸ© (æ–°ç‰ˆå‚æ•°)
safetyFactor  // å®‰å…¨ç³»æ•° (é»˜è®¤ 1.3)
```

#### b) ä¿æŒå‘åå…¼å®¹
```javascript
valve_torque    // é˜€é—¨æ‰­çŸ© (æ—§ç‰ˆå‚æ•°)
safety_factor   // å®‰å…¨ç³»æ•° (æ—§ç‰ˆå‚æ•°)
required_torque // ç›´æ¥æä¾›éœ€æ±‚æ‰­çŸ© (æ—§ç‰ˆå‚æ•°)
```

#### c) ä¼˜å…ˆçº§è§„åˆ™
1. **ä¼˜å…ˆä½¿ç”¨æ–°ç‰ˆå‚æ•°**: `valveTorque` + `safetyFactor`
2. **å…¼å®¹æ—§ç‰ˆå‚æ•°**: `valve_torque` + `safety_factor`
3. **ç›´æ¥ä½¿ç”¨**: `required_torque`ï¼ˆè·³è¿‡è®¡ç®—ï¼‰

---

### 2. æ˜ç¡®çš„æ‰­çŸ©è®¡ç®—å…¬å¼

**æ ¸å¿ƒå…¬å¼**:
```javascript
requiredTorque = valveTorque Ã— safetyFactor
```

**ç¤ºä¾‹è®¡ç®—**:
- é˜€é—¨æ‰­çŸ©: `100 NÂ·m`
- å®‰å…¨ç³»æ•°: `1.3` (é»˜è®¤å€¼)
- **éœ€æ±‚æ‰­çŸ©**: `100 Ã— 1.3 = 130 NÂ·m`

**æ§åˆ¶å°è¾“å‡º**:
```bash
ğŸ“Š æ‰­çŸ©è®¡ç®—ï¼šé˜€é—¨æ‰­çŸ© 100 NÂ·m Ã— å®‰å…¨ç³»æ•° 1.3 = 130 NÂ·m
```

---

### 3. å®‰å…¨ç³»æ•°é»˜è®¤å€¼è°ƒæ•´

| å‚æ•° | æ—§å€¼ | æ–°å€¼ | è¯´æ˜ |
|------|------|------|------|
| `safetyFactor` | 1.0 | **1.3** | æé«˜30%çš„å®‰å…¨è£•åº¦ï¼Œç¬¦åˆè¡Œä¸šæ ‡å‡† |

---

### 4. ç»Ÿä¸€å˜é‡å‘½å

**å…¨å±€æ›¿æ¢**: `finalRequiredTorque` â†’ `requiredTorque`

**å½±å“èŒƒå›´**:
- âœ… Scotch Yoke (SFç³»åˆ—) æ‰­çŸ©æ¯”è¾ƒ
- âœ… Rack & Pinion (AT/GYç³»åˆ—) æ‰­çŸ©æ¯”è¾ƒ
- âœ… æ‰­çŸ©è£•åº¦è®¡ç®—
- âœ… å“åº”æ•°æ®è¿”å›

---

## ğŸ” ç®—æ³•æ­¥éª¤è¯¦è§£

### æ­¥éª¤ 1: éªŒè¯å¿…éœ€å‚æ•°
```javascript
if (!working_pressure) {
  return res.status(400).json({ message: 'è¯·æä¾›å·¥ä½œå‹åŠ›' });
}

if (!mechanism) {
  return res.status(400).json({ message: 'è¯·æä¾›æœºæ„ç±»å‹' });
}
```

### æ­¥éª¤ 2: è®¡ç®—æœ€ç»ˆéœ€æ±‚æ‰­çŸ© â­
```javascript
// ä¼˜å…ˆä½¿ç”¨æ–°ç‰ˆå‚æ•°
if (valveTorque !== undefined) {
  actualValveTorque = valveTorque;
  actualSafetyFactor = safetyFactor; // é»˜è®¤1.3
  requiredTorque = valveTorque * safetyFactor;
  console.log(`ğŸ“Š æ‰­çŸ©è®¡ç®—ï¼šé˜€é—¨æ‰­çŸ© ${valveTorque} NÂ·m Ã— å®‰å…¨ç³»æ•° ${safetyFactor} = ${requiredTorque} NÂ·m`);
}
```

### æ­¥éª¤ 3: æ„å»ºæŸ¥è¯¢æ¡ä»¶
```javascript
let query = { mechanism: mechanism };

if (action_type_preference) {
  query.action_type = action_type_preference.toUpperCase();
}

if (body_size_preference) {
  query.body_size = body_size_preference.toUpperCase();
}

console.log('ğŸ” æŸ¥è¯¢æ¡ä»¶:', query);
```

### æ­¥éª¤ 4: æ‰§è¡Œæ‰­çŸ©åŒ¹é…é€»è¾‘
æ ¹æ®æœºæ„ç±»å‹åˆ†åˆ«å¤„ç†ï¼š

#### Scotch Yoke (æ‹¨å‰å¼)
```javascript
if (symmetricTorque >= requiredTorque) {
  isSymmetricMatch = true;
}

if (cantedTorque >= requiredTorque) {
  isCantedMatch = true;
}
```

#### Rack & Pinion (é½¿è½®é½¿æ¡å¼)
```javascript
// DA (åŒä½œç”¨)
if (actualTorque >= requiredTorque) {
  shouldInclude = true;
}

// SR (å¼¹ç°§å¤ä½)
if (springEndTorque >= requiredTorque && airStartTorque >= requiredTorque) {
  shouldInclude = true;
}
```

### æ­¥éª¤ 5: è®¡ç®—æ‰­çŸ©è£•åº¦
```javascript
const torqueMargin = ((actualTorque - requiredTorque) / requiredTorque * 100);
```

### æ­¥éª¤ 6: æŒ‰ä»·æ ¼æ’åºå¹¶è¿”å›
```javascript
finalResults.sort((a, b) => a.price - b.price);

res.json({
  success: true,
  count: finalResults.length,
  search_criteria: {
    valve_torque: actualValveTorque,
    safety_factor: actualSafetyFactor,
    required_torque: requiredTorque,
    // ... å…¶ä»–æ¡ä»¶
  },
  data: finalResults,
  best_choice: finalResults[0]
});
```

---

## ğŸ“Š API è¯·æ±‚ç¤ºä¾‹

### æ¨èæ–¹å¼ï¼ˆæ–°ç‰ˆ camelCaseï¼‰
```json
{
  "valveTorque": 100,
  "safetyFactor": 1.3,
  "working_pressure": 0.6,
  "mechanism": "Scotch Yoke",
  "yoke_preference": "Auto"
}
```

### å…¼å®¹æ–¹å¼ï¼ˆæ—§ç‰ˆ snake_caseï¼‰
```json
{
  "valve_torque": 100,
  "safety_factor": 1.3,
  "working_pressure": 0.6,
  "mechanism": "Scotch Yoke",
  "yoke_preference": "Auto"
}
```

### ç›´æ¥æä¾›éœ€æ±‚æ‰­çŸ©ï¼ˆè·³è¿‡è®¡ç®—ï¼‰
```json
{
  "required_torque": 130,
  "working_pressure": 0.6,
  "mechanism": "Scotch Yoke"
}
```

---

## ğŸ“ˆ å“åº”æ•°æ®ç¤ºä¾‹

```json
{
  "success": true,
  "message": "æ‰¾åˆ° 5 ä¸ªæ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨",
  "count": 5,
  "search_criteria": {
    "valve_torque": 100,
    "safety_factor": 1.3,
    "required_torque": 130,
    "working_pressure": 0.6,
    "mechanism": "Scotch Yoke",
    "yoke_preference": "Auto"
  },
  "data": [
    {
      "model_base": "SF14-200DA",
      "actual_torque": 150,
      "torque_margin": 15.38,
      "recommend_level": "æ¨è",
      "price": 2850
    }
  ],
  "best_choice": {
    "model_base": "SF14-200DA",
    "actual_torque": 150,
    "price": 2850
  }
}
```

---

## ğŸ¯ å…³é”®ä¼˜åŠ¿

### 1. æ¸…æ™°æ€§
- âœ… æ‰­çŸ©è®¡ç®—é€»è¾‘åœ¨ç®—æ³•æœ€å¼€å§‹å°±æ˜ç¡®æ‰§è¡Œ
- âœ… æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ¸…æ™°çš„æ³¨é‡Šå’Œåˆ†éš”ç¬¦
- âœ… æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„è®¡ç®—è¿‡ç¨‹

### 2. å‡†ç¡®æ€§
- âœ… ç»Ÿä¸€ä½¿ç”¨ `requiredTorque` è¿›è¡Œæ‰€æœ‰æ‰­çŸ©æ¯”è¾ƒ
- âœ… æ¶ˆé™¤äº†å¤šä¸ªå˜é‡åå¯¼è‡´çš„æ··æ·†é£é™©
- âœ… å®‰å…¨ç³»æ•°é»˜è®¤å€¼æå‡è‡³ 1.3ï¼Œç¬¦åˆå·¥ç¨‹æ ‡å‡†

### 3. å¯è¿½æº¯æ€§
- âœ… å“åº”æ•°æ®åŒ…å«å®Œæ•´çš„è®¡ç®—å‚æ•°
- âœ… æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„ä¸­é—´è®¡ç®—æ­¥éª¤
- âœ… å¯ä»¥è½»æ¾è¿½æº¯æ¯ä¸ªç»“æœçš„æ¥æº

### 4. å…¼å®¹æ€§
- âœ… æ”¯æŒæ–°ç‰ˆ camelCase å‚æ•°ï¼ˆæ¨èï¼‰
- âœ… å‘åå…¼å®¹æ—§ç‰ˆ snake_case å‚æ•°
- âœ… æ”¯æŒç›´æ¥æä¾›éœ€æ±‚æ‰­çŸ©

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1: ä½¿ç”¨æ–°ç‰ˆå‚æ•°
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "valveTorque": 100,
    "safetyFactor": 1.3,
    "working_pressure": 0.6,
    "mechanism": "Scotch Yoke",
    "yoke_preference": "Auto"
  }'
```

**é¢„æœŸç»“æœ**:
- âœ… è®¡ç®—å‡º `requiredTorque = 130 NÂ·m`
- âœ… æ§åˆ¶å°è¾“å‡º: `ğŸ“Š æ‰­çŸ©è®¡ç®—ï¼šé˜€é—¨æ‰­çŸ© 100 NÂ·m Ã— å®‰å…¨ç³»æ•° 1.3 = 130 NÂ·m`
- âœ… è¿”å›æ‰€æœ‰æ»¡è¶³ `actualTorque >= 130` çš„æ‰§è¡Œå™¨

### æµ‹è¯•åœºæ™¯ 2: çœç•¥å®‰å…¨ç³»æ•°ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "valveTorque": 100,
    "working_pressure": 0.6,
    "mechanism": "Rack & Pinion",
    "action_type_preference": "DA"
  }'
```

**é¢„æœŸç»“æœ**:
- âœ… è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ `safetyFactor = 1.3`
- âœ… è®¡ç®—å‡º `requiredTorque = 130 NÂ·m`

### æµ‹è¯•åœºæ™¯ 3: å‘åå…¼å®¹ï¼ˆæ—§ç‰ˆå‚æ•°ï¼‰
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "valve_torque": 100,
    "safety_factor": 1.5,
    "working_pressure": 0.6,
    "mechanism": "Scotch Yoke"
  }'
```

**é¢„æœŸç»“æœ**:
- âœ… ä½¿ç”¨æ—§ç‰ˆå‚æ•°è®¡ç®—
- âœ… `requiredTorque = 100 Ã— 1.5 = 150 NÂ·m`
- âœ… æ§åˆ¶å°è¾“å‡º: `ğŸ“Š æ‰­çŸ©è®¡ç®—ï¼ˆæ—§ç‰ˆï¼‰ï¼š...`

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| `backend/controllers/selectionController.js` | å®Œæ•´é‡æ„æ‰­çŸ©è®¡ç®—é€»è¾‘ | 9-87 |
| `backend/controllers/selectionController.js` | æ›´æ–°æ‰€æœ‰ `requiredTorque` ä½¿ç”¨ | å…¨æ–‡ |
| `backend/controllers/selectionController.js` | æ·»åŠ è°ƒè¯•æ—¥å¿— | 63, 71, 79, 104, 117, 435 |
| `backend/controllers/selectionController.js` | æ›´æ–°å“åº”æ•°æ®ç»“æ„ | 417-456 |

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–ç¡®ä¿äº†é€‰å‹ç®—æ³•çš„æ‰­çŸ©è®¡ç®—é€»è¾‘ï¼š

1. âœ… **åœ¨ç®—æ³•æœ€å¼€å§‹å°±æ˜ç¡®æ‰§è¡Œ**
2. âœ… **ä½¿ç”¨ç»Ÿä¸€çš„ `requiredTorque` å˜é‡**
3. âœ… **å®‰å…¨ç³»æ•°é»˜è®¤å€¼è°ƒæ•´ä¸º 1.3**
4. âœ… **æ”¯æŒæ–°æ—§ä¸¤ç§å‚æ•°æ ¼å¼**
5. âœ… **æ·»åŠ è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—**
6. âœ… **å“åº”æ•°æ®åŒ…å«å®Œæ•´è®¡ç®—å‚æ•°**

è¿™äº›æ”¹è¿›ä½¿å¾—ç®—æ³•æ›´åŠ å¥å£®ã€æ˜“äºç»´æŠ¤å’Œè°ƒè¯•ï¼

---

**ä¼˜åŒ–æ—¥æœŸ**: 2025-10-27  
**è´Ÿè´£äºº**: Cursor AI Assistant  
**ç‰ˆæœ¬**: v2.0

