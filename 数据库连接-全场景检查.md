# ğŸ” æ•°æ®åº“è¿æ¥ - å…¨åœºæ™¯æ£€æŸ¥æŠ¥å‘Š
## Database Connection - Full Scenario Audit

**æ£€æŸ¥æ—¥æœŸ**: 2025-10-30  
**ç›®æ ‡**: ç¡®ä¿æ‰€æœ‰åœºæ™¯ä¸‹éƒ½è¿æ¥åˆ°æ­£ç¡®çš„æ•°æ®åº“

---

## ğŸ“Š åœºæ™¯åˆ†ç±»

### åœºæ™¯1: æ¼”ç¤ºç¯å¢ƒ ğŸ¬
**é¢„æœŸæ•°æ®åº“**: `cmax`  
**ä½¿ç”¨åœºæ™¯**: å®¢æˆ·æ¼”ç¤ºã€å†…éƒ¨åŸ¹è®­ã€ç³»ç»ŸéªŒæ”¶

### åœºæ™¯2: å¼€å‘ç¯å¢ƒ ğŸ’»
**é¢„æœŸæ•°æ®åº“**: `cmax`  
**ä½¿ç”¨åœºæ™¯**: æ—¥å¸¸å¼€å‘ã€åŠŸèƒ½æµ‹è¯•

### åœºæ™¯3: ç”Ÿäº§ç¯å¢ƒ ğŸš€
**é¢„æœŸæ•°æ®åº“**: `cmax`ï¼ˆæˆ–é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šï¼‰  
**ä½¿ç”¨åœºæ™¯**: æ­£å¼ä¸Šçº¿è¿è¡Œ

### åœºæ™¯4: æµ‹è¯•ç¯å¢ƒ ğŸ§ª
**é¢„æœŸæ•°æ®åº“**: `cmax_test`ï¼ˆè‡ªåŠ¨æ·»åŠ  _test åç¼€ï¼‰  
**ä½¿ç”¨åœºæ™¯**: è‡ªåŠ¨åŒ–æµ‹è¯•ã€å•å…ƒæµ‹è¯•

---

## âœ… å·²ä¿®å¤çš„æ–‡ä»¶ï¼ˆæ­£ç¡®ï¼‰

### 1. âœ“ backend/config/database.js
```javascript
// å¼€å‘/ç”Ÿäº§ç¯å¢ƒ
dbUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/cmax';
```
**çŠ¶æ€**: âœ… æ­£ç¡® - é»˜è®¤ä½¿ç”¨ cmax

---

### 2. âœ“ backend/seed_final_acceptance.js
```javascript
const mongoUri = process.env.MONGO_URI || 
                 process.env.MONGODB_URI || 
                 'mongodb://localhost:27017/cmax';
```
**çŠ¶æ€**: âœ… æ­£ç¡® - æ¼”ç¤ºæ•°æ®åˆå§‹åŒ–åˆ° cmax

---

### 3. âœ“ æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
```bash
MONGODB_URI=mongodb://localhost:27017/cmax NODE_ENV=development npm start
```
**çŠ¶æ€**: âœ… æ­£ç¡® - æ˜ç¡®æŒ‡å®š cmax

---

## âš ï¸ éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼ˆå‘ç°é—®é¢˜ï¼‰

### 1. âŒ backend/drop-email-index.js
**å½“å‰é…ç½®**:
```javascript
const dbUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/cmax-actuators';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ cmax-actuatorsï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: å¦‚æœä¸è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¼šè¿æ¥åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 2. âŒ backend/clean-and-recreate-users.js
**å½“å‰é…ç½®**:
```javascript
const dbUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/cmax-actuators';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ cmax-actuatorsï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: æ¸…ç†ç”¨æˆ·æ—¶å¯èƒ½æ“ä½œé”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 3. âŒ backend/seed.js
**å½“å‰é…ç½®**:
```javascript
const mongoUri = process.env.MONGO_URI || 
                 process.env.MONGODB_URI || 
                 'mongodb://localhost:27017/project_ark';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ project_arkï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: æ‰§è¡Œ npm run seed ä¼šåˆå§‹åŒ–åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 4. âŒ backend/seed_comprehensive_test.js
**å½“å‰é…ç½®**:
```javascript
const mongoUri = process.env.MONGO_URI || 
                 process.env.MONGODB_URI || 
                 'mongodb://localhost:27017/project_ark';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ project_arkï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: ç»¼åˆæµ‹è¯•æ•°æ®åˆå§‹åŒ–åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 5. âŒ backend/seed_final_test_data.js
**å½“å‰é…ç½®**:
```javascript
await mongoose.connect(process.env.MONGODB_URI || 
                      'mongodb://localhost:27017/valve_selection', {
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ valve_selectionï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: æµ‹è¯•æ•°æ®åˆå§‹åŒ–åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 6. âŒ backend/seed_mock_suppliers.js
**å½“å‰é…ç½®**:
```javascript
await mongoose.connect(process.env.MONGODB_URI || 
                      'mongodb://localhost:27017/project_ark');
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ project_arkï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: æ¨¡æ‹Ÿä¾›åº”å•†æ•°æ®åˆå§‹åŒ–åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 7. âŒ backend/scripts/createAdminUser.js
**å½“å‰é…ç½®**:
```javascript
const mongoURI = process.env.MONGODB_URI || 
                'mongodb://localhost:27017/project_ark';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ project_arkï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·åˆ°é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

### 8. âŒ backend/scripts/testPasswordReset.js
**å½“å‰é…ç½®**:
```javascript
const mongoURI = process.env.MONGODB_URI || 
                'mongodb://localhost:27017/project_ark';
```
**é—®é¢˜**: é»˜è®¤ä½¿ç”¨ project_arkï¼ˆæ—§åç§°ï¼‰  
**å½±å“**: å¯†ç é‡ç½®æµ‹è¯•è¿æ¥é”™è¯¯çš„æ•°æ®åº“  
**ä¿®å¤**: æ”¹ä¸º 'mongodb://localhost:27017/cmax'

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§

### ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

è¿™äº›æ–‡ä»¶å¯èƒ½åœ¨æ¼”ç¤ºæˆ–ç”Ÿäº§ä¸­ä½¿ç”¨ï¼š

1. **backend/seed.js** - npm run seed å‘½ä»¤ä½¿ç”¨
2. **backend/seed_comprehensive_test.js** - ç»¼åˆæµ‹è¯•ä½¿ç”¨
3. **backend/scripts/createAdminUser.js** - åˆ›å»ºç®¡ç†å‘˜

### âš ï¸ ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®å¤ï¼‰

è¿™äº›æ–‡ä»¶åœ¨ç‰¹å®šåœºæ™¯ä½¿ç”¨ï¼š

4. **backend/clean-and-recreate-users.js** - ç”¨æˆ·ç®¡ç†
5. **backend/drop-email-index.js** - ç´¢å¼•ç®¡ç†
6. **backend/seed_final_test_data.js** - æµ‹è¯•æ•°æ®

### ğŸ’¡ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ä¿®å¤ï¼‰

è¿™äº›æ–‡ä»¶ä¸å¸¸ç”¨ï¼š

7. **backend/seed_mock_suppliers.js** - æ¨¡æ‹Ÿæ•°æ®
8. **backend/scripts/testPasswordReset.js** - æµ‹è¯•è„šæœ¬

---

## ğŸ¯ ç»Ÿä¸€æ ‡å‡†

### æ ‡å‡†é…ç½®æ¨¡å¼

æ‰€æœ‰è„šæœ¬åº”ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®æ¨¡å¼ï¼š

```javascript
const mongoUri = process.env.MONGO_URI || 
                 process.env.MONGODB_URI || 
                 'mongodb://localhost:27017/cmax';
```

**ä¼˜å…ˆçº§**:
1. MONGO_URI ç¯å¢ƒå˜é‡ï¼ˆæœ€é«˜ï¼‰
2. MONGODB_URI ç¯å¢ƒå˜é‡
3. é»˜è®¤å€¼ï¼šmongodb://localhost:27017/cmax

---

## ğŸ”„ å„åœºæ™¯ä½¿ç”¨çš„æ•°æ®åº“

### åœºæ™¯1: npm startï¼ˆæ­£å¸¸å¯åŠ¨ï¼‰
```bash
npm start
```
**æ•°æ®åº“**: cmaxï¼ˆé€šè¿‡ config/database.jsï¼‰  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯2: æ¼”ç¤ºå¯åŠ¨è„šæœ¬
```bash
bash æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
```
**æ•°æ®åº“**: cmaxï¼ˆæ˜ç¡®æŒ‡å®š MONGODB_URIï¼‰  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯3: npm run seed:final
```bash
npm run seed:final
```
**æ•°æ®åº“**: cmaxï¼ˆseed_final_acceptance.jsï¼‰  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯4: npm run seed
```bash
npm run seed
```
**æ•°æ®åº“**: project_arkï¼ˆseed.jsï¼‰  
**çŠ¶æ€**: âŒ **é”™è¯¯** - éœ€è¦ä¿®å¤

---

### åœºæ™¯5: NODE_ENV=test npm start
```bash
NODE_ENV=test npm start
```
**æ•°æ®åº“**: cmax_testï¼ˆè‡ªåŠ¨æ·»åŠ åç¼€ï¼‰  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯6: æ‰‹åŠ¨å¯åŠ¨ï¼ˆæœ‰ .env æ–‡ä»¶ï¼‰
```bash
# .env æ–‡ä»¶åŒ…å« MONGODB_URI=mongodb://localhost:27017/cmax
npm start
```
**æ•°æ®åº“**: cmax  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯7: æ‰‹åŠ¨å¯åŠ¨ï¼ˆæ—  .env æ–‡ä»¶ï¼‰
```bash
# æ²¡æœ‰ .env æ–‡ä»¶
npm start
```
**æ•°æ®åº“**: cmaxï¼ˆä½¿ç”¨ config/database.js çš„é»˜è®¤å€¼ï¼‰  
**çŠ¶æ€**: âœ… æ­£ç¡®

---

### åœºæ™¯8: ç”Ÿäº§ç¯å¢ƒ
```bash
NODE_ENV=production MONGODB_URI=mongodb://production-server:27017/cmax npm start
```
**æ•°æ®åº“**: ç¯å¢ƒå˜é‡æŒ‡å®šçš„æ•°æ®åº“  
**çŠ¶æ€**: âœ… æ­£ç¡®ï¼ˆéœ€è¦æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡ï¼‰

---

## âš¡ ç«‹å³ä¿®å¤å»ºè®®

### æ–¹æ¡ˆ1: ä¿®å¤æ‰€æœ‰æ–‡ä»¶ï¼ˆæ¨èï¼‰

ä¿®å¤æ‰€æœ‰8ä¸ªæ–‡ä»¶ï¼Œç¡®ä¿100%ä¸€è‡´æ€§

**ä¼˜ç‚¹**:
- å®Œå…¨æ¶ˆé™¤éšæ‚£
- æœªæ¥ä¸ä¼šå‡ºç°æ•°æ®åº“é”™è¯¯

**ç¼ºç‚¹**:
- éœ€è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶

---

### æ–¹æ¡ˆ2: åªä¿®å¤é«˜ä¼˜å…ˆçº§æ–‡ä»¶

åªä¿®å¤æœ€å¸¸ç”¨çš„3ä¸ªæ–‡ä»¶

**ä¼˜ç‚¹**:
- å¿«é€Ÿè§£å†³ä¸»è¦é—®é¢˜

**ç¼ºç‚¹**:
- ä»æœ‰æ½œåœ¨é£é™©

---

## ğŸ“ ä¿®å¤æ£€æŸ¥æ¸…å•

- [ ] backend/seed.js
- [ ] backend/seed_comprehensive_test.js
- [ ] backend/scripts/createAdminUser.js
- [ ] backend/clean-and-recreate-users.js
- [ ] backend/drop-email-index.js
- [ ] backend/seed_final_test_data.js
- [ ] backend/seed_mock_suppliers.js
- [ ] backend/scripts/testPasswordReset.js

---

## ğŸ‰ ä¿®å¤åçš„ä¿è¯

ä¿®å¤æ‰€æœ‰æ–‡ä»¶åï¼Œå¯ä»¥ä¿è¯ï¼š

âœ… **æ¼”ç¤ºç¯å¢ƒ**: å§‹ç»ˆä½¿ç”¨ cmax æ•°æ®åº“  
âœ… **å¼€å‘ç¯å¢ƒ**: å§‹ç»ˆä½¿ç”¨ cmax æ•°æ®åº“  
âœ… **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ç¯å¢ƒå˜é‡æŒ‡å®šæˆ–é»˜è®¤ cmax  
âœ… **æµ‹è¯•ç¯å¢ƒ**: è‡ªåŠ¨ä½¿ç”¨ cmax_test æ•°æ®åº“  
âœ… **æ‰€æœ‰è„šæœ¬**: ç»Ÿä¸€ä½¿ç”¨ cmax æ•°æ®åº“  

---

## ğŸ“ éªŒè¯æ–¹æ³•

ä¿®å¤åï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•éªŒè¯ï¼š

```bash
# 1. å¯åŠ¨ç³»ç»Ÿ
npm start

# 2. æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ•°æ®åº“
# åº”è¯¥æ˜¾ç¤º: æ•°æ®åº“è¿æ¥æˆåŠŸ: cmax

# 3. è¿æ¥ MongoDB éªŒè¯
mongosh
use cmax
show collections
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-30  
**éœ€è¦ä¿®å¤çš„æ–‡ä»¶**: 8 ä¸ª  
**å»ºè®®**: ç«‹å³ä¿®å¤æ‰€æœ‰æ–‡ä»¶ï¼Œç¡®ä¿100%ä¸€è‡´æ€§

---

Â© 2025 Project Ark Team

