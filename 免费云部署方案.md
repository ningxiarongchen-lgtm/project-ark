# 🎯 完全免费云部署方案
## 本机不开机，团队也能访问

---

## 📋 方案对比

| 方案 | 免费额度 | 访问速度 | 难度 | 推荐度 |
|------|---------|---------|------|--------|
| **方案1：Railway.app** | ⭐⭐⭐⭐⭐ | 国外快 | 简单 | ⭐⭐⭐⭐⭐ |
| **方案2：Render.com** | ⭐⭐⭐⭐ | 国外快 | 简单 | ⭐⭐⭐⭐ |
| **方案3：阿里云/腾讯云学生机** | ⭐⭐⭐ | 国内快 | 中等 | ⭐⭐⭐⭐⭐ |
| **方案4：Vercel + MongoDB Atlas** | ⭐⭐⭐⭐ | 国外快 | 简单 | ⭐⭐⭐⭐ |

---

## 🚀 推荐方案：Railway.app（最简单）

### 为什么选Railway？
- ✅ **完全免费**：每月$5免费额度（足够运行小型应用）
- ✅ **一键部署**：直接连接GitHub，自动部署
- ✅ **包含数据库**：内置MongoDB支持
- ✅ **自动HTTPS**：免费SSL证书
- ✅ **持续集成**：代码推送自动更新
- ✅ **零配置**：不需要服务器管理经验

### 部署步骤（15分钟完成）

#### 第1步：准备GitHub仓库

```bash
# 1. 如果还没有推送到GitHub，先创建远程仓库
# 在GitHub上创建新仓库（如：project-ark）

# 2. 推送代码到GitHub
cd "/Users/hexiaoxiao/Desktop/Model Selection System"
git remote add origin https://github.com/你的用户名/project-ark.git
git branch -M main
git push -u origin main
```

#### 第2步：注册Railway账号

1. 访问：https://railway.app
2. 点击 "Login" 或 "Start a New Project"
3. 使用GitHub账号登录（一键授权）

#### 第3步：部署后端

1. **创建新项目**
   - 点击 "New Project"
   - 选择 "Deploy from GitHub repo"
   - 选择你的仓库 `project-ark`

2. **配置后端服务**
   ```
   Root Directory: /backend
   Build Command: npm install
   Start Command: npm start
   ```

3. **添加环境变量**
   - 点击 Variables 标签
   - 添加以下配置：
   
   ```env
   NODE_ENV=production
   PORT=5001
   
   # JWT密钥（使用之前生成的）
   JWT_SECRET=【从 JWT密钥-生产环境专用.txt 复制】
   JWT_REFRESH_SECRET=【从 JWT密钥-生产环境专用.txt 复制】
   SESSION_SECRET=【从 JWT密钥-生产环境专用.txt 复制】
   
   # 数据库连接（等会从MongoDB服务获取）
   MONGODB_URI=【稍后填写】
   
   # CORS（前端部署后填写）
   ALLOWED_ORIGINS=【前端URL，稍后填写】
   ```

4. **添加MongoDB数据库**
   - 点击 "+ New" 按钮
   - 选择 "Database" → "Add MongoDB"
   - Railway会自动创建MongoDB实例
   - 复制 `MONGO_URL` 到上面的 `MONGODB_URI`

5. **部署**
   - 点击 "Deploy"
   - 等待部署完成（约2-3分钟）
   - 复制生成的后端URL（如：`https://project-ark-production.up.railway.app`）

#### 第4步：部署前端

有两个选择：

##### 选择A：使用Vercel（推荐，更快）

1. **访问Vercel**
   - 打开：https://vercel.com
   - 使用GitHub账号登录

2. **导入项目**
   - 点击 "Add New" → "Project"
   - 选择 `project-ark` 仓库
   - Framework Preset: Vite
   - Root Directory: `frontend`

3. **配置环境变量**
   ```env
   VITE_API_URL=https://你的后端URL.railway.app
   ```

4. **部署**
   - 点击 "Deploy"
   - 等待构建完成（约1-2分钟）
   - 获得前端URL（如：`https://project-ark.vercel.app`）

5. **更新后端CORS**
   - 回到Railway后端项目
   - 更新 `ALLOWED_ORIGINS` 为你的Vercel URL
   - 重新部署

##### 选择B：Railway部署前端（全在一起）

1. **在Railway项目中添加前端服务**
   - 点击 "+ New" 
   - 选择 "GitHub Repo" → 选择相同仓库
   - Root Directory: `/frontend`

2. **配置前端**
   ```
   Build Command: npm run build
   Start Command: npx serve -s dist -p $PORT
   ```

3. **添加环境变量**
   ```env
   VITE_API_URL=https://你的后端URL.railway.app
   ```

4. **部署并获取URL**

#### 第5步：初始化数据库

```bash
# 1. 本地连接Railway的MongoDB
# 在Railway复制MongoDB连接字符串

# 2. 导入数据
cd backend
MONGODB_URI="mongodb://railway连接字符串" npm run seed:final

# 或者创建一个临时脚本在Railway上运行
```

#### 第6步：测试访问

1. 打开前端URL（Vercel或Railway提供的）
2. 使用测试账号登录：
   - 销售经理：13000000002 / password
   - 技术工程师：13000000003 / password
3. 测试各项功能

---

## 🇨🇳 国内访问优化方案：阿里云/腾讯云学生机

### 为什么选学生机？
- ✅ **超低价格**：9.9元/月（学生认证）或免费试用
- ✅ **国内访问快**：适合国内团队
- ✅ **完全控制**：可以随时修改配置
- ✅ **长期使用**：可续费，不受免费额度限制

### 申请条件
- 学生身份（有学信网账号）
- 或新用户免费试用（1-3个月）

### 部署步骤

#### 第1步：购买服务器

**阿里云学生机**：
1. 访问：https://developer.aliyun.com/plan/student
2. 学生认证
3. 购买云服务器ECS（9.9元/月）
4. 选择配置：
   - CPU: 1核
   - 内存: 2GB
   - 系统盘: 40GB
   - 操作系统: Ubuntu 20.04 LTS

**腾讯云学生机**：
1. 访问：https://cloud.tencent.com/act/campus
2. 学生认证
3. 购买云服务器（10元/月）

#### 第2步：连接服务器

```bash
# 使用SSH连接（替换成你的服务器IP）
ssh root@你的服务器IP

# 第一次连接会要求输入密码（购买时设置的）
```

#### 第3步：安装环境（一键脚本）

在服务器上创建并运行安装脚本：

```bash
# 创建安装脚本
cat > install_server.sh << 'EOF'
#!/bin/bash
# 服务器环境一键安装脚本

set -e

echo "================================"
echo "开始安装服务器环境"
echo "================================"

# 更新系统
echo "1. 更新系统..."
apt update && apt upgrade -y

# 安装Node.js 18
echo "2. 安装Node.js..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# 安装MongoDB
echo "3. 安装MongoDB..."
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | tee /etc/apt/sources.list.d/mongodb-org-6.0.list
apt update
apt install -y mongodb-org

# 启动MongoDB
systemctl start mongod
systemctl enable mongod

# 安装PM2
echo "4. 安装PM2..."
npm install -g pm2

# 安装Nginx
echo "5. 安装Nginx..."
apt install -y nginx

# 安装Git
echo "6. 安装Git..."
apt install -y git

# 配置防火墙
echo "7. 配置防火墙..."
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw --force enable

echo "================================"
echo "✅ 环境安装完成！"
echo "================================"

# 显示版本信息
echo ""
echo "已安装版本："
echo "  Node.js: $(node -v)"
echo "  npm: $(npm -v)"
echo "  MongoDB: $(mongod --version | head -n 1)"
echo "  PM2: $(pm2 -v)"
echo "  Nginx: $(nginx -v 2>&1)"
echo ""
EOF

# 运行安装脚本
chmod +x install_server.sh
./install_server.sh
```

#### 第4步：部署应用

```bash
# 1. 克隆项目
cd /var/www
git clone https://github.com/你的用户名/project-ark.git
cd project-ark

# 2. 配置环境变量
cd backend
cp env.production.template .env.production

# 编辑配置文件
nano .env.production
# 填入JWT密钥等配置

# 3. 安装依赖
npm ci --production

# 4. 初始化数据库
npm run seed:final

# 5. 启动后端
pm2 start ecosystem.config.js --env production
pm2 save
pm2 startup  # 设置开机自启动

# 6. 构建前端
cd ../frontend
npm ci
npm run build

# 7. 配置Nginx
cat > /etc/nginx/sites-available/project-ark << 'EOF'
server {
    listen 80;
    server_name 你的服务器IP;  # 或域名

    # 前端
    location / {
        root /var/www/project-ark/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端API
    location /api {
        proxy_pass http://localhost:5001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# 启用配置
ln -s /etc/nginx/sites-available/project-ark /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

echo "================================"
echo "✅ 部署完成！"
echo "访问地址: http://你的服务器IP"
echo "================================"
```

---

## 🔄 代码更新流程（修复Bug后）

### Railway/Vercel方式（自动部署）

```bash
# 1. 本地修复bug
# 编辑代码...

# 2. 提交到Git
git add .
git commit -m "fix: 修复XXX问题"
git push origin main

# 3. 等待自动部署（1-2分钟）
# Railway和Vercel会自动检测到代码变更并重新部署
```

### 云服务器方式（手动部署）

```bash
# 连接到服务器
ssh root@你的服务器IP

# 进入项目目录
cd /var/www/project-ark

# 拉取最新代码
git pull origin main

# 更新后端
cd backend
npm ci --production
pm2 restart cmax-backend

# 更新前端
cd ../frontend
npm ci
npm run build

# 重启Nginx
systemctl reload nginx

echo "✅ 更新完成！"
```

---

## 💰 成本对比

| 方案 | 月费用 | 年费用 | 说明 |
|------|--------|--------|------|
| Railway.app | $0-5 | $0-60 | 免费额度内完全免费 |
| Vercel + MongoDB Atlas | $0 | $0 | 完全免费 |
| 阿里云学生机 | ¥9.9 | ¥118.8 | 需学生认证 |
| 腾讯云学生机 | ¥10 | ¥120 | 需学生认证 |
| 阿里云新用户 | ¥0 | ¥0 | 3个月免费试用 |

---

## 🎯 推荐选择

### 如果团队在国外或可以接受国外服务
**推荐：Railway.app**
- 最简单，15分钟完成
- 完全免费（免费额度够用）
- 自动部署，改代码自动更新
- 不需要服务器管理经验

### 如果团队在国内且需要快速访问
**推荐：阿里云/腾讯云学生机**
- 国内访问速度快
- 每月不到10元
- 完全可控，可以随意修改
- 适合长期使用

### 如果需要完全免费
**推荐：Vercel（前端）+ Railway（后端）**
- 完全免费
- 自动部署
- 但国内访问可能较慢

---

## 📞 需要帮助？

我可以帮您：
1. ✅ 详细指导Railway部署（最简单）
2. ✅ 配置阿里云服务器（如果你有）
3. ✅ 设置自动部署流程
4. ✅ 优化访问速度
5. ✅ 绑定自定义域名

告诉我你选择哪个方案，我详细指导你完成！🚀

