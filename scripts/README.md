# 📜 项目脚本工具

本文件夹包含 Project Ark 项目的实用脚本工具。

---

## 🩺 文档健康检查 (check_docs_freshness.js)

### 功能说明

自动扫描 `docs/` 文件夹，检测哪些核心文档超过指定时间未更新，帮助团队保持文档的新鲜度和准确性。

### 使用方法

```bash
npm run docs:health-check
```

### 配置参数

在脚本中可以修改以下参数：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `DOCS_PATH` | `../docs` | 要检查的文档目录 |
| `STALE_THRESHOLD_DAYS` | `180` (6个月) | 文档被认为陈旧的天数阈值 |

### 输出示例

#### ✅ 所有文档健康
```
🩺 开始扫描文档健康度...
📂 文档目录: /path/to/docs
⏰ 陈旧阈值: 180 天

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
           📊 扫描报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 统计信息:
  - 总文档数: 4
  - 健康文档: 4
  - 陈旧文档: 0
  - 健康率: 100.0%

✅ 以下 4 份文档是健康的 (最近 180 天内有更新):

  📄 1_README.md
     最后更新: 1 天前

  📄 2_DATABASE_SCHEMA.md
     最后更新: 1 天前

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎉 所有核心文档都保持最新状态，做得很好！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### ⚠️ 检测到陈旧文档
```
⚠️  警告：以下 2 份文档可能已陈旧，请团队进行人工审查：

  📄 OLD_GUIDE.md
     最后更新: 200 天前
     路径: /path/to/docs/OLD_GUIDE.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   🔍 审查建议:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

   1. 内容是否仍然准确？
      → 如果不是，请更新文档内容
      → 更新后 Git 提交即可刷新时间戳

   2. 这份文档是否还有存在的必要？
      → 如果没有，请在团队确认后归档或删除
      → 可移动到 legacy-docs/ 文件夹

   3. 文档是否需要拆分或重组？
      → 如果文档过于庞大，考虑拆分
      → 如果内容重复，考虑合并
```

### 工作原理

1. **扫描文件**: 递归扫描 `docs/` 目录下的所有 `.md` 文件
2. **获取时间戳**: 通过 Git 获取文件最后一次提交的日期（比文件系统更可靠）
3. **计算天数**: 计算距离今天的天数
4. **分类文档**: 
   - 健康文档: 更新天数 ≤ 阈值
   - 陈旧文档: 更新天数 > 阈值
5. **生成报告**: 输出详细的统计信息和建议

### 最佳实践

#### 定期运行
建议在以下时机运行此脚本：

- ✅ **每月一次**: 作为团队例会的一部分
- ✅ **季度审查**: 配合项目季度回顾
- ✅ **新人入职**: 让新人了解文档状态
- ✅ **重大更新前**: 确保文档与代码同步

#### 融入工作流

**方案1: 添加到 CI/CD** ✅ 已实现

GitHub Actions 工作流已配置！查看 `.github/workflows/docs-health-check.yml`

特性：
- ✅ 每月1号自动运行
- ✅ 支持手动触发
- ✅ PR 涉及文档时自动检查
- ✅ 详细文档: `.github/workflows/README.md`

**方案2: Git Pre-commit Hook**
```bash
# .git/hooks/pre-commit
#!/bin/bash
npm run docs:health-check
```

**方案3: 手动定期检查**
- 在项目管理看板中创建重复任务
- 每月第一周提醒团队运行

### 处理陈旧文档的流程

```
发现陈旧文档
    ↓
审查内容准确性
    ↓
准确？
 ├─ 是 → 简单 Git 提交刷新时间戳
 └─ 否 → 更新内容 → Git 提交
    ↓
文档仍需要？
 ├─ 是 → 完成
 └─ 否 → 移动到 legacy-docs/ → Git 提交
```

### 自定义阈值建议

根据文档类型调整阈值：

| 文档类型 | 建议阈值 | 原因 |
|---------|---------|------|
| 核心架构文档 | 180天 (6个月) | 架构变化较慢 |
| API文档 | 90天 (3个月) | API可能频繁更新 |
| 使用指南 | 120天 (4个月) | 功能迭代适中 |
| 演示剧本 | 60天 (2个月) | 需跟随产品变化 |

### 退出状态

- **退出码 0**: 检查完成（即使有陈旧文档也不阻塞）
- **退出码 1**: 脚本执行错误

> **注意**: 即使检测到陈旧文档，脚本也会以退出码 0 结束，避免阻塞 CI/CD 流程。陈旧文档只是**警告**，不是**错误**。

---

## 🔧 故障排除

### 问题: 脚本无法运行

**解决方案**:
```bash
# 确保脚本有执行权限
chmod +x scripts/check_docs_freshness.js

# 确保在项目根目录运行
cd /path/to/Model\ Selection\ System
npm run docs:health-check
```

### 问题: Git 时间戳不准确

**原因**: 文件未提交到 Git

**解决方案**:
```bash
# 提交新文档
git add docs/新文档.md
git commit -m "docs: 添加新文档"
```

### 问题: 时间戳显示为今天，但文档很旧

**原因**: 文件刚刚被添加到 Git，但内容很旧

**解决方案**:
- 检查文件内容是否需要更新
- 如果内容过时，更新后重新提交

---

## 📝 未来改进方向

- [ ] 支持检查文档中的断链（broken links）
- [ ] 集成到 GitHub Actions 自动运行
- [ ] 生成 HTML 报告
- [ ] 支持多语言文档检查
- [ ] 添加文档质量评分（内容长度、结构完整性等）

---

## 📞 反馈与建议

如果您对这个脚本有任何建议或发现问题，请：

1. 在团队会议中提出
2. 或直接修改脚本并提交 PR

---

© 2025 Project Ark Team. All Rights Reserved.

