# 🏆 最终验收测试指南
## Project Ark - Final Acceptance Testing Guide

---

## 📋 目录

1. [准备工作](#准备工作)
2. [手动测试清单](#手动测试清单)
3. [自动化测试](#自动化测试)
4. [验收标准](#验收标准)
5. [故障排查](#故障排查)

---

## 🎯 准备工作

### 1. 初始化测试环境

**运行终极数据初始化脚本**：

```bash
cd backend
npm run seed:final
```

**预期输出**：
```
✅ 数据库清空完成！共删除 XX 条记录
👥 测试用户:          10 个
🏢 供应商:            5 个
📦 执行器型号:        55 个
🔧 手动操作装置:      4 个
🔌 配件:              8 个
📋 示例项目:          4 个
```

### 2. 启动系统

**启动后端服务器**（终端1）：
```bash
cd backend
npm start
```

**启动前端服务器**（终端2）：
```bash
cd frontend
npm run dev
```

### 3. 验证环境就绪

- ✅ 后端运行在: `http://localhost:5001`
- ✅ 前端运行在: `http://localhost:5173`
- ✅ 数据库已初始化并包含测试数据

---

## 📝 手动测试清单

### 🔑 测试账户

| 角色 | 手机号 | 密码 | 测试场景 |
|------|--------|------|---------|
| 销售经理 | 13000000002 | password | 创建项目、赢单、售后 |
| 技术工程师 | 13000000003 | password | 技术选型 |
| 商务工程师 | 13000000004 | password | 报价、合同 |
| 采购专员 | 13000000005 | password | 采购订单 |
| 生产计划员 | 13000000006 | password | 排产、BOM |
| 质检员 | 13000000007 | password | 质量检验 |
| 物流专员 | 13000000008 | password | 发货 |
| 售后工程师 | 13000000009 | password | 售后工单 |
| 车间工人 | 13000000010 | password | 生产作业 |
| 系统管理员 | 13000000001 | password | 系统管理 |

---

### 🎬 场景1：售前流程（项目 → 选型 → 报价）

#### ✅ 测试 1.1：销售经理创建新项目

**步骤**：
1. 登录: `13000000002` / `password`
2. 导航到「项目管理」
3. 点击「新建项目」
4. 填写信息：
   - 项目名称：`【测试】天津钢铁厂阀门自动化项目`
   - 客户名称：`天津钢铁集团`
   - 行业：`Manufacturing`
   - 预算：`600000`
   - 指派技术工程师：`Tech Engineer User`
5. 提交创建

**预期结果**：
- ✅ 项目创建成功
- ✅ 项目编号自动生成
- ✅ 状态为「待指派技术」或「选型中」

---

#### ✅ 测试 1.2：技术工程师接收任务并完成选型

**步骤**：
1. 登出销售经理，登录技术工程师: `13000000003` / `password`
2. 检查仪表盘是否有新任务
3. 进入测试项目
4. 添加技术需求：
   - 需求1: V-101, AT-150-DA, 数量10
   - 需求2: V-102, GY-200-DA, 数量5
5. 提交技术方案

**预期结果**：
- ✅ 技术清单保存成功
- ✅ 项目状态变为「待商务报价」
- ✅ 显示提交成功消息

---

#### ✅ 测试 1.3：商务工程师创建BOM和报价

**步骤**：
1. 登出技术工程师，登录商务工程师: `13000000004` / `password`
2. 查看仪表盘「待报价项目」
3. 进入测试项目的报价工作台
4. 查看/生成BOM
5. 设置价格（可选）
6. 完成报价

**预期结果**：
- ✅ BOM显示所有产品
- ✅ 价格自动计算
- ✅ 项目状态变为「已报价」

---

#### ✅ 测试 1.4：销售经理查看报价

**步骤**：
1. 登出商务工程师，重新登录销售经理
2. 查看项目状态
3. 查看报价单/BOM
4. 验证价格信息

**预期结果**：
- ✅ 项目状态为「已报价」
- ✅ 报价单显示完整

---

### 🎬 场景2：售中流程（赢单 → 合同 → 生产订单）

#### ✅ 测试 2.1：销售经理标记赢单并生成合同

**步骤**：
1. 继续使用销售经理账户
2. 将项目状态更新为「赢单」
3. 点击「生成合同订单」
4. 填写合同信息
5. 上传合同草稿（可选）

**预期结果**：
- ✅ 项目状态变为「赢单」
- ✅ 合同创建成功

---

#### ✅ 测试 2.2：商务工程师审核合同并创建生产订单

**步骤**：
1. 登出销售经理，登录商务工程师
2. 查看待审核合同
3. 审核通过
4. 确认收款（模拟）
5. 创建生产订单

**预期结果**：
- ✅ 合同审核成功
- ✅ 生产订单创建成功
- ✅ 生产订单号生成（PO-YYYYMM-XXXX）

---

### 🎬 场景3：生产与供应链

#### ✅ 测试 3.1：生产计划员展开BOM并生成采购需求

**步骤**：
1. 登录生产计划员: `13000000006` / `password`
2. 查看待排产订单
3. 进入生产订单详情
4. 展开BOM查看物料
5. 生成采购需求

**预期结果**：
- ✅ BOM展开成功
- ✅ 采购需求生成成功

---

#### ✅ 测试 3.2：采购专员创建采购订单

**步骤**：
1. 登录采购专员: `13000000005` / `password`
2. 查看采购需求
3. 创建采购订单
4. 选择供应商：`北京精密机械有限公司`
5. 添加物料和价格

**预期结果**：
- ✅ 采购订单创建成功
- ✅ 订单编号生成

---

#### ✅ 测试 3.3：生产计划员查看物料状态更新

**步骤**：
1. 重新登录生产计划员
2. 返回生产订单
3. 查看BOM物料状态

**预期结果**：
- ✅ 物料状态显示「采购中」
- ✅ 预计到货日期已更新

---

#### ✅ 测试 3.4：车间工人完成作业单

**步骤**：
1. 登录车间工人: `13000000010` / `password`
2. 查看我的工单
3. 报告完成
4. 输入完成数量

**预期结果**：
- ✅ 工单显示
- ✅ 完工报告提交成功

---

#### ✅ 测试 3.5：质检员检验产品

**步骤**：
1. 登录质检员: `13000000007` / `password`
2. 查看待质检任务
3. 录入检验结果
4. 提交检验报告

**预期结果**：
- ✅ 质检任务显示
- ✅ 检验报告提交成功
- ✅ 产品状态变为「质检合格」

---

#### ✅ 测试 3.6：物流专员安排发货

**步骤**：
1. 登录物流专员: `13000000008` / `password`
2. 查看待发货订单
3. 创建发货记录
4. 填写运单号

**预期结果**：
- ✅ 发货记录创建成功
- ✅ 订单状态变为「已发货」

---

### 🎬 场景4：售后流程

#### ✅ 测试 4.1：销售经理创建售后工单

**步骤**：
1. 重新登录销售经理
2. 创建售后工单
3. 填写工单信息：
   - 服务类型：维修
   - 问题标题：`执行器异常噪音`
   - 指派给售后工程师
4. 提交工单

**预期结果**：
- ✅ 工单创建成功
- ✅ 工单号生成（TK-YYYYMM-XXXX）

---

#### ✅ 测试 4.2：售后工程师处理和关闭工单

**步骤**：
1. 登录售后工程师: `13000000009` / `password`
2. 查看我的工单
3. 接受工单
4. 添加处理记录
5. 标记为已解决
6. 关闭工单

**预期结果**：
- ✅ 工单状态：处理中 → 已解决 → 已关闭
- ✅ 历史记录完整

---

## 🤖 自动化测试

### 运行Cypress E2E测试

**GUI模式（推荐用于调试）**：
```bash
cd frontend
npx cypress open
```
然后选择 `final_acceptance_test.cy.js`

**无头模式（CI/CD）**：
```bash
cd frontend
npx cypress run --spec "cypress/e2e/final_acceptance_test.cy.js"
```

**查看测试结果**：
- 截图: `frontend/cypress/screenshots/`
- 视频: `frontend/cypress/videos/`
- 报告: 终端输出

---

## ✅ 验收标准

### 核心功能验收

- ✅ **用户认证**: 所有10个角色都能成功登录
- ✅ **角色权限**: 每个角色只能看到和操作自己权限范围内的功能
- ✅ **项目流程**: 从创建 → 选型 → 报价 → 赢单 → 合同 → 生产 全流程通畅
- ✅ **数据流转**: 任务在不同角色间正确流转
- ✅ **状态管理**: 项目/订单状态自动更新正确

### 协同功能验收

- ✅ **任务通知**: 任务分配后，被分配人能在仪表盘看到
- ✅ **数据同步**: 采购订单的交期自动同步到生产订单
- ✅ **跨部门协作**: 销售→技术→商务→生产→采购→质检→物流→售后 环环相扣

### 数据完整性验收

- ✅ **自动编号**: 项目、订单、工单编号自动生成且唯一
- ✅ **计算准确**: 价格、总金额、进度百分比计算正确
- ✅ **历史记录**: 所有关键操作都有历史记录/审计日志

---

## 🔧 故障排查

### 问题1：无法登录

**症状**: 输入账号密码后无响应

**解决方案**:
1. 检查后端服务器是否运行
2. 检查数据库是否已初始化
3. 重新运行 `npm run seed:final`

---

### 问题2：页面空白或404

**症状**: 访问页面显示空白或404错误

**解决方案**:
1. 检查前端服务器是否运行
2. 确认访问地址: `http://localhost:5173`
3. 清除浏览器缓存

---

### 问题3：项目列表为空

**症状**: 登录后看不到项目

**解决方案**:
1. 确认使用正确的角色登录
2. 检查该角色是否有权限查看项目
3. 重新初始化数据

---

### 问题4：Cypress测试失败

**症状**: E2E测试全部失败

**解决方案**:
1. 确保前后端都在运行
2. 确认数据已初始化
3. 查看截图了解失败原因
4. 检查测试脚本中的选择器是否与实际UI匹配

---

## 🎉 最终结论

当您完成了所有测试（手动或自动）后，可以得出结论：

> **"Project Ark" 平台的所有功能已按最终逻辑实现，角色权限清晰，跨部门协同工作流已完全跑通。系统已达到可投入公司正式使用的标准。**

---

## 📊 测试报告模板

### 测试执行记录

| 测试ID | 测试场景 | 执行人 | 结果 | 备注 |
|--------|---------|--------|------|------|
| 1.1 | 销售经理创建项目 | | ☐ 通过 ☐ 失败 | |
| 1.2 | 技术工程师选型 | | ☐ 通过 ☐ 失败 | |
| 1.3 | 商务工程师报价 | | ☐ 通过 ☐ 失败 | |
| 1.4 | 销售经理查看报价 | | ☐ 通过 ☐ 失败 | |
| 2.1 | 销售经理赢单 | | ☐ 通过 ☐ 失败 | |
| 2.2 | 商务工程师合同 | | ☐ 通过 ☐ 失败 | |
| 3.1 | 生产计划员排产 | | ☐ 通过 ☐ 失败 | |
| 3.2 | 采购专员采购 | | ☐ 通过 ☐ 失败 | |
| 3.3 | 物料状态更新 | | ☐ 通过 ☐ 失败 | |
| 3.4 | 车间工人完工 | | ☐ 通过 ☐ 失败 | |
| 3.5 | 质检员质检 | | ☐ 通过 ☐ 失败 | |
| 3.6 | 物流专员发货 | | ☐ 通过 ☐ 失败 | |
| 4.1 | 销售经理创建工单 | | ☐ 通过 ☐ 失败 | |
| 4.2 | 售后工程师处理 | | ☐ 通过 ☐ 失败 | |

**总通过率**: ___/14 (___%)

**测试日期**: ____________

**测试人员**: ____________

**结论**: ☐ 通过验收 ☐ 需要修复

---

**版本**: 1.0.0  
**最后更新**: 2025-10-29  
**维护者**: Project Ark Team

