# ä¼˜åŒ–ç‰©æ–™æ¸…å•å¿«é€Ÿå‚è€ƒ ğŸš€

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2025-10-27

---

## ğŸ“Š å­—æ®µç»“æ„

```javascript
optimized_bill_of_materials: [{
  actuator_model: String,    // å‹å·ï¼ˆå¤§å†™ï¼‰
  total_quantity: Number,    // æ•°é‡ï¼ˆâ‰¥1ï¼‰
  unit_price: Number,        // å•ä»·ï¼ˆâ‰¥0ï¼‰
  total_price: Number,       // æ€»ä»·ï¼ˆâ‰¥0ï¼‰
  covered_tags: [String],    // ä½å·åˆ—è¡¨
  notes: String              // å¤‡æ³¨
}]
```

---

## ğŸ’» å¸¸ç”¨ä»£ç ç‰‡æ®µ

### ç”Ÿæˆä¼˜åŒ–æ¸…å•

```javascript
const modelMap = new Map();

project.selections.forEach(sel => {
  const model = sel.selected_actuator?.final_model_name;
  const price = sel.selected_actuator?.price;
  const tag = sel.tag_number;
  
  if (modelMap.has(model)) {
    const item = modelMap.get(model);
    item.total_quantity += 1;
    item.total_price = item.unit_price * item.total_quantity;
    item.covered_tags.push(tag);
  } else {
    modelMap.set(model, {
      actuator_model: model,
      total_quantity: 1,
      unit_price: price,
      total_price: price,
      covered_tags: [tag]
    });
  }
});

project.optimized_bill_of_materials = Array.from(modelMap.values());
await project.save();
```

---

### æŸ¥è¯¢ä½å·å¯¹åº”å‹å·

```javascript
const findModelByTag = (project, tag) => {
  return project.optimized_bill_of_materials.find(
    item => item.covered_tags.includes(tag)
  );
};
```

---

### ç»Ÿè®¡æ€»ä»·

```javascript
const totalPrice = project.optimized_bill_of_materials.reduce(
  (sum, item) => sum + item.total_price, 0
);

const totalQuantity = project.optimized_bill_of_materials.reduce(
  (sum, item) => sum + item.total_quantity, 0
);
```

---

## ğŸ“Š æ•°æ®ç¤ºä¾‹

```javascript
{
  optimized_bill_of_materials: [
    {
      actuator_model: "SF10/C-150DA-T1",
      total_quantity: 3,
      unit_price: 8925,
      total_price: 26775,
      covered_tags: ["V-101", "V-102", "V-105"],
      notes: "ä½æ¸©ç¯å¢ƒ"
    },
    {
      actuator_model: "AT-DA63-T2",
      total_quantity: 2,
      unit_price: 93,
      total_price: 186,
      covered_tags: ["V-103", "V-104"]
    }
  ]
}
```

---

## ğŸ”§ API ç«¯ç‚¹

### ç”Ÿæˆä¼˜åŒ–æ¸…å•

```bash
POST /api/new-projects/:id/optimize-bom
```

### è·å–ä¼˜åŒ–æ¸…å•

```bash
GET /api/new-projects/:id/optimized-bom
```

### æ›´æ–°ä¼˜åŒ–æ¸…å•

```bash
PUT /api/new-projects/:id/optimized-bom
Content-Type: application/json

{
  "optimized_bill_of_materials": [...]
}
```

---

## ğŸ“ˆ ä¼˜åŠ¿å¯¹æ¯”

### ä¼˜åŒ–å‰

```
5ä¸ªé€‰å‹ â†’ 5æ¡è®°å½•
æ•°æ®å†—ä½™å¤š
éš¾ä»¥ç»Ÿè®¡
```

### ä¼˜åŒ–å

```
5ä¸ªé€‰å‹ â†’ 2æ¡è®°å½•ï¼ˆ2ä¸ªå‹å·ï¼‰
æ•°æ®ç²¾ç®€
ä¸€ç›®äº†ç„¶
ä¸“ä¸šæŠ¥ä»·
```

---

## ğŸ¯ å…³é”®å­—æ®µ

### covered_tags â­

**ç”¨é€”**: è¿½è¸ªå“ªäº›ä½å·ä½¿ç”¨äº†è¿™ä¸ªå‹å·

**ç¤ºä¾‹**:
```javascript
covered_tags: ["V-101", "V-102", "V-105"]
```

**åº”ç”¨**:
- ç”Ÿæˆä½å·-å‹å·å¯¹ç…§è¡¨
- åå‘æŸ¥è¯¢ä½å·å¯¹åº”çš„å‹å·
- ç»Ÿè®¡å‹å·ä½¿ç”¨é¢‘ç‡

---

## âœ… æœ€ä½³å®è·µ

1. âœ… æ€»ä»· = å•ä»· Ã— æ•°é‡
2. âœ… ä½å·è‡ªåŠ¨è½¬å¤§å†™
3. âœ… å‹å·è‡ªåŠ¨è½¬å¤§å†™
4. âœ… æ•°é‡æœ€å°ä¸º 1
5. âœ… ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°

---

**è¯¦ç»†æ–‡æ¡£**: è§ `é€‰å‹ä¼˜åŒ–ç‰©æ–™æ¸…å•å­—æ®µè¯´æ˜.md`

