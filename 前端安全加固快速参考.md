# å‰ç«¯å®‰å…¨åŠ å›ºå¿«é€Ÿå‚è€ƒæŒ‡å— âš¡

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1ï¸âƒ£ Token å®‰å…¨ - HttpOnly Cookie
**ä¹‹å‰:** localStorage å­˜å‚¨ï¼ˆæ˜“è¢« XSS çªƒå–ï¼‰  
**ç°åœ¨:** HttpOnly Cookieï¼ˆJavaScript æ— æ³•è®¿é—®ï¼‰

### 2ï¸âƒ£ XSS é˜²æŠ¤
**æ£€æŸ¥ç»“æœ:** âœ… æ—  `dangerouslySetInnerHTML` ä½¿ç”¨  
**é˜²æŠ¤çŠ¶æ€:** React é»˜è®¤è½¬ä¹‰ç”Ÿæ•ˆ

### 3ï¸âƒ£ æƒé™éªŒè¯
**å‰ç«¯:** UI éšè—ï¼ˆç”¨æˆ·ä½“éªŒï¼‰  
**åç«¯:** protect + authorize ä¸­é—´ä»¶ï¼ˆçœŸæ­£å®‰å…¨è¾¹ç•Œï¼‰

---

## ğŸ“¦ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### åç«¯
```bash
cd backend
npm install  # å®‰è£… cookie-parser
```

**å¿…éœ€æ–‡ä»¶ä¿®æ”¹:**
- âœ… `package.json` - æ·»åŠ  cookie-parser ä¾èµ–
- âœ… `server.js` - æ·»åŠ  cookieParser() ä¸­é—´ä»¶
- âœ… `controllers/authController.js` - ç™»å½•/æ³¨å†Œ/ç™»å‡ºä½¿ç”¨ Cookie
- âœ… `middleware/auth.js` - ä» Cookie è¯»å– token

### å‰ç«¯
```bash
cd frontend
# æ— éœ€é¢å¤–å®‰è£…
```

**å¿…éœ€æ–‡ä»¶ä¿®æ”¹:**
- âœ… `services/api.js` - withCredentials: true
- âœ… `pages/Login.jsx` - ä¸å†ä»å“åº”è·å– token
- âœ… `store/authStore.js` - login() ä¸è¦æ±‚ token å‚æ•°

---

## ğŸ” æµ‹è¯•éªŒè¯ (5åˆ†é’Ÿ)

### 1. ç™»å½•æµ‹è¯•
```
1. æ‰“å¼€æµè§ˆå™¨ DevTools
2. ç™»å½•ç³»ç»Ÿ
3. Application > Cookies > æŸ¥çœ‹ accessToken & refreshToken
4. ç¡®è®¤æœ‰ HttpOnly æ ‡è®° âœ…
```

### 2. API æµ‹è¯•
```
1. Network > æŸ¥çœ‹ä»»æ„ API è¯·æ±‚
2. Request Headers > Cookie è‡ªåŠ¨å‘é€ âœ…
3. æ—  Authorization: Bearer <token> å¤´
```

### 3. å®‰å…¨æµ‹è¯•
```
1. Console è¾“å…¥: document.cookie
2. çœ‹ä¸åˆ° accessToken å’Œ refreshToken âœ…
```

---

## ğŸš¨ é‡è¦ç¯å¢ƒå˜é‡

```bash
# backend/.env
NODE_ENV=production  # å¯ç”¨ secure cookie
FRONTEND_URL=https://your-domain.com
```

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜: ç™»å½•å Cookie æœªè®¾ç½®
**æ£€æŸ¥:**
- åç«¯æ˜¯å¦å®‰è£…äº† `cookie-parser`
- `server.js` æ˜¯å¦æ·»åŠ äº† `app.use(cookieParser())`
- CORS æ˜¯å¦è®¾ç½®äº† `credentials: true`

### é—®é¢˜: API è¯·æ±‚ 401 é”™è¯¯
**æ£€æŸ¥:**
- å‰ç«¯ axios æ˜¯å¦è®¾ç½®äº† `withCredentials: true`
- æµè§ˆå™¨ Network é¢æ¿ï¼ŒCookie æ˜¯å¦è‡ªåŠ¨å‘é€
- åç«¯ä¸­é—´ä»¶æ˜¯å¦ä» `req.cookies.accessToken` è¯»å–

### é—®é¢˜: ç”Ÿäº§ç¯å¢ƒ Cookie æœªä¼ è¾“
**æ£€æŸ¥:**
- æ˜¯å¦å¯ç”¨ HTTPS
- `NODE_ENV=production` æ˜¯å¦è®¾ç½®
- `secure: true` éœ€è¦ HTTPS

---

## ğŸ’¡ æ ¸å¿ƒä»£ç ç‰‡æ®µ

### åç«¯ - è®¾ç½® Cookie
```javascript
res.cookie('accessToken', token, {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'strict',
  maxAge: 8 * 60 * 60 * 1000
});
```

### å‰ç«¯ - Axios é…ç½®
```javascript
const api = axios.create({
  baseURL: API_URL,
  withCredentials: true  // âœ… å…³é”®é…ç½®
})
```

### å‰ç«¯ - ç™»å½•é€»è¾‘
```javascript
const user = response.data  // ä¸å†åŒ…å« token
login(user, null)  // token åœ¨ Cookie ä¸­
```

---

## âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡æ ‡å‡†

- [ ] Cookie æœ‰ HttpOnly æ ‡è®°
- [ ] Cookie æœ‰ SameSite=Strict
- [ ] ç”Ÿäº§ç¯å¢ƒ Cookie æœ‰ Secure æ ‡è®°
- [ ] Console æ— æ³•è®¿é—® token
- [ ] API è¯·æ±‚è‡ªåŠ¨å¸¦ Cookie
- [ ] ç™»å‡ºæ¸…é™¤ Cookie
- [ ] ä½æƒé™ç”¨æˆ·è®¿é—®é«˜æƒé™ API è¿”å› 403

---

**å¿«é€Ÿè”ç³»:** å¦‚æœ‰ç–‘é—®è¯·æŸ¥çœ‹ã€Šå‰ç«¯å®‰å…¨åŠ å›ºå®ŒæˆæŠ¥å‘Š.mdã€‹å®Œæ•´æ–‡æ¡£

