# è®¢å•ç®¡ç†åŠŸèƒ½å¿«é€Ÿå‚è€ƒ ğŸš€

## ğŸ“Œ æ ¸å¿ƒæ–‡ä»¶

### åç«¯
```
backend/
â”œâ”€â”€ models/SalesOrder.js           # è®¢å•æ•°æ®æ¨¡å‹
â”œâ”€â”€ controllers/orderController.js # è®¢å•æ§åˆ¶å™¨
â””â”€â”€ routes/orderRoutes.js          # è®¢å•è·¯ç”±
```

### å‰ç«¯
```
frontend/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ OrderManagement.jsx        # è®¢å•åˆ—è¡¨é¡µ
â”‚   â”œâ”€â”€ OrderDetails.jsx           # è®¢å•è¯¦æƒ…é¡µ
â”‚   â””â”€â”€ ProjectDetails.jsx         # é¡¹ç›®è¯¦æƒ…é¡µï¼ˆæ–°å¢è®¢å•ç”ŸæˆåŠŸèƒ½ï¼‰
â””â”€â”€ services/api.js                # APIæœåŠ¡ï¼ˆæ–°å¢ordersAPIï¼‰
```

---

## ğŸ”— APIç«¯ç‚¹é€ŸæŸ¥

| åŠŸèƒ½ | æ–¹æ³• | ç«¯ç‚¹ |
|------|------|------|
| ä»é¡¹ç›®åˆ›å»ºè®¢å• | POST | `/api/orders/from-project/:projectId` |
| è·å–è®¢å•åˆ—è¡¨ | GET | `/api/orders?status=&page=&limit=` |
| è·å–è®¢å•è¯¦æƒ… | GET | `/api/orders/:id` |
| æ›´æ–°è®¢å• | PUT | `/api/orders/:id` |
| æ›´æ–°çŠ¶æ€ | PATCH | `/api/orders/:id/status` |
| æ·»åŠ ä»˜æ¬¾ | POST | `/api/orders/:id/payment` |
| åˆ é™¤è®¢å• | DELETE | `/api/orders/:id` |
| è·å–ç»Ÿè®¡ | GET | `/api/orders/statistics` |

---

## ğŸ“‹ è®¢å•çŠ¶æ€

```
Pending â†’ Confirmed â†’ In Production â†’ Shipped â†’ Delivered â†’ Completed
                                                    â†“
                                                Cancelled
```

**ä»˜æ¬¾çŠ¶æ€**: Pending | Partial | Paid | Overdue

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### 1. ä»é¡¹ç›®ç”Ÿæˆè®¢å•

```javascript
// å‰ç«¯è°ƒç”¨
import { ordersAPI } from '../services/api'

const orderData = {
  requestedDeliveryDate: "2025-11-30",
  shippingAddress: "å®¢æˆ·åœ°å€",
  shippingMethod: "Standard",
  deliveryTerms: "FOB Factory",
  paymentTerms: "Net 30",
  taxRate: 13,
  shippingCost: 500,
  discount: 0,
  notes: "è®¢å•å¤‡æ³¨",
  internalNotes: "å†…éƒ¨å¤‡æ³¨"
}

const response = await ordersAPI.createFromProject(projectId, orderData)
```

### 2. è·å–è®¢å•åˆ—è¡¨

```javascript
// å¸¦ç­›é€‰æ¡ä»¶
const params = {
  status: 'Confirmed',
  paymentStatus: 'Pending',
  page: 1,
  limit: 20,
  startDate: '2025-01-01',
  endDate: '2025-12-31'
}

const response = await ordersAPI.getAll(params)
```

### 3. æ·»åŠ ä»˜æ¬¾è®°å½•

```javascript
const paymentData = {
  amount: 28500,
  date: "2025-10-27",
  method: "Bank Transfer",
  reference: "TXN20251027001",
  notes: "é¦–ä»˜æ¬¾50%"
}

await ordersAPI.addPayment(orderId, paymentData)
```

---

## âš ï¸ é‡è¦é™åˆ¶

1. **åªæœ‰çŠ¶æ€ä¸º `Won` çš„é¡¹ç›®æ‰èƒ½ç”Ÿæˆè®¢å•**
2. **æ¯ä¸ªé¡¹ç›®åªèƒ½ç”Ÿæˆä¸€ä¸ªè®¢å•**ï¼ˆé˜²æ­¢é‡å¤ï¼‰
3. **é¡¹ç›®å¿…é¡»æœ‰BOMæ•°æ®æ‰èƒ½ç”Ÿæˆè®¢å•**
4. **åªèƒ½åˆ é™¤ `Pending` æˆ– `Cancelled` çŠ¶æ€çš„è®¢å•**

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•æ­¥éª¤
```bash
# 1. å¯åŠ¨åç«¯
cd backend
npm start

# 2. å¯åŠ¨å‰ç«¯
cd frontend
npm run dev

# 3. åœ¨æµè§ˆå™¨ä¸­
# - ç™»å½•ç³»ç»Ÿ
# - è¿›å…¥"é¡¹ç›®ç®¡ç†"
# - é€‰æ‹©ä¸€ä¸ªæœ‰BOMçš„é¡¹ç›®
# - ç‚¹å‡»"æ ‡è®°ä¸ºèµ¢å•"
# - ç‚¹å‡»"ä¸€é”®ç”ŸæˆåˆåŒè®¢å•"
# - å¡«å†™è¡¨å•å¹¶æäº¤
# - åœ¨"è®¢å•ç®¡ç†"æŸ¥çœ‹æ–°è®¢å•
```

---

## ğŸ¨ UIç»„ä»¶ç‰¹è‰²

### ProjectDetails.jsx æ–°å¢æŒ‰é’®
```jsx
{/* èµ¢å•æŒ‰é’® - ç»¿è‰²æ¸å˜ */}
{project.status !== 'Won' && (
  <Button icon={<CheckCircleOutlined />}>æ ‡è®°ä¸ºèµ¢å•</Button>
)}

{/* ç”Ÿæˆè®¢å•æŒ‰é’® - è“è‰²æ¸å˜ */}
{project.status === 'Won' && (
  <Button icon={<ShoppingCartOutlined />}>ä¸€é”®ç”ŸæˆåˆåŒè®¢å•</Button>
)}
```

### OrderManagement.jsx ç»Ÿè®¡å¡ç‰‡
- è®¢å•æ€»æ•°
- å¾…å¤„ç†è®¢å•
- æ€»è¥æ”¶
- æœªæ”¶æ¬¾é‡‘é¢

### OrderDetails.jsx å…³é”®ç»„ä»¶
- Stepsï¼ˆè®¢å•è¿›åº¦æ¡ï¼‰
- Statisticï¼ˆè´¢åŠ¡ç»Ÿè®¡å¡ï¼‰
- Timelineï¼ˆä»˜æ¬¾è®°å½•æ—¶é—´è½´ï¼‰
- Tableï¼ˆè®¢å•æ˜ç»†è¡¨æ ¼ï¼‰

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ— æ³•ç”Ÿæˆè®¢å•ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹æ¡ä»¶ï¼š
- é¡¹ç›®çŠ¶æ€å¿…é¡»ä¸º `Won`
- é¡¹ç›®å¿…é¡»æœ‰BOMæ•°æ®
- è¯¥é¡¹ç›®è¿˜æ²¡æœ‰ç”Ÿæˆè¿‡è®¢å•

### Q2: å¦‚ä½•ä¿®æ”¹è®¢å•ï¼Ÿ
**A**: 
- åœ¨è®¢å•è¯¦æƒ…é¡µç‚¹å‡»"æ›´æ–°çŠ¶æ€"
- ä½¿ç”¨PUT `/api/orders/:id` æ›´æ–°å®Œæ•´è®¢å•ä¿¡æ¯

### Q3: ä»˜æ¬¾çŠ¶æ€å¦‚ä½•è‡ªåŠ¨æ›´æ–°ï¼Ÿ
**A**: 
- æ·»åŠ ä»˜æ¬¾è®°å½•æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å·²ä»˜é‡‘é¢
- å·²ä»˜ >= æ€»é¢: `Paid`
- å·²ä»˜ > 0: `Partial`
- æœªä»˜: `Pending`

### Q4: å¯ä»¥å–æ¶ˆè®¢å•å—ï¼Ÿ
**A**: 
- å¯ä»¥ï¼Œå°†è®¢å•çŠ¶æ€æ›´æ–°ä¸º `Cancelled`
- å·²å–æ¶ˆçš„è®¢å•å¯ä»¥åˆ é™¤

---

## ğŸ“Š æ•°æ®åº“å­—æ®µé€ŸæŸ¥

### SalesOrder æ ¸å¿ƒå­—æ®µ
```javascript
{
  orderNumber: String,           // è‡ªåŠ¨ç”Ÿæˆ SO-YYYYMM-XXXX
  status: String,                // è®¢å•çŠ¶æ€
  project: ObjectId,             // å…³è”é¡¹ç›®
  projectSnapshot: Object,       // é¡¹ç›®å¿«ç…§
  orderItems: Array,             // è®¢å•æ˜ç»†
  financial: {
    subtotal: Number,
    tax_rate: Number,
    tax_amount: Number,
    shipping_cost: Number,
    discount: Number,
    total_amount: Number
  },
  payment: {
    payment_status: String,
    payment_terms: String,
    paid_amount: Number,
    payment_records: Array
  },
  delivery: {
    shipping_method: String,
    delivery_terms: String,
    shipping_address: String,
    tracking_number: String
  }
}
```

---

## ğŸŒŸ æœ€ä½³å®è·µ

### 1. è®¢å•åˆ›å»º
- åœ¨é¡¹ç›®BOMç¡®è®¤æ— è¯¯åå†ç”Ÿæˆè®¢å•
- å¡«å†™å®Œæ•´çš„äº¤ä»˜å’Œä»˜æ¬¾ä¿¡æ¯
- æ·»åŠ å¿…è¦çš„å¤‡æ³¨è¯´æ˜

### 2. è®¢å•è·Ÿè¸ª
- åŠæ—¶æ›´æ–°è®¢å•çŠ¶æ€
- è®°å½•æ¯ç¬”ä»˜æ¬¾ä¿¡æ¯
- æ·»åŠ ç‰©æµè·Ÿè¸ªå·

### 3. æ•°æ®å®‰å…¨
- é‡è¦æ“ä½œå‰éƒ½æœ‰äºŒæ¬¡ç¡®è®¤
- å†…éƒ¨å¤‡æ³¨ä¸ä¼šæ˜¾ç¤ºç»™å®¢æˆ·
- é¡¹ç›®å¿«ç…§ç¡®ä¿è®¢å•æ•°æ®ç‹¬ç«‹

---

## ğŸ¯ ä¸‹ä¸€æ­¥åŠŸèƒ½

å¯æ‰©å±•çš„åŠŸèƒ½æ–¹å‘ï¼š
- âœ¨ è®¢å•PDFå¯¼å‡º
- âœ¨ é‚®ä»¶é€šçŸ¥
- âœ¨ è®¢å•æœç´¢
- âœ¨ æ‰¹é‡æ“ä½œ
- âœ¨ è®¢å•æ¨¡æ¿
- âœ¨ åº“å­˜æ£€æŸ¥
- âœ¨ ç‰©æµè·Ÿè¸ª

---

**æ›´æ–°æ—¶é—´**: 2025-10-27  
**ç‰ˆæœ¬**: v1.0.0

ğŸ’¡ **æç¤º**: è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿå‚è€ƒæ–‡æ¡£ã€‚è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ã€Šè®¢å•ç®¡ç†åŠŸèƒ½å®ŒæˆæŠ¥å‘Š.mdã€‹


