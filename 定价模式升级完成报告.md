# å®šä»·æ¨¡å¼å‡çº§å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æˆåŠŸå‡çº§äº†äº§å“æ¨¡å‹ä»¥æ”¯æŒ**å¯é€‰çš„é˜¶æ¢¯æŠ¥ä»·åŠŸèƒ½**ã€‚ç°åœ¨ç³»ç»Ÿæ”¯æŒä¸¤ç§å®šä»·æ¨¡å¼ï¼š
- âœ… **å›ºå®šä»·æ ¼** (`fixed`) - ä½¿ç”¨å•ä¸€çš„åŸºç¡€ä»·æ ¼
- âœ… **é˜¶æ¢¯ä»·æ ¼** (`tiered`) - æ ¹æ®é‡‡è´­æ•°é‡ä½¿ç”¨ä¸åŒçš„ä»·æ ¼æ¡£ä½

**å®Œæˆæ—¥æœŸ**: 2025-10-28

---

## ğŸ¯ å‡çº§ç›®æ ‡

ä¸ºäº§å“æ¨¡å‹ï¼ˆæ‰§è¡Œå™¨å’Œé…ä»¶ï¼‰å¼•å…¥çµæ´»çš„å®šä»·æœºåˆ¶ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿï¼š
1. æ”¯æŒå›ºå®šå•ä»·çš„ç®€å•å®šä»·æ¨¡å¼
2. æ”¯æŒåŸºäºæ•°é‡çš„é˜¶æ¢¯å®šä»·
3. é€šè¿‡ `pricing_model` å­—æ®µæ¸…æ™°åœ°åŒºåˆ†ä¸¤ç§æ¨¡å¼
4. ä¿æŒå‘åå…¼å®¹æ€§

---

## ğŸ“¦ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `backend/models/Actuator.js` âœ…

#### æ–°å¢å­—æ®µ

##### `pricing_model` - å®šä»·æ¨¡å¼å¼€å…³ï¼ˆæ ¸å¿ƒå­—æ®µï¼‰
```javascript
pricing_model: {
  type: String,
  enum: ['fixed', 'tiered'],
  default: 'fixed',
  required: true
}
```
- `'fixed'` - å›ºå®šä»·æ ¼æ¨¡å¼ï¼Œä½¿ç”¨ `base_price`
- `'tiered'` - é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ï¼Œä½¿ç”¨ `price_tiers` æ•°ç»„

##### `base_price` - å›ºå®šå•ä»·
```javascript
base_price: {
  type: Number,
  min: [0, 'åŸºç¡€ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°']
}
```
- å½“ `pricing_model = 'fixed'` æ—¶å¿…é¡»æä¾›
- ç”¨äºå­˜å‚¨å›ºå®šçš„å•ä»·

#### ä¿®æ”¹å­—æ®µ

##### `price_tiers` - é˜¶æ¢¯ä»·æ ¼ï¼ˆç°åœ¨ä¸ºå¯é€‰ï¼‰
```javascript
price_tiers: [{
  min_quantity: { type: Number, required: true, min: 1 },
  unit_price: { type: Number, required: true, min: 0 },
  price_type: { type: String, enum: ['normal', 'low_temp', 'high_temp', 'standard'], default: 'normal' },
  notes: { type: String }
}]
```
- **ç§»é™¤äº†å­—æ®µçº§åˆ«çš„ `required` çº¦æŸ**
- å½“ `pricing_model = 'tiered'` æ—¶å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ªæ¡£ä½
- é€šè¿‡ä¿å­˜å‰éªŒè¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§

#### æ›´æ–°çš„å®ä¾‹æ–¹æ³•

##### `getPriceByQuantity(quantity, priceType)`
```javascript
actuatorSchema.methods.getPriceByQuantity = function(quantity, priceType = 'normal') {
  if (this.pricing_model === 'fixed') {
    return this.base_price || null;
  }
  
  if (this.pricing_model === 'tiered') {
    if (!this.price_tiers || this.price_tiers.length === 0) {
      return null;
    }
    return calculatePrice(this.price_tiers, quantity, priceType);
  }
  
  return this.base_price || null;
};
```

**è¡Œä¸º**:
- `pricing_model = 'fixed'`: è¿”å› `base_price`ï¼ˆä¸å—æ•°é‡å½±å“ï¼‰
- `pricing_model = 'tiered'`: æ ¹æ®æ•°é‡ä» `price_tiers` ä¸­æŸ¥æ‰¾å¯¹åº”æ¡£ä½çš„å•ä»·

##### `getAllPriceTiers(priceType)`
```javascript
actuatorSchema.methods.getAllPriceTiers = function(priceType = null) {
  if (this.pricing_model === 'fixed') {
    if (!this.base_price) return [];
    return [{
      min_quantity: 1,
      unit_price: this.base_price,
      price_type: 'normal',
      notes: 'å›ºå®šå•ä»·'
    }];
  }
  
  if (this.pricing_model === 'tiered') {
    if (!this.price_tiers || this.price_tiers.length === 0) return [];
    return getAllPriceTiers(this.price_tiers, priceType);
  }
  
  return [];
};
```

**è¡Œä¸º**:
- `pricing_model = 'fixed'`: è¿”å›åŒ…å«å•ä¸ªæ¡£ä½çš„æ•°ç»„ï¼ˆæ–¹ä¾¿ç»Ÿä¸€å±•ç¤ºï¼‰
- `pricing_model = 'tiered'`: è¿”å›å®Œæ•´çš„ä»·æ ¼æ¡£ä½åˆ—è¡¨

#### æ–°å¢ä¿å­˜å‰éªŒè¯

```javascript
actuatorSchema.pre('save', function(next) {
  // éªŒè¯ model_base æ ¼å¼ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
  if (this.model_base && !this.model_base.includes('-')) {
    this.model_base = `${this.body_size}-${this.action_type}`;
  }
  
  // ========== æ–°å¢ï¼šå®šä»·æ¨¡å¼æ•°æ®éªŒè¯ ==========
  if (this.pricing_model === 'fixed') {
    // å›ºå®šä»·æ ¼æ¨¡å¼ï¼šå¿…é¡»æä¾› base_price
    if (!this.base_price || this.base_price <= 0) {
      return next(new Error('å›ºå®šä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›æœ‰æ•ˆçš„ base_price'));
    }
  } else if (this.pricing_model === 'tiered') {
    // é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ï¼šå¿…é¡»æä¾› price_tiers
    if (!this.price_tiers || this.price_tiers.length === 0) {
      return next(new Error('é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ª price_tiers'));
    }
    
    // éªŒè¯æ¯ä¸ªæ¡£ä½çš„æ•°æ®å®Œæ•´æ€§
    for (let tier of this.price_tiers) {
      if (!tier.min_quantity || tier.min_quantity < 1) {
        return next(new Error('price_tiers ä¸­çš„ min_quantity å¿…é¡»å¤§äº 0'));
      }
      if (!tier.unit_price || tier.unit_price < 0) {
        return next(new Error('price_tiers ä¸­çš„ unit_price ä¸èƒ½ä¸ºè´Ÿæ•°'));
      }
    }
  }
  
  next();
});
```

---

### 2. `backend/models/Accessory.js` âœ…

#### æ–°å¢å­—æ®µ

##### `pricing_model` - å®šä»·æ¨¡å¼å¼€å…³
```javascript
pricing_model: {
  type: String,
  enum: ['fixed', 'tiered'],
  default: 'fixed',
  required: true
}
```

##### `base_price` - å›ºå®šå•ä»·
```javascript
base_price: {
  type: Number,
  min: [0, 'åŸºç¡€ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°']
}
```

##### `price_tiers` - é˜¶æ¢¯ä»·æ ¼ï¼ˆæ–°å¢ï¼‰
```javascript
price_tiers: [{
  min_quantity: { type: Number, required: true, min: 1 },
  unit_price: { type: Number, required: true, min: 0 },
  price_type: { type: String, enum: ['normal', 'bulk', 'promotional'], default: 'normal' },
  notes: { type: String }
}]
```

#### ä¿ç•™å­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰

##### `price` - æ—§çš„ä»·æ ¼å­—æ®µ
```javascript
price: {
  type: Number,
  min: [0, 'ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°']
}
```
- **å·²æ ‡è®°ä¸ºå·²å¼ƒç”¨**ï¼Œå»ºè®®ä½¿ç”¨ `base_price`
- ä¿ç•™æ­¤å­—æ®µä»¥æ”¯æŒæ—§æ•°æ®
- åœ¨ä¿å­˜æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ° `base_price`

#### æ–°å¢å®ä¾‹æ–¹æ³•

##### `getPriceByQuantity(quantity, priceType)`
```javascript
accessorySchema.methods.getPriceByQuantity = function(quantity, priceType = 'normal') {
  if (this.pricing_model === 'fixed') {
    return this.base_price || this.price || null; // å…¼å®¹æ—§çš„ price å­—æ®µ
  }
  
  if (this.pricing_model === 'tiered') {
    if (!this.price_tiers || this.price_tiers.length === 0) {
      return null;
    }
    
    // ç­›é€‰ç¬¦åˆä»·æ ¼ç±»å‹çš„æ¡£ä½
    let tiers = this.price_tiers.filter(tier => tier.price_type === priceType);
    if (tiers.length === 0) tiers = this.price_tiers;
    
    // æŒ‰ min_quantity é™åºæ’åºï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ¡£ä½
    const sortedTiers = tiers.sort((a, b) => b.min_quantity - a.min_quantity);
    for (let tier of sortedTiers) {
      if (quantity >= tier.min_quantity) {
        return tier.unit_price;
      }
    }
    
    return sortedTiers[sortedTiers.length - 1]?.unit_price || null;
  }
  
  return this.base_price || this.price || null;
};
```

##### `getAllPriceTiers(priceType)`
```javascript
accessorySchema.methods.getAllPriceTiers = function(priceType = null) {
  if (this.pricing_model === 'fixed') {
    const fixedPrice = this.base_price || this.price;
    if (!fixedPrice) return [];
    return [{
      min_quantity: 1,
      unit_price: fixedPrice,
      price_type: 'normal',
      notes: 'å›ºå®šå•ä»·'
    }];
  }
  
  if (this.pricing_model === 'tiered') {
    if (!this.price_tiers || this.price_tiers.length === 0) return [];
    
    let tiers = this.price_tiers;
    if (priceType) {
      tiers = tiers.filter(tier => tier.price_type === priceType);
    }
    
    return tiers.sort((a, b) => a.min_quantity - b.min_quantity);
  }
  
  return [];
};
```

#### æ›´æ–°çš„ä¿å­˜å‰éªŒè¯

```javascript
accessorySchema.pre('save', function(next) {
  if (this.pricing_model === 'fixed') {
    const fixedPrice = this.base_price || this.price;
    if (!fixedPrice || fixedPrice <= 0) {
      return next(new Error('å›ºå®šä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›æœ‰æ•ˆçš„ base_price æˆ– price'));
    }
    
    // å¦‚æœåªæœ‰ price æ²¡æœ‰ base_priceï¼ŒåŒæ­¥å®ƒä»¬
    if (!this.base_price && this.price) {
      this.base_price = this.price;
    }
  } else if (this.pricing_model === 'tiered') {
    if (!this.price_tiers || this.price_tiers.length === 0) {
      return next(new Error('é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ª price_tiers'));
    }
    
    for (let tier of this.price_tiers) {
      if (!tier.min_quantity || tier.min_quantity < 1) {
        return next(new Error('price_tiers ä¸­çš„ min_quantity å¿…é¡»å¤§äº 0'));
      }
      if (!tier.unit_price || tier.unit_price < 0) {
        return next(new Error('price_tiers ä¸­çš„ unit_price ä¸èƒ½ä¸ºè´Ÿæ•°'));
      }
    }
  }
  
  // å‘åå…¼å®¹ï¼šç¡®ä¿æ—§çš„ price å­—æ®µä¸ºæ­£æ•°
  if (this.price && this.price < 0) {
    return next(new Error('é…ä»¶ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°'));
  }
  
  next();
});
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åˆ›å»ºå›ºå®šä»·æ ¼çš„æ‰§è¡Œå™¨

```javascript
const actuator = new Actuator({
  model_base: 'AT-100-DA',
  series: 'AT',
  body_size: '100',
  action_type: 'DA',
  
  // å›ºå®šä»·æ ¼æ¨¡å¼
  pricing_model: 'fixed',
  base_price: 5000,  // å›ºå®šå•ä»· 5000 å…ƒ
  
  // å…¶ä»–å­—æ®µ...
});

await actuator.save();

// è·å–ä»·æ ¼ï¼ˆä¸å—æ•°é‡å½±å“ï¼‰
const price = actuator.getPriceByQuantity(1);   // 5000
const price2 = actuator.getPriceByQuantity(100); // 5000ï¼ˆç›¸åŒï¼‰
```

### ç¤ºä¾‹ 2: åˆ›å»ºé˜¶æ¢¯ä»·æ ¼çš„æ‰§è¡Œå™¨

```javascript
const actuator = new Actuator({
  model_base: 'GY-200-DA',
  series: 'GY',
  body_size: '200',
  action_type: 'DA',
  
  // é˜¶æ¢¯ä»·æ ¼æ¨¡å¼
  pricing_model: 'tiered',
  price_tiers: [
    { min_quantity: 1, unit_price: 8000 },    // 1-9 ä¸ªï¼š8000 å…ƒ/ä¸ª
    { min_quantity: 10, unit_price: 7500 },   // 10-49 ä¸ªï¼š7500 å…ƒ/ä¸ª
    { min_quantity: 50, unit_price: 7000 }    // 50+ ä¸ªï¼š7000 å…ƒ/ä¸ª
  ],
  
  // å…¶ä»–å­—æ®µ...
});

await actuator.save();

// è·å–ä»·æ ¼ï¼ˆæ ¹æ®æ•°é‡å˜åŒ–ï¼‰
const price1 = actuator.getPriceByQuantity(5);   // 8000
const price2 = actuator.getPriceByQuantity(20);  // 7500
const price3 = actuator.getPriceByQuantity(100); // 7000
```

### ç¤ºä¾‹ 3: åˆ›å»ºå›ºå®šä»·æ ¼çš„é…ä»¶

```javascript
const accessory = new Accessory({
  name: 'ç”µç£é˜€',
  category: 'æ§åˆ¶ç±»',
  
  // å›ºå®šä»·æ ¼æ¨¡å¼
  pricing_model: 'fixed',
  base_price: 1200,
  
  // å…¶ä»–å­—æ®µ...
});

await accessory.save();
```

### ç¤ºä¾‹ 4: åˆ›å»ºé˜¶æ¢¯ä»·æ ¼çš„é…ä»¶

```javascript
const accessory = new Accessory({
  name: 'å¯†å°å¥—ä»¶',
  category: 'å®‰å…¨ä¸ä¿æŠ¤ç±»',
  
  // é˜¶æ¢¯ä»·æ ¼æ¨¡å¼
  pricing_model: 'tiered',
  price_tiers: [
    { min_quantity: 1, unit_price: 150, price_type: 'normal' },
    { min_quantity: 10, unit_price: 140, price_type: 'normal' },
    { min_quantity: 50, unit_price: 130, price_type: 'normal' },
    { min_quantity: 100, unit_price: 120, price_type: 'bulk' }  // æ‰¹é‡ä»·æ ¼
  ],
  
  // å…¶ä»–å­—æ®µ...
});

await accessory.save();

// è·å–ä¸åŒæ•°é‡å’Œç±»å‹çš„ä»·æ ¼
const normalPrice = accessory.getPriceByQuantity(5, 'normal');    // 150
const bulkPrice = accessory.getPriceByQuantity(100, 'bulk');      // 120
```

### ç¤ºä¾‹ 5: è·å–ä»·æ ¼æ¡£ä½åˆ—è¡¨

```javascript
// å›ºå®šä»·æ ¼äº§å“
const fixedPriceActuator = await Actuator.findOne({ 
  pricing_model: 'fixed' 
});
const tiers1 = fixedPriceActuator.getAllPriceTiers();
// è¿”å›: [{ min_quantity: 1, unit_price: 5000, price_type: 'normal', notes: 'å›ºå®šå•ä»·' }]

// é˜¶æ¢¯ä»·æ ¼äº§å“
const tieredPriceActuator = await Actuator.findOne({ 
  pricing_model: 'tiered' 
});
const tiers2 = tieredPriceActuator.getAllPriceTiers();
// è¿”å›: [
//   { min_quantity: 1, unit_price: 8000, ... },
//   { min_quantity: 10, unit_price: 7500, ... },
//   { min_quantity: 50, unit_price: 7000, ... }
// ]
```

---

## ğŸ” æ•°æ®éªŒè¯è§„åˆ™

### å›ºå®šä»·æ ¼æ¨¡å¼ (`pricing_model: 'fixed'`)

âœ… **å¿…é¡»æä¾›**:
- `base_price` (Actuator)
- `base_price` æˆ– `price` (Accessoryï¼Œå‘åå…¼å®¹)

âœ… **éªŒè¯è§„åˆ™**:
- `base_price > 0`

âŒ **é”™è¯¯ç¤ºä¾‹**:
```javascript
// é”™è¯¯ï¼šå›ºå®šä»·æ ¼æ¨¡å¼ä½†æ²¡æœ‰ base_price
{
  pricing_model: 'fixed',
  // base_price ç¼ºå¤±
}
// âŒ ä¿å­˜å¤±è´¥: "å›ºå®šä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›æœ‰æ•ˆçš„ base_price"
```

### é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ (`pricing_model: 'tiered'`)

âœ… **å¿…é¡»æä¾›**:
- `price_tiers` æ•°ç»„ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªæ¡£ä½

âœ… **éªŒè¯è§„åˆ™**:
- `price_tiers.length >= 1`
- æ¯ä¸ªæ¡£ä½çš„ `min_quantity >= 1`
- æ¯ä¸ªæ¡£ä½çš„ `unit_price >= 0`

âŒ **é”™è¯¯ç¤ºä¾‹**:
```javascript
// é”™è¯¯ï¼šé˜¶æ¢¯ä»·æ ¼æ¨¡å¼ä½†æ²¡æœ‰ price_tiers
{
  pricing_model: 'tiered',
  price_tiers: []  // ç©ºæ•°ç»„
}
// âŒ ä¿å­˜å¤±è´¥: "é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ª price_tiers"

// é”™è¯¯ï¼šæ¡£ä½æ•°æ®ä¸å®Œæ•´
{
  pricing_model: 'tiered',
  price_tiers: [
    { min_quantity: 0, unit_price: 5000 }  // min_quantity ä¸èƒ½ä¸º 0
  ]
}
// âŒ ä¿å­˜å¤±è´¥: "price_tiers ä¸­çš„ min_quantity å¿…é¡»å¤§äº 0"
```

---

## ğŸ”„ å‘åå…¼å®¹æ€§

### Accessory æ¨¡å‹çš„å‘åå…¼å®¹

ä¸ºäº†ç¡®ä¿ç°æœ‰æ•°æ®çš„å…¼å®¹æ€§ï¼Œ`Accessory` æ¨¡å‹ä¿ç•™äº†æ—§çš„ `price` å­—æ®µï¼š

```javascript
// æ—§æ•°æ®ï¼ˆåªæœ‰ price å­—æ®µï¼‰
const oldAccessory = {
  name: 'ç”µç£é˜€',
  price: 1200  // æ—§å­—æ®µ
};

// ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š
// 1. åœ¨ getPriceByQuantity() ä¸­ä¼šä¼˜å…ˆä½¿ç”¨ base_priceï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ price
// 2. åœ¨ä¿å­˜æ—¶ï¼Œå¦‚æœåªæœ‰ price æ²¡æœ‰ base_priceï¼Œä¼šè‡ªåŠ¨åŒæ­¥
```

### è¿ç§»å»ºè®®

å¦‚æœæœ‰ç°æœ‰æ•°æ®ï¼Œå»ºè®®è¿è¡Œæ•°æ®è¿ç§»è„šæœ¬ï¼š

```javascript
// è¿ç§»è„šæœ¬ç¤ºä¾‹
async function migrateAccessories() {
  const accessories = await Accessory.find({ 
    pricing_model: { $exists: false } 
  });
  
  for (let accessory of accessories) {
    accessory.pricing_model = 'fixed';
    accessory.base_price = accessory.price;
    await accessory.save();
  }
  
  console.log(`è¿ç§»å®Œæˆï¼š${accessories.length} ä¸ªé…ä»¶`);
}
```

---

## ğŸ“Š å­—æ®µå¯¹æ¯”è¡¨

### Actuator æ¨¡å‹

| å­—æ®µå | å‡çº§å‰ | å‡çº§å | è¯´æ˜ |
|--------|--------|--------|------|
| `pricing_model` | âŒ ä¸å­˜åœ¨ | âœ… æ–°å¢ | å®šä»·æ¨¡å¼å¼€å…³ |
| `base_price` | âŒ ä¸å­˜åœ¨ | âœ… æ–°å¢ | å›ºå®šå•ä»· |
| `price_tiers` | å¿…å¡«ï¼ˆéšå¼ï¼‰ | âœ… å¯é€‰ | é˜¶æ¢¯ä»·æ ¼æ•°ç»„ |

### Accessory æ¨¡å‹

| å­—æ®µå | å‡çº§å‰ | å‡çº§å | è¯´æ˜ |
|--------|--------|--------|------|
| `pricing_model` | âŒ ä¸å­˜åœ¨ | âœ… æ–°å¢ | å®šä»·æ¨¡å¼å¼€å…³ |
| `base_price` | âŒ ä¸å­˜åœ¨ | âœ… æ–°å¢ | å›ºå®šå•ä»· |
| `price_tiers` | âŒ ä¸å­˜åœ¨ | âœ… æ–°å¢ | é˜¶æ¢¯ä»·æ ¼æ•°ç»„ |
| `price` | âœ… å¿…å¡« | âœ… ä¿ç•™ï¼ˆå¯é€‰ï¼‰ | æ—§å­—æ®µï¼Œå‘åå…¼å®¹ |

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§

âœ… `pricing_model` å­—æ®µæ­£ç¡®å®šä¹‰ï¼Œé»˜è®¤å€¼ä¸º `'fixed'`  
âœ… `base_price` å­—æ®µæ­£ç¡®å®šä¹‰ï¼Œç”¨äºå›ºå®šä»·æ ¼  
âœ… `price_tiers` å­—æ®µä¸ºå¯é€‰å­—æ®µ  
âœ… `getPriceByQuantity()` æ–¹æ³•æ ¹æ® `pricing_model` è¿”å›æ­£ç¡®ä»·æ ¼  
âœ… `getAllPriceTiers()` æ–¹æ³•æ ¹æ® `pricing_model` è¿”å›æ­£ç¡®æ¡£ä½åˆ—è¡¨  

### æ•°æ®éªŒè¯

âœ… å›ºå®šä»·æ ¼æ¨¡å¼å¿…é¡»æœ‰ `base_price`  
âœ… é˜¶æ¢¯ä»·æ ¼æ¨¡å¼å¿…é¡»æœ‰ `price_tiers` ä¸”è‡³å°‘ä¸€ä¸ªæ¡£ä½  
âœ… ä»·æ ¼æ•°æ®å¿…é¡»ä¸ºæ­£æ•°  
âœ… æ•°é‡å¿…é¡»å¤§äº 0  

### å‘åå…¼å®¹

âœ… Accessory æ¨¡å‹ä¿ç•™ `price` å­—æ®µ  
âœ… æ—§çš„ `price` å­—æ®µå¯ä»¥è‡ªåŠ¨åŒæ­¥åˆ° `base_price`  
âœ… API æ–¹æ³•æ”¯æŒæ—§æ•°æ®  

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•

```javascript
describe('Actuator Pricing Model', () => {
  it('should save actuator with fixed pricing', async () => {
    const actuator = new Actuator({
      model_base: 'AT-100-DA',
      pricing_model: 'fixed',
      base_price: 5000
    });
    
    await actuator.save();
    expect(actuator.getPriceByQuantity(1)).toBe(5000);
    expect(actuator.getPriceByQuantity(100)).toBe(5000);
  });
  
  it('should save actuator with tiered pricing', async () => {
    const actuator = new Actuator({
      model_base: 'GY-200-DA',
      pricing_model: 'tiered',
      price_tiers: [
        { min_quantity: 1, unit_price: 8000 },
        { min_quantity: 10, unit_price: 7500 }
      ]
    });
    
    await actuator.save();
    expect(actuator.getPriceByQuantity(5)).toBe(8000);
    expect(actuator.getPriceByQuantity(15)).toBe(7500);
  });
  
  it('should reject fixed pricing without base_price', async () => {
    const actuator = new Actuator({
      model_base: 'AT-100-DA',
      pricing_model: 'fixed'
      // base_price ç¼ºå¤±
    });
    
    await expect(actuator.save()).rejects.toThrow('å›ºå®šä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›æœ‰æ•ˆçš„ base_price');
  });
  
  it('should reject tiered pricing without price_tiers', async () => {
    const actuator = new Actuator({
      model_base: 'GY-200-DA',
      pricing_model: 'tiered',
      price_tiers: []
    });
    
    await expect(actuator.save()).rejects.toThrow('é˜¶æ¢¯ä»·æ ¼æ¨¡å¼ä¸‹å¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ª price_tiers');
  });
});
```

---

## ğŸ“ åç»­å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

1. **åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬**
   - ä¸ºç°æœ‰æ‰§è¡Œå™¨å’Œé…ä»¶æ•°æ®æ·»åŠ  `pricing_model` å­—æ®µ
   - å°†ç°æœ‰çš„ä»·æ ¼æ•°æ®è¿ç§»åˆ°ç›¸åº”çš„å­—æ®µ

2. **æ›´æ–°å‰ç«¯ç•Œé¢**
   - åœ¨äº§å“ç®¡ç†é¡µé¢æ·»åŠ å®šä»·æ¨¡å¼é€‰æ‹©å™¨
   - æ ¹æ®é€‰æ‹©çš„æ¨¡å¼æ˜¾ç¤ºä¸åŒçš„ä»·æ ¼è¾“å…¥è¡¨å•

3. **æ›´æ–° API æ–‡æ¡£**
   - è®°å½•æ–°çš„å­—æ®µå’Œè¡Œä¸º
   - æä¾›ç¤ºä¾‹è¯·æ±‚å’Œå“åº”

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2ä¸ªæœˆï¼‰

1. **ä»·æ ¼å¯è§†åŒ–**
   - åœ¨å‰ç«¯å±•ç¤ºä»·æ ¼æ¡£ä½å›¾è¡¨
   - æ˜¾ç¤ºä»·æ ¼è¶‹åŠ¿å’Œä¼˜æƒ å¹…åº¦

2. **æ‰¹é‡ä»·æ ¼ç®¡ç†**
   - æ”¯æŒæ‰¹é‡æ›´æ–°äº§å“ä»·æ ¼
   - æ”¯æŒæŒ‰æ¯”ä¾‹è°ƒæ•´ä»·æ ¼æ¡£ä½

3. **ä»·æ ¼å†å²è®°å½•**
   - è®°å½•ä»·æ ¼å˜æ›´å†å²
   - æ”¯æŒä»·æ ¼å›æ»š

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡å‡çº§æˆåŠŸå®ç°äº†ï¼š

âœ… **çµæ´»çš„å®šä»·æœºåˆ¶** - æ”¯æŒå›ºå®šä»·æ ¼å’Œé˜¶æ¢¯ä»·æ ¼ä¸¤ç§æ¨¡å¼  
âœ… **æ¸…æ™°çš„æ¨¡å‹è®¾è®¡** - é€šè¿‡ `pricing_model` å­—æ®µæ˜ç¡®åŒºåˆ†å®šä»·æ¨¡å¼  
âœ… **å®Œæ•´çš„æ•°æ®éªŒè¯** - ç¡®ä¿ä»·æ ¼æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§  
âœ… **å‘åå…¼å®¹æ€§** - ä¿ç•™æ—§å­—æ®µï¼Œæ”¯æŒç°æœ‰æ•°æ®  
âœ… **æ˜“äºä½¿ç”¨çš„ API** - ç»Ÿä¸€çš„æ–¹æ³•æ¥å£ï¼Œè‡ªåŠ¨å¤„ç†ä¸¤ç§æ¨¡å¼  

ç°åœ¨ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸åŒäº§å“çš„ç‰¹ç‚¹ï¼Œçµæ´»é€‰æ‹©åˆé€‚çš„å®šä»·æ–¹å¼ï¼Œæ—¢æ”¯æŒç®€å•çš„å›ºå®šä»·æ ¼ï¼Œä¹Ÿæ”¯æŒå¤æ‚çš„é˜¶æ¢¯å®šä»·ç­–ç•¥ã€‚

---

**å‡çº§å®Œæˆæ—¥æœŸ**: 2025-10-28  
**å‡çº§è´Ÿè´£äºº**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸  
**ç‰ˆæœ¬**: 2.0.0

