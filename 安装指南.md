# C-MAX 执行器选型系统 - 安装指南

本指南将帮助您在本地机器上运行该应用程序。

## 环境要求

在开始之前，请确保已安装以下软件：

- **Node.js** (v16 或更高版本) - [下载地址](https://nodejs.org/)
- **MongoDB** (v5 或更高版本) - [下载地址](https://www.mongodb.com/try/download/community)
- **npm** 或 **yarn** - Node.js 自带
- **Git** - [下载地址](https://git-scm.com/)

## 安装步骤

### 1. 进入项目目录

项目已设置在：
```bash
cd "/Users/hexiaoxiao/Desktop/Model Selection System"
```

### 2. 后端设置

#### 安装后端依赖

```bash
cd backend
npm install
```

#### 配置环境变量

在 `backend` 目录下创建 `.env` 文件：

```bash
cp .env.example .env
```

编辑 `.env` 文件，配置如下：

```env
PORT=5000
MONGODB_URI=mongodb://localhost:27017/cmax-actuators
JWT_SECRET=请修改为强密码_生产环境必须更改
JWT_EXPIRE=7d
NODE_ENV=development
FRONTEND_URL=http://localhost:5173
```

**重要提示：** 在生产环境中，请将 `JWT_SECRET` 更改为强且唯一的值！

#### 启动 MongoDB

确保 MongoDB 在您的系统上运行：

**macOS (使用 Homebrew)：**
```bash
brew services start mongodb-community
```

**Linux：**
```bash
sudo systemctl start mongod
```

**Windows：**
如果作为服务安装，MongoDB 应该会自动启动。否则运行：
```bash
"C:\Program Files\MongoDB\Server\7.0\bin\mongod.exe"
```

#### 初始化数据库

使用示例数据填充数据库：

```bash
npm run seed
```

这将创建：
- 3 个示例用户（管理员、工程师、销售经理）
- 5 个示例产品
- 5 个示例配件

#### 启动后端服务器

```bash
npm run dev
```

后端 API 将在 `http://localhost:5000` 上运行

您应该看到：
```
╔════════════════════════════════════════════════════════╗
║   C-MAX 执行器选型系统 - 后端 API                       ║
║   环境: development                                    ║
║   服务器运行在端口 5000                                 ║
║   API: http://localhost:5000                           ║
╚════════════════════════════════════════════════════════╝
```

### 3. 前端设置

打开新的终端窗口/标签。

#### 安装前端依赖

```bash
cd frontend
npm install
```

#### 配置环境变量

在 `frontend` 目录下创建 `.env` 文件：

```env
VITE_API_URL=http://localhost:5000/api
```

#### 启动前端开发服务器

```bash
npm run dev
```

前端将在 `http://localhost:5173` 上运行

您应该看到：
```
  VITE v5.0.0  准备就绪，用时 XXX ms

  ➜  本地:   http://localhost:5173/
  ➜  网络: 使用 --host 暴露
  ➜  按 h 显示帮助
```

## 访问应用程序

1. 打开网络浏览器，访问：`http://localhost:5173`

2. 使用以下演示账号登录：

### 管理员账号
- **邮箱：** admin@cmax.com
- **密码：** admin123
- **权限：** 完全系统访问权限，包括管理面板

### 工程师账号
- **邮箱：** john@cmax.com
- **密码：** engineer123
- **权限：** 项目管理和技术功能

### 销售经理账号
- **邮箱：** sarah@cmax.com
- **密码：** sales123
- **权限：** 报价和初步定价

## 验证安装

### 测试后端 API

在浏览器中访问 `http://localhost:5000/api/health`。您应该看到：

```json
{
  "status": "OK",
  "message": "C-MAX 执行器选型系统 API 正在运行",
  "timestamp": "2025-10-26T..."
}
```

### 测试前端

1. 访问 `http://localhost:5173`
2. 您应该看到登录页面
3. 使用任一演示账号登录
4. 您应该被重定向到仪表板

## 常见问题和解决方案

### MongoDB 连接错误

**错误：** `MongoServerError: connect ECONNREFUSED`

**解决方案：** 确保 MongoDB 正在运行：
```bash
# 检查 MongoDB 是否运行
mongosh

# 如果未运行，启动它
brew services start mongodb-community  # macOS
sudo systemctl start mongod           # Linux
```

### 端口已被占用

**错误：** `EADDRINUSE: address already in use :::5000`

**解决方案：** 
1. 查找并终止使用该端口的进程：
```bash
# macOS/Linux
lsof -i :5000
kill -9 <PID>

# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F
```

2. 或在 `backend/.env` 中更改端口

### 前端无法连接后端

**错误：** 网络错误或 CORS 问题

**解决方案：**
1. 验证后端在端口 5000 上运行
2. 检查 `frontend/.env` 是否有正确的 API URL
3. 验证 `backend/.env` 是否有正确的 FRONTEND_URL

### 模块未找到错误

**解决方案：** 清除 node_modules 并重新安装：
```bash
# 后端
cd backend
rm -rf node_modules package-lock.json
npm install

# 前端
cd ../frontend
rm -rf node_modules package-lock.json
npm install
```

## 开发工作流程

### 后端开发

后端使用 **nodemon** 进行自动重载。对后端文件的任何更改都将自动重启服务器。

### 前端开发

Vite 提供热模块替换（HMR）。对 React 组件的更改将立即更新，无需刷新页面。

### 测试 API 端点

使用以下工具：
- **Postman** - [下载](https://www.postman.com/downloads/)
- **Thunder Client** - VS Code 扩展
- **curl** - 命令行工具

API 测试示例：
```bash
# 登录
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@cmax.com","password":"admin123"}'

# 获取产品（使用认证令牌）
curl -X GET http://localhost:5000/api/products \
  -H "Authorization: Bearer 您的令牌"
```

## 生产环境构建

### 后端

```bash
cd backend
npm start
```

### 前端

```bash
cd frontend
npm run build
```

生产构建将在 `frontend/dist/` 目录中

预览生产构建：
```bash
npm run preview
```

## 其他资源

- **MongoDB 文档：** https://docs.mongodb.com/
- **Express.js 指南：** https://expressjs.com/
- **React 文档：** https://react.dev/
- **Ant Design 组件：** https://ant.design/components/
- **Vite 指南：** https://vitejs.dev/guide/

## 技术支持

如有问题：
1. 检查浏览器控制台中的错误消息（按 F12）
2. 检查终端输出的后端错误
3. 查看 MongoDB 日志
4. 确保所有依赖项已正确安装

## 下一步

1. ✅ 按照上述步骤完成设置
2. ✅ 熟悉演示数据
3. ✅ 探索管理面板（以管理员身份登录）
4. ✅ 尝试使用不同参数的选型引擎
5. ✅ 创建测试项目并生成报价
6. ✅ 从管理面板使用 Excel 模板导入产品

祝您使用愉快！🚀


