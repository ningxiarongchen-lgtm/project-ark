# ğŸ—„ï¸ æ•°æ®åº“é…ç½®è¯´æ˜
## Database Configuration Guide

**æ›´æ–°æ—¥æœŸ**: 2025-10-30

---

## ğŸ“‹ æ•°æ®åº“åç§°ç»Ÿä¸€

### âœ… å·²ç»Ÿä¸€é…ç½®

æ‰€æœ‰æ¼”ç¤ºç›¸å…³çš„é…ç½®ç°å·²ç»Ÿä¸€ä½¿ç”¨ `cmax` æ•°æ®åº“ï¼š

```
æ•°æ®åº“åç§°: cmax
è¿æ¥å­—ç¬¦ä¸²: mongodb://localhost:27017/cmax
```

---

## ğŸ”§ ä¿®æ”¹çš„é…ç½®æ–‡ä»¶

### 1. `backend/config/database.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
// å¼€å‘/ç”Ÿäº§ç¯å¢ƒé»˜è®¤æ•°æ®åº“
dbUri = process.env.MONGODB_URI || 'mongodb://localhost:27017/cmax';
```

**è¯´æ˜**: ç³»ç»Ÿé»˜è®¤è¿æ¥åˆ° `cmax` æ•°æ®åº“

---

### 2. `backend/seed_final_acceptance.js`

**ä¿®æ”¹å†…å®¹**:
```javascript
// æ•°æ®åˆå§‹åŒ–è„šæœ¬é»˜è®¤æ•°æ®åº“
const mongoUri = process.env.MONGO_URI || 
                 process.env.MONGODB_URI || 
                 'mongodb://localhost:27017/cmax';
```

**è¯´æ˜**: æ¼”ç¤ºæ•°æ®å°†è¢«åˆå§‹åŒ–åˆ° `cmax` æ•°æ®åº“

---

### 3. `æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh`

**ä¿®æ”¹å†…å®¹**:
```bash
# å¯åŠ¨æ—¶è®¾ç½®ç¯å¢ƒå˜é‡
MONGODB_URI=mongodb://localhost:27017/cmax NODE_ENV=development npm start
```

**è¯´æ˜**: å¯åŠ¨è„šæœ¬æ˜ç¡®æŒ‡å®šä½¿ç”¨ `cmax` æ•°æ®åº“

---

### 4. `backend/.env.demo`

**æ–°å¢æ–‡ä»¶**:
```env
MONGODB_URI=mongodb://localhost:27017/cmax
```

**è¯´æ˜**: æ¼”ç¤ºç¯å¢ƒé…ç½®æ¨¡æ¿

---

## ğŸ“Š æ•°æ®åº“ä½¿ç”¨åœºæ™¯

### å¼€å‘/æ¼”ç¤ºç¯å¢ƒ
```
æ•°æ®åº“åç§°: cmax
ç”¨é€”: æ—¥å¸¸å¼€å‘ã€å®¢æˆ·æ¼”ç¤ºã€ç³»ç»Ÿæµ‹è¯•
```

### æµ‹è¯•ç¯å¢ƒ
```
æ•°æ®åº“åç§°: cmax_test
ç”¨é€”: è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆè‡ªåŠ¨æ·»åŠ  _test åç¼€ï¼‰
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šä½¿ç”¨æ¼”ç¤ºå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
bash æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
```

**è‡ªåŠ¨é…ç½®**:
- âœ… è‡ªåŠ¨è®¾ç½® MONGODB_URI=mongodb://localhost:27017/cmax
- âœ… è‡ªåŠ¨åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®åˆ° cmax æ•°æ®åº“
- âœ… æ— éœ€æ‰‹åŠ¨é…ç½®

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

**1. é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `backend/.env` æ–‡ä»¶ï¼š
```bash
cd backend
cp .env.demo .env
```

æˆ–æ‰‹åŠ¨åˆ›å»ºåŒ…å«ä»¥ä¸‹å†…å®¹çš„ `.env` æ–‡ä»¶ï¼š
```env
NODE_ENV=development
PORT=5001
MONGODB_URI=mongodb://localhost:27017/cmax
JWT_SECRET=your-secret-key
FRONTEND_URL=http://localhost:5173
```

**2. åˆå§‹åŒ–æ•°æ®**

```bash
cd backend
npm run seed:final
```

**3. å¯åŠ¨æœåŠ¡**

```bash
# åç«¯
cd backend
npm start

# å‰ç«¯
cd frontend
npm run dev
```

---

## ğŸ” éªŒè¯æ•°æ®åº“

### æ£€æŸ¥å½“å‰æ•°æ®åº“

```bash
# è¿æ¥åˆ° MongoDB
mongosh

# åˆ‡æ¢åˆ° cmax æ•°æ®åº“
use cmax

# æŸ¥çœ‹æ‰€æœ‰é›†åˆ
show collections

# æŸ¥çœ‹ç”¨æˆ·æ•°é‡
db.users.countDocuments()

# æŸ¥çœ‹æ‰§è¡Œå™¨æ•°é‡
db.actuators.countDocuments()

# æŸ¥çœ‹é¡¹ç›®æ•°é‡
db.newprojects.countDocuments()
```

### é¢„æœŸç»“æœ

æ¼”ç¤ºæ•°æ®åˆå§‹åŒ–åï¼Œcmax æ•°æ®åº“åº”åŒ…å«ï¼š

```
âœ… ç”¨æˆ· (users): 10 ä¸ªæµ‹è¯•è´¦å·
âœ… ä¾›åº”å•† (suppliers): 5 ä¸ª
âœ… æ‰§è¡Œå™¨å‹å· (actuators): 55 ä¸ª
âœ… æ‰‹åŠ¨æ“ä½œè£…ç½® (manualoverrides): 4 ä¸ª
âœ… é…ä»¶ (accessories): 8 ä¸ª
âœ… ç¤ºä¾‹é¡¹ç›® (newprojects): 4 ä¸ª
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### cmax æ•°æ®åº“åŒ…å«çš„é›†åˆ

| é›†åˆåç§° | è¯´æ˜ | æ•°é‡ |
|---------|------|------|
| users | ç”¨æˆ·è´¦å· | 10 |
| suppliers | ä¾›åº”å•† | 5 |
| actuators | æ‰§è¡Œå™¨å‹å· | 55 |
| accessories | é…ä»¶ | 8 |
| manualoverrides | æ‰‹åŠ¨æ“ä½œè£…ç½® | 4 |
| newprojects | æ–°é¡¹ç›® | 4 |
| salesorders | é”€å”®è®¢å• | 0-N |
| productionorders | ç”Ÿäº§è®¢å• | 0-N |
| purchaseorders | é‡‡è´­è®¢å• | 0-N |
| servicetickets | å”®åå·¥å• | 0-N |
| qualitychecks | è´¨æ£€è®°å½• | 0-N |
| workorders | å·¥ä½œå• | 0-N |

---

## ğŸ”„ æ•°æ®é‡ç½®

### é‡æ–°åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®

å¦‚æœéœ€è¦é‡ç½®æ•°æ®åº“åˆ°åˆå§‹çŠ¶æ€ï¼š

```bash
cd backend
npm run seed:final
```

**æ³¨æ„**: æ­¤æ“ä½œä¼šï¼š
- âŒ æ¸…ç©º cmax æ•°æ®åº“çš„æ‰€æœ‰ç°æœ‰æ•°æ®
- âœ… é‡æ–°åˆ›å»ºæ¼”ç¤ºæ•°æ®

---

## ğŸ›¡ï¸ æ•°æ®å®‰å…¨

### å¼€å‘/æ¼”ç¤ºç¯å¢ƒ
- ä½¿ç”¨ `cmax` æ•°æ®åº“
- åŒ…å«æµ‹è¯•æ•°æ®
- å¯ä»¥éšæ—¶é‡ç½®

### ç”Ÿäº§ç¯å¢ƒå»ºè®®
- ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“åç§°ï¼ˆå¦‚ `cmax_production`ï¼‰
- ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ `MONGODB_URI`
- ä½¿ç”¨å¼ºå¯†ç å’Œè®¿é—®æ§åˆ¶
- å®šæœŸå¤‡ä»½æ•°æ®

---

## ğŸ“ ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§

ç³»ç»ŸæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è¯»å–æ•°æ®åº“é…ç½®ï¼š

1. **ç¯å¢ƒå˜é‡** `MONGODB_URI` ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. **ç¯å¢ƒå˜é‡** `MONGO_URI`
3. **é»˜è®¤å€¼** `mongodb://localhost:27017/cmax`

**ç¤ºä¾‹**:
```bash
# ä¸´æ—¶ä½¿ç”¨å…¶ä»–æ•°æ®åº“
MONGODB_URI=mongodb://localhost:27017/test npm start

# æ°¸ä¹…é…ç½®ï¼ˆåœ¨ .env æ–‡ä»¶ä¸­ï¼‰
MONGODB_URI=mongodb://localhost:27017/cmax
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `MongoDB Connection Error`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ MongoDB æ˜¯å¦è¿è¡Œ
brew services list | grep mongodb

# å¯åŠ¨ MongoDB
brew services start mongodb-community

# éªŒè¯è¿æ¥
mongosh --eval "db.adminCommand('ping')"
```

---

### é—®é¢˜2: æ•°æ®ä¸ºç©º

**ç—‡çŠ¶**: ç™»å½•åçœ‹ä¸åˆ°é¡¹ç›®æˆ–æ•°æ®

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°åˆå§‹åŒ–æ•°æ®
cd backend
npm run seed:final

# åˆ·æ–°æµè§ˆå™¨
```

---

### é—®é¢˜3: æ•°æ®åº“åç§°ä¸ä¸€è‡´

**ç—‡çŠ¶**: æ•°æ®ä¿å­˜åˆ°äº†å…¶ä»–æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat backend/.env | grep MONGODB_URI

# ç¡®ä¿è®¾ç½®ä¸º cmax
echo "MONGODB_URI=mongodb://localhost:27017/cmax" > backend/.env

# æˆ–ä½¿ç”¨æ¼”ç¤ºå¯åŠ¨è„šæœ¬
bash æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
```

---

## ğŸ“– ç›¸å…³å‘½ä»¤

### MongoDB å¸¸ç”¨å‘½ä»¤

```bash
# è¿æ¥åˆ° MongoDB
mongosh

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
show dbs

# åˆ‡æ¢æ•°æ®åº“
use cmax

# æŸ¥çœ‹å½“å‰æ•°æ®åº“
db.getName()

# æŸ¥çœ‹æ‰€æœ‰é›†åˆ
show collections

# æŸ¥çœ‹é›†åˆæ•°æ®
db.users.find().pretty()

# ç»Ÿè®¡æ–‡æ¡£æ•°é‡
db.users.countDocuments()

# åˆ é™¤æ•°æ®åº“ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
db.dropDatabase()
```

---

## ğŸ¯ æ€»ç»“

âœ… **æ‰€æœ‰æ¼”ç¤ºæ•°æ®ç»Ÿä¸€ä¿å­˜åœ¨ `cmax` æ•°æ®åº“**

âœ… **é…ç½®æ–‡ä»¶å·²å…¨éƒ¨æ›´æ–°**:
- backend/config/database.js
- backend/seed_final_acceptance.js
- æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
- backend/.env.demo

âœ… **ä½¿ç”¨æ¼”ç¤ºå¯åŠ¨è„šæœ¬è‡ªåŠ¨é…ç½®**:
```bash
bash æ¼”ç¤ºç¯å¢ƒå¯åŠ¨.sh
```

âœ… **æ•°æ®å¯éšæ—¶é‡ç½®**:
```bash
npm run seed:final
```

---

**ç»´æŠ¤è€…**: Project Ark Team  
**æ›´æ–°æ—¥æœŸ**: 2025-10-30

---

Â© 2025 Project Ark Team. All Rights Reserved.

