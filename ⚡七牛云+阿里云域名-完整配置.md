# ⚡ 七牛云 + 阿里云域名 - 完整配置指南

## 🎯 总体流程（10分钟完成）

```
第1步：七牛云绑定子域名 (2分钟)
    ↓
第2步：获取CNAME地址 (立即)
    ↓
第3步：阿里云配置DNS (3分钟)
    ↓
第4步：等待生效 (5-10分钟)
    ↓
第5步：测试访问 (立即)
```

---

## 第1步：七牛云绑定子域名

### 在当前七牛云页面：

1. **将域名修改为：**
   ```
   cdn.project-ark.com.cn
   ```

2. **配置保持不变：**
   ```
   ✅ 通信协议：HTTP（先用HTTP，后面可以升级HTTPS）
   ✅ 覆盖范围：中国大陆
   ✅ 使用场景：下载分发
   ✅ IP协议：IPv4 / IPv6
   ✅ 源站配置：七牛云存储
   ```

3. **点击"创建"按钮**

### 创建成功后会显示：

```
✅ 域名创建成功！

CNAME地址：cdn.project-ark.com.cn.qiniudns.com
（或类似格式的地址）
```

📋 **重要！复制这个CNAME地址，下一步要用！**

---

## 第2步：阿里云DNS配置（详细步骤）

### 2.1 登录阿里云控制台

1. **访问：** https://www.aliyun.com
2. **点击右上角"控制台"**
3. **登录您的阿里云账号**

### 2.2 进入域名管理

1. **在控制台搜索框输入：** `域名`
2. **或：** 左侧菜单 → 产品与服务 → 域名
3. **点击"域名列表"**
4. **找到您的域名：** `project-ark.com.cn`

### 2.3 添加DNS解析记录

1. **点击域名右侧的"解析"按钮**

2. **点击"添加记录"按钮**

3. **填写记录信息：**

   ```
   记录类型：CNAME
   （从下拉菜单选择 CNAME）
   
   主机记录：cdn
   （只填写 cdn，不要填写完整域名）
   
   解析线路：默认
   （保持默认即可）
   
   记录值：[粘贴七牛云返回的CNAME地址]
   （例如：cdn.project-ark.com.cn.qiniudns.com）
   
   TTL：10 分钟
   （或选择默认的10分钟）
   ```

4. **点击"确认"按钮**

### 2.4 配置完成

✅ 您会看到新增的记录：

```
主机记录    记录类型    记录值
cdn         CNAME      cdn.project-ark.com.cn.qiniudns.com
```

---

## 第3步：返回七牛云检查状态

### 在七牛云控制台：

1. **对象存储 → smart-system-overseas2 → 域名管理**

2. **查看域名状态：**
   ```
   域名：cdn.project-ark.com.cn
   状态：配置中... → 等待CNAME生效
   ```

3. **大约5-10分钟后：**
   ```
   状态：✅ 正常
   ```

---

## 第4步：测试访问

### 4.1 等待DNS生效（5-10分钟）

**检查DNS是否生效：**

在您的电脑终端执行：
```bash
# Mac/Linux
dig cdn.project-ark.com.cn

# Windows PowerShell
nslookup cdn.project-ark.com.cn
```

如果看到返回了七牛云的CNAME地址，说明DNS已生效！

### 4.2 访问您的网站

**浏览器访问：**
```
http://cdn.project-ark.com.cn/index.html
```

✅ **如果能看到您的智能制造系统登录页面，说明配置成功！**

### 4.3 手机测试

1. 打开手机浏览器
2. 访问：`http://cdn.project-ark.com.cn/index.html`
3. 应该能正常显示，没有乱码

---

## 🎉 配置成功后的优化

### 优化1：配置HTTPS（推荐）

**在七牛云控制台：**

1. **域名管理 → 点击 cdn.project-ark.com.cn**

2. **HTTPS配置 → 申请免费证书**
   ```
   证书来源：免费证书
   域名：cdn.project-ark.com.cn
   ```

3. **等待证书签发**（约5分钟）

4. **开启强制HTTPS**

5. **访问地址变为：**
   ```
   https://cdn.project-ark.com.cn/index.html
   ```

### 优化2：配置默认首页（可选）

由于是SPA应用，可能需要配置：

1. **在七牛云"域名管理" → "高级配置"**
2. **配置错误页面** → 404错误返回 index.html

### 优化3：刷新CDN缓存

**每次更新文件后：**

```bash
# 如果安装了qshell
qshell cdnrefresh https://cdn.project-ark.com.cn/
```

或在七牛云控制台：
```
CDN → 刷新预热 → 输入URL刷新
```

---

## 📋 完整配置截图参考

### 阿里云DNS配置应该是这样：

```
┌─────────────────────────────────────────────────────────────┐
│ 域名解析列表                                                   │
├──────────┬────────┬──────────────────────────────────────────┤
│ 主机记录  │ 类型   │ 记录值                                     │
├──────────┼────────┼──────────────────────────────────────────┤
│ @        │ A      │ 你的服务器IP（如果有）                       │
│ www      │ CNAME  │ @（如果有）                                 │
│ cdn      │ CNAME  │ cdn.project-ark.com.cn.qiniudns.com      │ ← 新增
└──────────┴────────┴──────────────────────────────────────────┘
```

---

## ❓ 常见问题

### Q1: DNS配置后多久生效？

**A:** 
- 正常情况：5-10分钟
- 最长可能：24小时（极少见）
- 可以用 `dig` 或 `nslookup` 命令检查

### Q2: 显示"CNAME冲突"怎么办？

**A:** 
- 检查是否已经存在 `cdn` 这个主机记录
- 如果存在，可以改用其他名称：
  - `static.project-ark.com.cn`
  - `assets.project-ark.com.cn`
  - `files.project-ark.com.cn`

### Q3: 阿里云提示"与已有记录冲突"？

**A:**
- 说明 `cdn` 这个主机记录已经存在
- 可以：
  1. 删除旧记录，添加新记录
  2. 或使用其他主机记录名称

### Q4: 能直接绑定主域名吗？

**A:**
- 技术上可以，但**不推荐**
- 主域名通常用于：
  - 官网
  - 企业邮箱
  - 其他核心服务
- CDN/静态资源应该用子域名

### Q5: HTTP和HTTPS可以同时用吗？

**A:**
- 可以
- 配置HTTPS后，建议开启"强制HTTPS"
- 这样HTTP会自动跳转到HTTPS

---

## 🎯 配置检查清单

配置完成后，检查以下项目：

- [ ] 七牛云域名状态为"正常"
- [ ] 阿里云DNS记录已添加
- [ ] `dig cdn.project-ark.com.cn` 返回正确CNAME
- [ ] 浏览器能访问 `http://cdn.project-ark.com.cn/index.html`
- [ ] 页面显示正常，无乱码
- [ ] 手机访问正常
- [ ] （可选）HTTPS配置完成
- [ ] （可选）强制HTTPS已开启

---

## 💰 费用说明

### 阿里云域名费用：
```
已支付（域名注册费）
.com.cn 域名：约 ￥29-39/年
```

### 七牛云CDN费用：
```
完全免费（免费额度内）
- 存储：10GB
- 流量：10GB/月
- 您的使用量：约 2-5GB/月 ✅
```

### DNS解析费用：
```
阿里云DNS：免费
- 免费版支持基本解析
```

---

## 🚀 下一步操作

配置成功后：

### 1. 更新前端API配置

如果需要前端连接后端，更新配置：

```javascript
// frontend/.env.production
VITE_API_URL=https://你的后端地址
```

### 2. 分享给团队

```
访问地址：http://cdn.project-ark.com.cn/index.html

测试账号：
手机号：13800000000
密码：admin123
```

### 3. 配置监控（可选）

使用 UptimeRobot 监控：
- https://uptimerobot.com
- 免费监控50个网址
- 每5分钟检查一次

---

## 📞 需要帮助？

如果遇到问题：

### 七牛云相关：
- 客服：400-808-9176
- 在线客服：七牛云控制台右下角

### 阿里云相关：
- 客服：95187
- 工单系统：阿里云控制台 → 工单

### 或者：
**随时告诉我遇到的问题，我会帮您解决！** 🚀

---

## ✅ 成功标志

当您看到：
1. ✅ 七牛云域名状态"正常"
2. ✅ 浏览器能访问 `http://cdn.project-ark.com.cn/index.html`
3. ✅ 页面显示完整，无乱码
4. ✅ 手机访问正常

**恭喜！配置完全成功！** 🎉

---

**现在开始配置吧！有任何问题随时问我！** 💪

