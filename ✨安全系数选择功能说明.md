# ✨ 安全系数选择功能说明

**日期**: 2025-11-06  
**功能**: 支持用户自定义安全系数  
**状态**: ✅ 已部署

---

## 📋 功能概述

### 原有逻辑
- 安全系数固定为 **1.3**
- 用户无法调整
- 不能满足特殊工况需求

### 新增功能
- ✅ **单个选型**：添加安全系数下拉选择框
- ✅ **批量选型**：每行可独立设置安全系数
- ✅ **默认值**：1.3（推荐值）
- ✅ **可选范围**：1.0, 1.2, 1.3, 1.5, 1.8, 2.0
- ✅ **智能提示**：显示安全系数的作用和计算公式

---

## 🎯 安全系数选项说明

| 安全系数 | 说明 | 适用场景 |
|---------|------|---------|
| **1.0** | 无安全裕量 | 精确匹配，无额外安全余量 |
| **1.2** | 标准 | 一般工况，标准安全要求 |
| **1.3** | 推荐（默认） | 推荐值，大多数应用场景 |
| **1.5** | 高安全要求 | 重要工况，需要更高安全裕量 |
| **1.8** | 极高安全要求 | 关键应用，极高可靠性要求 |
| **2.0** | 最高安全要求 | 最严苛工况，最大安全裕量 |

---

## 💡 计算逻辑

### 公式
```
实际需求扭矩 = 阀门扭矩 × 安全系数
```

### 示例

#### 示例1：标准工况（安全系数 1.3）
- 阀门扭矩：100 Nm
- 安全系数：1.3
- **实际需求扭矩** = 100 × 1.3 = **130 Nm**

#### 示例2：高安全要求（安全系数 1.5）
- 阀门扭矩：100 Nm
- 安全系数：1.5
- **实际需求扭矩** = 100 × 1.5 = **150 Nm**

#### 示例3：精确匹配（安全系数 1.0）
- 阀门扭矩：100 Nm
- 安全系数：1.0
- **实际需求扭矩** = 100 × 1.0 = **100 Nm**

---

## 🖥️ 界面说明

### 单个选型界面

在"执行器选型参数"面板的"基本参数"部分：

```
┌─────────────────────────────────┐
│ 安全系数                         │
│ ┌─────────────────────────────┐ │
│ │ 1.3 (推荐，默认)            ▼│ │
│ └─────────────────────────────┘ │
│ ⓘ 安全系数用于计算执行器实际    │
│   需求扭矩。默认1.3，特殊要求   │
│   可调整。实际需求 = 阀门扭矩 × │
│   安全系数                       │
└─────────────────────────────────┘
```

**下拉选项**:
- 1.0 (无安全裕量)
- 1.2 (标准)
- 1.3 (推荐，默认) ← 默认选中
- 1.5 (高安全要求)
- 1.8 (极高安全要求)
- 2.0 (最高安全要求)

### 批量选型界面

在批量选型表格中，增加"安全系数"列：

```
┌────────┬────────────┬───────────┬────────────┬──────────┐
│ 位号   │ 需求扭矩   │ 安全系数  │ 工作压力   │ ...      │
├────────┼────────────┼───────────┼────────────┼──────────┤
│ FV-101 │ 100 Nm     │ 1.3 ▼     │ 0.4 MPa ▼  │ ...      │
├────────┼────────────┼───────────┼────────────┼──────────┤
│ FV-102 │ 150 Nm     │ 1.5 ▼     │ 0.5 MPa ▼  │ ...      │
└────────┴────────────┴───────────┴────────────┴──────────┘
```

每行可独立设置不同的安全系数。

---

## 📝 使用指南

### 场景1：标准工况（使用默认值）

1. 打开选型界面
2. 保持"安全系数"默认值 **1.3**
3. 填写其他参数
4. 点击"查找匹配执行器"

### 场景2：高安全要求工况

**适用情况**：
- 关键控制点
- 高温高压环境
- 频繁启闭场合
- 重要安全设备

**操作步骤**：
1. 打开选型界面
2. 将"安全系数"改为 **1.5** 或 **1.8**
3. 填写其他参数
4. 点击"查找匹配执行器"

### 场景3：精确匹配（无额外裕量）

**适用情况**：
- 空间受限
- 预算严格
- 扭矩计算已包含安全裕量

**操作步骤**：
1. 打开选型界面
2. 将"安全系数"改为 **1.0**
3. 填写其他参数
4. 点击"查找匹配执行器"

### 场景4：批量选型（不同安全系数）

**适用情况**：
- 多个阀门位号
- 不同重要程度
- 不同工况条件

**操作步骤**：
1. 打开"批量选型"标签
2. 点击"添加行"
3. 为每行单独设置安全系数：
   - 关键位号：1.5 或 1.8
   - 普通位号：1.3（默认）
   - 非关键位号：1.2
4. 点击"开始批量选型"

---

## 🔧 技术实现

### 前端
- **文件**: `frontend/src/pages/SelectionEngine.jsx`
- **单个选型**: 新增`safetyFactor`表单字段
- **批量选型**: 新增`safetyFactor`表格列
- **默认值**: 1.3
- **初始值设置**: 
  ```javascript
  initialValues={{
    safetyFactor: 1.3 // 默认安全系数
  }}
  ```

### 后端
- **文件**: `backend/controllers/selectionController.js`
- **参数接收**: `safetyFactor = 1.3`
- **兼容性**: 同时支持`safetyFactor`和`safety_factor`
- **验证**: 已内置支持，无需额外修改

### API参数
```javascript
POST /api/selection/calculate
{
  "required_torque": 100,
  "safetyFactor": 1.5,  // ← 新增参数
  "working_pressure": 0.4,
  "mechanism": "Scotch Yoke",
  "valve_type": "Ball Valve",
  // ... 其他参数
}
```

---

## ✅ 验证测试

### 测试1: 默认安全系数（1.3）
- **输入**: 阀门扭矩 100 Nm，不修改安全系数
- **预期**: 匹配扭矩 ≥ 130 Nm 的执行器
- **状态**: ✅ 通过

### 测试2: 高安全系数（1.5）
- **输入**: 阀门扭矩 100 Nm，安全系数改为 1.5
- **预期**: 匹配扭矩 ≥ 150 Nm 的执行器
- **状态**: ✅ 通过

### 测试3: 无安全裕量（1.0）
- **输入**: 阀门扭矩 100 Nm，安全系数改为 1.0
- **预期**: 匹配扭矩 ≥ 100 Nm 的执行器
- **状态**: ✅ 通过

### 测试4: 批量选型（混合安全系数）
- **输入**: 
  - FV-101: 100 Nm, 安全系数 1.3
  - FV-102: 150 Nm, 安全系数 1.5
- **预期**: 
  - FV-101: 匹配 ≥ 130 Nm
  - FV-102: 匹配 ≥ 225 Nm
- **状态**: ✅ 通过

---

## 📊 使用建议

### 推荐配置

| 应用场景 | 推荐安全系数 | 说明 |
|---------|-------------|------|
| 一般工业用途 | 1.3 | 默认值，适用于大多数场景 |
| 关键控制点 | 1.5 | 增加可靠性裕量 |
| 高温/高压环境 | 1.5 - 1.8 | 考虑环境影响 |
| 频繁启闭 | 1.5 | 考虑磨损因素 |
| 安全联锁 | 1.8 - 2.0 | 最高安全要求 |
| 精确测试 | 1.0 - 1.2 | 已知准确扭矩值 |

### 注意事项

⚠️ **选择过小的安全系数**：
- 可能导致执行器扭矩不足
- 阀门无法正常开关
- 设备可能过载

⚠️ **选择过大的安全系数**：
- 可能选择过大的执行器
- 增加成本和空间占用
- 可能超出实际需求

💡 **最佳实践**：
- 除非有特殊要求，建议使用默认值 **1.3**
- 不确定时，宁可选择较大的安全系数
- 关键应用咨询技术支持

---

## 🚀 部署信息

- **Git Commit**: `2442133ab`
- **部署地址**: https://266e80c4.smart-system.pages.dev
- **部署时间**: 2025-11-06
- **影响范围**: 
  - ✅ 单个选型页面
  - ✅ 批量选型页面
  - ✅ 选型计算逻辑

---

## 📞 技术支持

如有疑问或需要帮助，请联系技术支持团队。

**功能状态**: ✅ 已上线，可正常使用

