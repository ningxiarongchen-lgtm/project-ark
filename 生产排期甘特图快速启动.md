# 生产排期甘特图 - 快速启动指南

## 🚀 快速开始

### 1. 安装新依赖

```bash
cd frontend
npm install gantt-task-react@^0.3.9
```

### 2. 启动系统

```bash
# 终端1 - 启动后端
cd backend
npm start

# 终端2 - 启动前端
cd frontend
npm run dev
```

### 3. 访问页面

打开浏览器访问：`http://localhost:5173/production-schedule`

---

## 📋 快速操作指南

### 场景 1: 查看生产排程甘特图

1. 登录系统（需要以下角色之一）：
   - Administrator
   - Production Planner  
   - Sales Manager

2. 点击左侧菜单 **"生产排期"**

3. 默认显示甘特图视图，可以看到：
   - ✅ 顶部统计卡片（6个指标）
   - ✅ APS排程说明
   - ✅ 筛选工具栏
   - ✅ 交互式甘特图

### 场景 2: 执行 APS 智能排程

**前提条件**: 需要有 Administrator 或 Production Planner 角色

1. 切换到 **"列表视图"** 标签页

2. 找到状态为 **"待生产(Pending)"** 的生产订单

3. 点击该订单行的 **"排程"** 按钮（⚡图标）

4. 在弹出的确认对话框中：
   - 查看生产订单详情
   - 确认无误后点击 **"开始排程"**

5. 等待 3-10 秒，APS 算法执行：
   - BOM物料展开
   - ATP库存检查
   - 采购时间计算
   - 产能分析
   - 智能排程

6. 查看排程结果弹窗：
   ```
   ✓ 总工单数: 12
   ✓ 已排程: 12
   ✓ 总时长: 1440 分钟 (24.0 小时)
   ✓ 最早开始: 2025-01-15 08:00
   ✓ 最晚完成: 2025-01-18 17:00
   ⚠ 物料短缺: 2 项
   ⚠ 产能问题: 1 项
   ```

7. 页面自动刷新，切换回甘特图可查看排程结果

### 场景 3: 使用甘特图交互功能

#### 切换视图模式
点击视图模式下拉框，选择：
- **小时** - 精确到小时的排程（适合短周期）
- **天** - 默认视图（推荐）
- **周** - 周级别排程（适合长周期）
- **月** - 月度总览

#### 筛选工单
1. **按工作中心筛选**
   - 选择特定工作中心（如"装配中心1"）
   - 只显示该工作中心的工单

2. **按状态筛选**
   - 选择工单状态（如"进行中"）
   - 只显示该状态的工单

3. **按日期范围筛选**
   - 选择开始和结束日期
   - 点击"应用筛选"
   - 只显示该时间段的工单

#### 查看工单详情
- **悬浮** - 鼠标悬浮在任务条上，查看快速信息
- **双击** - 双击任务条，打开详情抽屉，查看完整信息

---

## 🎨 甘特图阅读指南

### 颜色含义

| 颜色 | 状态 | 说明 |
|------|------|------|
| 🔵 蓝色 | 进行中 | 正在执行的工单 |
| 🟢 绿色 | 已完成 | 已完成的工单 |
| 🟡 橙色 | 暂停 | 暂停中的工单 |
| 🟣 紫色 | 待质检 | 等待质检的工单 |
| ⚪ 灰色 | 待发布 | 尚未发布的工单 |
| 🔴 红色 | 已取消 | 已取消的工单 |

### 进度条

任务条内的深色进度条表示完成百分比：
- 空白 (0%) = 待开始
- 半满 (50%) = 进行中
- 全满 (100%) = 已完成

### 时间轴

- 横轴显示日期（天/周/月）
- 竖轴显示工单列表
- 红色竖线表示今天

---

## 🔧 常见问题

### Q1: 看不到甘特图数据？

**原因**: 可能没有已排程的工单

**解决方案**:
1. 检查是否有生产订单
2. 为生产订单生成工单（通过 MES 系统）
3. 执行 APS 排程
4. 刷新页面

### Q2: 没有"排程"按钮？

**原因**: 权限不足

**解决方案**:
- 需要 Administrator 或 Production Planner 角色
- 联系管理员分配权限

### Q3: 排程失败？

**可能原因**:
- 生产订单未生成工单
- 缺少工艺路线
- 缺少工作中心

**解决方案**:
1. 检查生产订单详情
2. 确保已生成工单
3. 检查工艺路线配置
4. 检查工作中心设置

### Q4: 甘特图显示不正常？

**解决方案**:
1. 清除浏览器缓存
2. 刷新页面
3. 检查浏览器控制台错误
4. 确保依赖已正确安装

---

## 💡 使用技巧

### 技巧 1: 快速定位延期工单

1. 筛选状态为"进行中"
2. 查看甘特图，红色竖线左侧且未完成的任务即为延期工单

### 技巧 2: 查看工作中心负载

1. 在工作中心下拉框选择特定工作中心
2. 查看该工作中心的任务密度
3. 如果任务重叠或密集，说明负载较高

### 技巧 3: 优化排程

1. 执行 APS 排程后，查看警告信息
2. 如有物料短缺，联系采购部门
3. 如有产能问题，考虑：
   - 增加班次
   - 分配到备用工作中心
   - 调整优先级

### 技巧 4: 批量查看

1. 使用月视图查看整体排程
2. 使用日视图查看详细安排
3. 在列表视图导出数据做进一步分析

---

## 📊 关键指标解读

### 统计卡片

1. **生产订单总数** - 系统中所有生产订单
2. **待生产** - 尚未开始的订单（需执行排程）
3. **已排期** - 已执行 APS 排程的订单
4. **生产中** - 正在执行的订单
5. **已完成** - 完成的订单
6. **平均完成率** - 所有订单的平均进度

### 排程摘要

- **总工单数** - 该生产订单包含的工单数量
- **已排程** - 成功计算时间的工单数
- **总时长** - 所有工单的总工时
- **最早开始** - 第一个工单的开始时间
- **最晚完成** - 最后一个工单的结束时间

---

## 🎯 推荐工作流程

### 每日排程检查（生产计划员）

```
08:00 - 打开生产排期页面
      ↓
      查看统计卡片，了解整体情况
      ↓
      切换到甘特图视图
      ↓
      检查今日和明日的工单安排
      ↓
      识别延期和冲突
      ↓
      必要时执行重新排程
      ↓
      通知相关工作中心
```

### 新订单排程（生产计划员）

```
接收新销售订单
      ↓
创建生产订单
      ↓
生成工单
      ↓
打开生产排期页面
      ↓
在列表视图找到该订单
      ↓
点击"排程"按钮
      ↓
查看 APS 排程结果
      ↓
确认物料和产能
      ↓
在甘特图验证时间安排
      ↓
通知相关部门
```

### 生产监控（生产经理）

```
定期查看甘特图（每日 2-3 次）
      ↓
关注"进行中"工单进度
      ↓
识别延期风险
      ↓
检查资源利用率
      ↓
协调产能和物料
      ↓
必要时调整优先级
```

---

## 🔗 相关页面链接

- **生产订单管理** - `/production`
- **MES 工单管理** - `/mes/work-orders`
- **工作中心管理** - `/mes/work-centers`
- **工艺路线管理** - `/mes/routings`

---

## 📱 移动端使用

目前甘特图主要针对桌面端优化，移动端建议：

1. 使用 **"列表视图"** 标签页
2. 横屏使用以获得更好体验
3. 使用平板设备（iPad 等）效果更佳

---

## ⚙️ 高级配置

### 自定义视图设置（开发人员）

修改 `ProductionGantt.jsx`:

```javascript
// 默认视图模式
const [viewMode, setViewMode] = useState(ViewMode.Day) // 改为 ViewMode.Week

// 列宽
columnWidth={60} // 调整列宽

// 颜色主题
barBackgroundColor="#1890ff" // 修改任务条颜色
```

### APS 排程参数（开发人员）

调用排程 API 时可传入配置：

```javascript
await productionAPI.scheduleProduction(orderId, {
  forceReschedule: false,     // 强制重排
  considerHolidays: true,     // 考虑节假日
  bufferTime: 30,             // 工序间缓冲时间(分钟)
  maxUtilization: 90          // 最大产能利用率(%)
})
```

---

## 🎓 培训建议

### 新用户培训（30分钟）

1. **系统介绍** (5分钟)
   - APS 概念
   - 甘特图作用

2. **界面导航** (10分钟)
   - 统计卡片
   - 甘特图视图
   - 列表视图
   - 筛选工具

3. **基本操作** (10分钟)
   - 查看甘特图
   - 切换视图模式
   - 筛选工单
   - 查看详情

4. **实操练习** (5分钟)
   - 执行一次排程
   - 查看排程结果

### 高级用户培训（1小时）

包含基础培训内容，额外增加：

1. **APS 算法原理** (15分钟)
   - 排程步骤
   - 约束条件
   - 优化策略

2. **高级操作** (20分钟)
   - 复杂筛选
   - 数据分析
   - 问题排查

3. **最佳实践** (10分钟)
   - 工作流程
   - 注意事项
   - 常见错误

---

## 📞 获取帮助

- **技术文档**: 查看《生产排期甘特图功能完成报告.md》
- **API 文档**: 查看《API接口文档.md》
- **问题反馈**: 联系开发团队

---

**祝使用愉快！🎉**

最后更新: 2025-10-28

