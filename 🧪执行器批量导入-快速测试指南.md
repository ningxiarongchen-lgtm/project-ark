# 🧪 执行器批量导入 - 快速测试指南

## ⏰ 测试时机

**请在部署完成后10分钟执行测试**

当前部署时间: 2025年11月7日
预计可测试时间: 部署后10分钟

---

## 🔍 部署状态检查

### 步骤1: 检查GitHub Actions

1. 访问: https://github.com/ningxiarongchen-lgtm/project-ark/actions
2. 查看最新的工作流运行
3. 确认以下两个工作流都显示 ✅ 成功:
   - `Deploy to Render` (后端部署)
   - `Deploy to Cloudflare Pages` (前端部署)

### 步骤2: 检查后端健康

在浏览器或终端中访问:
```bash
curl https://project-ark-efy7.onrender.com/api/health
```

预期响应:
```json
{
  "status": "OK",
  "message": "Server is running"
}
```

### 步骤3: 检查前端访问

访问你的前端URL，确认页面可以正常加载。

---

## ✅ 功能测试步骤

### 测试1: 访问新功能页面

1. 登录系统 (管理员账号)
2. 点击左侧菜单 **数据管理**
3. 检查是否看到 **执行器批量导入** 标签页
4. 点击该标签，应该看到:
   - 统计信息卡片（显示当前数据量）
   - 步骤指示器（0/3 步骤）
   - "下载执行器数据模板"按钮

### 测试2: 下载模板

1. 点击 **下载执行器数据模板** 按钮
2. 检查下载的文件:
   - 文件名: `C-MAX_Actuator_Data_Template.xlsx`
   - 文件大小: 约10-20KB
3. 用Excel打开文件，检查是否包含4个工作表:
   - ✅ Instructions
   - ✅ SF_Data (10列)
   - ✅ AT_Data (4列)
   - ✅ GY_Data (4列)

### 测试3: 测试数据准备

使用下载的模板，填写以下测试数据:

**SF_Data 工作表:**
```
Model           Type  Price  Air_Pressure_bar  SST_Nm  SET_Nm  AST_Nm  AET_Nm  DA_Torque_0deg_Nm  DA_Torque_90deg_Nm
TEST-SF-100DA   DA    5000   6                 (空)    (空)    (空)    (空)    100                150
TEST-SF-100SR   SR    5500   6                 50      100     80      120     (空)               (空)
```

**AT_Data 工作表:**
```
Model           Type  Price  Output_Torque_Nm
TEST-AT-050DA   DA    3000   50
TEST-AT-100SR   SR    3500   100
```

**GY_Data 工作表:**
```
Model           Type  Price  Output_Torque_Nm
TEST-GY-080DA   DA    4000   80
TEST-GY-120SR   SR    4500   120
```

### 测试4: 上传导入（成功场景）

1. 保存填写好的Excel文件
2. 在系统中点击 **选择填写好的Excel文件**
3. 选择刚才保存的文件
4. 检查文件信息显示是否正确
5. 点击 **确认并开始导入**
6. 等待处理完成（约5-10秒）
7. 检查成功消息:
   - ✅ "数据导入成功！"
   - ✅ 显示导入统计（SF: 2条, AT: 2条, GY: 2条）

### 测试5: 验证导入结果

1. 切换到 **执行器管理（高级）** 标签页
2. 在搜索框输入 "TEST-"
3. 检查是否显示6条测试记录
4. 验证数据正确性:
   - SF系列记录的扭矩数据
   - AT系列的材质: "铝合金+硬质氧化"
   - GY系列的材质: "不锈钢"

### 测试6: 错误处理测试

准备一个有错误的Excel文件:

**SF_Data 工作表（故意制造错误）:**
```
Model           Type  Price  Air_Pressure_bar  SST_Nm  SET_Nm  AST_Nm  AET_Nm  DA_Torque_0deg_Nm  DA_Torque_90deg_Nm
TEST-SF-ERROR1  SR    5000   6                 (空)    (空)    (空)    (空)    100                150
                                                ↑ 错误：SR类型但填写了DA扭矩
TEST-SF-ERROR2  DA    abc    6                 50      100     80      120     (空)               (空)
                      ↑ 错误：价格不是数字
```

上传此文件：
1. 应该看到错误提示
2. 点击 **下载错误报告**
3. 打开错误报告Excel
4. 检查是否添加了 **错误说明** 列
5. 验证错误描述是否清晰

---

## 🎯 预期测试结果

### ✅ 成功标准

- [ ] 可以访问"执行器批量导入"页面
- [ ] 可以成功下载模板
- [ ] 模板包含正确的工作表和列定义
- [ ] 可以上传正确的数据文件
- [ ] 导入成功并显示统计信息
- [ ] 导入的数据可以在列表中查看
- [ ] AT系列自动添加了"铝合金+硬质氧化"材质
- [ ] GY系列自动添加了"不锈钢"材质
- [ ] 错误数据会被正确检测
- [ ] 错误报告生成并可下载

### ❌ 失败场景处理

如果测试失败，检查以下内容:

**1. 页面无法访问**
- 检查前端部署状态
- 清除浏览器缓存
- 尝试强制刷新 (Ctrl+Shift+R)

**2. 模板下载失败**
- 检查后端API是否正常
- 查看浏览器控制台错误
- 检查网络请求状态

**3. 上传失败**
- 检查文件格式是否为.xlsx
- 检查文件大小是否<10MB
- 查看具体错误信息

**4. 导入失败**
- 查看后端日志
- 检查MongoDB连接
- 检查exceljs依赖是否安装

---

## 🐛 常见问题排查

### Q1: 看不到"执行器批量导入"标签
**解决方案:**
1. 确认使用管理员账号登录
2. 清除浏览器缓存并刷新
3. 检查前端部署是否完成

### Q2: 下载模板时报错
**解决方案:**
1. 检查后端API: `/api/data-management/actuators/template/unified`
2. 查看后端日志，确认exceljs依赖已安装
3. 重启后端服务

### Q3: 上传文件后一直加载
**解决方案:**
1. 检查文件大小（应<10MB）
2. 检查网络连接
3. 查看浏览器控制台错误

### Q4: 数据校验通过但导入失败
**解决方案:**
1. 检查MongoDB连接状态
2. 查看后端错误日志
3. 检查数据库事务是否正常

---

## 📝 测试记录表

完成测试后，请填写以下记录:

```
测试日期: _____________
测试人员: _____________
前端URL: _____________
后端URL: https://project-ark-efy7.onrender.com

【部署检查】
□ GitHub Actions 工作流成功
□ 后端健康检查通过
□ 前端页面可访问

【功能测试】
□ 访问新功能页面成功
□ 下载模板成功
□ 模板结构正确
□ 成功导入测试数据
□ 数据验证正确
□ 错误处理正常

【问题记录】
_________________________________
_________________________________
_________________________________

【总体评价】
□ 完全通过
□ 部分通过（需要修复）
□ 未通过（需要重大修改）
```

---

## 🎬 测试完成后

### 清理测试数据

如果不需要保留测试数据:
1. 准备一个只包含真实数据的Excel
2. 重新导入（会替换测试数据）

或者:
1. 在"执行器管理（高级）"中
2. 搜索 "TEST-"
3. 批量删除测试记录

### 准备生产数据

测试通过后:
1. 准备完整的生产数据Excel
2. 仔细检查所有数据
3. 创建数据备份
4. 正式导入生产数据

---

## 📞 获取帮助

如果测试遇到问题:
1. 查看部署完成报告
2. 查看使用指南
3. 查看技术实现文档
4. 检查GitHub Actions日志
5. 查看后端/前端部署日志

---

**测试版本**: v1.0  
**创建时间**: 2025-11-07  
**预计测试时长**: 15-20分钟

