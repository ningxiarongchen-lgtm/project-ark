# 产品版本管理和ECO功能快速启动指南

## 🚀 5分钟快速上手

### 1. 启动系统

```bash
# 后端
cd backend
npm start

# 前端
cd frontend
npm run dev
```

访问: `http://localhost:5173`

---

## 📋 功能入口

### 产品版本管理

**入口**: 导航菜单 → 产品数据库

**页面路径**:
- 产品列表: `/products`
- 产品详情: `/products/:id`

**操作流程**:
```
1. 点击"产品数据库"菜单
2. 查看产品列表（显示版本号和状态）
3. 点击任意产品的"查看详情"
4. 切换到"版本历史"Tab
5. 查看产品所有历史版本
```

### ECO审批管理

**入口**: 产品详情页 → 工程变更记录Tab

**页面路径**:
- ECO详情: `/ecos/:id`

**操作流程**:
```
工程师:
1. 进入产品详情页
2. 切换到"工程变更记录"Tab
3. 点击"发起变更"
4. 填写ECO表单并提交
5. ECO创建成功（状态：草稿）
6. 点击"提交审批"

主管:
1. 进入产品详情页（或ECO列表）
2. 点击ECO查看详情
3. 审查完整信息
4. 点击"批准"或"驳回"
5. 填写审批意见并提交
```

---

## 🎯 常用操作

### 查看产品版本历史

```
产品列表 → 点击产品 → 版本历史Tab
```

可以看到:
- 所有历史版本列表
- 版本演进时间线
- 每个版本的变更说明

### 发起工程变更

```
产品详情 → 工程变更记录Tab → 发起变更
```

需要填写:
- ✅ ECO标题 (必填)
- ✅ 变更类型 (必填，9种可选)
- ✅ 优先级 (必填，低/中/高/紧急)
- ✅ 新版本号 (必填)
- ✅ 变更描述 (必填)
- ✅ 变更原因 (必填)

### 审批ECO

```
ECO详情页 → 批准/驳回按钮 → 填写审批意见
```

需要填写:
- ✅ 审批角色 (必填，5种角色可选)
- ✅ 审批意见 (必填)
- ☑️ 附加条件 (批准时可选)

审批角色:
- 技术审批
- 质量审批
- 生产审批
- 财务审批
- 管理审批

---

## 📱 页面功能说明

### 产品列表页 (Products.jsx)

**筛选器**:
- 🔍 搜索框: 搜索型号或描述
- 📁 系列筛选: SF / AT / GY
- ⚙️ 作用类型: 双作用(DA) / 弹簧复位(SR)
- 🏷️ 状态筛选: 设计中 / 已发布 / 已停产

**表格列**:
- 型号、系列、版本、状态
- 作用类型、本体尺寸
- 定价模式、基础价格
- 库存状态、操作按钮

### 产品详情页 (ProductDetails.jsx)

**Tab 1: 基本信息**
- 产品基本信息（型号、版本、状态等）
- 版本说明
- 产品描述
- 技术规格（压力、温度、重量等）

**Tab 2: BOM结构**
- （开发中）

**Tab 3: 版本历史**
- 创建新版本按钮（管理员可见）
- 版本历史表格
- 版本演进时间线

**Tab 4: 工程变更记录**
- 发起变更按钮
- ECO记录表格
- 点击查看ECO详情

### ECO详情页 (ECODetails.jsx)

**头部区域**:
- ECO编号
- 审批状态Tag
- 是否已关闭Tag

**操作按钮**:
- 提交审批（草稿状态，发起人可见）
- 批准（审批中，主管/管理员可见）
- 驳回（审批中，主管/管理员可见）
- 关闭ECO（已批准，主管/管理员可见）

**信息卡片**:
- 基本信息
- 受影响产品
- 影响分析（技术/质量/成本/交付）
- 成本估算
- 审批流程（Steps可视化 + 审批记录表格）
- 实施计划（如果有）
- 关闭信息（如果已关闭）

---

## 🔐 权限说明

### 工程师 (engineer)

**可以做什么**:
- ✅ 查看产品列表和详情
- ✅ 查看版本历史
- ✅ 创建ECO
- ✅ 编辑自己发起的ECO（草稿或已拒绝状态）
- ✅ 提交ECO审批

**不能做什么**:
- ❌ 批准/驳回ECO
- ❌ 关闭ECO
- ❌ 创建新产品版本
- ❌ 删除ECO

### 主管 (supervisor)

**可以做什么**:
- ✅ 工程师的所有权限
- ✅ 批准/驳回ECO
- ✅ 关闭ECO

**不能做什么**:
- ❌ 创建新产品版本
- ❌ 删除ECO

### 管理员 (administrator)

**可以做什么**:
- ✅ 所有权限
- ✅ 创建新产品版本
- ✅ 删除ECO

---

## 🔄 ECO状态流转

```
草稿 → 待审批 → 审批中 → 已批准 → 关闭
                ↓
             已拒绝 → (返回草稿，可重新编辑)
```

**状态说明**:
- **草稿**: ECO刚创建，可以编辑
- **待审批**: 已提交审批，等待审批人处理
- **审批中**: 部分审批人已审批，等待其他人
- **已批准**: 所有审批人都批准
- **已拒绝**: 有审批人驳回
- **已取消**: 主动取消
- **关闭**: 变更已完成，ECO归档

---

## 📊 数据字段说明

### 产品版本字段

| 字段名 | 说明 | 示例 |
|--------|------|------|
| version | 版本号 | "1.0", "2.0", "2.1" |
| status | 产品状态 | "设计中", "已发布", "已停产" |
| parent_id | 父版本ID | ObjectId |
| version_notes | 版本说明 | "升级密封材料至VITON" |
| release_date | 发布日期 | 2025-10-28 |
| discontinue_date | 停产日期 | 2026-10-28 |
| eco_references | 关联ECO列表 | [ObjectId, ...] |

### ECO核心字段

| 字段名 | 说明 | 示例 |
|--------|------|------|
| eco_number | ECO编号 | "ECO-202510-0001" |
| title | ECO标题 | "AT-10 DA密封材料升级" |
| change_type | 变更类型 | "材料替换" |
| priority | 优先级 | "中" |
| description | 变更描述 | "将密封材料从NBR升级到..." |
| reason | 变更原因 | "客户需求高温应用" |
| approval.status | 审批状态 | "待审批" |

---

## 💡 使用技巧

### 技巧1: 快速查找待审批ECO

```
方法1: 使用API
GET /api/ecos/pending-approvals

方法2: 在产品详情页
进入产品 → 工程变更记录Tab → 查看状态为"待审批"的ECO
```

### 技巧2: 追踪产品演进

```
进入产品详情 → 版本历史Tab → 查看时间线

可以看到:
- 产品从最初版本到当前版本的演进
- 每个版本的发布日期
- 每个版本的变更说明
```

### 技巧3: 批量查看某产品的所有ECO

```
GET /api/ecos/by-product/:actuatorId

或在产品详情页:
产品详情 → 工程变更记录Tab
```

### 技巧4: 查看ECO统计

```
GET /api/ecos/stats

返回:
- 总体统计（总数、草稿、待审批等）
- 按变更类型统计
- 按优先级统计
```

---

## ⚡ API快速参考

### ECO相关API

```bash
# 获取ECO列表
GET /api/ecos?page=1&limit=10&status=待审批

# 获取ECO详情
GET /api/ecos/:id

# 创建ECO
POST /api/ecos
Body: { title, change_type, priority, description, ... }

# 提交审批
POST /api/ecos/:id/submit

# 批准
POST /api/ecos/:id/approve
Body: { role, comments, conditions }

# 驳回
POST /api/ecos/:id/reject
Body: { role, comments }

# 关闭ECO
POST /api/ecos/:id/close
Body: { closed_reason, closed_notes }

# 获取待审批
GET /api/ecos/pending-approvals

# 获取统计
GET /api/ecos/stats

# 按产品查询
GET /api/ecos/by-product/:actuatorId
```

### 版本管理API

```bash
# 获取版本历史
GET /api/actuators/:id/versions

# 创建新版本（管理员）
POST /api/actuators/:id/new-version
Body: { version, version_notes, updates }
```

---

## 🐛 常见问题

### Q1: 为什么看不到"批准"按钮？

**A**: 只有主管(supervisor)和管理员(administrator)角色才能看到批准/驳回按钮。工程师只能创建和提交ECO。

### Q2: ECO创建后可以修改吗？

**A**: 可以。只有在"草稿"或"已拒绝"状态下可以编辑。提交审批后就不能修改了。

### Q3: 如何查看我需要审批的ECO？

**A**: 
方法1: 调用API `GET /api/ecos/pending-approvals`
方法2: 在产品详情页的"工程变更记录"Tab中查看状态为"待审批"的ECO

### Q4: ECO被驳回后怎么办？

**A**: 
1. 发起人会看到ECO状态变为"已拒绝"
2. 可以重新编辑ECO
3. 修改完成后再次提交审批

### Q5: 版本历史为什么是空的？

**A**: 如果产品没有parent_id，说明它是初始版本，没有历史版本。只有通过"创建新版本"功能创建的版本才会有版本历史链。

### Q6: 如何创建新版本？

**A**: 
1. 只有管理员可以创建新版本
2. 在产品详情页的"版本历史"Tab中点击"创建新版本"
3. 或调用API: `POST /api/actuators/:id/new-version`

---

## 📞 快速联系

- **技术支持**: 查看完整报告 `产品版本管理和ECO审批功能完成报告.md`
- **API文档**: 查看 `完整API文档.md`
- **测试指南**: 查看报告中的"测试建议"章节

---

## ✅ 检查清单

在开始使用前，请确保:

- [ ] 后端服务器已启动
- [ ] 前端服务器已启动
- [ ] MongoDB数据库运行正常
- [ ] 已登录系统
- [ ] 知道自己的角色权限
- [ ] 了解ECO审批流程
- [ ] 查看过快速启动指南

---

## 🎉 开始使用

1. **登录系统**
2. **点击"产品数据库"菜单**
3. **选择一个产品查看详情**
4. **尝试发起一个ECO**
5. **体验完整的审批流程**

**祝使用愉快！** 🚀

