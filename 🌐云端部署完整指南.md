# 🌐 云端部署完整指南 - 团队随时访问

**目标：** 部署到云服务器，团队成员通过网址访问，不依赖本地电脑  
**要求：** 前端 + 后端 + 数据库全部部署到云端

---

## 🎯 推荐方案对比

| 方案 | 难度 | 费用 | 国内访问 | 推荐度 |
|------|------|------|----------|--------|
| **Railway** | ⭐ 最简单 | 免费额度 | 一般 | ⭐⭐⭐⭐⭐ |
| **Render** | ⭐⭐ 简单 | 完全免费 | 慢 | ⭐⭐⭐⭐ |
| **Vercel + Railway** | ⭐⭐ 简单 | 免费额度 | 前端快 | ⭐⭐⭐⭐ |
| **阿里云/腾讯云** | ⭐⭐⭐⭐ 复杂 | ¥100/月起 | 最快 | ⭐⭐⭐⭐⭐ |

---

## 🚀 方案一：Railway 一键部署（最推荐）

### ✨ 优点
- ✅ **最简单** - 一键部署，自动配置
- ✅ **包含数据库** - 自动提供MongoDB
- ✅ **免费额度** - $5/月免费额度（够小团队使用）
- ✅ **自动域名** - 提供免费子域名
- ✅ **自动HTTPS** - 自动SSL证书

### 📋 部署步骤

#### 第1步：准备GitHub仓库
```bash
# 确认代码已推送（已完成✅）
cd "/Users/hexiaoxiao/Desktop/Model Selection System"
git status
```

#### 第2步：注册Railway账号
1. 访问：https://railway.app
2. 点击 "Start a New Project"
3. 使用GitHub账号登录（授权访问仓库）

#### 第3步：创建项目

**方式A：从GitHub仓库部署**
```
1. 在Railway控制台点击 "New Project"
2. 选择 "Deploy from GitHub repo"
3. 选择仓库：ningxiarongchen-lgtm/project-ark
4. Railway会自动识别Node.js项目
```

**方式B：使用Railway CLI**
```bash
# 1. 安装Railway CLI
npm install -g @railway/cli

# 2. 登录
railway login

# 3. 在项目目录初始化
cd "/Users/hexiaoxiao/Desktop/Model Selection System"
railway init

# 4. 部署
railway up
```

#### 第4步：添加MongoDB数据库
```
1. 在Railway项目中点击 "New"
2. 选择 "Database" → "Add MongoDB"
3. Railway会自动创建MongoDB实例
4. 自动生成 MONGODB_URI 环境变量
```

#### 第5步：配置环境变量

在Railway控制台的 "Variables" 标签页添加：

```bash
# Node环境
NODE_ENV=production

# 端口（Railway自动分配）
PORT=$PORT

# MongoDB连接（自动生成，无需手动设置）
MONGODB_URI=$MONGODB_URI

# JWT密钥（复制你本地的密钥）
JWT_SECRET=your_production_jwt_secret_here

# Refresh Token密钥
REFRESH_TOKEN_SECRET=your_refresh_token_secret_here

# 前端URL（部署后获得）
FRONTEND_URL=https://your-frontend.up.railway.app
```

#### 第6步：配置前端环境变量

Railway会自动识别前端和后端：

**前端环境变量：**
```bash
# 后端API地址（从后端服务获取）
VITE_API_URL=https://your-backend.up.railway.app
```

#### 第7步：部署并获取网址
```
1. Railway自动部署（约2-5分钟）
2. 后端网址：https://xxx.up.railway.app
3. 前端网址：https://yyy.up.railway.app
4. 数据库：自动连接，无需暴露地址
```

#### 第8步：初始化数据库
```bash
# 使用Railway CLI连接到后端服务
railway run node backend/seed_final_acceptance.js
```

### 🎉 完成！访问网址
- **前端地址：** https://your-frontend.up.railway.app
- **后端API：** https://your-backend.up.railway.app
- **团队成员可直接访问前端网址**

---

## 🎨 方案二：Render 完全免费部署

### ✨ 优点
- ✅ **完全免费** - 永久免费套餐
- ✅ **包含数据库** - 免费PostgreSQL（可用MongoDB）
- ✅ **自动部署** - Git推送自动部署
- ⚠️ 缺点：国内访问可能较慢

### 📋 部署步骤

#### 第1步：注册Render
1. 访问：https://render.com
2. 使用GitHub账号登录

#### 第2步：部署MongoDB（使用MongoDB Atlas）
```
1. 访问：https://www.mongodb.com/cloud/atlas
2. 注册免费账号（512MB免费）
3. 创建集群（选择离中国最近的区域：新加坡）
4. 创建数据库用户
5. 获取连接字符串：mongodb+srv://...
```

#### 第3步：部署后端
```
1. Render控制台 → "New" → "Web Service"
2. 连接GitHub仓库：project-ark
3. 配置：
   - Name: project-ark-backend
   - Root Directory: backend
   - Environment: Node
   - Build Command: npm install
   - Start Command: node server.js
4. 添加环境变量：
   - NODE_ENV=production
   - MONGODB_URI=<MongoDB Atlas连接字符串>
   - JWT_SECRET=<你的密钥>
   - REFRESH_TOKEN_SECRET=<你的密钥>
5. 点击 "Create Web Service"
```

#### 第4步：部署前端
```
1. Render控制台 → "New" → "Static Site"
2. 连接GitHub仓库：project-ark
3. 配置：
   - Name: project-ark-frontend
   - Root Directory: frontend
   - Build Command: npm install && npm run build
   - Publish Directory: dist
4. 添加环境变量：
   - VITE_API_URL=<后端网址>
5. 点击 "Create Static Site"
```

#### 第5步：获取访问地址
- **前端：** https://project-ark-frontend.onrender.com
- **后端：** https://project-ark-backend.onrender.com

---

## 🌟 方案三：Vercel (前端) + Railway (后端)

### ✨ 优点
- ✅ **前端极速** - Vercel全球CDN，国内访问快
- ✅ **后端稳定** - Railway可靠部署
- ✅ **免费额度** - 两者都有免费套餐

### 📋 部署步骤

#### 第1步：部署后端到Railway（参考方案一）

#### 第2步：部署前端到Vercel
```bash
# 1. 安装Vercel CLI
npm install -g vercel

# 2. 登录
vercel login

# 3. 部署前端
cd "/Users/hexiaoxiao/Desktop/Model Selection System/frontend"
vercel --prod

# 4. 设置环境变量
vercel env add VITE_API_URL
# 输入Railway后端地址
```

#### 第3步：配置自定义域名（可选）
```
1. Vercel控制台 → Settings → Domains
2. 添加你的域名
3. 配置DNS记录
```

---

## 🇨🇳 方案四：阿里云/腾讯云（国内最佳）

### ✨ 优点
- ✅ **国内访问最快**
- ✅ **完全控制**
- ✅ **符合国内合规要求**
- ⚠️ 需要备案（约2周）
- 💰 费用：约¥100-300/月

### 📋 部署步骤

#### 第1步：购买服务器
```
阿里云 ECS 或 腾讯云 CVM
推荐配置：
- CPU: 2核
- 内存: 4GB
- 带宽: 5Mbps
- 系统: Ubuntu 22.04
- 费用: 约¥100/月
```

#### 第2步：连接服务器
```bash
# 使用SSH连接
ssh root@your_server_ip

# 更新系统
apt update && apt upgrade -y
```

#### 第3步：安装环境
```bash
# 1. 安装Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
apt install -y nodejs

# 2. 安装MongoDB
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/6.0 multiverse" | tee /etc/apt/sources.list.d/mongodb-org-6.0.list
apt update
apt install -y mongodb-org
systemctl start mongod
systemctl enable mongod

# 3. 安装Nginx
apt install -y nginx

# 4. 安装PM2
npm install -g pm2
```

#### 第4步：部署代码
```bash
# 1. 克隆代码
cd /var/www
git clone https://github.com/ningxiarongchen-lgtm/project-ark.git
cd project-ark

# 2. 安装后端依赖
cd backend
npm install --production

# 3. 配置环境变量
cat > .env << EOF
NODE_ENV=production
PORT=5001
MONGODB_URI=mongodb://localhost:27017/cmax
JWT_SECRET=your_jwt_secret_here
REFRESH_TOKEN_SECRET=your_refresh_token_secret_here
FRONTEND_URL=http://your_domain.com
EOF

# 4. 启动后端
pm2 start server.js --name project-ark-api
pm2 save
pm2 startup

# 5. 构建前端
cd ../frontend
npm install
npm run build
```

#### 第5步：配置Nginx
```bash
# 创建Nginx配置
cat > /etc/nginx/sites-available/project-ark << 'EOF'
server {
    listen 80;
    server_name your_domain.com;  # 替换为你的域名

    # 前端静态文件
    location / {
        root /var/www/project-ark/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端API代理
    location /api {
        proxy_pass http://localhost:5001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # WebSocket支持
    location /socket.io {
        proxy_pass http://localhost:5001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
EOF

# 启用站点
ln -s /etc/nginx/sites-available/project-ark /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

#### 第6步：配置SSL（HTTPS）
```bash
# 使用Let's Encrypt免费SSL
apt install -y certbot python3-certbot-nginx
certbot --nginx -d your_domain.com
```

#### 第7步：初始化数据库
```bash
cd /var/www/project-ark/backend
node seed_final_acceptance.js
```

### 🎉 完成！
- **访问地址：** http://your_domain.com 或 http://your_server_ip
- **HTTPS：** https://your_domain.com（配置SSL后）

---

## 📊 方案对比总结

### 🚀 快速上线（推荐新手）
**选择：Railway**
- 10分钟上线
- 无需服务器知识
- 免费额度够用

### 💰 完全免费
**选择：Render + MongoDB Atlas**
- 永久免费
- 适合小团队
- 国内访问较慢

### ⚡ 性能最佳
**选择：Vercel (前端) + Railway (后端)**
- 前端全球加速
- 后端稳定可靠
- 国内访问较快

### 🇨🇳 国内最佳
**选择：阿里云/腾讯云**
- 国内访问最快
- 完全可控
- 需要投入成本

---

## 🎯 推荐决策流程

```
是否有预算？
├─ 有预算 (¥100-300/月)
│  └─ 国内用户为主？
│     ├─ 是 → 阿里云/腾讯云 ⭐⭐⭐⭐⭐
│     └─ 否 → Railway ⭐⭐⭐⭐
│
└─ 无预算（免费）
   └─ 需要最快上线？
      ├─ 是 → Railway (免费额度) ⭐⭐⭐⭐⭐
      └─ 否 → Render ⭐⭐⭐⭐
```

---

## 🔐 安全提醒

### ✅ 部署前检查清单
- [ ] 确保`.env`文件不在Git中
- [ ] 使用强密码作为JWT_SECRET
- [ ] MongoDB使用强密码
- [ ] 配置CORS只允许你的前端域名
- [ ] 启用HTTPS（SSL）
- [ ] 定期备份数据库

### 🔑 生成安全密钥
```bash
# 生成JWT密钥
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# 生成Refresh Token密钥
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

---

## 📞 下一步

### 方案一推荐：Railway（最简单）
1. 访问 https://railway.app 注册
2. 连接GitHub仓库
3. 添加MongoDB
4. 配置环境变量
5. 等待部署完成（5分钟）
6. 获取网址分享给团队

### 需要帮助？
- Railway文档：https://docs.railway.app
- Render文档：https://render.com/docs
- 阿里云文档：https://help.aliyun.com

---

**准备好了吗？选择一个方案开始部署吧！** 🚀

