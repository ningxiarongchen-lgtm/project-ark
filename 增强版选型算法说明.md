# å¢å¼ºç‰ˆé€‰å‹ç®—æ³•è¯´æ˜æ–‡æ¡£

## ğŸ“… æ›´æ–°æ—¶é—´
2025-10-27

---

## ğŸ¯ æ¦‚è¿°

æ ¹æ®æ‚¨æä¾›çš„ä¼ªä»£ç ï¼Œæˆ‘ä»¬å®ç°äº†å¢å¼ºç‰ˆçš„æ‰§è¡Œå™¨é€‰å‹ç®—æ³•ã€‚æ–°ç®—æ³•æä¾›äº†æ›´çµæ´»ã€æ›´ç²¾ç¡®çš„åŒ¹é…é€»è¾‘ã€‚

---

## ğŸš€ æ ¸å¿ƒæ”¹è¿›

### 1. æ”¯æŒå®‰å…¨ç³»æ•° â­
ç°åœ¨å¯ä»¥è¾“å…¥é˜€é—¨æ‰­çŸ©å’Œå®‰å…¨ç³»æ•°ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ‰€éœ€æ‰­çŸ©ã€‚

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
{
  "valve_torque": 500,      // é˜€é—¨æ‰­çŸ© 500 Nm
  "safety_factor": 1.2,     // å®‰å…¨ç³»æ•° 1.2
  // ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼šæ‰€éœ€æ‰­çŸ© = 500 Ã— 1.2 = 600 Nm
  "working_pressure": 0.5
}
```

### 2. è½­æ¶åå¥½ç³»ç»Ÿ â­â­â­
æ”¯æŒä¸‰ç§è½­æ¶åå¥½æ¨¡å¼ï¼š

#### Auto æ¨¡å¼ï¼ˆè‡ªåŠ¨ï¼‰
```javascript
{
  "yoke_preference": "Auto"
}
```
- ä¼˜å…ˆåŒ¹é…å¯¹ç§°è½­æ¶
- å¦‚æœå¯¹ç§°ä¸æ»¡è¶³ï¼Œå°è¯•å€¾æ–œè½­æ¶
- å¦‚æœä¸¤ç§éƒ½æ»¡è¶³ï¼Œæ ‡è®°ä¸º "Both"

#### Symmetric æ¨¡å¼ï¼ˆä»…å¯¹ç§°ï¼‰
```javascript
{
  "yoke_preference": "Symmetric"
}
```
- ä»…è€ƒè™‘å¯¹ç§°è½­æ¶
- åªè¿”å›å¯¹ç§°è½­æ¶æ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨

#### Canted æ¨¡å¼ï¼ˆä»…å€¾æ–œï¼‰
```javascript
{
  "yoke_preference": "Canted"
}
```
- ä»…è€ƒè™‘å€¾æ–œè½­æ¶
- åªè¿”å›å€¾æ–œè½­æ¶æ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨

### 3. è¯¦ç»†çš„è½­æ¶åŒ¹é…é€»è¾‘ â­â­

**ç®—æ³•æµç¨‹**:
```
1. è·å–å€™é€‰æ‰§è¡Œå™¨
   â†“
2. å¯¹æ¯ä¸ªæ‰§è¡Œå™¨ï¼š
   â€¢ æ£€æŸ¥å¯¹ç§°è½­æ¶æ‰­çŸ©æ˜¯å¦æ»¡è¶³
   â€¢ æ£€æŸ¥å€¾æ–œè½­æ¶æ‰­çŸ©æ˜¯å¦æ»¡è¶³
   â†“
3. æ ¹æ®è½­æ¶åå¥½å†³å®šæ˜¯å¦åŒ…å«ï¼š
   â€¢ Symmetric: ä»…å¯¹ç§°æ»¡è¶³ â†’ åŒ…å«
   â€¢ Canted: ä»…å€¾æ–œæ»¡è¶³ â†’ åŒ…å«
   â€¢ Auto: ä»»ä¸€æ»¡è¶³ â†’ åŒ…å«ï¼Œæ ‡è®°æ¨èç±»å‹
   â†“
4. æŒ‰ä»·æ ¼æ’åºï¼ˆä»ä½åˆ°é«˜ï¼‰
```

### 4. æ¨èè½­æ¶ç±»å‹æ ‡è®° â­

æ¯ä¸ªç»“æœéƒ½æ ‡è®°äº†æ¨èçš„è½­æ¶ç±»å‹ï¼š

```javascript
{
  "recommended_yoke": "Symmetric",  // æˆ– "Canted" æˆ– "Both"
  "symmetric_torque": 858,          // å¯¹ç§°è½­æ¶æ‰­çŸ©
  "canted_torque": 1158            // å€¾æ–œè½­æ¶æ‰­çŸ©
}
```

### 5. æŒ‰ä»·æ ¼æ’åº â­

ç»“æœæŒ‰ä»·æ ¼ä»ä½åˆ°é«˜æ’åºï¼Œè€Œä¸æ˜¯æŒ‰æ‰­çŸ©æ’åºï¼š

```javascript
// æ—§ç‰ˆï¼šæŒ‰æ‰­çŸ©æ’åºï¼ˆæœ€æ¥è¿‘éœ€æ±‚çš„ï¼‰
// æ–°ç‰ˆï¼šæŒ‰ä»·æ ¼æ’åºï¼ˆæœ€ç»æµçš„ï¼‰

results.sort((a, b) => a.price - b.price);
```

### 6. æ›´æ™ºèƒ½çš„é¢„ç®—è¿‡æ»¤ â­

åœ¨åŒ¹é…è¿‡ç¨‹ä¸­å°±è¿›è¡Œé¢„ç®—è¿‡æ»¤ï¼Œæé«˜æ•ˆç‡ï¼š

```javascript
{
  "max_budget": 7000  // ä»…è¿”å›ä»·æ ¼ â‰¤ 7000 çš„æ‰§è¡Œå™¨
}
```

---

## ğŸ“ å®Œæ•´APIä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€é€‰å‹
```javascript
POST /api/selection/calculate

{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Auto"
}
```

### ä½¿ç”¨å®‰å…¨ç³»æ•°
```javascript
POST /api/selection/calculate

{
  "valve_torque": 500,
  "safety_factor": 1.2,        // æ‰€éœ€æ‰­çŸ© = 600 Nm
  "working_pressure": 0.5,
  "working_angle": 0,
  "yoke_preference": "Auto"
}
```

### æŒ‡å®šè½­æ¶ç±»å‹
```javascript
POST /api/selection/calculate

{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Symmetric",  // ä»…å¯¹ç§°è½­æ¶
  "action_type_preference": "SR"    // ä»…å•ä½œç”¨å¼¹ç°§å¤ä½
}
```

### å¸¦é¢„ç®—é™åˆ¶
```javascript
POST /api/selection/calculate

{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Auto",
  "max_budget": 7000,              // é¢„ç®—ä¸Šé™
  "needs_manual_override": true     // éœ€è¦æ‰‹åŠ¨è£…ç½®
}
```

### å®Œæ•´å‚æ•°ç¤ºä¾‹
```javascript
POST /api/selection/calculate

{
  // æ‰­çŸ©å‚æ•°ï¼ˆäºŒé€‰ä¸€ï¼‰
  "valve_torque": 500,              // é˜€é—¨æ‰­çŸ©
  "safety_factor": 1.2,             // å®‰å…¨ç³»æ•°
  // æˆ–ç›´æ¥æä¾›
  "required_torque": 600,           // æ‰€éœ€æ‰­çŸ©
  
  // å¿…éœ€å‚æ•°
  "working_pressure": 0.5,          // å·¥ä½œå‹åŠ›ï¼ˆMPaï¼‰
  
  // å¯é€‰å‚æ•°
  "working_angle": 0,               // å·¥ä½œè§’åº¦ï¼ˆ0 æˆ– 90ï¼‰
  "yoke_preference": "Auto",        // è½­æ¶åå¥½
  "action_type_preference": "SR",   // ä½œç”¨ç±»å‹åå¥½
  "body_size_preference": "SF12",   // æœ¬ä½“å°ºå¯¸åå¥½
  "max_budget": 10000,              // æœ€å¤§é¢„ç®—
  "needs_manual_override": true     // æ˜¯å¦éœ€è¦æ‰‹åŠ¨è£…ç½®
}
```

---

## ğŸ“Š å“åº”ç»“æ„

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "æ‰¾åˆ° 4 ä¸ªæ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨",
  "count": 4,
  "search_criteria": {
    "valve_torque": 500,
    "safety_factor": 1.2,
    "required_torque": 600,
    "working_pressure": 0.5,
    "working_angle": 0,
    "yoke_preference": "Auto",
    "action_type_preference": "ä¸é™",
    "needs_manual_override": true,
    "max_budget": "ä¸é™"
  },
  "data": [
    {
      "_id": "...",
      "model_base": "SF12-250SR",
      "body_size": "SF12",
      "action_type": "SR",
      "price": 6500,
      "actual_torque": 858,
      "torque_margin": 43.00,
      "recommended_yoke": "Symmetric",
      "recommend_level": "å¼ºçƒˆæ¨è",
      "symmetric_torque": 858,
      "canted_torque": 1158,
      "lead_time": "14å¤©",
      "manual_override": {
        "_id": "...",
        "model": "HG",
        "price": 800
      },
      "total_price": 7300,
      "compatible_overrides_count": 2
    },
    // ... æ›´å¤šç»“æœï¼ˆæŒ‰ä»·æ ¼æ’åºï¼‰
  ],
  "best_choice": {
    // ä»·æ ¼æœ€ä½çš„é€‰é¡¹
  },
  "timestamp": "2025-10-27T03:00:00.000Z"
}
```

### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "æœªæ‰¾åˆ°æ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨",
  "suggestions": [
    "å°è¯•é™ä½æ‰­çŸ©è¦æ±‚æˆ–å‡å°å®‰å…¨ç³»æ•°",
    "é€‰æ‹©æ›´é«˜çš„å·¥ä½œå‹åŠ›",
    "è€ƒè™‘ä½¿ç”¨å€¾æ–œè½­æ¶ï¼ˆæ‰­çŸ©æ›´å¤§ï¼‰",
    "å¢åŠ é¢„ç®—é™åˆ¶",
    "è”ç³»æŠ€æœ¯æ”¯æŒè·å–å®šåˆ¶æ–¹æ¡ˆ"
  ],
  "search_criteria": {
    "required_torque": 1000,
    "valve_torque": 800,
    "safety_factor": 1.25,
    "working_pressure": 0.3,
    "yoke_preference": "Symmetric",
    "max_budget": 5000
  }
}
```

---

## ğŸ”„ ç®—æ³•é€»è¾‘è¯¦è§£

### ä¼ªä»£ç å®ç°

```javascript
function findMatchingActuators(inputs) {
  const { 
    valve_torque, 
    safety_factor, 
    required_torque,
    working_pressure, 
    yoke_preference 
  } = inputs;
  
  // è®¡ç®—å®é™…æ‰€éœ€æ‰­çŸ©
  const finalRequiredTorque = required_torque || 
                               (valve_torque * safety_factor);
  
  // 1. ä»æ•°æ®åº“è·å–å€™é€‰æ‰§è¡Œå™¨
  let candidateActuators = await Actuator.find(query);
  
  let finalResults = [];
  
  // 2. å¾ªç¯å¹¶è¯¦ç»†åŒ¹é…
  for (const actuator of candidateActuators) {
    let isSymmetricMatch = false;
    let isCantedMatch = false;
    
    // æ£€æŸ¥å¯¹ç§°è½­æ¶æ‰­çŸ©
    const symmetricTorque = actuator.torque_symmetric.get(key);
    if (symmetricTorque >= finalRequiredTorque) {
      isSymmetricMatch = true;
    }
    
    // æ£€æŸ¥å€¾æ–œè½­æ¶æ‰­çŸ©
    const cantedTorque = actuator.torque_canted.get(key);
    if (cantedTorque >= finalRequiredTorque) {
      isCantedMatch = true;
    }
    
    // 3. æ ¹æ®åå¥½ç¡®å®šæœ€ç»ˆæ¨è
    if (yoke_preference === 'Symmetric' && isSymmetricMatch) {
      actuator.recommended_yoke = 'Symmetric';
      finalResults.push(actuator);
    } 
    else if (yoke_preference === 'Canted' && isCantedMatch) {
      actuator.recommended_yoke = 'Canted';
      finalResults.push(actuator);
    } 
    else if (yoke_preference === 'Auto') {
      if (isSymmetricMatch && isCantedMatch) {
        actuator.recommended_yoke = 'Both';
        finalResults.push(actuator);
      } else if (isSymmetricMatch) {
        actuator.recommended_yoke = 'Symmetric';
        finalResults.push(actuator);
      } else if (isCantedMatch) {
        actuator.recommended_yoke = 'Canted';
        finalResults.push(actuator);
      }
    }
  }
  
  // 4. æŒ‰ä»·æ ¼æ’åºï¼ˆä»ä½åˆ°é«˜ï¼‰
  return finalResults.sort((a, b) => a.price - b.price);
}
```

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### åœºæ™¯ 1: æ ‡å‡†é€‰å‹
**éœ€æ±‚**: é€‰æ‹©æ»¡è¶³600Nmæ‰­çŸ©è¦æ±‚çš„æ‰§è¡Œå™¨

**æ—§ç‰ˆ**:
```javascript
{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_type": "symmetric"  // åªæ£€æŸ¥å¯¹ç§°
}
```

**æ–°ç‰ˆ**:
```javascript
{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Auto"  // è‡ªåŠ¨æ£€æŸ¥ä¸¤ç§è½­æ¶
}
```

**æ”¹è¿›**: æ–°ç‰ˆä¼šåŒæ—¶æ£€æŸ¥å¯¹ç§°å’Œå€¾æ–œè½­æ¶ï¼Œæä¾›æ›´å¤šé€‰æ‹©ã€‚

---

### åœºæ™¯ 2: è€ƒè™‘å®‰å…¨ç³»æ•°
**éœ€æ±‚**: é˜€é—¨æ‰­çŸ©500Nmï¼Œå®‰å…¨ç³»æ•°1.2

**æ—§ç‰ˆ**:
```javascript
// éœ€è¦æ‰‹åŠ¨è®¡ç®—
{
  "required_torque": 600,  // æ‰‹åŠ¨è®¡ç®— 500 Ã— 1.2
  "working_pressure": 0.5
}
```

**æ–°ç‰ˆ**:
```javascript
{
  "valve_torque": 500,
  "safety_factor": 1.2,     // ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—
  "working_pressure": 0.5
}
```

**æ”¹è¿›**: ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼Œå‡å°‘äººä¸ºé”™è¯¯ã€‚

---

### åœºæ™¯ 3: é¢„ç®—æ•æ„Ÿ
**éœ€æ±‚**: æ‰¾æœ€ä¾¿å®œçš„æ»¡è¶³è¦æ±‚çš„æ‰§è¡Œå™¨

**æ—§ç‰ˆ**:
```javascript
// æŒ‰æ‰­çŸ©æ’åºï¼Œéœ€è¦æ‰‹åŠ¨ç­›é€‰ä»·æ ¼
{
  "required_torque": 600,
  "working_pressure": 0.5
}
// ç»“æœï¼šSF14-400DA ($8000) - æ‰­çŸ©æœ€æ¥è¿‘
```

**æ–°ç‰ˆ**:
```javascript
// æŒ‰ä»·æ ¼æ’åºï¼Œç›´æ¥è¿”å›æœ€ä¾¿å®œçš„
{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Auto"
}
// ç»“æœï¼šSF12-250SR ($6500) - ä»·æ ¼æœ€ä½
```

**æ”¹è¿›**: é»˜è®¤æ¨èæœ€ç»æµçš„æ–¹æ¡ˆã€‚

---

## ğŸ¯ æ¨èç­‰çº§è¯´æ˜

ç³»ç»Ÿæ ¹æ®æ‰­çŸ©è£•åº¦è‡ªåŠ¨è®¡ç®—æ¨èç­‰çº§ï¼š

| æ‰­çŸ©è£•åº¦ | æ¨èç­‰çº§ | è¯´æ˜ |
|---------|---------|------|
| 20% - 50% | å¼ºçƒˆæ¨è | æ‰­çŸ©è£•åº¦é€‚ä¸­ï¼Œæœ€ä½³é€‰æ‹© |
| 10% - 20% | æ¨è | æ‰­çŸ©è£•åº¦è¾ƒå°ï¼Œå¯ä»¥ä½¿ç”¨ |
| 0% - 10% | å‹‰å¼ºå¯ç”¨ | æ‰­çŸ©è£•åº¦å¾ˆå°ï¼Œå»ºè®®æ…é‡ |
| > 50% | å¯é€‰ | æ‰­çŸ©è£•åº¦è¿‡å¤§ï¼Œå¯èƒ½æµªè´¹ |

**è®¡ç®—å…¬å¼**:
```
æ‰­çŸ©è£•åº¦ = (å®é™…æ‰­çŸ© - æ‰€éœ€æ‰­çŸ©) / æ‰€éœ€æ‰­çŸ© Ã— 100%
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1: åŸºç¡€åŠŸèƒ½
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "required_torque": 600,
    "working_pressure": 0.5,
    "yoke_preference": "Auto"
  }'
```

### æµ‹è¯• 2: å®‰å…¨ç³»æ•°
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "valve_torque": 500,
    "safety_factor": 1.2,
    "working_pressure": 0.5,
    "yoke_preference": "Auto"
  }'
```

### æµ‹è¯• 3: ä»…å¯¹ç§°è½­æ¶
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "required_torque": 600,
    "working_pressure": 0.5,
    "yoke_preference": "Symmetric"
  }'
```

### æµ‹è¯• 4: é¢„ç®—é™åˆ¶
```bash
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "required_torque": 600,
    "working_pressure": 0.5,
    "yoke_preference": "Auto",
    "max_budget": 7000
  }'
```

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½ | æ—§ç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| å®‰å…¨ç³»æ•° | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è½­æ¶åå¥½ | å•ä¸€ç±»å‹ | Auto/Symmetric/Canted |
| åŒ¹é…é€»è¾‘ | å•ä¸€æ£€æŸ¥ | åŒæ—¶æ£€æŸ¥ä¸¤ç§è½­æ¶ |
| æ¨èæ ‡è®° | âŒ æ—  | âœ… æ ‡è®°æ¨èè½­æ¶ç±»å‹ |
| æ’åºæ–¹å¼ | æŒ‰æ‰­çŸ© | æŒ‰ä»·æ ¼ |
| é¢„ç®—è¿‡æ»¤ | æŸ¥è¯¢åè¿‡æ»¤ | åŒ¹é…ä¸­è¿‡æ»¤ |
| æ‰­çŸ©ä¿¡æ¯ | å•ä¸€æ‰­çŸ© | ä¸¤ç§è½­æ¶æ‰­çŸ©éƒ½æ˜¾ç¤º |
| æ¨èç­‰çº§ | ç®€å• | è¯¦ç»†ï¼ˆ4ä¸ªç­‰çº§ï¼‰|

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. é¦–æ¬¡é€‰å‹
```javascript
{
  "valve_torque": 500,
  "safety_factor": 1.2,
  "working_pressure": 0.5,
  "yoke_preference": "Auto"  // è·å–æœ€å¤šé€‰é¡¹
}
```

### 2. é¢„ç®—æœ‰é™
```javascript
{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Auto",
  "max_budget": 7000  // é™åˆ¶é¢„ç®—
}
```

### 3. ç‰¹å®šè¦æ±‚
```javascript
{
  "required_torque": 600,
  "working_pressure": 0.5,
  "yoke_preference": "Symmetric",      // æŒ‡å®šè½­æ¶
  "action_type_preference": "SR",      // æŒ‡å®šç±»å‹
  "body_size_preference": "SF12"       // æŒ‡å®šå°ºå¯¸
}
```

---

## ğŸŠ æ€»ç»“

å¢å¼ºç‰ˆé€‰å‹ç®—æ³•æä¾›äº†ï¼š

1. âœ… **æ›´çµæ´»çš„è¾“å…¥æ–¹å¼**ï¼ˆæ”¯æŒå®‰å…¨ç³»æ•°ï¼‰
2. âœ… **æ›´æ™ºèƒ½çš„åŒ¹é…é€»è¾‘**ï¼ˆAutoæ¨¡å¼ï¼‰
3. âœ… **æ›´è¯¦ç»†çš„ç»“æœä¿¡æ¯**ï¼ˆæ¨èè½­æ¶ç±»å‹ï¼‰
4. âœ… **æ›´ç»æµçš„æ¨èæ–¹æ¡ˆ**ï¼ˆæŒ‰ä»·æ ¼æ’åºï¼‰
5. âœ… **æ›´ç²¾ç¡®çš„è¿‡æ»¤æœºåˆ¶**ï¼ˆé¢„ç®—è¿‡æ»¤ï¼‰

**å®Œå…¨å…¼å®¹æ‚¨æä¾›çš„ä¼ªä»£ç é€»è¾‘ï¼**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1.0  
**æœ€åæ›´æ–°**: 2025-10-27  
**é€‚ç”¨ç‰ˆæœ¬**: C-MAX é€‰å‹ç³»ç»Ÿ v2.0.0+

