# 温度代码后端快速参考 🚀

**版本**: v1.0  
**更新时间**: 2025-10-27

---

## 🔥 核心逻辑

### SF系列价格计算

```javascript
// 如果温度代码不是 'No code'，价格上浮5%
let adjustedPrice = actuator.base_price;
if (temperature_code && temperature_code !== 'No code') {
  adjustedPrice = actuator.base_price * 1.05;
}
```

### 型号名称生成

```javascript
// 基础型号 + 温度代码（如果不是 'No code'）
let finalModelName = recommendedModel;
if (temperature_code && temperature_code !== 'No code') {
  finalModelName = `${recommendedModel}-${temperature_code.toUpperCase()}`;
}
```

---

## 💰 价格规则

### SF系列

| 温度代码 | 价格 | 示例 |
|----------|------|------|
| `No code` | `base_price` | ¥8,500 |
| `T1`, `T2`, `T3`, `M` | `base_price × 1.05` | ¥8,925 |

### AT/GY系列

| 温度类型 | 价格字段 |
|----------|----------|
| `normal` | `base_price_normal` |
| `low` | `base_price_low` |
| `high` | `base_price_high` |

*温度代码不影响AT/GY价格，仅影响型号名称*

---

## 📊 返回数据结构

### SF系列

```javascript
{
  final_model_name: "SF10/C-150DA-T1",  // 最终型号
  temperature_code: "T1",                 // 温度代码
  price: 8925,                            // 调整后价格
  base_price: 8500,                       // 原始价格
  price_adjustment: 425,                  // 调整金额
  total_price: 9225                       // 含手轮总价
}
```

### AT/GY系列

```javascript
{
  final_model_name: "AT-DA63-T2",    // 最终型号
  temperature_code: "T2",             // 温度代码
  temperature_type: "low",            // 温度类型
  price: 93,                          // 低温价格
  handwheel: { model: "SD-1", price: 127 },
  total_price: 220                    // 含手轮总价
}
```

---

## 🧪 测试命令

```bash
# SF系列 + 常温
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "mechanism": "Scotch Yoke",
    "valve_type": "Ball Valve",
    "temperature_code": "No code",
    "required_torque": 3750,
    "working_pressure": 0.6,
    "working_angle": 90
  }'

# SF系列 + T1（价格上浮5%）
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "mechanism": "Scotch Yoke",
    "valve_type": "Butterfly Valve",
    "temperature_code": "T1",
    "required_torque": 3750,
    "working_pressure": 0.6,
    "working_angle": 90
  }'

# AT系列 + T2
curl -X POST http://localhost:5001/api/selection/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "mechanism": "Rack & Pinion",
    "temperature_type": "low",
    "temperature_code": "T2",
    "needs_handwheel": true,
    "required_torque": 50,
    "working_pressure": 0.55
  }'
```

---

## 📝 日志输出

### SF系列（带温度调整）

```
💰 温度代码 T1: 价格调整 = ¥8500 × 1.05 = ¥8925.00
📝 最终型号: SF10/C-150DA-T1 (基础: SF10/C-150DA, 温度: T1)
```

### AT系列（带温度代码）

```
💰 AT-DA63: 低温型价格 = ¥93
📝 最终型号: AT-DA63-T2 (基础: AT-DA63, 温度: T2)
```

---

## ✅ 验证要点

### SF系列
- [ ] 常温价格不调整
- [ ] 非常温价格上浮5%
- [ ] 型号名称含温度代码
- [ ] 总价包含调整

### AT/GY系列
- [ ] 温度类型决定价格
- [ ] 温度代码影响型号
- [ ] 手轮价格单独计算
- [ ] 价格明细正确

---

## 📊 价格计算示例

### 示例 1: SF + T1

```
基础价格: ¥8,500
温度代码: T1
调整后价格: ¥8,500 × 1.05 = ¥8,925
手轮价格: ¥300
总价: ¥9,225
型号: SF10/C-150DA-T1
```

### 示例 2: AT + T2 + 手轮

```
温度类型: low
基础价格: ¥93 (base_price_low)
温度代码: T2 (仅影响型号)
手轮价格: ¥127
总价: ¥220
型号: AT-DA63-T2
```

---

**详细文档**: 见 `温度代码后端升级完成报告.md`

