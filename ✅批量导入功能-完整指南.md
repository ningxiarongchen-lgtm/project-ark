# 批量导入功能 - 完整指南

## 🎉 功能概述

系统现在支持**两种类型**的批量导入：

1. **执行器数据导入**（AT/GY/SF系列）
2. **产品数据导入**（通用产品）

---

## 📁 支持的文件格式

✅ **.csv** - CSV文件（推荐）  
✅ **.xlsx** - Excel 2007+  
✅ **.xls** - Excel 97-2003  

**文件大小限制：** 最大 10MB

---

## 🔧 功能1: 执行器CSV导入

### 特点
- ✅ **零配置**：直接上传原始CSV，无需修改
- ✅ **自动识别**：自动识别AT/GY或SF系列
- ✅ **JSON解析**：自动处理JSON字段（torque_data, dimensions等）
- ✅ **智能映射**：自动映射字段到数据库

### 支持的CSV格式

#### AT/GY系列
```csv
model_base,series,action_type,base_price_normal,torque_data,dimensions
AT-SR52K8,AT,SR,75,"{""spring_end"":7.7}","{""A"":147}"
```

#### SF系列
```csv
model_base,body_size,cylinder_size,base_price,torque_symmetric
SF10-150DA,SF10,150,1339,"{""0.3_0"":309}"
```

### 必填字段
- ✅ `model_base` - 执行器型号（必填）
- ✅ `series` - 系列名称（AT/GY/SF）（必填）
- ✅ `action_type` - 作用类型（DA/SR）（必填）
- ✅ 价格 - `base_price_normal/low/high` 至少一个（必填）

### 可选字段
- 📋 `torque_data` - JSON扭矩数据（自动解析）
- 📋 `dimensions` - JSON尺寸数据（自动解析）
- 📋 其他所有字段

### 使用步骤

1. **打开导入页面**
   - 导航：系统菜单 → 产品批量导入

2. **选择导入类型**
   - 选择：**执行器数据（AT/GY/SF系列）**

3. **上传CSV文件**
   - 点击"选择文件"
   - 选择您的CSV文件（如 `at_gy_actuators_data_final.csv`）
   - **可选**：勾选"更新重复数据"

4. **开始导入**
   - 点击"开始导入"
   - 等待处理完成

5. **查看结果**
   - 查看成功/失败/跳过统计
   - 查看详细错误信息

### 您的CSV文件
✅ `at_gy_actuators_data_final.csv` - 56条数据  
✅ `sf_actuators_data.csv` - 141条数据  
**总计：197条执行器数据**

---

## 📦 功能2: 产品数据导入

### 特点
- ✅ **灵活验证**：只有型号必填，其他都可选
- ✅ **自动补全**：缺失字段自动使用默认值
- ✅ **模板支持**：提供标准模板下载（可选）

### 必填字段
- ✅ `modelNumber` - 产品型号（**唯一必填**）

### 可选字段（全部！）
- 📋 `description` - 产品描述（默认自动生成）
- 📋 `torqueValue` - 扭矩值
- 📋 `operatingPressure` - 工作压力
- 📋 `basePrice` - 基础价格
- 📋 `series` - 系列（默认：SF-Series）
- 📋 其他所有字段

### CSV示例
```csv
modelNumber,description,torqueValue,operatingPressure,basePrice,series
SF10-200DA,双作用执行器,500,6,1500,SF-Series
AT-SR52K8,,100,5.5,,AT-Series
GY-105SR,高扭矩执行器,,,2000,GY-Series
```

**注意：** 第二行和第三行的部分字段为空也能成功导入！

### 使用步骤

1. **选择导入类型**
   - 选择：**产品数据**

2. **准备CSV文件**（两种方式）
   - **方式A**：下载模板，填写后上传
   - **方式B**：直接准备CSV（只需包含modelNumber列）

3. **上传并导入**
   - 上传您的CSV/Excel文件
   - 点击"开始导入"

4. **查看结果**
   - 系统会显示导入统计和错误详情

---

## 🔄 重复数据处理

### 执行器导入
- **不勾选"更新重复数据"**：跳过已存在的执行器
- **勾选"更新重复数据"**：更新已存在的执行器

### 产品导入
- 自动跳过已存在的产品（基于`modelNumber`）

---

## ⚡ 导入性能

### 预期导入时间
- **小文件**（< 50条）：10-20秒
- **中等文件**（50-200条）：30-60秒
- **大文件**（200-500条）：1-2分钟

### 处理流程
1. 📄 解析文件（CSV/Excel → JSON）
2. 🔍 识别格式（AT/GY/SF/Product）
3. ✨ 数据处理（JSON解析、字段映射）
4. ✅ 验证数据（必填字段检查）
5. 💾 导入数据库（逐条保存）
6. 📊 生成报告

---

## 🐛 常见问题与解决

### Q1: 上传后显示"CSV文件为空"
**原因：** 文件没有数据行或格式错误  
**解决：**
- 确保CSV有标题行和数据行
- 确保文件编码为UTF-8
- 用Excel打开检查是否正常

### Q2: 部分数据导入失败
**原因：** 缺少必填字段  
**解决：**
- **执行器**：确保有 model_base, series, action_type, 价格
- **产品**：确保有 modelNumber（其他都可以空）

### Q3: JSON字段无法解析
**原因：** JSON格式不正确  
**解决：**
- 系统会自动尝试修复（单引号→双引号）
- 如果还失败，该字段将为空，不影响导入
- 示例正确格式：`"{""key"":""value""}"`

### Q4: 导入速度慢
**原因：** 数据量大或网络慢  
**解决：**
- 耐心等待，不要关闭页面
- 建议分批导入（每批200条以内）
- 检查网络连接

### Q5: 重复数据如何处理
**执行器：**
- 不勾选"更新"：跳过，显示在"跳过"列表
- 勾选"更新"：覆盖更新

**产品：**
- 自动跳过，显示在"跳过"列表

---

## 📊 导入结果说明

### 成功统计
- ✅ **成功导入**：数据成功保存到数据库
- ⚠️ **跳过**：重复数据被跳过
- ❌ **失败**：验证或保存失败

### 详细信息
- **错误详情**：列出每个失败行的错误原因
- **跳过详情**：列出被跳过的重复数据
- **行号显示**：方便定位问题（从第2行开始，第1行是标题）

---

## 💡 最佳实践

### 1. 执行器导入
✅ 直接使用原始CSV，不修改  
✅ 确保JSON字段用双引号  
✅ 大文件建议分批导入  
✅ 首次导入不勾选"更新"，检查结果后再决定

### 2. 产品导入
✅ 至少包含modelNumber列  
✅ 其他字段都可以空着  
✅ 建议填写description和basePrice（虽然可选）  
✅ 使用模板可以看到所有可用字段

### 3. CSV文件准备
✅ 使用UTF-8编码  
✅ 第一行必须是列名（英文）  
✅ 不要有空行  
✅ 日期格式：YYYY-MM-DD  
✅ 数字不要加单位（如：100，不是100Nm）

---

## 🎯 立即开始

### 执行器导入
1. 打开系统登录管理员账号
2. 进入"产品批量导入"
3. 选择"执行器数据"
4. 上传 `at_gy_actuators_data_final.csv` 或 `sf_actuators_data.csv`
5. 点击"开始导入"
6. 查看结果

### 产品导入
1. 打开系统登录管理员账号
2. 进入"产品批量导入"
3. 选择"产品数据"
4. （可选）下载模板
5. 上传您的CSV文件
6. 点击"开始导入"
7. 查看结果

---

## 📞 技术支持

### API端点
- **执行器导入**：`POST /api/actuator-management/import-csv`
- **产品导入**：`POST /api/products/import`

### 权限要求
- 管理员（Administrator）
- 技术工程师（Technical Engineer）

### 文件位置
- **后端处理器**：`backend/utils/actuatorCsvProcessor.js`
- **后端控制器**：`backend/controllers/actuatorManagementController.js`
- **前端页面**：`frontend/src/pages/ProductImport.jsx`

---

## ✅ 功能状态

| 功能 | 状态 | 说明 |
|------|------|------|
| 执行器CSV导入 | ✅ 已完成 | 支持AT/GY/SF |
| 产品CSV导入 | ✅ 已完成 | 只需modelNumber |
| JSON自动解析 | ✅ 已完成 | 自动处理 |
| 重复数据处理 | ✅ 已完成 | 可选更新 |
| 详细错误报告 | ✅ 已完成 | 精确到行 |
| 文件格式支持 | ✅ 已完成 | CSV/XLS/XLSX |

---

## 🎉 总结

现在您可以：
- ✅ 直接上传执行器CSV文件（AT/GY/SF）
- ✅ 上传产品CSV文件（只需型号）
- ✅ 所有格式验证已放宽
- ✅ 自动处理所有复杂逻辑

**开始导入您的数据吧！** 🚀

---

**文档创建时间：** 2025-11-03  
**最后更新：** 2025-11-03  
**版本：** 2.0  
**状态：** ✅ 生产就绪

