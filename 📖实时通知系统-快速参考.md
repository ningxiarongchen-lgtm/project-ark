# ğŸ“– å®æ—¶é€šçŸ¥ç³»ç»Ÿ - å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åç«¯ - å‘é€é€šçŸ¥

```javascript
const notificationService = require('../services/notificationService');

// 1. å‘æŒ‡å®šè§’è‰²å‘é€é€šçŸ¥
await notificationService.notifyRole('Production Planner', {
  title: 'æ ‡é¢˜',
  message: 'æ¶ˆæ¯å†…å®¹',
  link: '/target-page',
  type: 'notification_type',
  priority: 'high' // low, medium, high, urgent
});

// 2. å‘å•ä¸ªç”¨æˆ·å‘é€
await notificationService.notifySingleUser(userId, {
  title: 'æ ‡é¢˜',
  message: 'æ¶ˆæ¯',
  link: '/page'
});

// 3. é¢„å®šä¹‰æ–¹æ³•
await notificationService.notifyProjectWon(project);
await notificationService.notifyProductionCompleted(production);
await notificationService.notifyQualityCheckPassed(qc, production);
await notificationService.notifyTicketAssigned(ticket, engineerId);
```

### å‰ç«¯ - ä½¿ç”¨é€šçŸ¥

```javascript
import { useNotificationStore } from '../store/notificationStore';

const {
  notifications,      // é€šçŸ¥åˆ—è¡¨
  unreadCount,       // æœªè¯»æ•°é‡
  fetchNotifications,// è·å–é€šçŸ¥
  markAsRead,        // æ ‡è®°å·²è¯»
  markAllAsRead,     // å…¨éƒ¨å·²è¯»
} = useNotificationStore();
```

## ğŸ“‹ API ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/api/notifications` | è·å–é€šçŸ¥åˆ—è¡¨ |
| GET | `/api/notifications/unread-count` | è·å–æœªè¯»æ•°é‡ |
| GET | `/api/notifications/:id` | è·å–å•ä¸ªé€šçŸ¥ |
| POST | `/api/notifications/:id/mark-read` | æ ‡è®°å·²è¯» |
| POST | `/api/notifications/mark-all-read` | å…¨éƒ¨å·²è¯» |
| DELETE | `/api/notifications/:id` | åˆ é™¤é€šçŸ¥ |
| DELETE | `/api/notifications/clear-read` | æ¸…é™¤å·²è¯» |

## ğŸ¯ å·²é›†æˆçš„ä¸šåŠ¡æµç¨‹

| ä¸šåŠ¡åœºæ™¯ | è§¦å‘äº‹ä»¶ | æ¥æ”¶è§’è‰² | ä¼˜å…ˆçº§ |
|---------|---------|---------|-------|
| é¡¹ç›®èµ¢å• | åˆåŒç­¾ç½²å®Œæˆ | Production Planner | high |
| åˆåŒå®¡æ‰¹ | åˆåŒæäº¤å®¡æ‰¹ | Commercial Engineer | high |
| ç”Ÿäº§å®Œæˆ | æ‰€æœ‰ç‰©æ–™ç”Ÿäº§å®Œæˆ | Quality Inspector | high |
| è´¨æ£€é€šè¿‡ | è´¨é‡æ£€éªŒåˆæ ¼ | Logistics Coordinator | high |
| è´¨æ£€å¤±è´¥ | è´¨é‡æ£€éªŒä¸åˆæ ¼ | Production Planner | urgent |
| å·¥å•åˆ†é… | æœåŠ¡å·¥å•åˆ†é… | æŒ‡å®šå·¥ç¨‹å¸ˆ | high/urgent |

## ğŸ¨ é€šçŸ¥ç±»å‹å’Œä¼˜å…ˆçº§

### é€šçŸ¥ç±»å‹ (type)

```javascript
'project_assigned'      // é¡¹ç›®åˆ†é…
'project_won'           // é¡¹ç›®èµ¢å•
'selection_submitted'   // é€‰å‹æäº¤
'quote_needed'          // éœ€è¦æŠ¥ä»·
'contract_submitted'    // åˆåŒæäº¤
'contract_approved'     // åˆåŒæ‰¹å‡†
'production_needed'     // éœ€è¦ç”Ÿäº§
'bom_shortage'          // ç‰©æ–™çŸ­ç¼º
'purchase_needed'       // éœ€è¦é‡‡è´­
'production_started'    // ç”Ÿäº§å¼€å§‹
'production_completed'  // ç”Ÿäº§å®Œæˆ
'quality_check_needed'  // éœ€è¦è´¨æ£€
'quality_check_passed'  // è´¨æ£€é€šè¿‡
'quality_check_failed'  // è´¨æ£€å¤±è´¥
'delivery_scheduled'    // å‘è´§å®‰æ’
'ticket_assigned'       // å·¥å•åˆ†é…
'ticket_updated'        // å·¥å•æ›´æ–°
'urgent'                // ç´§æ€¥
'info'                  // ä¿¡æ¯
```

### ä¼˜å…ˆçº§ (priority)

| ä¼˜å…ˆçº§ | é¢œè‰² | ä½¿ç”¨åœºæ™¯ |
|-------|------|---------|
| `low` | ç°è‰² | ä¸€èˆ¬ä¿¡æ¯ |
| `medium` | è“è‰² | å¸¸è§„ä»»åŠ¡ |
| `high` | é»„è‰² | é‡è¦ä»»åŠ¡ |
| `urgent` | çº¢è‰² | ç´§æ€¥ä»»åŠ¡ |

## ğŸ”§ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ é€šçŸ¥

```javascript
// 1. å¼•å…¥æœåŠ¡
const notificationService = require('../services/notificationService');

// 2. åœ¨ä¸šåŠ¡é€»è¾‘ä¸­å‘é€é€šçŸ¥
try {
  await notificationService.notifyRole('Role Name', {
    title: 'é€šçŸ¥æ ‡é¢˜',
    message: 'è¯¦ç»†è¯´æ˜',
    link: `/path/${id}`,
    type: 'notification_type',
    priority: 'high',
    relatedEntity: {
      entityType: 'ModelName',
      entityId: document._id
    }
  });
} catch (notifyError) {
  console.error('âš ï¸ å‘é€é€šçŸ¥å¤±è´¥:', notifyError);
  // ä¸ä¸­æ–­ä¸»æµç¨‹
}
```

### åˆ›å»ºè‡ªå®šä¹‰é€šçŸ¥æ–¹æ³•

```javascript
// åœ¨ notificationService.js ä¸­æ·»åŠ 
async notifyCustomEvent(data) {
  return await this.notifyRole('Target Role', {
    title: 'è‡ªå®šä¹‰æ ‡é¢˜',
    message: `è‡ªå®šä¹‰æ¶ˆæ¯: ${data.info}`,
    link: `/custom/${data.id}`,
    type: 'custom_type',
    priority: 'medium',
    relatedEntity: {
      entityType: 'CustomEntity',
      entityId: data._id
    }
  });
}
```

## ğŸ¯ ç”¨æˆ·ç•Œé¢åŠŸèƒ½

### é“ƒé“›ç»„ä»¶åŠŸèƒ½

- âœ… æ˜¾ç¤ºæœªè¯»æ•°é‡çº¢ç‚¹
- âœ… ç‚¹å‡»æŸ¥çœ‹é€šçŸ¥åˆ—è¡¨
- âœ… å®æ—¶æ¥æ”¶æ–°é€šçŸ¥
- âœ… è‡ªåŠ¨å¼¹çª—æé†’

### é€šçŸ¥åˆ—è¡¨æ“ä½œ

- âœ… ç‚¹å‡»é€šçŸ¥è·³è½¬åˆ°ç›®æ ‡é¡µé¢
- âœ… å•ä¸ªé€šçŸ¥æ ‡è®°å·²è¯»
- âœ… å…¨éƒ¨æ ‡è®°å·²è¯»
- âœ… åˆ é™¤å•ä¸ªé€šçŸ¥
- âœ… æ¸…é™¤æ‰€æœ‰å·²è¯»é€šçŸ¥
- âœ… åˆ·æ–°é€šçŸ¥åˆ—è¡¨

### å®æ—¶å¼¹çª—

- âœ… å³ä¸‹è§’è‡ªåŠ¨å¼¹å‡º
- âœ… æ ¹æ®ä¼˜å…ˆçº§æ˜¾ç¤ºä¸åŒé¢œè‰²
- âœ… ç‚¹å‡»è·³è½¬åˆ°ç›®æ ‡é¡µé¢
- âœ… 10ç§’åè‡ªåŠ¨å…³é—­

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥ WebSocket è¿æ¥

```javascript
// æµè§ˆå™¨æ§åˆ¶å°
import { isConnected } from './services/socketService';
console.log('WebSocket è¿æ¥çŠ¶æ€:', isConnected());
```

### æŸ¥çœ‹é€šçŸ¥æ•°æ®

```javascript
// æµè§ˆå™¨æ§åˆ¶å°
import { useNotificationStore } from './store/notificationStore';
const store = useNotificationStore.getState();
console.log('é€šçŸ¥åˆ—è¡¨:', store.notifications);
console.log('æœªè¯»æ•°é‡:', store.unreadCount);
```

### åç«¯æ—¥å¿—

```javascript
// æŸ¥çœ‹é€šçŸ¥å‘é€æ—¥å¿—
console.log('âœ… å·²å‘ X ä½ç”¨æˆ·å‘é€äº†é€šçŸ¥: æ ‡é¢˜');
console.log('ğŸ“¬ Received notification:', notification);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦åœ¨å¾ªç¯ä¸­å‘é€å¤§é‡é€šçŸ¥** - ä¼šå½±å“æ€§èƒ½
2. **ä¼˜å…ˆçº§è¦åˆç†** - é¿å…æ»¥ç”¨ `urgent`
3. **é“¾æ¥è¦æ­£ç¡®** - ç¡®ä¿ link æŒ‡å‘æœ‰æ•ˆé¡µé¢
4. **æ¶ˆæ¯è¦ç®€æ´** - title ç®€æ˜æ‰¼è¦ï¼Œmessage è¡¥å……è¯´æ˜
5. **å¼‚å¸¸å¤„ç†** - é€šçŸ¥å‘é€å¤±è´¥ä¸åº”ä¸­æ–­ä¸»ä¸šåŠ¡æµç¨‹

## ğŸ“ å¸¸è§é—®é¢˜

**Q: é€šçŸ¥æ²¡æœ‰å®æ—¶æ˜¾ç¤ºï¼Ÿ**  
A: æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€ï¼Œç¡®ä¿é“ƒé“›å›¾æ ‡æ˜¯è“è‰²çš„ã€‚

**Q: æœªè¯»æ•°é‡ä¸å‡†ç¡®ï¼Ÿ**  
A: ç‚¹å‡»åˆ·æ–°æŒ‰é’®æˆ–è°ƒç”¨ `fetchUnreadCount()`ã€‚

**Q: é€šçŸ¥å‘é€åæ‰¾ä¸åˆ°ï¼Ÿ**  
A: æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤é€šçŸ¥æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚

**Q: å¦‚ä½•æµ‹è¯•é€šçŸ¥åŠŸèƒ½ï¼Ÿ**  
A: ä½¿ç”¨ä¸¤ä¸ªæµè§ˆå™¨çª—å£ï¼Œåˆ†åˆ«ç™»å½•ä¸åŒè§’è‰²ï¼Œè§¦å‘ä¸šåŠ¡æµç¨‹è§‚å¯Ÿé€šçŸ¥ã€‚

---

**æ›´æ–°æ—¶é—´**: 2025-10-31  
**ç‰ˆæœ¬**: v1.0

